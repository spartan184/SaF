;========================================================;
; MordorKhamul
;========================================================;

ChildObject MordorKhamul MordorNazgul
    SelectPortrait = HPKhamul
    ButtonImage = HIKhamul
    
    Draw = W3DScriptedModelDraw ModuleTag_DRAW1
      OkToChangeModelColor = Yes
      ExtraPublicBone = PASSENGERBONE
      DependencySharedModelFlags = TURN_LEFT_HIGH_SPEED TURN_RIGHT_HIGH_SPEED MOVING ACCELERATE DECELERATE TURN_LEFT TURN_RIGHT ATTACKING BACKING_UP
        
        DefaultModelConditionState
            Model               = MUKhamul_SKN
            Skeleton            = MUNazgul_SKL
            ParticleSysBone     = B_PELVIS RingWraithFlare FollowBone:yes
            ParticleSysBone     = B_PELVIS RingWraithWindIdle FollowBone:yes
        End
        
        ModelConditionState     = MOUNTED ARMORSET_PLAYER_UPGRADE
            Model                = mukhamhrs_skn
            Skeleton             = RUHHs_Theo_SKL
            ParticleSysBone     = BAT_SPINE2 RingWraithFlare FollowBone:yes
            ParticleSysBone     = BAT_SPINE2 RingWraithWindIdle FollowBone:yes
        End
        
        ModelConditionState     = MOUNTED
            Model                = MUKhamul_HRS
            Skeleton             = RUHHs_Theo_SKL
            ParticleSysBone     = BAT_SPINE2 RingWraithFlare FollowBone:yes
            ParticleSysBone     = BAT_SPINE2 RingWraithWindIdle FollowBone:yes
        End
        
        ModelConditionState        = ARMORSET_PLAYER_UPGRADE
            Model               = MUKhamul_HA
            Skeleton            = MUNazgul_SKL
            ParticleSysBone     = B_PELVIS RingWraithFlare FollowBone:yes
            ParticleSysBone     = B_PELVIS RingWraithWindIdle FollowBone:yes
        End
        
        IdleAnimationState
            StateName = Idle            
            Animation           = IDLA
                AnimationName     = MUNazgul_IDLB1
                AnimationMode     = ONCE
                AnimationPriority   = 20
            End            
            Animation           = IDLB
                AnimationName     = MUNazgul_IDLB2
                AnimationMode     = ONCE
                AnimationPriority   = 20
            End      
            Animation           = IDLC
                AnimationName     = MUNazgul_IDLC
                AnimationMode     = ONCE
                AnimationPriority   = 10
            End            
            Animation           = IDLD
                AnimationName     = MUNazgul_IDLD
                AnimationMode     = ONCE
                AnimationPriority   = 10
            End 
            Animation           = IDLE
                AnimationName     = MUNazgul_IDLE
                AnimationMode     = ONCE
                AnimationPriority   = 10
            End             
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
            EndScript            
        End
        
        AnimationState                       = PACKING_TYPE_2 MOUNTED
            StateName                        = SPELL
            Animation                        = SPCC
                AnimationName                = RUHHs_Theo_SPCA
                AnimationSpeedFactorRange    = 0.842 0.842
                AnimationMode                = ONCE
            End        
        End
        
        AnimationState                       = PACKING_TYPE_1 MOUNTED
            StateName                        =    SPELL
            Animation                        =    SPCC
                AnimationName                =    RUHHs_Theo_IDLC
                AnimationSpeedFactorRange    =    0.842 0.842
                AnimationMode                =    ONCE
            End        
        End
        AnimationState                =    FREEFALL MOUNTED
            Animation                =    freefall
                AnimationName        =    RUHHs_Theo_FLYC
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End
        AnimationState                =    STUNNED_FLAILING MOUNTED
            Animation                =    JustDie
                AnimationName        =    RUHHs_Theo_FLYC
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End
        AnimationState                =    DYING SPLATTED MOUNTED
            Animation                =    Land
                AnimationName        =    RUHHs_Theo_LNDA
                AnimationMode        =    ONCE
            End
        End
        AnimationState                =    DYING MOUNTED
            Animation                =    JustDie
                AnimationName        =    RUHHs_Theo_DIEA
                AnimationMode        =    ONCE
            End
        End
        AnimationState                =    STUNNED_STANDING_UP MOUNTED
            Animation                =    StandUp
                AnimationName        =    RUHHs_Theo_GTPA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End
        AnimationState                =    STUNNED MOUNTED
            Animation                =    Land
                AnimationName        =    RUHHs_Theo_LNDA
                AnimationMode        =    ONCE
            End
        End
        AnimationState                =    MOUNTED TURN_LEFT_HIGH_SPEED
            Animation                =    TurnLeft
                AnimationName        =    RUHHs_Theo_TNL1
                AnimationMode        =    LOOP
                AnimationSpeedFactorRange= .75 .75 ;1.8 1.8
                AnimationBlendTime    =    20
            End
        End
        AnimationState                =    MOUNTED TURN_RIGHT_HIGH_SPEED
            Animation                =    TurnLeft
                AnimationName        =    RUHHs_Theo_TNR1
                AnimationMode        =    LOOP
                AnimationSpeedFactorRange= .75 .75 ;1.8 1.8
                AnimationBlendTime    =    20
            End
        End
        AnimationState                =    MOVING TURN_LEFT MOUNTED
            Animation                =    TurnLeft
                AnimationName        =    RUHHs_Theo_TRNL
                AnimationMode        =    LOOP
            End
        End
        AnimationState                =    MOVING TURN_RIGHT MOUNTED
            Animation                =    TurnRight
                AnimationName        =    RUHHs_Theo_TRNR
                AnimationMode        =    LOOP
            End
        End
        AnimationState                =    MOVING ACCELERATE MOUNTED
            Animation                =    Accelerate
                AnimationName        =    RUHHs_Theo_ACCL
                AnimationMode        =    LOOP
            End
        End
        AnimationState                =    MOVING DECELERATE MOUNTED
            Animation                =    Decelerate
                AnimationName        =    RUHHs_Theo_DECL
                AnimationMode        =    ONCE
            End
        End
        AnimationState                =    MOVING WALKING MOUNTED
            Animation                =    Walk
                AnimationName        =    RUHHs_Theo_WLKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End
        AnimationState                =    MOVING BACKING_UP MOUNTED
            Animation                =    BackingUp
                AnimationName        =    RUHHs_Theo_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End
        AnimationState        = MOUNTED MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = MountedRunAndFire
                AnimationName       = RUHHs_Theo_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART  
        End
        AnimationState                =    MOVING MOUNTED
            Animation                =    RunA
                AnimationName        =    RUHHs_Theo_RUNA
                AnimationMode        =    LOOP
            End
             Flags                    =    RANDOMSTART
        End
        AnimationState                =    FIRING_OR_PREATTACK_A MOUNTED
            Animation                =    AttackA
                AnimationName        =    RUHHs_Theo_ATKA
                AnimationMode        =    ONCE
            End
            Animation                =    AttackB
                AnimationName        =    RUHHs_Theo_ATKB
                AnimationMode        =    ONCE
            End
            ParticleSysBone        =    None MeleeDust
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState                =    SELECTED MOUNTED
            SimilarRestart            =   Yes            
            StateName                =    AtAttentionIdle
            Animation                =    ATNB
                AnimationName        =    RUHHs_Theo_IDLH
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
            EndScript
        End
        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =    RUHHs_Theo_ATNA
                AnimationMode        =    ONCE
            End
        End        
        AnimationState                = MOUNTED
            Animation
                AnimationName        =    RUHHs_Theo_IDLA
                AnimationPriority    =    20
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Animation            =    IdleB
                AnimationName        =    RUHHs_Theo_IDLB
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Animation            =    IdleC
                AnimationName        =    RUHHs_Theo_IDLC
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Flags                =    RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState        = STUNNED_FLAILING 
            Flags               = RANDOMSTART
            Animation           = MUNazgul_FLYA
                AnimationName     = MUNazgul_FLYA
                AnimationMode     = LOOP
            End
        End
        AnimationState        = DYING SPLATTED
            Animation           = MUNazgul_LNDA
                AnimationName     = MUNazgul_LNDA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = DYING
            Animation           = MUNazgul_DTHA
                AnimationName     = MUNazgul_DTHA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = STUNNED_STANDING_UP
            Animation           = MUNazgul_GTPA
                AnimationName     = MUNazgul_GTPA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = STUNNED 
            Animation           = MUNazgul_LNDA
                AnimationName     = MUNazgul_LNDA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = PACKING_TYPE_2 
            StateName          =    CaptainPower
            Animation           = MUNazgul_SPCA
                AnimationName     = MUNazgul_SPCA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = MUNazgul_ATRA
                AnimationMode       = LOOP
            End
            ParticleSysBone     = None InfantryDustTrails 
            Flags               = RANDOMSTART  
        End
        AnimationState        = MOVING
            ParticleSysBone     = None InfantryDustTrails 
            Flags               = RANDOMSTART
            Animation           = MUNazgul_RUNA
                AnimationName     = MUNazgul_RUNA
                AnimationMode     = LOOP
            End
            Animation           = MUNazgul_RUNB
                AnimationName     = MUNazgul_RUNB
                AnimationMode     = LOOP
            End
        End
        AnimationState        = FIRING_OR_PREATTACK_A
            StateName           = WithSword
            Animation           = ATKA
                AnimationName     = MUNazgul_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName    = MUNazgul_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKC
                AnimationName    = MUNazgul_ATKC
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            ParticleSysBone     = None MeleeDust
        End
        AnimationState        = ATTACKING
            Animation           = ALERT_1
                AnimationName     = MUNazgul_IDLA
                AnimationMode     = LOOP
            End
        End
        TransitionState                    =    TRANS_Idle_to_Selected
            Animation                    =    ATND
                AnimationName            =    MUNazgul_ATNA
                AnimationMode            =    ONCE
            End
        End
        TransitionState                    =    TRANS_Selected_To_Idle
            Animation                    =    ATNE
                AnimationName            =    MUNazgul_ATNC
                AnimationMode            =    ONCE
            End
        End
        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = MUNazgul_CHRA
                AnimationMode        = ONCE
            End
        End
        AnimationState                =    SELECTED
            StateName                =    Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    MUNazgul_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
            EndScript
        End
        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = MUNazgul_CHRA
                AnimationMode   = Once
            End
            Flags                =    RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState                    = EMOTION_ALERT EMOTION_MORALE_HIGH
            Animation                    = Taunting
                AnimationName            =  MUNazgul_TNTA
                AnimationMode            = ONCE
            End
            Flags                        = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState        = EMOTION_ALERT
            Animation           = ALERT_1
                AnimationName     = MUNazgul_IDLA
                AnimationMode     = LOOP
            End
        End
        AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
                AnimationName = MUNazgul_HITA
                AnimationMode = ONCE
            End
        End        
    End

    CommandSet = MordorKhamulCommandSet
    DisplayName = OBJECT:MordorKhamul
    RecruitText = CONTROLBAR:MordorKhamulRecruit
    ReviveText    = CONTROLBAR:MordorKhamulRevive
    Hotkey        = CONTROLBAR:MordorKhamulHotkey

    ; ===================== Audio Voices =====================
    ;VoiceCreated                = CampOrcCreateNazgul
    ;VoiceFullyCreated           = CampOrcCreateNazgul
    VoiceAttack                 = KhamulVoiceAttack
    VoiceAttack2                = NazgulVoiceAttack
    VoiceAttackCharge           = KhamulVoiceAttackCharge
    VoiceAttackStructure        = KhamulVoiceAttackBuilding
    VoiceFear                   = KhamulVoiceHelpMe
    VoiceMove                   = KhamulVoiceMove
    VoiceMove2                  = NazgulVoiceMove
    VoiceMoveToCamp             = KhamulVoiceMoveCamp
    VoiceMoveWhileAttacking     = KhamulVoiceDisengage
    VoicePriority               = 76
    VoiceSelect                 = KhamulVoiceSelect
    VoiceSelect2                = NazgulVoiceSelect
    VoiceSelectBattle           = KhamulVoiceSelectBattle
    VoiceRetreatToCastle        = KhamulVoiceRetreat
    VoiceGuard                  = NazgulVoiceMove
    SoundCrushing               = RohirrimCrushing        ; Sound made when crushing another unit underhoof
    SoundImpact                 = ImpactHorse 

    UnitSpecificSounds
        VoiceGarrison           = KhamulVoiceMoveGarrison              
    End

    ClientBehavior = ModelConditionSoundSelectorClientBehavior ModuleTag_MCSoundSelector
        SoundState = MOUNTED
            VoiceAttackCharge   = KhamulVoiceAttackCharge 
            VoiceMove           = KhamulVoiceMove 
            VoiceSelect         = KhamulVoiceSelect 
            VoiceSelect2        = NazgulVoiceSelect 
        End
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                = USER_1
        DeathFX                = FX_NazgulDeath
        DeathAnimationTime        = 5133
        InitialSpawnFX            = FX_KhamulInitialSpawn 
        RespawnAnim                = LEVELED
        RespawnFX                = FX_KhamulRespawn
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                = HIKhamul
        RespawnRules =    AutoSpawn:No      Cost:0        Time:60000        Health:100%  
        RespawnEntry =    Level:2            Cost:0        Time:60000       
        RespawnEntry =    Level:3            Cost:0        Time:60000
        RespawnEntry =    Level:4            Cost:0        Time:60000
        RespawnEntry =    Level:5            Cost:0        Time:60000
        RespawnEntry =    Level:6            Cost:0        Time:60000
        RespawnEntry =    Level:7            Cost:0        Time:60000
        RespawnEntry =    Level:8            Cost:0        Time:60000
        RespawnEntry =    Level:9            Cost:0        Time:60000
        RespawnEntry =    Level:10            Cost:0        Time:60000
    End

    ; ---------------------------------------------------------------- ;
    ; ---------------------- Easterling Leadership ---------------------- ;
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_NazgulLeadershipEnabler
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_GenericUpgrade1
    End
    Behavior = SpecialPowerModule ModuleTag_LeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
    End  
    Behavior = AttributeModifierAuraUpdate ModuleTag_KhamulLeadership
        StartsActive    = No
        TriggeredBy        = Upgrade_GenericUpgrade1
        BonusName        = KhamulLeadership
        RefreshDelay    = 2000
        Range            = 200
        AllowPowerWhenAttacking = Yes
        ObjectFilter    = NONE +MordorEasterlingHorde +MordorEasterlingArcherComboHorde
    End

    ; ---------------------------------------------------------------- ;
    ; ---------------------- Negative Leadership ---------------------- ;

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ArmorEnabler
        SpecialPowerTemplate = SpecialAbilityFakeLeadership2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_ArmorUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
    End  
    Behavior = AttributeModifierAuraUpdate ModuleTag_ArmorLeadership
        StartsActive    = No
        TriggeredBy        = Upgrade_GenericUpgrade2
        BonusName        = KhamulNegativeLeadership
        RefreshDelay    = 2000
        Range            = 200
        AllowPowerWhenAttacking = Yes
        TargetEnemy = Yes
        ObjectFilter    = ANY -INFANTRY +CAVALRY -MONSTER -STRUCTURE -BASE_FOUNDATION  -HERO
    End
    ; ---------------------------------------------------------------- ;

End
