;------------------------------------------------------------------------------
; aka Uruk Hai, IsengardUrukHai, FighterIsengard, UrukWarrior, UrukFighter, UrukHaiWarrior, UrukHaiFighter, UrukSwordman
Object IsengardDunlandHuskarl
  ; *** ART Parameters ***

  ; This is required for garrisoned objects - please put in all objects.
  Scale		= 1.05
	SelectPortrait         = UpHuskarl
	ButtonImage         = uihuskarl

	Draw = W3DScriptedModelDraw ModuleTag_DRAW
		OkToChangeModelColor = Yes
		StaticModelLODMode = yes
		DefaultModelConditionState
			Model               = iunhuskarl_skn
		End
		ModelConditionState = USER_1 ;WEAPONSET_TOGGLE_1
			Model               = iuNhuskarlM_skn	
		End
		AnimationState        = PACKING_TYPE_2
			StateName		  =	CaptainPower
			Animation           = GUFaramir_CHRC
				AnimationName     = GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
		End
		AnimationState        = STUNNED_FLAILING
			StateName           = STATE_Sword
			Animation           = GUFaramir_FLYB
				AnimationName     = GUFaramir_SKL.GUFaramir_FLYB
				AnimationMode     = LOOP
				AnimationSpeedFactorRange	= 0.4 0.6
			End
			Flags               = RANDOMSTART
		End
		AnimationState        = DYING SPLATTED
			StateName           = STATE_Sword
			Animation           = GUFaramir_LNDB
				AnimationName     = GUFaramir_SKL.GUFaramir_LNDB
				AnimationMode     = ONCE
			End
		End
		AnimationState        = DYING DEATH_2
			StateName           = DEATH_2
			Animation					= ATNE
				AnimationName			= GUFaramir_SKL.iunhuskarl_atnb
				AnimationMode			= LOOP
				AnimationBlendTime		= 15
			End
		End		
		AnimationState        = DYING
			StateName           = STATE_Sword
			Animation           = GUFaramir_DIEA
				AnimationName     = GUFaramir_SKL.GUFaramir_DIEA
				AnimationMode     = ONCE
			End
			Animation           = GUFaramir_DIEB
				AnimationName     = GUFaramir_SKL.GUFaramir_DIEB
				AnimationMode     = ONCE
			End
		End
		AnimationState        = STUNNED_STANDING_UP
			StateName           = STATE_Sword
			Animation           = GUFaramir_GTPB
				AnimationName     = GUFaramir_SKL.GUFaramir_GTPB
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End
		AnimationState        = STUNNED
			StateName           = STATE_Sword
			Animation           = GUFaramir_LNDB
				AnimationName     = GUFaramir_SKL.GUFaramir_LNDB
				AnimationMode     = ONCE
			End
		End	
		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			Animation           = TrotAndFire
				AnimationName       = GUFaramir_SKL.GUFaramir_ATRA
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART
			StateName = RunAndSwing
		End
		AnimationState        = FIRING_OR_PREATTACK_A
			StateName           = STATE_Sword
			Animation           = iunhuskarl_atka
				AnimationName     = GUFaramir_SKL.iunhuskarl_atka
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 1.149 1.149
			End
			Animation           = iunhuskarl_atkb
				AnimationName    = GUFaramir_SKL.iunhuskarl_atkb
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 1.149 1.149
			End
			Animation           = iunhuskarl_atkc
				AnimationName    = GUFaramir_SKL.iunhuskarl_atkc
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.47 1.47
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			Animation           = gudundan_rune
				AnimationName   = GUFaramir_SKL.gudundan_rune
				AnimationSpeedFactorRange = 0.85 0.85
				Distance		= 28
			End
			Animation           = gudundan_runa
				AnimationName   = GUFaramir_SKL.gudundan_runa
				AnimationSpeedFactorRange = 0.85 0.85
				Distance		= 28
			End
			Animation           = iunhuskarl_runa
				AnimationName   = GUFaramir_SKL.iunhuskarl_runa
				AnimationSpeedFactorRange = 0.85 0.85
				Distance		= 28
			End			
		End
		AnimationState        = ATTACKING
			StateName           = STATE_Sword
			Animation           = ATKD
				AnimationName     = GUFaramir_SKL.GUFaramir_IDLA
				AnimationMode     = MANUAL
			End			
		End
		AnimationState = EMOTION_ALERT HIT_REACTION
			Animation = Hit_Level_1_d
				AnimationName = GUFaramir_SKL.GUFaramir_HITD
				AnimationMode = ONCE
			End
		End
		AnimationState = HIT_REACTION
			Animation = Hit_Level_1_b
				AnimationName = GUFaramir_SKL.GUFaramir_HITB
				AnimationMode = ONCE
			End
		End
		AnimationState				= LEVELED
			Animation				= LevelUp
				AnimationName		= GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode		= ONCE
			End
		End
		AnimationState				=	EMOTION_CELEBRATING
			Animation
				AnimationName		=	GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode		=	LOOP
			End
		End
		AnimationState				=	EMOTION_TAUNTING
			Animation
				AnimationName		=	GUFaramir_SKL.GUFaramir_TNTC
				AnimationMode		=	ONCE
			End
			Animation
				AnimationName		=	GUFaramir_SKL.GUFaramir_TNTD
				AnimationMode		=	ONCE
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
		End
		AnimationState				=	EMOTION_ALERT
			StateName				=	STATE_READY
			Animation				=	ready
				AnimationName		=	GUFaramir_SKL.GUFaramir_IDLA
				AnimationMode		=	LOOP
				AnimationBlendTime	=	20
			End
		End
		AnimationState				=	SELECTED 
			StateName					= STATE_Selected_Sword
			Animation					= ATNE
				AnimationName			= GUFaramir_SKL.iunhuskarl_atnb
				AnimationMode			= LOOP
				AnimationBlendTime		= 15
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedSword") return end
			EndScript
		End
		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation           		= iunhuskarl_idla
				AnimationName       	= GUFaramir_SKL.iunhuskarl_idla
				AnimationMode       	= ONCE
				AnimationPriority	    = 20
				AnimationBlendTime		= 10
			End
			Animation           		= iunhuskarl_idlb
				AnimationName       	= GUFaramir_SKL.iunhuskarl_idlb
				AnimationMode       	= ONCE
				AnimationPriority	    = 10
				AnimationBlendTime		= 10				
			End
			Animation           		= iunhuskarl_idlc
				AnimationName       	= GUFaramir_SKL.iunhuskarl_idlc
				AnimationMode       	= ONCE
				AnimationPriority	    = 10
				AnimationBlendTime		= 10				
			End
			Animation           		= iunhuskarl_idld
				AnimationName       	= GUFaramir_SKL.iunhuskarl_idld
				AnimationMode       	= ONCE
				AnimationPriority	    = 10
				AnimationBlendTime		= 10				
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
			EndScript
		End
		TransitionState = TRANS_BoredToSelectedSword
			Animation = ANTD
				AnimationName		= GUFaramir_SKL.iunhuskarl_atna
				AnimationMode		= ONCE
			End		
		End
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= GUFaramir_SKL.iunhuskarl_atna
				AnimationMode	= ONCE_BACKWARDS
			End
			Flags 				= START_FRAME_LAST			
		End	
	End

    ; ***DESIGN parameters ***
    Side = Isengard
    EditorSorting = UNIT
    ThreatLevel = 2.0
    ThingClass = HORDE_UNIT
    EmotionRange = 240
    CommandPoints = 5
    CommandSet = IsengardDunlandHuskarlCommandSet
    TransportSlotCount = 1

    VisionRange = M_ISENGARD_DUNLAND_HUSKARL_VISION_RANGE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD

    BountyValue = M_ISENGARD_DUNLAND_HUSKARL_BOUNTY_VALUE
    DisplayName = OBJECT:IsengardDunlandHuskarl
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
    CrusherLevel = 0 ;What can I crush?: 0 = fluffy bunnies, 1 = infantry, 2 = trees, 3 = vehicles
    CrushRevengeWeapon = BasicInfantryCrushRevenge

    WeaponSet
        Conditions          = None 
        Weapon              = PRIMARY    HuskarlSword
        AutoChooseSources   = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
		Conditions			= WEAPONSET_TOGGLE_1
		Weapon				= PRIMARY	HuskarlSwordMordhau	;AngmarSwordUpgraded
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	WeaponSet
		Conditions          = PLAYER_UPGRADE
		Weapon              = PRIMARY HuskarlsRecklessSwings
		AutoChooseSources   = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End	
    ArmorSet
        Conditions      = None
        Armor           = HuskarlArmor
        DamageFX        = NormalDamageFX
    End

    BuildFadeInOnCreateTime = 0 ; 2  ;temporarily set to 0
    

  ; *** AUDIO Parameters ***;

    VoiceAttack					        = HuskarlVoiceAttack
	VoiceAttackCharge				    = HuskarlVoiceAttackCharge
	VoiceAttackMachine			        = HuskarlVoiceAttack
	VoiceAttackStructure			    = HuskarlVoiceAttackBuilding
	VoiceEnterStateAttack			    = HuskarlVoiceEnterStateAttack
	VoiceEnterStateAttackCharge		    = HuskarlVoiceEnterStateAttackCharge
	VoiceEnterStateAttackMachine	    = HuskarlVoiceEnterStateAttackBuilding
	VoiceEnterStateAttackStructure	    = HuskarlVoiceEnterStateAttack
	VoiceCreated				        = HuskarlVoiceSalute
	VoiceFullyCreated 			        = HuskarlVoiceSalute
	VoiceGuard					        = HuskarlVoiceMove
	VoiceMove					        = HuskarlVoiceMove
	VoiceMoveToCamp				        = HuskarlVoiceMoveCamp
	VoiceMoveWhileAttacking			    = HuskarlVoiceDisengage
	VoicePriority				        = 53
	VoiceRetreatToCastle			    = HuskarlVoiceRetreat
	VoiceSelect					        = HuskarlVoiceSelect
	VoiceSelectBattle 			        = HuskarlVoiceSelectBattle
	VoiceEnterStateMove			        = HuskarlVoiceEnterStateMove
	VoiceEnterStateMoveToCamp		    = HuskarlVoiceEnterStateMoveCamp
	VoiceEnterStateMoveWhileAttacking	= HuskarlVoiceEnterStateDisengage
	VoiceEnterStateRetreatToCastle	    = HuskarlVoiceEnterStateRetreat

	SoundImpact					        = ImpactHorse

	UnitSpecificSounds
		VoiceGarrison						= HuskarlVoiceGarrison
		;VoiceInitiateCaptureBuilding		= HuskarlVoiceMove
	End

    EvaEventDamagedOwner            = UnitUnderAttack         ;Eva event to trigger when unit is damaged

	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
		Key = Humanoid_Male Man Man_Male Unit Infantry Gondor_Soldier
	End
	
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		;AnimationSound = Sound: TauntHumanHitShield	Animation:GUMAArms_SKL.GUManMocap_IDLC	Frames: 17 27
		;AnimationSound = Sound: TauntHumanHitShield	Animation:GUMAArms_SKL.GUManMocap_TNTC	Frames: 74 82 94 125 139

		;AnimationSound = Sound:BodyFallGeneric1		Animation:GUMAArms_SKL.GUManMocap_DIEB	Frames:89
		;AnimationSound = Sound:BodyFallGeneric1		Animation:GUMAArms_SKL.GUManMocap_DIEC	Frames:71
		;AnimationSound = Sound:BodyFallGeneric1		Animation:GUMAArms_SKL.GUManMocap_DIED	Frames:29
		;AnimationSound = Sound:BodyFallGeneric1		Animation:GUMAArms_SKL.GUManMocap_DIEE	Frames:28
		;AnimationSound = Sound:BodyFallGeneric1		Animation:GUMAArms_SKL.GUMAARMS_LNDA	Frames:0
	End

    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE CAN_USE_SIEGE_TOWER GRAB_AND_DROP
     
    Body = ActiveBody ModuleTag_02
        CheerRadius             = M_EMOTION_CHEER_RADIUS
        MaxHealth               = M_ISENGARD_DUNLAND_HUSKARL_HEALTH              
        MaxHealthDamaged        = M_ISENGARD_DUNLAND_HUSKARL_HEALTH_DAMAGED               
        CheerRadius             = M_EMOTION_CHEER_RADIUS
    End
        
    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        AILuaEventsList               = DunlandHuskarlFunctions
        MoodAttackCheckRate           = 500
        AttackPriority                = AttackPriority_Infantry
    End

    LocomotorSet
        Locomotor     = HumanLocomotor
        Condition     = SET_NORMAL
        Speed         = 55        
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime        = 2533    ;msec
    End
 
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL 
        SinkDelay = 3000
        SinkRate = 0.40     ; in Dist/Sec
        DestructionDelay = 8000
        Sound = INITIAL HuskarlVoiceDie
    End
    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes = NONE +FADED
		FadeDelay = 0
		FadeTime = 5000
		DestructionDelay = 5000 
		DeathFlags = DEATH_2
		;Sound = INITIAL SpellGenericUnsummonFasterMS
	End
    Behavior = SlowDeathBehavior ModuleTag_07
		DeathTypes = NONE +KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.60     // in Dist/Sec
		DestructionDelay = 10000
	End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
		TriggeredBy         = Upgrade_GondorFighterFearless
		AttributeModifier   = FearlessForever
	End
 
	Behavior = WeaponSetUpgrade ModuleTag_RecklessSwings
		TriggeredBy		        = Upgrade_GenericUpgrade3
		;WeaponCondition		    = WEAPONSET_TOGGLE_2
	End

    ;-----------------------------------------------------------------------------
	;	Mordhau Grip
	;-----------------------------------------------------------------------------	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MordhauGripEnabler
		SpecialPowerTemplate 		= SpecialAbilityHuskarlMordhauGrip
		TriggeredBy 				= Upgrade_GenericUpgrade1
	End	
	Behavior = SpecialPowerModule ModuleTag_MordhauGripSpecialPower                      
		SpecialPowerTemplate		= SpecialAbilityHuskarlMordhauGrip
		StartsPaused				= Yes
	End
	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_MordhauGripUpdate
		SpecialPowerTemplate		= SpecialAbilityHuskarlMordhauGrip
		Duration					= 20000
		WeaponSetFlags				= WEAPONSET_TOGGLE_1
		StartsPaused				= Yes
		AttributeModifier			= DunlandMordhauGrip
	End

    Behavior = SquishCollide ModuleTag_06
    End
  
    Behavior = HordeMemberCollide ModuleTag_HMC
    End
 
    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2860 ; level 1 (light  damage)  hit reaction animations in ms
        HitReactionLifeTimer2 = 3000 ; level 2 (medium damage)  hit reaction animations in ms

        HitReactionThreshold1 = 0.0   ; level 1 (light  damage) threshold trigger
        HitReactionThreshold2 = 50.0  ; level 2 (medium damage) threshold trigger
    End
  
  Geometry = CYLINDER
  GeometryMajorRadius = 8.0
  GeometryMinorRadius = 8.0
  GeometryHeight = 19.2
  GeometryIsSmall = Yes

  Shadow = SHADOW_DECAL
  ShadowSizeX = 21;
  ShadowSizeY = 21;
  ShadowTexture = ShadowI;
End

 Object HuskarlsRecklessEgg
	
	Draw = W3DScriptedModelDraw ModuleTag_Draw		
		DefaultModelConditionState
			Model = None
		End
	End
	
	KindOf = INERT IMMOBILE UNATTACKABLE
	
	Body = ActiveBody ModuleTag_MakesKillWork
		MaxHealth = 1
	End
	
	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
		MinLifetime = 5000
		MaxLifetime = 5000
	End
	
	Behavior = AttributeModifierAuraUpdate ModuleTag_GrimResolve
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HuskarlRecklessModifier
		RefreshDelay	= 1000
		Range			= 10
		ObjectFilter	= NONE +IsengardDunlandHuskarl
	End	
	
End

ChildObject IsengardDunlandHuskarl_Summoned IsengardDunlandHuskarl
	IsTrainable = No
	CommandPoints = 0
	EquivalentTo = IsengardDunlandHuskarl
	KindOf = +SUMMONED
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= 75000
		MaxLifetime		= 75000
		DeathType		= FADED
	End	
End