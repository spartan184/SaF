;------------------------------------------------------------------------------
Object GundabadSnowTroll ;(GundabadStoneTroll - I haven't changed all the references yet, getting there...)
  ; *** ART Parameters ***

    ; This is required for garrisoned objects - please put in all objects.
    ButtonImage        = BIGundStoneTroll
    SelectPortrait    = UPGundStoneTroll

	Draw = W3DScriptedModelDraw ModuleTag_01
	
	WadingParticleSys = EntRipples
	OkToChangeModelColor = Yes

	ExtraPublicBone				= TRUNK01
    ExtraPublicBone				= FIREPOINT01
    ExtraPublicBone             = ROCK

	DefaultModelConditionState
		Model = wustroll_skn
		WeaponLaunchBone = PRIMARY FIREPOINT01
	End
	
    IdleAnimationState
        StateName = STATE_Idle
        Animation = Breathe
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLA 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 40
        End
        Animation = BellyScratch
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLC 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Animation = RubHead
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLK 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Animation = LittleRoar
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLM 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 3
        End
        Animation = WipeNose
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLN 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Flags                        = RESTART_ANIM_WHEN_COMPLETE    
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Mace" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript    
    End

    ; Splatted death goes first, independant of death flags
    ModelConditionState    = DYING DECAY SPLATTED
        Model                = MUCavTroll_DISA
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY SPLATTED 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISA.MUCavTroll_DISA
            AnimationMode      = ONCE
        End
    End

    ModelConditionState    = DYING DECAY DEATH_1
        Model                = MUCavTroll_DISB
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY DEATH_1 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISB.MUCavTroll_DISB
            AnimationMode      = ONCE
        End
    End

    ModelConditionState    = DYING DECAY DEATH_2
        Model                = MUCavTroll_DISC
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY DEATH_2 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISC.MUCavTroll_DISC
            AnimationMode      = ONCE
        End
    End

    ; Flailing must go before dying in case we are dead in the air
    AnimationState = STUNNED_FLAILING
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_FLYA
            AnimationMode = LOOP
        End
    End

    ;;; DYING ANIMATIONS ;;;    
    AnimationState = DYING SPLATTED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_LNDA
            AnimationMode = ONCE
        End
    End

    AnimationState = DYING DEATH_1
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_DIEB
            AnimationMode = ONCE
        End

            ParticleSysBone = B_PELVIS TrollSplatDust
            ParticleSysBone = BAT_HEAD TrollSplatDust
    End

    AnimationState = DYING DEATH_2
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_DIEC
            AnimationMode = ONCE
        End

            ParticleSysBone = BAT_SPINE1 TrollSplatDust1
            ParticleSysBone = BAT_HEAD TrollSplatDust1
    End

    AnimationState = DYING
        Animation
            AnimationName     =  MuCavTroll_SKL.MuCavTroll_DIEC
            AnimationMode     = ONCE
        End
    End
            
    AnimationState                = STUNNED_STANDING_UP
        Animation                = MuCavTroll_GTPA
            AnimationName        = MuCavTroll_SKL.MuCavTroll_GTPA
            AnimationMode        = ONCE
        End
    End    

    AnimationState                = STUNNED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_LNDA
            AnimationMode = ONCE
        End
        ParticleSysBone = B_PELVIS TrollSplatDust2
        ParticleSysBone = BAT_HEAD TrollSplatDust2
    End
    
    ;;; PASSENGER OF SIEGE TOWER ANIMS ;;;
    AnimationState = PASSENGER MOVING BACKING_UP; pulling the seige tower or grond
            Animation = Passenger_moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_PSHA ; MuCavTroll_PSHA
            AnimationMode = LOOP_BACKWARDS
            AnimationSpeedFactorRange = 2.0 2.0
        End
        Flags = RANDOMSTART
    End

    AnimationState = PASSENGER MOVING ; pushing the seige tower
            Animation = Passenger_moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_PSHA
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
        End
        Flags = RANDOMSTART
    End

    AnimationState = PASSENGER ; idling by the grond
        Animation = Passenger
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLD
            AnimationMode = LOOP
            AnimationBlendTime = 15
        End
        Flags = RANDOMSTART
    End

    ;--- bop our friends on the head
    AnimationState = SPECIAL_WEAPON_ONE
        Animation = Punch
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKF
            AnimationMode = ONCE
        End
        Animation = Backhand
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKG
            AnimationMode = ONCE
        End            
    End
                
    ;--Troll is angry
    AnimationState = WEAPONSET_RAMPAGE
        Animation = GetMad
                AnimationName = MuCavTroll_SKL.MuCavTroll_RPGC
                AnimationMode = LOOP
            End
        End

    ; --------- With Club ------------

; --------- With Rock or Infantry ------------

    AnimationState = MOVING WEAPONSET_TOGGLE_1 USER_1
		Animation
			AnimationName = MuCavTroll_SKL.MuCavTroll_RUNA 
			AnimationMode = LOOP
            AnimationSpeedFactorRange = 0.77 0.77
			;Distance		= 120
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
		;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
		;FXEvent    = Frame:17 Name:FX_TrollLeftFootStep
		BeginScript
			CurDrawableShowSubObject("ROCK")
		EndScript
	End

    AnimationState = MOVING WEAPONSET_TOGGLE_1 ATTACKING
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_RUNA 
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 0.77 0.77
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:18 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING WEAPONSET_TOGGLE_1 DAMAGED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB 
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.3 1.3
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING WEAPONSET_TOGGLE_1
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKD
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.36 1.36
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:16 Name:FX_TrollLeftFootStep
    End
        
        AnimationState = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1			; throw rock
			StateName = Throw
			Animation
				AnimationName		= MuCavTroll_SKL.MuCavTroll_THRA
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
                ;AnimationSpeedFactorRange = 0.5 0.5
			End
			FrameForPristineBonePositions = 10 ;21 ;24
		End

		AnimationState = RELOADING_A WEAPONSET_TOGGLE_1						; Pickup rock.
			Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
		End

    AnimationState                    = CONTINUOUS_FIRE_MEAN
        StateName                    =    STATE_Coasting
        Animation                    =    HangFrameWhileCoasting
            AnimationName            =    MuCavTroll_SKL.MuCavTroll_THRA
            AnimationMode            =    MANUAL
        End
    End

    ; Normal fist attacks
    AnimationState = FIRING_OR_PREATTACK_A
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKA
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKE
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
    End

    ;Building attack, which you can do with a rock in yo hand
    AnimationState = FIRING_OR_PREATTACK_B
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKJ
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
    End


    AnimationState = TURN_LEFT
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_TRNL
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        ParticleSysBone = None InfantryDustTrails
    End

    AnimationState = TURN_RIGHT
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_TRNR
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        ParticleSysBone = None InfantryDustTrails
    End

    AnimationState = MOVING ATTACKING
        Animation = Charging
            AnimationName = MuCavTroll_SKL.MuCavTroll_RUNB
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 0.8 0.8
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:18 Name:FX_TrollLeftFootStep
    End
        
    AnimationState                = MOVING PANICKING
        Animation                = RUNM
            AnimationName        =  MuCavTroll_SKL.MuCavTroll_MFDA
            AnimationMode        = LOOP
        End
        Flags                    = RANDOMSTART
    End
    
    AnimationState = MOVING DAMAGED
        Animation = Moving_Damaged
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB
            AnimationMode = LOOP
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING USER_1
		Animation = Charging
			AnimationName = MuCavTroll_SKL.MuCavTroll_RUNB
			AnimationMode = LOOP
			Distance		= 120
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
		;FXEvent    = Frame:6 Name:FX_TrollRightFootStep
		;FXEvent    = Frame:17 Name:FX_TrollLeftFootStep
		BeginScript
			CurDrawableHideSubObject("ROCK")
		EndScript
	End

    AnimationState = MOVING
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = ENGAGED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLA
            AnimationMode = LOOP
        End
    End
    
; --------- Just built ------------
        
    AnimationState = JUST_BUILT
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKC ; temp
            AnimationMode = ONCE
            AnimationBlendTime = 0
            AnimationSpeedFactorRange = 0.9 0.9            
        End    
    End    

; --------- Click and Hit Reactions ------------
        
    AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITD
            AnimationMode = ONCE
            End
    End

    AnimationState = HIT_REACTION HIT_LEVEL_2
            Animation = Hit_Level_2
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITC
            AnimationMode = ONCE
            End
    End

    AnimationState = HIT_REACTION HIT_LEVEL_3
            Animation = Hit_Level_3
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITA
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_1
            Animation = Click_React_1
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTA
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_2
            Animation = Click_React_2
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTB
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_3
            Animation = Click_React_3
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTC
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_4
            Animation = Click_React_4
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTD
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_5
            Animation = Click_React_5
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTE
            AnimationMode = ONCE
            End
    End
    
    AnimationState = USER_2
        Animation = ReactToTrollPoke ; The two comes from the special TrollBored weapon
            AnimationName = MuCavTroll_SKL.MuCavTroll_HITA
            AnimationMode = ONCE
        End
    End

        AnimationState = ENGAGED WEAPONSET_TOGGLE_1
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
        End

;-----------------------------------
;Emotion

    AnimationState = EMOTION_CELEBRATING
        Animation
            AnimationName    =    MuCavTroll_SKL.MuCavTroll_IDLF
            AnimationMode    =    LOOP
        End
    End

    AnimationState = WEAPONSET_TOGGLE_1
            StateName = STATE_IdleRock
            Animation = Breathe
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLB 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 40
            End
            Animation = BellyScratch
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLG 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 10
            End
            Animation = RubHead
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLF 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 10
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE     
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToMace") end
            EndScript
        End

    ;------------------ Troll Rock Transitions ------------------------

        
        TransitionState       = TRANS_SelectedToMace
            Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
        End
        TransitionState       = TRANS_SelectedToIdle
            Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE_BACKWARDS
			End
			;FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			;FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
        End
        AnimationState        = SELECTED WEAPONSET_TOGGLE_1
            StateName           = STATE_Mace
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToMace") end
            EndScript
        End      
        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Mace" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

  End


	; ***DESIGN parameters ***
	Side = Gundabad
	IsTrainable        = Yes
	EditorSorting = UNIT
	ThreatLevel = 2.0
	TransportSlotCount = 1
	ShowHealthInSelectionDecal = Yes
	VisionRange = 400 ;M_VISION_ENT
	ShroudClearingRange = 400 ;M_SHROUD_CLEAR_ENT
	MaxSimultaneousOfType = 5
	ImmuneToShockwave = Yes

	BuildCost = SAF_GUNDABAD_SNOWTROLL_BUILDCOST
	BuildTime = SAF_GUNDABAD_SNOWTROLL_BUILDTIME
    
	CommandPoints = 20

    WeaponSet
        Conditions          =  None
        Weapon              =  PRIMARY    GundabadSnowTrollPunch
        Weapon              =  SECONDARY  GundabadSnowTrollBash
        OnlyAgainst         =  SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources 	=  PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions          =  WEAPONSET_TOGGLE_1
        Weapon              =  PRIMARY    StoneTrollRockFromThinAir
        PreferredAgainst    =  PRIMARY    STRUCTURE BLOCKING_GATE
        AutoChooseSources 	=  PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
	
	WeaponSet
		Conditions          = RAMPAGE
		Weapon              = PRIMARY  GundabadSnowTrollRampage
	End

    WeaponSet
		Conditions          = RAMPAGE WEAPONSET_TOGGLE_1
		Weapon              = PRIMARY  GundabadSnowTrollRampage
	End
	
	ArmorSet
		Conditions      = None
		Armor           = TrollArmor
		DamageFX        = NormalDamageFX
	End
    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SnowTrollHeavyArmor
        DamageFX        = NormalDamageFX
    End

	BountyValue = SAF_GUNDABAD_SNOWTROLL_BOUNTY_VALUE
	DisplayName = OBJECT:GundabadSnowTroll
	
	CrushableLevel = 2  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CrusherLevel = 2 ;What can I crush?: 0 = small animals, 1 = infantry, 2 = trees, 3 = vehicles
	UseCrushAttack = No  ; Don't attack using crush, just crush when you walk through. 
	CrushWeapon = TrollCrush
	CrushKnockback = 40
	CrushZFactor = 1.0

	CommandSet = GundabadSnowTrollCommandSet

    ; *** AUDIO Parameters ***;

    VoiceAttack            = TrollVoiceAttack
    VoiceAttackCharge        = TrollVoiceAttack
    VoiceAttackMachine    = TrollVoiceAttack
    VoiceAttackStructure    = TrollVoiceAttack
    VoiceCreated        = CampOrcCreateMountainTroll
    VoiceFullyCreated     = CampOrcCreateMountainTroll
    VoiceGuard            = TrollVoiceMove
    VoiceMove            = TrollVoiceMove
    VoiceMoveToCamp        = TrollVoiceMove
    VoiceMoveWhileAttacking    = TrollVoiceMove
    VoicePriority        = 19
    VoiceSelect            = TrollVoiceSelect
    VoiceSelectBattle     = TrollVoiceSelect

    SoundImpact            = ImpactHorse        ;TrollDie

	EvaEventDamagedOwner        = UnitUnderAttack         ;Eva event to trigger when unit is damaged

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
		AnimationSound = Sound:TrollBodyfall		Animation:MUCavTroll_SKL.MUCavTroll_DieB Frames:33
		AnimationSound = Sound:TrollBodyfall		Animation:MUCavTroll_SKL.MUCavTroll_DieC Frames:84
		AnimationSound = Sound:TrollBodyfall		Animation:MUCavTroll_SKL.MUCavTroll_LndA Frames:3 21
		AnimationSound = Sound:TrollIdleRubHeadVox	Animation:MUCavTroll_SKL.MUCavTroll_IDLK Frames:0
		AnimationSound = Sound:TrollBodyfall		Animation:MUCavTroll_SKL.MUCavTroll_RCTB Frames:3

		AnimationSound = Sound:TrollRoar Animation:MUCavTroll_SKL.MUCavTroll_IDLE Frames:10 Animation:MUCavTroll_SKL.MUCavTroll_IDLG Frames:78 Animation:MUCavTroll_SKL.MUCavTroll_IDLK Frames:0 Animation:MUCavTroll_SKL.MUCavTroll_IDLM Frames:0 Animation:MUCavTroll_SKL.MUCavTroll_ATKA Frames:12 Animation:MUCavTroll_SKL.MUCavTroll_ATKC Frames:17 Animation:MUCavTroll_SKL.MUCavTroll_ATKD Frames:10 Animation:MUCavTroll_SKL.MUCavTroll_ATKE Frames:14 Animation:MUCavTroll_SKL.MUCavTroll_ATKF Frames:3 Animation:MUCavTroll_SKL.MUCavTroll_ATKG Frames:13 Animation:MUCavTroll_SKL.MUCavTroll_HITC Frames:21 Animation:MUCavTroll_SKL.MUCavTroll_HITD Frames:10 Animation:MUCavTroll_SKL.MUCavTroll_MFDA Frames:47 Animation:MUCavTroll_SKL.MUCavTroll_RCTD Frames:29 Animation:MUCavTroll_SKL.MUCavTroll_RCTE Frames:53 Animation:MUCavTroll_SKL.MUCavTroll_RPGC Frames:0 32 59 88
		AnimationSound = Sound:TrollIdleYell01 Animation:MUCavTroll_SKL.MUCavTroll_IDLF Frames:37
		AnimationSound = Sound:TrollTreeShakeYell Animation:MUCavTroll_SKL.MUCavTroll_GRBA Frames:14  Animation:MUCavTroll_SKL.MUCavTroll_GRBB Frames:12 
		AnimationSound = Sound:TrollTreeShakeYell Animation:MUCavTroll_SKL.MUCavTroll_GRBC Frames:26  Animation:MUCavTroll_SKL.MUCavTroll_GRBD Frames:28 
		AnimationSound = Sound:TrollFootstep Animation:MUCavTroll_SKL.MUCavTroll_RUNA Frames:4 17  Animation:MUCavTroll_SKL.MUCavTroll_RUNB Frames:4 17  Animation:MUCavTroll_SKL.MUCavTroll_WLKA Frames:0 15  Animation:MUCavTroll_SKL.MUCavTroll_WLKB Frames:0 20  Animation:MUCavTroll_SKL.MUCavTroll_WLKD Frames:0 22 Animation:MUCavTroll_SKL.MUCavTroll_TRNL Frames:15 27 Animation:MUCavTroll_SKL.MUCavTroll_TRNR Frames:15 27 Animation:MUCavTroll_SKL.MUCavTroll_RCTD Frames:7 66 Animation:MUCavTroll_SKL.MUCavTroll_GTPA Frames:12 80 97 Animation:MUCavTroll_SKL.MUCavTroll_MFDA Frames:4 17 29 42 
		AnimationSound = Sound:TrollFootstepRampage Animation:MUCavTroll_SKL.MUCavTroll_RPGC Frames:43 61 77 93 100 116 123 139 149
		AnimationSound = Sound:TrollTreeSwingLight Animation:MUCavTroll_SKL.MUCavTroll_IDLE Frames:49 Animation:MUCavTroll_SKL.MUCavTroll_RPGC Frames:112 ;Animation:MUCavTroll_SKL.MUCavTroll_THPA Frames:16 Animation:MUCavTroll_SKL.MUCavTroll_MFDA Frames:2 22
		AnimationSound = Sound:TrollGrabRock Animation:MuCavTroll_SKL.MuCavTroll_GRBB Frames:0
		AnimationSound = Sound:TrollGetupShakeHeadVox Animation:MuCavTroll_SKL.MuCavTroll_GTPA Frames:31
		AnimationSound = Sound:ImpactTrollTreeLight Animation:MUCavTroll_SKL.MUCavTroll_IDLE Frames:55
    End

	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU            ;Tie into LargeGroupAudio system
		Key = Troll
		;UnitWeight = 2 ; Trollsie counts as 2 infantry when computing group size
	End


    ; *** ENGINEERING Parameters ***
	
	Behavior = EmotionTrackerUpdate    Module_EmotionTracker
		AddEmotion    =    Terror_Base
		AddEmotion    =    Alert_Base
	End

	RadarPriority = UNIT
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS TROLL MONSTER SCORE NO_FREEWILL_ENTER CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_INFANTRY SCARY CAN_ATTACK_WALLS	;WORKING_PASSENGER
	
	Body = DelayedDeathBody ModuleTag_02
		MaxHealth                = SAF_GUNDABAD_SNOWTROLL_HEALTH ;BALANCE CaveTroll Health
		MaxHealthDamaged            = SAF_GUNDABAD_SNOWTROLL_HEALTH_DAMAGED
		MaxHealthReallyDamaged            = SAF_GUNDABAD_SNOWTROLL_HEALTH_RAMPAGE_DAMAGED
		DoHealthCheck                = No            ; Don't want to get the delayed death behaviour when we die normally.
		DelayedDeathTime            = 5000
		CanRespawn                = No            ; Unit can't get revived.
    End

    Behavior = AutoHealBehavior ModuleTag_MountainTrollHealing
		StartsActive = No
		TriggeredBy = Upgrade_GenericUpgrade2
        HealingAmount = M_MONSTER_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = M_MONSTER_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		AILuaEventsList = GundabadTrollFunctions
		RampageTime        =    4470
		AttackPriority                = AttackPriority_Cavalry
	End
	
	LocomotorSet
		Locomotor = TrollLocomotor
		Condition = SET_NORMAL 
		Speed     = 33
	End
    LocomotorSet
        Locomotor = SaFTrollLocomotor
        Condition = SET_NORMAL_UPGRADED
        Speed     = 66    
    End
	
	Behavior = DualWeaponBehavior ModuleTag_25
		SwitchWeaponOnCloseRangeDistance = 100
	End
	
	Behavior LifetimeUpdate LifetimeTag
		WaitForWakeUp    =    Yes
	End

	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
	
	;;; WILL OF SAURON BONUS ;;;
	Behavior = LocomotorSetUpgrade ModuleTag_11
		TriggeredBy = Upgrade_TechnologyGundabadWillOfSauron
	End
    Behavior = AttributeModifierUpgrade ModuleTag_WillOfSauronBonus
        TriggeredBy = Upgrade_TechnologyGundabadWillOfSauron
        AttributeModifier = WillOfSauronAnims
    End
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FakeButtonEnabler
        SpecialPowerTemplate = SpecialAbilityFakeLeadership2
        TriggeredBy = Upgrade_TechnologyGundabadWillOfSauron
    End
    Behavior = SpecialPowerModule ModuleTag_FakeButton
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

	;;; TROLLISH ARMOR BEHAVIORS ;;;
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FakeButtonEnabler1
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_GenericUpgrade2 ;Upgrade_MountainTrollVeterancy
    End
    Behavior = SpecialPowerModule ModuleTag_FakeButton1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End
    Behavior = AttributeModifierUpgrade ModuleTag_TrollishArmorBonus
        TriggeredBy = Upgrade_GenericUpgrade2 ;Upgrade_MountainTrollVeterancy
        AttributeModifier = TrollishArmorBonus
    End
    Behavior = ArmorUpgrade ModuleTag_TrollishArmorBonus1
        TriggeredBy = Upgrade_GenericUpgrade2 ;Upgrade_MountainTrollVeterancy
        ArmorSetFlag            = PLAYER_UPGRADE
    End
    Behavior = SubObjectsUpgrade ModuleTag_TrollishArmorBonus2
        TriggeredBy        = Upgrade_GenericUpgrade2 ;Upgrade_MountainTrollVeterancy
        RecolorHouse    = Yes
		ShowSubObjects = ARMOR PAULDRONS
    End
	;;; END OF TROLLISH ARMOR BEHAVIORS ;;;
	
	;;; BORED BEHAVIORS ;;;
	Behavior = SpecialPowerModule ModuleTag_MordorMtTrollBoredAbility                     
		SpecialPowerTemplate      = SpecialAbilityMountainTrollBored
		UpdateModuleStartsAttack  = Yes
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_MordorMtTrollBored   
		SpecialPowerTemplate    = SpecialAbilityMountainTrollBored
		UnpackTime              = 800 ; hit the guy
		PackTime                = 1200
		AwardXPForTriggering    = 0
		StartAbilityRange = 50.0	;25.0	;We're much bigger now, and can reach farther
		SpecialWeapon = GundabadSnowTrollBored
		WhichSpecialWeapon = 1
	End
	Behavior = AutoPickUpUpdate AutoPickUpModuleTagOne
		ScanDelayTime = 40000
		ScanDistance = 150
		Bored = Yes    ; look for someone to hit with the BoredSpecialPower
		BoredFilter = NONE +MordorMountainTroll +MordorCaveTroll +GundabadSnowTroll +GundabadCaveTroll
    End
	
	;;; EATING BEHAVIORS ;;;
	Behavior = GrabPassengerSpecialPower ModuleTag_07                      
		SpecialPowerTemplate      = SpecialAbilityGrabPassenger
		UpdateModuleStartsAttack  = Yes
		AllowTree                = Yes
		InitiateFX                = FX_TrollGrabInitiate   ; Evil hack so we can different voices for grab tree or grab rock
	End
	Behavior = SpecialAbilityUpdate ModuleTag_08                
		SpecialPowerTemplate    = SpecialAbilityGrabPassenger
		StartAbilityRange       = 12.0
		UnpackTime              = 300 ; This does not match the animation, but looks good.
		PreparationTime         = 1   ; touching it to grabbing it
		PersistentPrepTime      = 630 ; grabbing it to whacking it on the ground (if shrubbery)
		PackTime                = 1000 ; whacking it to holding it nice
		CustomAnimAndDuration   = AnimState:EATING AnimTime:3000 TriggerTime:1400
		AwardXPForTriggering    = 0
	End
    Behavior = AutoPickUpUpdate ModuleTag_AutoPickup
        ScanDelayTime = 20000
        ScanDistance = 200	;default value is 300 units 
        Bored = Yes
        EatObjectEntry = MyHealth:80% TargetHealth:100% Filter:NONE +ORC	;When I'm below x% of my max health, I will look for an object to eat.
    End
	Behavior = AutoPickUpUpdate ModuleTag_PickupFromButton ; There is a seperate AutoPickUpUpdate that runs without a button
		ScanDelayTime = 20000
		ScanDistance = 600	;default value is 300 units 
		Bored = Yes
		EatObjectEntry = MyHealth:99% TargetHealth:100% Filter:NONE +ORC	;When I'm below x% of my max health, I will look for an object to eat.
		RunFromButton = Yes ; No natural scanning, wakes up to run exactly once when hit with a WakeAutoPickup button
		RunFromButtonNumber = 3; In case of multiples, this lines up with the OPTION_THREE field in the waking button
    End
	Behavior = TransportContain ModuleTag_09
        ObjectStatusOfContained = UNSELECTABLE
        PassengerFilter			= ANY +ORC +ROCK
        ManualPickUpFilter		= ANY -ORC +ROCK +ROCK_VENDOR ; we do not want the user to be able to manually pick up an orc with a troll.
        CanGrabStructure = Yes ; Overrides buildings' natural 0 in TransportSlotCount that makes them uncontainable
        Slots = 1
        ShowPips = No
        AllowEnemiesInside = Yes
        AllowNeutralInside = Yes
        AllowAlliesInside  = Yes
        DamagePercentToUnits = 0%
        TypeOneForWeaponState = ROCK
        
        PassengerBonePrefix = PassengerBone:Firepoint01    KindOf:ROCK 
        PassengerBonePrefix = PassengerBone:Trunk		KindOf:INFANTRY

    End
	;;; END OF BORED/EATING BEHAVIORS ;;;
	
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
		HitReactionLifeTimer1 = 1500 ; level 1 (light  damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer2 = 1500 ; level 2 (medium damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer3 = 3000 ; level 3 (heavy  damage)  hit reaction animations in frames (5 per sec)
		HitReactionThreshold1 = 0.0   ; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 50.0  ; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 200.0  ; level 3 (heavy  damage) threshold trigger
	End
	Behavior = ClickReactionBehavior ClickBehaviorModuleTag
		ClickReactionTimer = 600 ; 10 seconds in ticks
		ReactionFrames1 = 15  ; in frames (5 per sec)
		ReactionFrames2 = 7  ; in frames (5 per sec)
		ReactionFrames3 = 7  ; in frames (5 per sec)
		ReactionFrames4 = 15  ; in frames (5 per sec)
		ReactionFrames5 = 18 ; in frames (5 per sec)
	End
	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 0.0 ;1.0
		ShockStandingTime = 4600    ;msec ;27800
		FirstHeight = 0 
		SecondHeight = 0
	End
	
	Behavior = SlowDeathBehavior ModuleTag_50
		DeathTypes = ALL
		SinkDelay = 10000
		SinkRate = 0.9     ; in Dist/Sec
		DestructionDelay = 35000
		;DecayBeginTime = 3000
		Sound = INITIAL TrollDie
		ProbabilityModifier = 50
		DeathFlags   = DEATH_1 ; Tell model which death animation to play. Sets BOTH model condition and object status bits.
	End
	Behavior = SlowDeathBehavior ModuleTag_51
		DeathTypes = ALL
		SinkDelay = 10000
		SinkRate = 0.9     ; in Dist/Sec
		DestructionDelay = 35000
		;DecayBeginTime = 4500
		Sound = INITIAL TrollDie
		ProbabilityModifier = 50
		DeathFlags   = DEATH_2 ; Tell model which death animation to play. Sets BOTH model condition and object status bits.
	End

	Geometry = CYLINDER
	GeometryMajorRadius = 17.6
	GeometryHeight = 32.0
	GeometryIsSmall = No
	Shadow = SHADOW_VOLUME_NON_SELF_2; volumetric shadow that doesn't cast onto all objects using SHADOW_VOLUME_NON_SELF_2
	Scale = 1.3

End


ChildObject GundabadCaveTroll GundabadSnowTroll

    ButtonImage        = BIGundCaveTroll
    SelectPortrait    = UPGundCaveTroll

Scale = 1.0

Draw = W3DScriptedModelDraw ModuleTag_01
	
	WadingParticleSys = EntRipples
	OkToChangeModelColor = Yes

	ExtraPublicBone				= TRUNK01
    ExtraPublicBone				= FIREPOINT01
    ExtraPublicBone             = ROCK

    RandomTexture = mucavtroll.tga 0 mucavtroll.tga
	RandomTexture = mucavtroll2.tga 0 mucavtroll.tga

	DefaultModelConditionState
		Model = MuCavTroll_SKN
		WeaponLaunchBone = PRIMARY FIREPOINT01
	End   

    IdleAnimationState
        StateName = STATE_Idle
        Animation = Breathe
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLA 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 40
        End
        Animation = BellyScratch
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLC 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Animation = RubHead
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLK 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Animation = LittleRoar
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLM 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 3
        End
        Animation = WipeNose
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLN 
            AnimationMode = ONCE
            AnimationBlendTime = 10
            AnimationPriority = 10
        End
        Flags                        = RESTART_ANIM_WHEN_COMPLETE    
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Mace" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript    
    End

    ; Splatted death goes first, independant of death flags
    ModelConditionState    = DYING DECAY SPLATTED
        Model                = MUCavTroll_DISA
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY SPLATTED 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISA.MUCavTroll_DISA
            AnimationMode      = ONCE
        End
    End

    ModelConditionState    = DYING DECAY DEATH_1
        Model                = MUCavTroll_DISB
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY DEATH_1 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISB.MUCavTroll_DISB
            AnimationMode      = ONCE
        End
    End

    ModelConditionState    = DYING DECAY DEATH_2
        Model                = MUCavTroll_DISC
        RetainSubObjects = Yes
    End;

    AnimationState         = DYING DECAY DEATH_2 
        Animation            = dead1
            AnimationName       = MUCavTroll_DISC.MUCavTroll_DISC
            AnimationMode      = ONCE
        End
    End

    ; Flailing must go before dying in case we are dead in the air
    AnimationState = STUNNED_FLAILING
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_FLYA
            AnimationMode = LOOP
        End
    End

    ;;; DYING ANIMATIONS ;;;    
    AnimationState = DYING SPLATTED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_LNDA
            AnimationMode = ONCE
        End
    End

    AnimationState = DYING DEATH_1
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_DIEB
            AnimationMode = ONCE
        End

            ParticleSysBone = B_PELVIS TrollSplatDust
            ParticleSysBone = BAT_HEAD TrollSplatDust
    End

    AnimationState = DYING DEATH_2
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_DIEC
            AnimationMode = ONCE
        End

            ParticleSysBone = BAT_SPINE1 TrollSplatDust1
            ParticleSysBone = BAT_HEAD TrollSplatDust1
    End

    AnimationState = DYING
        Animation
            AnimationName     =  MuCavTroll_SKL.MuCavTroll_DIEC
            AnimationMode     = ONCE
        End
    End
            
    AnimationState                = STUNNED_STANDING_UP
        Animation                = MuCavTroll_GTPA
            AnimationName        = MuCavTroll_SKL.MuCavTroll_GTPA
            AnimationMode        = ONCE
        End
    End    

    AnimationState                = STUNNED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_LNDA
            AnimationMode = ONCE
        End
        ParticleSysBone = B_PELVIS TrollSplatDust2
        ParticleSysBone = BAT_HEAD TrollSplatDust2
    End
    
    ;;; PASSENGER OF SIEGE TOWER ANIMS ;;;
    AnimationState = PASSENGER MOVING BACKING_UP; pulling the seige tower or grond
            Animation = Passenger_moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_PSHA ; MuCavTroll_PSHA
            AnimationMode = LOOP_BACKWARDS
            AnimationSpeedFactorRange = 2.0 2.0
        End
        Flags = RANDOMSTART
    End

    AnimationState = PASSENGER MOVING ; pushing the seige tower
            Animation = Passenger_moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_PSHA
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
        End
        Flags = RANDOMSTART
    End

    AnimationState = PASSENGER ; idling by the grond
        Animation = Passenger
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLD
            AnimationMode = LOOP
            AnimationBlendTime = 15
        End
        Flags = RANDOMSTART
    End

    ;--- bop our friends on the head
    AnimationState = SPECIAL_WEAPON_ONE
        Animation = Punch
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKF
            AnimationMode = ONCE
        End
        Animation = Backhand
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKG
            AnimationMode = ONCE
        End            
    End
                
    ;--Troll is angry
    AnimationState = WEAPONSET_RAMPAGE
        Animation = GetMad
                AnimationName = MuCavTroll_SKL.MuCavTroll_RPGC
                AnimationMode = LOOP
            End
        End

    ; --------- With Club ------------

; --------- With Rock or Infantry ------------

    AnimationState = MOVING WEAPONSET_TOGGLE_1 USER_1
		Animation
			AnimationName = MuCavTroll_SKL.MuCavTroll_RUNA 
			AnimationMode = LOOP
			AnimationSpeedFactorRange = 0.77 0.77
			;Distance		= 120
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
		;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
		;FXEvent    = Frame:17 Name:FX_TrollLeftFootStep
		BeginScript
			CurDrawableShowSubObject("ROCK")
		EndScript
	End

    AnimationState = MOVING WEAPONSET_TOGGLE_1 ATTACKING
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_RUNA 
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 0.77 0.77
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:18 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING WEAPONSET_TOGGLE_1 DAMAGED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB 
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.3 1.3
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING WEAPONSET_TOGGLE_1
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKD
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 1.36 1.36
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:16 Name:FX_TrollLeftFootStep
    End
        
        AnimationState = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1			; throw rock
			StateName = Throw
			Animation
				AnimationName		= MuCavTroll_SKL.MuCavTroll_THRA
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
                ;AnimationSpeedFactorRange = 0.5 0.5
			End
			FrameForPristineBonePositions = 10 ;21 ;24
		End

		AnimationState = RELOADING_A WEAPONSET_TOGGLE_1						; Pickup rock.
			Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
		End

    AnimationState                    = CONTINUOUS_FIRE_MEAN
        StateName                    =    STATE_Coasting
        Animation                    =    HangFrameWhileCoasting
            AnimationName            =    MuCavTroll_SKL.MuCavTroll_THRA
            AnimationMode            =    MANUAL
        End
    End

    ; Normal fist attacks
    AnimationState = FIRING_OR_PREATTACK_A
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKA
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKE
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
    End

    ;Building attack, which you can do with a rock in yo hand
    AnimationState = FIRING_OR_PREATTACK_B
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_ATKJ
            AnimationMode = ONCE
            UseWeaponTiming        = Yes
        End
    End


    AnimationState = TURN_LEFT
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_TRNL
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        ParticleSysBone = None InfantryDustTrails
    End

    AnimationState = TURN_RIGHT
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_TRNR
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        ParticleSysBone = None InfantryDustTrails
    End

    AnimationState = MOVING ATTACKING
        Animation = Charging
            AnimationName = MuCavTroll_SKL.MuCavTroll_RUNB
            AnimationMode = LOOP
            AnimationSpeedFactorRange = 0.8 0.8
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
            ;FXEvent    = Frame:5 Name:FX_TrollRightFootStep
            ;FXEvent    = Frame:18 Name:FX_TrollLeftFootStep
    End
        
    AnimationState                = MOVING PANICKING
        Animation                = RUNM
            AnimationName        =  MuCavTroll_SKL.MuCavTroll_MFDA
            AnimationMode        = LOOP
        End
        Flags                    = RANDOMSTART
    End
    
    AnimationState = MOVING DAMAGED
        Animation = Moving_Damaged
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB
            AnimationMode = LOOP
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = MOVING USER_1
		Animation = Charging
			AnimationName = MuCavTroll_SKL.MuCavTroll_RUNB
			AnimationMode = LOOP
			Distance		= 120
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
		;FXEvent    = Frame:6 Name:FX_TrollRightFootStep
		;FXEvent    = Frame:17 Name:FX_TrollLeftFootStep
		BeginScript
			CurDrawableHideSubObject("ROCK")
		EndScript
	End

    AnimationState = MOVING
        Animation = Moving
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKB
            AnimationMode = LOOP
            AnimationBlendTime = 10
        End
        Flags = RANDOMSTART
        ParticleSysBone = None InfantryDustTrails
        ;FXEvent    = Frame:0 Name:FX_TrollRightFootStep
        ;FXEvent    = Frame:20 Name:FX_TrollLeftFootStep
    End

    AnimationState = ENGAGED
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_IDLA
            AnimationMode = LOOP
        End
    End
    
; --------- Just built ------------
        
    AnimationState = JUST_BUILT
        Animation
            AnimationName = MuCavTroll_SKL.MuCavTroll_WLKC ; temp
            AnimationMode = ONCE
            AnimationBlendTime = 0
            AnimationSpeedFactorRange = 0.9 0.9            
        End    
    End    

; --------- Click and Hit Reactions ------------
        
    AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITD
            AnimationMode = ONCE
            End
    End

    AnimationState = HIT_REACTION HIT_LEVEL_2
            Animation = Hit_Level_2
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITC
            AnimationMode = ONCE
            End
    End

    AnimationState = HIT_REACTION HIT_LEVEL_3
            Animation = Hit_Level_3
          AnimationName = MuCavTroll_SKL.MuCavTroll_HITA
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_1
            Animation = Click_React_1
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTA
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_2
            Animation = Click_React_2
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTB
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_3
            Animation = Click_React_3
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTC
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_4
            Animation = Click_React_4
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTD
            AnimationMode = ONCE
            End
    End

    AnimationState = REACT_5
            Animation = Click_React_5
          AnimationName = MuCavTroll_SKL.MuCavTroll_RCTE
            AnimationMode = ONCE
            End
    End
    
    AnimationState = USER_2
        Animation = ReactToTrollPoke ; The two comes from the special TrollBored weapon
            AnimationName = MuCavTroll_SKL.MuCavTroll_HITA
            AnimationMode = ONCE
        End
    End

        AnimationState = ENGAGED WEAPONSET_TOGGLE_1
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
        End

;-----------------------------------
;Emotion

    AnimationState = EMOTION_CELEBRATING
        Animation
            AnimationName    =    MuCavTroll_SKL.MuCavTroll_IDLF
            AnimationMode    =    LOOP
        End
    End

    AnimationState = WEAPONSET_TOGGLE_1
            StateName = STATE_IdleRock
            Animation = Breathe
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLB 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 40
            End
            Animation = BellyScratch
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLG 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 10
            End
            Animation = RubHead
                AnimationName = MuCavTroll_SKL.MuCavTroll_IDLF 
                AnimationMode = ONCE
                AnimationBlendTime = 10
                AnimationPriority = 10
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE     
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToMace") end
            EndScript
        End

    ;------------------ Troll Rock Transitions ------------------------

        
        TransitionState       = TRANS_SelectedToMace
            Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
        End
        TransitionState       = TRANS_SelectedToIdle
            Animation
				AnimationName		= MuCavTroll_SKL.mucavtroll_rlda
				AnimationMode		= ONCE_BACKWARDS
			End
			;FXEvent	= Frame:21	Name: FX_CaveTrollRockGrab
			;FXEvent	= Frame:38	Name: FX_CaveTrollRockYank
        End
        AnimationState        = SELECTED WEAPONSET_TOGGLE_1
            StateName           = STATE_Mace
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToMace") end
            EndScript
        End      
        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = MuCavTroll_SKL.MuCavTroll_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Mace" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

  End

  	; ***DESIGN parameters ***
	Side = Gundabad
	IsTrainable        = Yes
	EditorSorting = UNIT
	ThreatLevel = 2.0
	TransportSlotCount = 1
	ShowHealthInSelectionDecal = Yes
	VisionRange = M_VISION_ENT
	ShroudClearingRange = M_SHROUD_CLEAR_ENT
	MaxSimultaneousOfType = 500
	ImmuneToShockwave = Yes
	
	BuildCost = SAF_GUNDABAD_CAVETROLL_BUILDCOST
	BuildTime = SAF_GUNDABAD_CAVETROLL_BUILDTIME
	CommandPoints = 20

    DisplayName = OBJECT:GundabadCaveTroll

    WeaponSet
        Conditions          =  None
        Weapon              =  PRIMARY    GundabadCaveTrollPunch
        Weapon              =  SECONDARY  GundabadCaveTrollBash
        OnlyAgainst         =  SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources 	=  PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions          =  WEAPONSET_TOGGLE_1
        Weapon              =  PRIMARY    CaveTrollRockFromThinAir
        PreferredAgainst    =  PRIMARY    STRUCTURE BLOCKING_GATE
        AutoChooseSources   =  PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources 	=  PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
	
	WeaponSet
		Conditions          = RAMPAGE
		Weapon              = PRIMARY  GundabadCaveTrollRampage
	End

    WeaponSet
		Conditions          = RAMPAGE WEAPONSET_TOGGLE_1
		Weapon              = PRIMARY  GundabadCaveTrollRampage
	End
	
	ArmorSet
		Conditions      = None
		Armor           = TrollArmor
		DamageFX        = NormalDamageFX
	End

    Body = DelayedDeathBody ModuleTag_02
		MaxHealth                = SAF_GUNDABAD_CAVETROLL_HEALTH ;BALANCE CaveTroll Health
		MaxHealthDamaged            = SAF_GUNDABAD_CAVETROLL_HEALTH_DAMAGED
		MaxHealthReallyDamaged       = SAF_GUNDABAD_CAVETROLL_HEALTH_RAMPAGE_DAMAGED
		DoHealthCheck                = No            ; Don't want to get the delayed death behaviour when we die normally.
		DelayedDeathTime            = 5000
		CanRespawn                = No            ; Unit can't get revived.
    End

    Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		AILuaEventsList = GundabadCaveTrollFunctions
		RampageTime        =    4470
		AttackPriority                = AttackPriority_Cavalry
	End

    CommandSet = GundabadCaveTrollCommandSet
End
