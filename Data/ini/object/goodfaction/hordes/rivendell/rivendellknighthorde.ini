Object RivendellKnightHorde
    SelectPortrait	     = uprivelfknight
    ButtonImage	         = uirivelfknight

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model           = None
        End
        ModelConditionState = HORDE_EMPTY
            Model           = None
        End        
        ModelConditionState = WORLD_BUILDER
            Model           = HordeMarkGUKni
        End
    End 
    
    ; *** DESIGN Parameters *** ;
    Side                     = Rivendell
    EditorSorting            = UNIT
    EmotionRange             = 240
    DisplayName              = OBJECT:HordeRivendellKnight
    
    WeaponSet
        Conditions           = None 
        Weapon               = PRIMARY    NormalMeleeHordeRangefinder
    End
    
    CommandSet               = RivendellElfKnightCommandSet
    BuildCost                = RIVENDELL_KNIGHT_BUILDCOST
    BuildTime                = RIVENDELL_KNIGHT_BUILDTIME  
    VisionRange              = M_GONDOR_KNIGHT_HORDE_VISION_RANGE
    CommandPoints            = 20 
    FormationWidth           = 2
    FormationDepth           = 1 
    CrushableLevel           = 2
    CrusherLevel             = 1 
    MinCrushVelocityPercent  = 50% 
    CrushDecelerationPercent = 50
    CrushKnockback           = 40 
    CrushZFactor             = 1.0 
    TransportSlotCount       = 1
    
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY 
    
    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End   
    
    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                   = 5000
        MinCowerTime                   = 3000
        AILuaEventsList                = CavalryFunctions  
        AttackPriority                 = AttackPriority_Cavalry
    End
    
    Behavior  = ReplenishUnitsBehavior ModuleTag_ReplenishUnitsBehavior01
        ReplenishDelay                 = 5000                
        ReplenishRadius                = 150.0f                  
        NoReplenishIfEnemyWithinRadius = 200.0f  
        ReplenishStatii                = RIDERLESS           
        ReplenishFXList                = FX_MagicHit      
        ReplenishHordeMembersOnly      = Yes
        StartsActive                   = Yes
    End
    
    Behavior = HorseHordeContain ModuleTag_HordeContain
        ObjectStatusOfContained = 
        InitialPayload                  = RivendellKnight  5
        Slots                           = 5
        PassengerFilter                 = NONE +CAVALRY +RivendellKnightBanner
        ShowPips                        = No
        RandomOffset                    = X:4 y:4
        ThisFormationIsTheMainFormation = Yes  
        
        BannerCarriersAllowed           = RivendellKnightBanner                             
        BannerCarrierPosition           = UnitType:RivendellKnight    Pos:X:40.0 Y:0.0    
        
        RankInfo                        = RankNumber:1 UnitType:RivendellKnight Position:X:0 Y:0        Position:X:0 Y:25        Position:X:0 Y:-25        Position:X:0 Y:50        Position:X:0 Y:-50 
    
        RanksToReleaseWhenAttacking     = 1
        AlternateFormation              = RivendellKnightHordeWedgeFormation
        MeleeAttackLeashDistance        = 25     
    End
    
    Behavior                            = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult                     = 1.0
    End  
    
    Behavior                            = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance           =    M_INFANTRY_TAUNT_POINT_RADIUS    
        TauntAndPointUpdateDelay        =    1000  
        TauntAndPointExcluded           =    NONE
        AfraidOf                        =    NONE +GondorGwaihir +RohanTreeBerd +RohanEntFir +RohanEntAsh +RohanEntBirch +MordorBalrog +MordorFellBeast +MordorWitchKingOnFellBeast  +MordorCaveTroll +MordorMountainTroll +MordorDrummerTroll +MordorMumakil ;Must be SCARY kindof as well.
        AlwaysAfraidOf                  =    NONE +MordorBalrog +RohanOathbreaker +MordorSauron 
        PointAt                         =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast 
        HeroScanDistance                =    150
        FearScanDistance                =    M_INFANTRY_FEAR_SCAN_RADIUS        
        AddEmotion                      =    Terror_Base        
        AddEmotion                      =    OVERRIDE Point_Base
            Duration                    =    2500
        End        
        AddEmotion                      =    Taunt_Base
        AddEmotion                      =    CheerIdle_Base
        AddEmotion                      =    CheerBusy_Base       
        AddEmotion                      =    HeroCheerIdle_Base        ;OVERRIDE
        AddEmotion                      =    HeroCheerBusy_Base        ;OVERRIDE
        AddEmotion                      =    Alert_Base
     End  
     
    LocomotorSet
        Locomotor                       = NormalCavalryHordeLocomotor 
        Condition                       = SET_NORMAL
        Speed                           = M_NORMAL_CAVALRY_HORDE_SPEED
    End
    
    Behavior                            = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP                        = Yes
    End
    
    ; -- Banner Carrier
    Behavior                            = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy                     = Upgrade_RivendellBasicTraining Upgrade_TechnologyRivendellBasicTraining
        RequiresAllTriggers             = Yes
        LevelsToGain                    = 1
        LevelCap                        = 2
    End 
    
    ; -- Forge Blades
    Behavior                            = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy                     = Upgrade_RivendellForgedBlades Upgrade_TechnologyRivendellForgedBlades
        RequiresAllTriggers             = Yes
    End  
    
    ; -- Heavy Armor
    Behavior                            = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy                     = Upgrade_RivendellHeavyArmor Upgrade_TechnologyRivendellHeavyArmor
        RequiresAllTriggers             = Yes
    End    
    
    Behavior                            = AttributeModifierUpgrade ModuleTag_ArmorSpeedReduction
        TriggeredBy                     = Upgrade_RivendellHeavyArmor
        AttributeModifier               = HeavyArmorDebuff
    End
    
    ; -- Rank 2 Ability
    Behavior                            = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate            = SpecialAbilityRank2
        TriggeredBy                     = Upgrade_GenericUpgrade2
    End    
    
    Behavior                            = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate            = SpecialAbilityRank2
        UpdateModuleStartsAttack        = No
        StartsPaused                    = Yes
        AttributeModifier               = GondorKnightRank2
;        AttributeModifierRange         = 200
        AttributeModifierAffectsSelf    = Yes
        AttributeModifierAffects        = NONE +GondorCavalry +RivendellKnightHorde +RivendellKnightHordeWedgeFormation
        AttributeModifierFX             = FX_GoodPower
    End
    
    Geometry                            = BOX
    GeometryMajorRadius                 = 12.0
    GeometryMinorRadius                 = 24.0
    GeometryHeight                      = 20.0
    GeometryIsSmall                     = No    
End
ChildObject RivendellKnightHordeWedgeFormation RivendellKnightHorde
    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers              = GondorKnightWedge
        ObjectStatusOfContained         = 
        InitialPayload                  = RivendellKnight 5
        Slots                           = 5
        PassengerFilter                 = NONE +CAVALRY +RivendellKnightBanner
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:8 y:3    
        
        BannerCarriersAllowed           = RivendellKnightBanner                               
        BannerCarrierPosition           = UnitType:RivendellKnight    Pos:X:30.0 Y:0.0       
        
        RankInfo                        = RankNumber:1 UnitType:RivendellKnight Position:X:0 Y:0        Position:X:-30 Y:30        Position:X:-30 Y:-30        Position:X:-60 Y:60        Position:X:-60 Y:-60        
        
        RanksToReleaseWhenAttacking     = 1
        AlternateFormation              = RivendellKnightHorde
    End
End