;------------------------------------------------------------------------------
;
;    Peasant.ini
;
;------------------------------------------------------------------------------
;Creating this peasant will randomize between several variations of the peasant.
;------------------------------------------------------------------------------
Object RohanPeasant

    SelectPortrait    = UPRohan_Peasant

    Draw = W3DScriptedModelDraw ModuleTag_01  
        DefaultModelConditionState
            ;Give it a model so it'll show up in WB
            Model               = RUPsnt_1_SKN
            Skeleton            = RUPsnt_1_SKL
        End
    End

    ;***** IMPORTANT NOTE! ***************************************************************    
    ;Certain Upgrades and costs may need to be propagated from here. One example was veterancy
    ;overlays.
    ;*************************************************************************************    

    Side = Rohan
    EditorSorting = UNIT
    BuildVariations = RohanPeasantAdult RohanPeasantAdultAxe RohanPeasantKid RohanPeasantKidAxe RohanPeasantSpear ; RohanPeasant4    ; RohanPeasant2 <- removed from the game 
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT SWARM_DOZER GRAB_AND_DROP DOZER 
    
  ;Shadow = SHADOW_DECAL
  ;ShadowSizeX = 24;
  ;ShadowSizeY = 24;
  ;ShadowTexture = ShadowI;

End
ChildObject RohanPeasant_Summoned RohanPeasant
    IsTrainable = No
    CommandPoints = 0
    EquivalentTo = RohanPeasant
    
    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
    ; This one does the work, but the one in the horde displays the timer
        MinLifetime        = 75000 ; 180000
        MaxLifetime        = 75000 ; 180000
        DeathType        = FADED
    End

    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond    = 0.2%    ; % of max health to repair each second
        AILuaEventsList                    = RohanPeasant2Functions
        AttackPriority                =     AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End
End
;;------------------------------------------------------------------------------
; aka PeasantAdult
Object RohanPeasantAdult    ; ///  Adult ///
    ; ***ART Parameters ***
    
    SelectPortrait    = UPRohan_Peasant
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = rupsnt2A.tga 0 rupsnt2A.tga
        RandomTexture = rupsnt2B.tga 0 rupsnt2A.tga
		RandomTexture = rupsnt2C.tga 0 rupsnt2A.tga

		RandomTexture = rupsnt2AHA.tga 0 rupsnt2AHA.tga
        RandomTexture = rupsnt2BHA.tga 0 rupsnt2AHA.tga
		RandomTexture = rupsnt2CHA.tga 0 rupsnt2AHA.tga
		
		RandomTexture = rushield01.tga 0 rushield01.tga
		RandomTexture = rushield02.tga 0 rushield01.tga
		RandomTexture = rushield03.tga 0 rushield01.tga
		RandomTexture = rushield04.tga 0 rushield01.tga
		RandomTexture = rushield05.tga 0 rushield01.tga
		RandomTexture = rushield06.tga 0 rushield01.tga
		RandomTexture = rushield07.tga 0 rushield01.tga
		RandomTexture = rushield08.tga 0 rushield01.tga
		
;;====================== MODELS ================================================================    
		
		DefaultModelConditionState
			Model               = rusnt02_skn
			Skeleton            = RUPsnt_1_SKL
		End
		
		ModelConditionState = ARMORSET_PLAYER_UPGRADE
			Model               = rusnt02HA_skn
			Skeleton            = RUPsnt_1_SKL
		End
		
		ModelConditionState = USER_1
			Model               = rusnt02DR_skn
			Skeleton            = RUPsnt_1_SKL
		End
        
;;================== ANIMATIONS =================================================================        

;;------------------  DYING -------------------------------------------------------------

        AnimationState                        = PASSENGER
            Animation                        = FLLA
                AnimationName                = RUPsnt_1_FLLA
                AnimationMode                = LOOP
            End
        End
        
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState                        = FREEFALL
            Animation                        = FLYA
                AnimationName                = RUPsnt_1_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.7    0.7
                AnimationBlendTime            = 10
            End
        End
        
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode      = LOOP
            End
            Flags               = RANDOMSTART
        End
        
        AnimationState                        = DYING SPLATTED
            Animation                        = LNDA
                AnimationName                = RUPsnt_1_LNDA
                AnimationMode                = ONCE
            End
        End
        
        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUPsnt_1_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEB
                AnimationName     = RUPsnt_1_DIEB
                AnimationMode     = ONCE
            End            
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUPsnt_1_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
;            Animation           = GTPB
;                AnimationName     = RUPsnt_1_GTPB
;                AnimationMode     = ONCE
;                                AnimationSpeedFactorRange = 1.5 1.5
;            End            
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_1_LNDA
                AnimationMode     = ONCE
            End
        End        
                
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUPsnt_1_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART 
        End


    ;;------------------ ATTACKING ---------------------------------------

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation
                AnimationName        =    RUPsnt_1_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName        =    RUPsnt_1_ATKB
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End            
        End
        
;;------------------ MOVING ------------------------------------------
    
;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = BAKA
                AnimationName        = RUPsnt_1_BAKA
                AnimationMode        = LOOP
            End
;            Animation                = BAKB
;                AnimationName        = RUPsnt_1_BAKB
;                AnimationMode        = LOOP
;            End
;            Animation                = BAKC
;                AnimationName        = RUPsnt_1_BAKC
;                AnimationMode        = LOOP
;            End                                
        End

; OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = RUNM
;                AnimationName        = RUPsnt_1_MFDA
;                AnimationMode        = LOOP
;            End
;            Flags                    = RANDOMSTART
;            ;;ParticleSysBone            = None InfantryDustTrails
;        End
        
        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_1_WLKA
                AnimationMode        = LOOP
            End
;            Animation                = WLKE
;                AnimationName        = RUPsnt_1_WLKE
;                AnimationMode        = LOOP
;            End
            
            ;;ParticleSysBone     = None InfantryDustTrails
        End
        
        AnimationState                = MOVING
            Animation                = RUNA
                AnimationName        = RUPsnt_1_RUNA
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End
            Animation                = RUNC
                AnimationName        = RUPsnt_1_RUNC
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End            
            Flags                    = RANDOMSTART
            ParticleSysBone            = None InfantryDustTrails
        End
        
; WORKING        
        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_1_IDLA 
                AnimationMode        =    LOOP
            End
        End

        
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKA
                AnimationName        = RUPsnt_1_WRKA
                AnimationMode        = ONCE
            End
            Animation                = WRKD
                AnimationName        = RUPsnt_1_WRKD
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End    
    
;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_1_HITA
                AnimationMode = ONCE
            End
        End

;;------------- EMOTIONS ---------------------------------------------

            

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing1
                AnimationName        = RUPsnt_1_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End

;;======= TERROR
        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_1_FERA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_TAUNTING
            Animation                = TNTA
                AnimationName        = RUPsnt_1_TNTA
                AnimationMode        = ONCE
            End
            Animation                = TNTB
                AnimationName        = RUPsnt_1_TNTB
                AnimationMode        = ONCE
            End    
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE        
        End

;;====== CELEBRATING        
            AnimationState                = EMOTION_CELEBRATING
                Animation                = CHRA
                    AnimationName        = RUPsnt_1_CHRA
                    AnimationMode        = ONCE
                End
                Animation                = CHRB
                    AnimationName        = RUPsnt_1_CHRB
                    AnimationMode        = ONCE
                End
                Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
            End
            
            AnimationState                = EMOTION_ALERT
                StateName                = STATE_Alert
                Animation                = &&ALERT&&
                    AnimationName        = RUPsnt_1_IDLA
                    AnimationMode        = LOOP
                End
            End
            
    ;;------------- SELECTED ---------------------------------------------

        AnimationState                =    SELECTED
            StateName                =    STATE_Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUPsnt_1_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End    

    ;;--------------- IDLE STATES -----------------------------------------------------------------    
        IdleAnimationState
            StateName            =    STATE_Idle
            Animation           = IDLA
                AnimationName     = RUPsnt_1_IDLA
                AnimationMode     = ONCE
                AnimationPriority = 20
            End

            Animation           = IDLC
                AnimationName     = RUPsnt_1_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLD
                AnimationName     = RUPsnt_1_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 2
            End

            Animation           = IDLE
                AnimationName     = RUPsnt_1_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLF
                AnimationName     = RUPsnt_1_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLG
                AnimationName     = RUPsnt_1_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 1                
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript        
        End
        
    ;---Transitions-------------------------------------        

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = RUPsnt_1_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End
        
        TransitionState                =    TRANS_IdleToSelected
            Animation                =    ATNA
                AnimationName        =    RUPsnt_1_ATNA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End    
        
    End
    
    ; ***DESIGN parameters ***
    Side = Rohan
    EditorSorting = UNIT
    ThreatLevel = 1.0
    TransportSlotCount = 1
    
    CommandPoints = 2

    CommandSet = PeasantCommandSet
    
    BountyValue = M_ROHAN_PEASANT_BOUNTY_VALUE

    ;;;; WEAPON SETS ;;;;
    WeaponSet
        Conditions          = None 
        Weapon              = PRIMARY        RohanFighterSword
    End
    
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY        RohanFighterSwordUpgraded
    End
    
    ;;;; ARMOR SETS ;;;;    
    ArmorSet
        Conditions      = None
        Armor           = PeasantArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
            
    DisplayName = OBJECT:RohanPeasant
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
    CrushRevengeWeapon = BasicInfantryCrushRevenge
    EquivalentTo = RohanPeasant    


    ; *** AUDIO Parameters ***;

    VoiceAttack                 = PeasantMaleVoiceAttack
    VoiceAttackCharge             = PeasantMaleVoiceAttackCharge
    VoiceAttackStructure             = PeasantMaleVoiceAttackBuilding
    VoiceAttackMachine             = PeasantMaleVoiceAttack
    VoiceCreated                 = PeasantMaleVoiceSalute
    VoiceFullyCreated             = PeasantMaleVoiceSalute
    VoiceGuard                    = PeasantMaleVoiceMove
    VoiceMove                     = PeasantMaleVoiceMove
    VoiceMoveToCamp                 = PeasantMaleVoiceMoveCamp
    VoiceMoveWhileAttacking         = PeasantMaleVoiceDisengage
    VoicePriority                = 30
    VoiceRetreatToCastle             = PeasantMaleVoiceRetreat
    VoiceSelect                 = PeasantMaleVoiceSelect
    VoiceSelect2                 = PeasantVoiceSelect2
    VoiceSelectBattle              = PeasantMaleVoiceSelectBattle
    
    VoiceEnterStateAttack             = PeasantMaleVoiceEnterStateAttack
    VoiceEnterStateAttackCharge         = PeasantMaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackStructure     = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackMachine         = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove             = PeasantMaleVoiceEnterStateMove
    VoiceEnterStateMoveToCamp         = PeasantMaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking     = PeasantMaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle    = PeasantMaleVoiceEnterStateRetreat
        
    SoundImpact                    = ImpactHorse
    
    UnitSpecificSounds
        VoiceGarrison            = PeasantMaleVoiceGarrison    
        VoiceRepair                = PeasantMaleVoiceRepair
    End

    EvaEventDamagedOwner             = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ClientBehavior = RandomSoundSelectorClientBehavior ModuleTag_RSSCB
        ; This is a counter to the similar module in the RohanPeasant4. Without this,
        ; the larger a group, the more likely it is a woman's voice will be heard; until
        ; a 100 peasant group will basically ALWAYS be playing. This ensures that a 
        ; large group of mixed peasants will still be led by a man. [Sorry, but that's
        ; Middle Earth for you -- just ask Eowyn!]
        Chance = 5% 
        RerollOnEveryFrame = No ; For consistancy
        VoicePriority = 32 ; Bossy man is high enough to overcome "bossy" women
    End
    
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_DIEA    Frames:45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_1_SKL.RUPsnt_1_DIEB    Frames:44
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_LNDA    Frames:4
    End


    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER SWARM_DOZER GRAB_AND_DROP
    
;    CommandSet = GondorWorkerCommandSet
    
    Body = ActiveBody ModuleTag_02
        CheerRadius       = M_EMOTION_CHEER_RADIUS
        MaxHealth         = M_ROHAN_PEASANT_HEALTH                ;BALANCE Peasant Health
        MaxHealthDamaged  = M_ROHAN_PEASANT_HEALTH_DAMAGED            
        ;RecoveryTime      = M_ROHAN_PEASANT_HEALTH_RECOVERY_TIME        
    End
    
    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond    = 0.2%    ; % of max health to repair each second
        AILuaEventsList                    = RohanPeasant2Functions
        AttackPriority                =     AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End

    LocomotorSet
        Locomotor = HumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End

    LocomotorSet
        Locomotor = HumanWanderLocomotor
        Condition = SET_WANDER
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End 

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
    End
    
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 4000
        SinkRate = 0.25     ; in Dist/Sec
        DestructionDelay = 10000
            Sound = INITIAL PeasantMaleVoiceDie
    End
    
     Behavior = WeaponSetUpgrade ModuleTag_Weaponpgrade
        TriggeredBy = Upgrade_RohanForgedBlades
    End

     Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy = Upgrade_RohanHeavyArmor
        ArmorSetFlag            = PLAYER_UPGRADE
    End

    ;; Don't remove this. It's required for newly spawned members
    ;; It does not change the armor set, but it allows us to accept the Drafted Upgrade
     Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeDrafted
        TriggeredBy = Upgrade_Drafted
        IgnoreArmorUpgrade = Yes ; does not trigger any armor sets
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End        
    ;-------------------------------------------------------------------------------	
    ;----------------------------------UPGRADES-------------------------------------
    ;-------------------------------------------------------------------------------
		; We get drafted and get USER_1
	Behavior = AttributeModifierUpgrade ModuleTag_Drafteduser
		TriggeredBy = Upgrade_Drafted
		AttributeModifier = RohanPeasantDrafted
	End
	
	Behavior = SubObjectsUpgrade Drafted_Upgrade
		TriggeredBy		= Upgrade_Drafted
		FXListUpgrade   = FX_Draft
		;Sound = INITIAL PeasantVoiceDraftUpgrade			;this doesn't work
	End
	
	; After this we can get FB 
	Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
		TriggeredBy		= Upgrade_RohanForgedBlades
		ShowSubObjects	= Forged_Sword
	End	
	
	
	;-------------------------------------------------------------------------------


    Behavior = SquishCollide ModuleTag_06
        ;nothing
    End
    
    Behavior = HordeMemberCollide ModuleTag_HMC
        ;nothing
    End

    Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
        FirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        SecondHeight = 24
        FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes ; I don't detonate, I just hit
        DieOnImpact = Yes
        BounceCount = 1   ; When I hit the ground, I'll arc again
        BounceDistance = 40 ; this far
        BounceFirstHeight = 16  ; Height of Bezier control points above highest intervening terrain
        BounceSecondHeight = 16
        BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2333 ; level 1 (light  damage)  hit reaction animations in ms
        HitReactionLifeTimer2 = 2333 ; level 2 (medium damage)  hit reaction animations in ms
        HitReactionLifeTimer3 = 2333 ; level 3 (heavy  damage)  hit reaction animations in ms

        HitReactionThreshold1 = 5.0   ; level 1 (light  damage) threshold trigger
        HitReactionThreshold2 = 25.0  ; level 2 (medium damage) threshold trigger
        HitReactionThreshold3 = 50.0  ; level 3 (heavy  damage) threshold trigger

        FastHitsResetReaction = Yes    ;If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Male
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes

	Shadow = SHADOW_DECAL	;volumetric shadow that doesn't cast onto all objects.
	ShadowSizeX = 20
	ShadowSizeY = 20
	ShadowTexture = ShadowI

End

ChildObject RohanPeasantAdultAxe RohanPeasantAdult

	; After this we can get FB 
	Behavior = WorkerAIUpdate ModuleTag_10
		AutoAcquireEnemiesWhenIdle		= Yes ATTACK_BUILDINGS
		RepairHealthPercentPerSecond	= 0.2%    ; % of max health to repair each second
		AILuaEventsList					= RohanPeasant3Functions
		AttackPriority				= 	AttackPriority_Infantry
		SpecialContactPoints		   = Repair
	End
	
	; After this we can get FB 
	Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
		TriggeredBy		= Upgrade_RohanForgedBlades
		ShowSubObjects	= Forged_Axe
	End	
End

;;------------------------------------------------------------------------------

;;------------------------------------------------------------------------------
; aka PeasantKid
Object RohanPeasantKid    ; ///  Kid ///
    ; ***ART Parameters ***
    Scale = .89
    SelectPortrait    = UPRohan_Peasant
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = rushield01.tga 0 rushield01.tga
		RandomTexture = rushield02.tga 0 rushield01.tga
		RandomTexture = rushield03.tga 0 rushield01.tga
		RandomTexture = rushield04.tga 0 rushield01.tga
		RandomTexture = rushield05.tga 0 rushield01.tga
		RandomTexture = rushield06.tga 0 rushield01.tga
		RandomTexture = rushield07.tga 0 rushield01.tga
		RandomTexture = rushield08.tga 0 rushield01.tga

;;====================== MODELS ================================================================    
		
		DefaultModelConditionState
			Model               = rusnt03_skn
			Skeleton            = RUPsnt_1_SKL
		End
		
		ModelConditionState = ARMORSET_PLAYER_UPGRADE
			Model               = rusnt03HA_skn
			Skeleton            = RUPsnt_1_SKL
		End
		
		ModelConditionState = USER_1
			Model               = rusnt03DR_skn
			Skeleton            = RUPsnt_1_SKL
		End
        
;;================== ANIMATIONS =================================================================        

;;------------------  DYING -------------------------------------------------------------

        AnimationState                        = PASSENGER
            Animation                        = FLLA
                AnimationName                = RUPsnt_1_FLLA
                AnimationMode                = LOOP
            End
        End
        
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState                        = FREEFALL
            Animation                        = FLYA
                AnimationName                = RUPsnt_1_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.7    0.7
                AnimationBlendTime            = 10
            End
        End
        
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode      = LOOP
            End
            Flags               = RANDOMSTART
        End
        
        AnimationState                        = DYING SPLATTED
            Animation                        = LNDA
                AnimationName                = RUPsnt_1_LNDA
                AnimationMode                = ONCE
            End
        End
        
        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUPsnt_1_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEB
                AnimationName     = RUPsnt_1_DIEB
                AnimationMode     = ONCE
            End            
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUPsnt_1_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
;            Animation           = GTPB
;                AnimationName     = RUPsnt_1_GTPB
;                AnimationMode     = ONCE
;                                AnimationSpeedFactorRange = 1.5 1.5
;            End            
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_1_LNDA
                AnimationMode     = ONCE
            End
        End        
                
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUPsnt_1_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART 
        End


    ;;------------------ ATTACKING ---------------------------------------

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation
                AnimationName        =    RUPsnt_1_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName        =    RUPsnt_1_ATKB
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End            
        End
        
;;------------------ MOVING ------------------------------------------
    
;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = BAKA
                AnimationName        = RUPsnt_1_BAKA
                AnimationMode        = LOOP
            End
;            Animation                = BAKB
;                AnimationName        = RUPsnt_1_BAKB
;                AnimationMode        = LOOP
;            End
;            Animation                = BAKC
;                AnimationName        = RUPsnt_1_BAKC
;                AnimationMode        = LOOP
;            End                                
        End

; OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = RUNM
;                AnimationName        = RUPsnt_1_MFDA
;                AnimationMode        = LOOP
;            End
;            Flags                    = RANDOMSTART
;            ;;ParticleSysBone            = None InfantryDustTrails
;        End
        
        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_1_WLKA
                AnimationMode        = LOOP
            End
;            Animation                = WLKE
;                AnimationName        = RUPsnt_1_WLKE
;                AnimationMode        = LOOP
;            End
            
            ;;ParticleSysBone     = None InfantryDustTrails
        End
        
        AnimationState                = MOVING
            Animation                = RUNA
                AnimationName        = RUPsnt_1_RUNA
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End
            Animation                = RUNC
                AnimationName        = RUPsnt_1_RUNC
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End            
            Flags                    = RANDOMSTART
            ParticleSysBone            = None InfantryDustTrails
        End
        
; WORKING        
        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_1_IDLA 
                AnimationMode        =    LOOP
            End
        End

        
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKA
                AnimationName        = RUPsnt_1_WRKA
                AnimationMode        = ONCE
            End
            Animation                = WRKD
                AnimationName        = RUPsnt_1_WRKD
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End    
    
;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_1_HITA
                AnimationMode = ONCE
            End
        End

;;------------- EMOTIONS ---------------------------------------------

            

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing1
                AnimationName        = RUPsnt_1_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End

;;======= TERROR
        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_1_FERA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_TAUNTING
            Animation                = TNTA
                AnimationName        = RUPsnt_1_TNTA
                AnimationMode        = ONCE
            End
            Animation                = TNTB
                AnimationName        = RUPsnt_1_TNTB
                AnimationMode        = ONCE
            End    
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE        
        End

;;====== CELEBRATING        
            AnimationState                = EMOTION_CELEBRATING
                Animation                = CHRA
                    AnimationName        = RUPsnt_1_CHRA
                    AnimationMode        = ONCE
                End
                Animation                = CHRB
                    AnimationName        = RUPsnt_1_CHRB
                    AnimationMode        = ONCE
                End
                Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
            End
            
            AnimationState                = EMOTION_ALERT
                StateName                = STATE_Alert
                Animation                = &&ALERT&&
                    AnimationName        = RUPsnt_1_IDLA
                    AnimationMode        = LOOP
                End
            End
            
    ;;------------- SELECTED ---------------------------------------------

        AnimationState                =    SELECTED
            StateName                =    STATE_Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUPsnt_1_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End    

    ;;--------------- IDLE STATES -----------------------------------------------------------------    
        IdleAnimationState
            StateName            =    STATE_Idle
            Animation           = IDLA
                AnimationName     = RUPsnt_1_IDLA
                AnimationMode     = ONCE
                AnimationPriority = 20
            End

            Animation           = IDLC
                AnimationName     = RUPsnt_1_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLD
                AnimationName     = RUPsnt_1_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 2
            End

            Animation           = IDLE
                AnimationName     = RUPsnt_1_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLF
                AnimationName     = RUPsnt_1_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLG
                AnimationName     = RUPsnt_1_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 1                
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript        
        End
        
    ;---Transitions-------------------------------------        

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = RUPsnt_1_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End
        
        TransitionState                =    TRANS_IdleToSelected
            Animation                =    ATNA
                AnimationName        =    RUPsnt_1_ATNA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End    
        
    End
    
    ; ***DESIGN parameters ***
    Side = Rohan
    EditorSorting = UNIT
    ThreatLevel = 1.0
    TransportSlotCount = 1
    
    CommandPoints = 2

    CommandSet = PeasantCommandSet
    
    BountyValue = M_ROHAN_PEASANT_BOUNTY_VALUE

    ;;;; WEAPON SETS ;;;;
    WeaponSet
        Conditions          = None 
        Weapon              = PRIMARY        RohanFighterSword
    End
    
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY        RohanFighterSwordUpgraded
    End
    
    ;;;; ARMOR SETS ;;;;    
    ArmorSet
        Conditions      = None
        Armor           = PeasantArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
            
    DisplayName = OBJECT:RohanPeasant
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
    CrushRevengeWeapon = BasicInfantryCrushRevenge
    EquivalentTo = RohanPeasant    


    ; *** AUDIO Parameters ***;

    VoiceAttack                 = PeasantMaleVoiceAttack
    VoiceAttackCharge             = PeasantMaleVoiceAttackCharge
    VoiceAttackStructure             = PeasantMaleVoiceAttackBuilding
    VoiceAttackMachine             = PeasantMaleVoiceAttack
    VoiceCreated                 = PeasantMaleVoiceSalute
    VoiceFullyCreated             = PeasantMaleVoiceSalute
    VoiceGuard                    = PeasantMaleVoiceMove
    VoiceMove                     = PeasantMaleVoiceMove
    VoiceMoveToCamp                 = PeasantMaleVoiceMoveCamp
    VoiceMoveWhileAttacking         = PeasantMaleVoiceDisengage
    VoicePriority                = 30
    VoiceRetreatToCastle             = PeasantMaleVoiceRetreat
    VoiceSelect                 = PeasantMaleVoiceSelect
    VoiceSelect2                 = PeasantVoiceSelect2
    VoiceSelectBattle              = PeasantMaleVoiceSelectBattle
    
    VoiceEnterStateAttack             = PeasantMaleVoiceEnterStateAttack
    VoiceEnterStateAttackCharge         = PeasantMaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackStructure     = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackMachine         = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove             = PeasantMaleVoiceEnterStateMove
    VoiceEnterStateMoveToCamp         = PeasantMaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking     = PeasantMaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle    = PeasantMaleVoiceEnterStateRetreat
        
    SoundImpact                    = ImpactHorse
    
    UnitSpecificSounds
        VoiceGarrison            = PeasantMaleVoiceGarrison    
        VoiceRepair                = PeasantMaleVoiceRepair
    End

    EvaEventDamagedOwner             = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ClientBehavior = RandomSoundSelectorClientBehavior ModuleTag_RSSCB
        ; This is a counter to the similar module in the RohanPeasant4. Without this,
        ; the larger a group, the more likely it is a woman's voice will be heard; until
        ; a 100 peasant group will basically ALWAYS be playing. This ensures that a 
        ; large group of mixed peasants will still be led by a man. [Sorry, but that's
        ; Middle Earth for you -- just ask Eowyn!]
        Chance = 5% 
        RerollOnEveryFrame = No ; For consistancy
        VoicePriority = 32 ; Bossy man is high enough to overcome "bossy" women
    End
    
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_DIEA    Frames:45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_1_SKL.RUPsnt_1_DIEB    Frames:44
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_LNDA    Frames:4
    End


    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER SWARM_DOZER GRAB_AND_DROP
    
;    CommandSet = GondorWorkerCommandSet
    
    Body = ActiveBody ModuleTag_02
        CheerRadius       = M_EMOTION_CHEER_RADIUS
        MaxHealth         = M_ROHAN_PEASANT_HEALTH                ;BALANCE Peasant Health
        MaxHealthDamaged  = M_ROHAN_PEASANT_HEALTH_DAMAGED            
        ;RecoveryTime      = M_ROHAN_PEASANT_HEALTH_RECOVERY_TIME        
    End
    
    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond    = 0.2%    ; % of max health to repair each second
        AILuaEventsList                    = RohanPeasant2Functions
        AttackPriority                =     AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End

    LocomotorSet
        Locomotor = HumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End

    LocomotorSet
        Locomotor = HumanWanderLocomotor
        Condition = SET_WANDER
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End 

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
    End
    
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 4000
        SinkRate = 0.25     ; in Dist/Sec
        DestructionDelay = 10000
            Sound = INITIAL PeasantMaleVoiceDie
    End
    
     Behavior = WeaponSetUpgrade ModuleTag_Weaponpgrade
        TriggeredBy = Upgrade_RohanForgedBlades
    End

     Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy = Upgrade_RohanHeavyArmor
        ArmorSetFlag            = PLAYER_UPGRADE
    End

    ;; Don't remove this. It's required for newly spawned members
    ;; It does not change the armor set, but it allows us to accept the Drafted Upgrade
     Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeDrafted
        TriggeredBy = Upgrade_Drafted
        IgnoreArmorUpgrade = Yes ; does not trigger any armor sets
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End        
    ;-------------------------------------------------------------------------------	
    ;----------------------------------UPGRADES-------------------------------------
    ;-------------------------------------------------------------------------------
		; We get drafted and get USER_1
	Behavior = AttributeModifierUpgrade ModuleTag_Drafteduser
		TriggeredBy = Upgrade_Drafted
		AttributeModifier = RohanPeasantDrafted
	End
	
	Behavior = SubObjectsUpgrade Drafted_Upgrade
		TriggeredBy		= Upgrade_Drafted
		FXListUpgrade   = FX_Draft
		;Sound = INITIAL PeasantVoiceDraftUpgrade			;this doesn't work
	End
	
	; After this we can get FB 
	Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
		TriggeredBy		= Upgrade_RohanForgedBlades
		ShowSubObjects	= Forged_Sword
	End	
	
	
	;-------------------------------------------------------------------------------


    Behavior = SquishCollide ModuleTag_06
        ;nothing
    End
    
    Behavior = HordeMemberCollide ModuleTag_HMC
        ;nothing
    End

    Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
        FirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        SecondHeight = 24
        FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes ; I don't detonate, I just hit
        DieOnImpact = Yes
        BounceCount = 1   ; When I hit the ground, I'll arc again
        BounceDistance = 40 ; this far
        BounceFirstHeight = 16  ; Height of Bezier control points above highest intervening terrain
        BounceSecondHeight = 16
        BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2333 ; level 1 (light  damage)  hit reaction animations in ms
        HitReactionLifeTimer2 = 2333 ; level 2 (medium damage)  hit reaction animations in ms
        HitReactionLifeTimer3 = 2333 ; level 3 (heavy  damage)  hit reaction animations in ms

        HitReactionThreshold1 = 5.0   ; level 1 (light  damage) threshold trigger
        HitReactionThreshold2 = 25.0  ; level 2 (medium damage) threshold trigger
        HitReactionThreshold3 = 50.0  ; level 3 (heavy  damage) threshold trigger

        FastHitsResetReaction = Yes    ;If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Male
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes

	Shadow = SHADOW_DECAL	;volumetric shadow that doesn't cast onto all objects.
	ShadowSizeX = 20
	ShadowSizeY = 20
	ShadowTexture = ShadowI

End

ChildObject RohanPeasantKidAxe RohanPeasantKid

	; After this we can get FB 
	Behavior = WorkerAIUpdate ModuleTag_10
		AutoAcquireEnemiesWhenIdle		= Yes ATTACK_BUILDINGS
		RepairHealthPercentPerSecond	= 0.2%    ; % of max health to repair each second
		AILuaEventsList					= RohanPeasant3Functions
		AttackPriority				= 	AttackPriority_Infantry
		SpecialContactPoints		   = Repair
	End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End
	
	; After this we can get FB 
	Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
		TriggeredBy		= Upgrade_RohanForgedBlades
		ShowSubObjects	= Forged_Axe
	End	
End

;;------------------------------------------------------------------------------


;;------------------------------------------------------------------------------
; aka PeasantSpear
Object RohanPeasantSpear    ; ///  Polearm ///
    ; ***ART Parameters ***
    Scale = .95
    SelectPortrait    = UPRohan_Peasant
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = rupsnt1a.tga 0 rupsnt1a.tga
        RandomTexture = rupsnt1b.tga 0 rupsnt1a.tga
		RandomTexture = rupsnt1c.tga 0 rupsnt1a.tga
		RandomTexture = rupsnt1d.tga 0 rupsnt1a.tga
		
		RandomTexture = rupsnt1aHA.tga 0 rupsnt1aHA.tga
        RandomTexture = rupsnt1bHA.tga 0 rupsnt1aHA.tga
		RandomTexture = rupsnt1cHA.tga 0 rupsnt1aHA.tga
		RandomTexture = rupsnt1dHA.tga 0 rupsnt1aHA.tga
		
		RandomTexture = rushield01.tga 0 rushield01.tga
		RandomTexture = rushield02.tga 0 rushield01.tga
		RandomTexture = rushield03.tga 0 rushield01.tga
		RandomTexture = rushield04.tga 0 rushield01.tga
		RandomTexture = rushield05.tga 0 rushield01.tga
		RandomTexture = rushield06.tga 0 rushield01.tga
		RandomTexture = rushield07.tga 0 rushield01.tga
		RandomTexture = rushield08.tga 0 rushield01.tga

;;====================== MODELS ================================================================    
		
		DefaultModelConditionState
			Model               = rupsnt01_skn
			Skeleton            = eumthlnd_skl
		End
		
		ModelConditionState = ARMORSET_PLAYER_UPGRADE
			Model               = rupsnt01HA_skn
			Skeleton            = eumthlnd_skl
		End
		
		ModelConditionState = USER_1
			Model               = rupsnt01DR_skn
			Skeleton            = eumthlnd_skl
		End
        
;;================== ANIMATIONS =================================================================        

AnimationState                        = PASSENGER
            Animation                        = Grabbed
                AnimationName                = eumthlnd_FLYA
                AnimationMode                = LOOP
            End
        End
        AnimationState                        = THROWN_PROJECTILE
            Animation                       = FlyA
                AnimationName                   = eumthlnd_FLYA
                AnimationMode               = LOOP
            End
        End
        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = eumthlnd_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
        End
	AnimationState = ALTERNATE_FORMATION FIRING_OR_PREATTACK_A
	 	Animation = ATKC
			AnimationName		= EUMthlnd_ATKA
			AnimationMode		= LOOP
			UseWeaponTiming		= Yes	
		End
	End
	AnimationState = ALTERNATE_FORMATION FIRING_OR_PREATTACK_A WEAPONSTATE_CLOSE_RANGE
		Animation = ATKC
			AnimationName		= EUMthlnd_ATKA
			AnimationMode		= ONCE
			UseWeaponTiming		= Yes
		End
		StateName = PikeUp
	End
    AnimationState = ALTERNATE_FORMATION MOVING BACKING_UP
		Animation = Moving_Back
			AnimationName = EUMthlnd_BAKA	
		    AnimationMode = LOOP
		End	
    End
	AnimationState = ALTERNATE_FORMATION MOVING
	 	Animation = ATKC
			AnimationName		= EUMthlnd_RUNB
			AnimationMode		= LOOP
		End
	End
	AnimationState						= DYING SPLATTED
 		Animation						= Splat
			AnimationName				= EUMthlnd_LNDA
			AnimationMode				= ONCE
		End
    End
     AnimationState = ALTERNATE_FORMATION DYING AFLAME
		Animation = Flaming_Death
			AnimationName = EUMthlnd_MFDA
		    AnimationMode = ONCE
		End
    End
    AnimationState =  ALTERNATE_FORMATION DYING 
		Animation = Dying_1
			AnimationName = EUMthlnd_DIEA
			AnimationMode = ONCE
			AnimationBlendTime			= 15
		End
		Animation = Dying_2
			AnimationName = EUMthlnd_DIEB
			AnimationMode = ONCE
			AnimationBlendTime			= 15
		End
		Animation = Dying_3
			AnimationName = EUMthlnd_DIEC
			AnimationMode = ONCE
			AnimationBlendTime			= 15
		End
    End
	 AnimationState = ALTERNATE_FORMATION
         Animation = ATKC
            AnimationName        = EUMthlnd_PTLB
            AnimationMode        = LOOP
        End
        StateName = STATE_Planted
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev ~= "STATE_Planted"	and Prev ~= "Trans_Up_To_Down" then CurDrawableSetTransitionAnimState("Trans_Up_To_Down") return end
		EndScript
    End
        AnimationState                        = STUNNED_FLAILING 
            Animation                       = FlyA
                AnimationName               = eumthlnd_FLYA
                AnimationMode               = LOOP
            End
        End
        AnimationState                         = DYING SPLATTED
            Animation                         = Splatted_On_Ground
                AnimationName                 = eumthlnd_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
        End
        AnimationState                        = DYING AFLAME
            Animation                        = MFDA
                AnimationName                = eumthlnd_MFDA
                AnimationMode                = LOOP
            End
        End
        AnimationState                        = DYING
            Animation                        = DIEB
                AnimationName                = eumthlnd_DIEA
                AnimationMode                = ONCE
            End
            Animation                        = DIEC
                AnimationName                = eumthlnd_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = DIED
                AnimationName                = eumthlnd_DIEC
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = STUNNED_STANDING_UP
            Animation                        = GTPA
                AnimationName                = eumthlnd_GTPA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End
        AnimationState            =     STUNNED
            Animation            =     Slatted_On_Ground
            AnimationName                 = eumthlnd_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
       End
	   
	   ; "building" with huge hammer
		AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
			Animation				=	Stand
				AnimationName		=	IUSaruman_SKL.eumthlnd_idla 
				AnimationMode		=	LOOP
			End
		End

		
		AnimationState				= ACTIVELY_CONSTRUCTING
			Animation				= WRKA
				AnimationName		= IUSaruman_SKL.eumthlnd_ATKA
				AnimationMode		= ONCE
			End
			Flags					= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End	
	   
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
			Animation           = RunAndFire
                AnimationName       = eumthlnd_ATRA
                AnimationMode       = LOOP
            End
            ParticleSysBone                = None InfantryDustTrails
            Flags               = RANDOMSTART  
        End
        AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
            Animation                    = TerrorFromTheSky
                AnimationName            = eumthlnd_RUNE
                AnimationMode            = LOOP
            End
            ParticleSysBone                = None InfantryDustTrails
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING EMOTION_TERROR
            Animation                        = TerrorFromTheSky
                AnimationName                = eumthlnd_RUNE
                AnimationMode                = ONCE
            End
            ParticleSysBone                = None InfantryDustTrails
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState                        = MOVING BACKING_UP
            Animation                        = BAKA
                AnimationName                = eumthlnd_BAKA
                AnimationMode                = LOOP
            End
            Animation                        = BAKB
                AnimationName                = eumthlnd_BAKB
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING PANICKING
            Animation                        = MFDA
                AnimationName                = eumthlnd_MFDA
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
            ParticleSysBone                = None InfantryDustTrails
        End
		AnimationState                        = MOVING ATTACKING
            Animation = TrotAndFire
				AnimationName = EUMthlnd_RUNC
				AnimationMode = LOOP
			End
			Animation = TrotAndFire2
				AnimationName = EUMthlnd_RUND
				AnimationMode = LOOP
			End
            Flags                            = RANDOMSTART
            ParticleSysBone                = None InfantryDustTrails
        End
		AnimationState                        = MOVING
            ShareAnimation                    = Yes
			Animation = RUNA
				AnimationName = EUMthlnd_RUNA
				AnimationMode = LOOP
			End
			Animation = RUNB
				AnimationName = EUMthlnd_RUNB
				AnimationMode = LOOP
			End
            Flags                            = RANDOMSTART
            ParticleSysBone                = None InfantryDustTrails
        End
        AnimationState                        = EMOTION_UNCONTROLLABLY_AFRAID
            Animation                        = FERA
                AnimationName                = eumthlnd_FERA
                AnimationMode                = LOOP
            End 
        End
        AnimationState                        = FIRING_OR_PREATTACK_A
           Animation                        = ATA1
                AnimationName                = eumthlnd_ATKA
                AnimationMode                = ONCE
            End
			Animation                        = ATA2
                AnimationName                = eumthlnd_ATKB
                AnimationMode                = ONCE
            End
			Animation                        = ATA3
                AnimationName                = eumthlnd_ATKC
                AnimationMode                = ONCE
            End
			Flags                            = RANDOMSTART
            ParticleSysBone                = None MeleeDust
        End
        AnimationState                        = ATTACKING
            Animation                        = ALERT_1
                AnimationName                = eumthlnd_IDLA
                AnimationMode                = LOOP
            End
        End
        AnimationState                        = HIT_REACTION
            Animation                        = HITB
                AnimationName                = eumthlnd_HITA
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = EMOTION_ALERT EMOTION_AFRAID
            Animation                        = APPB
                AnimationName                = eumthlnd_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = RANDOMSTART
        End
        AnimationState                        = EMOTION_AFRAID
            Animation                        = FERA
                AnimationName                = eumthlnd_FERA
                AnimationMode                = LOOP
            End 
        End
        AnimationState                        = EMOTION_POINTING
            Animation                        = Pointing1
                AnimationName                = eumthlnd_PNTA
                AnimationMode                = LOOP
            End
        End
		AnimationState                        = EMOTION_TAUNTING
            Animation                        = Taunting1
                AnimationName                = eumthlnd_TNTA
                AnimationMode                = ONCE
            End
            Animation                        = Taunting2
                AnimationName                = eumthlnd_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState                        = EMOTION_CELEBRATING
            Animation                        = CHRB
                AnimationName                = eumthlnd_CHRA
                AnimationMode                = ONCE
            End
            Animation                        = CHRC
                AnimationName                = eumthlnd_CHRB
                AnimationMode                = ONCE
            End
			Animation                        = CHRC
                AnimationName                = eumthlnd_CHRC
                AnimationMode                = ONCE
            End
            Flags                            =    RESTART_ANIM_WHEN_COMPLETE
        End
		AnimationState                        = EMOTION_ALERT
            Animation                        = ALERT_1
                AnimationName                = eumthlnd_IDLA
                AnimationMode                = LOOP
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = eumthlnd_ATNB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" 
                then 
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") 
                end
                if CurDrawableModelcondition("ATTACKING")
                then
                    return "IDLA"
                else
                    return "ATNA"
                end
            EndScript
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End
        AnimationState                = USER_3
            StateName                = STATE_User_3
            Animation                = GUARD_STANCE
                AnimationName        = eumthlnd_IDLA
                AnimationMode        = LOOP
            End
        End	
        IdleAnimationState				= 
            StateName                = STATE_Idle
            Animation                = IDLB
                AnimationName       = eumthlnd_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 20
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLF
                AnimationName       = eumthlnd_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 1
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLG
                AnimationName       = eumthlnd_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 1
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLJ
                AnimationName       = eumthlnd_IDLE
                AnimationMode       = ONCE
                AnimationPriority   = 1
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End       
			Flags                    = RESTART_ANIM_WHEN_COMPLETE  
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End
        TransitionState       = TRANS_TO_USER_1
            Animation
                AnimationName     = eumthlnd_RCTA
                AnimationMode     = ONCE
            End
        End
        TransitionState       = TRANS_IdleToSelected
            Animation           = ATNA
                AnimationName     = eumthlnd_ATNA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End
        TransitionState        = TRANS_SelectedToIdle
            Animation            = ATND
                AnimationName    = eumthlnd_ATNC
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End
		TransitionState = Trans_Down_To_Up
			Animation = Transition
				AnimationName = EUMthlnd_PLTC
				AnimationMode = ONCE
			End
		End
		TransitionState = Trans_Up_To_Down
			Animation = Transition
				AnimationName = EUMthlnd_PLTA
				AnimationMode = ONCE
			End
		End
		TransitionState = TRANS_BS_Normal
			Animation = Transition
				AnimationName				= EUMthlnd_ATNA
				AnimationMode				= ONCE
				AnimationBlendTime			= 10
				AnimationMustCompleteBlend	= yes
			End
		End
		TransitionState = TRANS_SR_Alt
		End
		TransitionState = TRANS_RS_Alt
		End
		TransitionState = TRANS_BS_Alt
		End
		TransitionState = TRANS_SB_Alt
		End
		TransitionState = TRANS_BR_Alt
		End
		TransitionState = TRANS_RB_Alt
		End
	End
    
    ; ***DESIGN parameters ***
    Side = Rohan
    EditorSorting = UNIT
    ThreatLevel = 1.0
    TransportSlotCount = 1
    
    CommandPoints = 2

    CommandSet = PeasantCommandSet
    
    BountyValue = M_ROHAN_PEASANT_BOUNTY_VALUE

    ;;;; WEAPON SETS ;;;;
    WeaponSet
        Conditions          = None 
        Weapon              = PRIMARY        RohanFighterSword
    End
    
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY        RohanFighterSwordUpgraded
    End
    
    ;;;; ARMOR SETS ;;;;    
    ArmorSet
        Conditions      = None
        Armor           = PeasantArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
            
    DisplayName = OBJECT:RohanPeasant
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
    CrushRevengeWeapon = BasicInfantryCrushRevenge
    EquivalentTo = RohanPeasant    


    ; *** AUDIO Parameters ***;

    VoiceAttack                 = PeasantMaleVoiceAttack
    VoiceAttackCharge             = PeasantMaleVoiceAttackCharge
    VoiceAttackStructure             = PeasantMaleVoiceAttackBuilding
    VoiceAttackMachine             = PeasantMaleVoiceAttack
    VoiceCreated                 = PeasantMaleVoiceSalute
    VoiceFullyCreated             = PeasantMaleVoiceSalute
    VoiceGuard                    = PeasantMaleVoiceMove
    VoiceMove                     = PeasantMaleVoiceMove
    VoiceMoveToCamp                 = PeasantMaleVoiceMoveCamp
    VoiceMoveWhileAttacking         = PeasantMaleVoiceDisengage
    VoicePriority                = 30
    VoiceRetreatToCastle             = PeasantMaleVoiceRetreat
    VoiceSelect                 = PeasantMaleVoiceSelect
    VoiceSelect2                 = PeasantVoiceSelect2
    VoiceSelectBattle              = PeasantMaleVoiceSelectBattle
    
    VoiceEnterStateAttack             = PeasantMaleVoiceEnterStateAttack
    VoiceEnterStateAttackCharge         = PeasantMaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackStructure     = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackMachine         = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove             = PeasantMaleVoiceEnterStateMove
    VoiceEnterStateMoveToCamp         = PeasantMaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking     = PeasantMaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle    = PeasantMaleVoiceEnterStateRetreat
        
    SoundImpact                    = ImpactHorse
    
    UnitSpecificSounds
        VoiceGarrison            = PeasantMaleVoiceGarrison    
        VoiceRepair                = PeasantMaleVoiceRepair
    End

    EvaEventDamagedOwner             = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ClientBehavior = RandomSoundSelectorClientBehavior ModuleTag_RSSCB
        ; This is a counter to the similar module in the RohanPeasant4. Without this,
        ; the larger a group, the more likely it is a woman's voice will be heard; until
        ; a 100 peasant group will basically ALWAYS be playing. This ensures that a 
        ; large group of mixed peasants will still be led by a man. [Sorry, but that's
        ; Middle Earth for you -- just ask Eowyn!]
        Chance = 5% 
        RerollOnEveryFrame = No ; For consistancy
        VoicePriority = 32 ; Bossy man is high enough to overcome "bossy" women
    End
    
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_DIEA    Frames:45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_1_SKL.RUPsnt_1_DIEB    Frames:44
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_LNDA    Frames:4
    End


    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER SWARM_DOZER GRAB_AND_DROP
    
;    CommandSet = GondorWorkerCommandSet
    
    Body = ActiveBody ModuleTag_02
        CheerRadius       = M_EMOTION_CHEER_RADIUS
        MaxHealth         = M_ROHAN_PEASANT_HEALTH                ;BALANCE Peasant Health
        MaxHealthDamaged  = M_ROHAN_PEASANT_HEALTH_DAMAGED            
        ;RecoveryTime      = M_ROHAN_PEASANT_HEALTH_RECOVERY_TIME        
    End
    
    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond    = 0.2%    ; % of max health to repair each second
        AILuaEventsList                    = RohanPeasant1Functions
        AttackPriority                =     AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End

    LocomotorSet
        Locomotor = HumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End

    LocomotorSet
        Locomotor = HumanWanderLocomotor
        Condition = SET_WANDER
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End 

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
    End
    
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 4000
        SinkRate = 0.25     ; in Dist/Sec
        DestructionDelay = 10000
            Sound = INITIAL PeasantMaleVoiceDie
    End
    
     Behavior = WeaponSetUpgrade ModuleTag_Weaponpgrade
        TriggeredBy = Upgrade_RohanForgedBlades
    End

     Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy = Upgrade_RohanHeavyArmor
        ArmorSetFlag            = PLAYER_UPGRADE
    End

    ;; Don't remove this. It's required for newly spawned members
    ;; It does not change the armor set, but it allows us to accept the Drafted Upgrade
     Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeDrafted
        TriggeredBy = Upgrade_Drafted
        IgnoreArmorUpgrade = Yes ; does not trigger any armor sets
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End        
    ;-------------------------------------------------------------------------------	
    ;----------------------------------UPGRADES-------------------------------------
    ;-------------------------------------------------------------------------------
		; We get drafted and get USER_1
	Behavior = AttributeModifierUpgrade ModuleTag_Drafteduser
		TriggeredBy = Upgrade_Drafted
		AttributeModifier = RohanPeasantDrafted
	End
	
	Behavior = SubObjectsUpgrade Drafted_Upgrade
		TriggeredBy		= Upgrade_Drafted
		FXListUpgrade   = FX_Draft
		;Sound = INITIAL PeasantVoiceDraftUpgrade			;this doesn't work
	End
	
	; After this we can get FB 
	Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
		TriggeredBy		= Upgrade_RohanForgedBlades
		ShowSubObjects	= Forged_Spear
	End	
	
	
	;-------------------------------------------------------------------------------


    Behavior = SquishCollide ModuleTag_06
        ;nothing
    End
    
    Behavior = HordeMemberCollide ModuleTag_HMC
        ;nothing
    End

    Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
        FirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        SecondHeight = 24
        FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes ; I don't detonate, I just hit
        DieOnImpact = Yes
        BounceCount = 1   ; When I hit the ground, I'll arc again
        BounceDistance = 40 ; this far
        BounceFirstHeight = 16  ; Height of Bezier control points above highest intervening terrain
        BounceSecondHeight = 16
        BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2333 ; level 1 (light  damage)  hit reaction animations in ms
        HitReactionLifeTimer2 = 2333 ; level 2 (medium damage)  hit reaction animations in ms
        HitReactionLifeTimer3 = 2333 ; level 3 (heavy  damage)  hit reaction animations in ms

        HitReactionThreshold1 = 5.0   ; level 1 (light  damage) threshold trigger
        HitReactionThreshold2 = 25.0  ; level 2 (medium damage) threshold trigger
        HitReactionThreshold3 = 50.0  ; level 3 (heavy  damage) threshold trigger

        FastHitsResetReaction = Yes    ;If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Male
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes

	Shadow = SHADOW_DECAL	;volumetric shadow that doesn't cast onto all objects.
	ShadowSizeX = 20
	ShadowSizeY = 20
	ShadowTexture = ShadowI

End

;;------------------------------------------------------------------------------
; aka Peasant1
Object RohanPeasant1    ; ///  Adult ///
    ; ***ART Parameters ***
    
    SelectPortrait    = UPRohan_Peasant
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = RUPeasant01.tga 0 RUPeasant01HA.tga
        RandomTexture = rupeasant02.tga 0 RUPeasant01HA.tga
		RandomTexture = rupeasant03.tga 0 RUPeasant01HA.tga
		RandomTexture = rupeasant04.tga 0 RUPeasant01HA.tga
		
		RandomTexture = ruhood.tga 0 RUHood.tga
		RandomTexture = ruhood2.tga 0 RUHood.tga
		RandomTexture = ruhood3.tga 0 RUHood.tga
		
		RandomTexture = ruhelm.tga 0 RUhelm.tga
		RandomTexture = ruhelm2.tga 0 RUhelm.tga
		RandomTexture = ruhelm3.tga 0 RUhelm.tga

;;====================== MODELS ================================================================    
        DefaultModelConditionState
            Model               = RUPsnt_1_SKN
            Skeleton            = RUPsnt_1_SKL
        End
        
;;================== ANIMATIONS =================================================================        

;;------------------  DYING -------------------------------------------------------------

        AnimationState                        = PASSENGER
            Animation                        = FLLA
                AnimationName                = RUPsnt_1_FLLA
                AnimationMode                = LOOP
            End
        End
        
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState                        = FREEFALL
            Animation                        = FLYA
                AnimationName                = RUPsnt_1_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.7    0.7
                AnimationBlendTime            = 10
            End
        End
        
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUPsnt_1_FLYA
                AnimationMode      = LOOP
            End
            Flags               = RANDOMSTART
        End
        
        AnimationState                        = DYING SPLATTED
            Animation                        = LNDA
                AnimationName                = RUPsnt_1_LNDA
                AnimationMode                = ONCE
            End
        End
        
        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUPsnt_1_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEB
                AnimationName     = RUPsnt_1_DIEB
                AnimationMode     = ONCE
            End            
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUPsnt_1_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
;            Animation           = GTPB
;                AnimationName     = RUPsnt_1_GTPB
;                AnimationMode     = ONCE
;                                AnimationSpeedFactorRange = 1.5 1.5
;            End            
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_1_LNDA
                AnimationMode     = ONCE
            End
        End        
                
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUPsnt_1_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART 
        End


    ;;------------------ ATTACKING ---------------------------------------

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation
                AnimationName        =    RUPsnt_1_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName        =    RUPsnt_1_ATKB
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End            
        End
        
;;------------------ MOVING ------------------------------------------
    
;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = BAKA
                AnimationName        = RUPsnt_1_BAKA
                AnimationMode        = LOOP
            End
;            Animation                = BAKB
;                AnimationName        = RUPsnt_1_BAKB
;                AnimationMode        = LOOP
;            End
;            Animation                = BAKC
;                AnimationName        = RUPsnt_1_BAKC
;                AnimationMode        = LOOP
;            End                                
        End

; OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = RUNM
;                AnimationName        = RUPsnt_1_MFDA
;                AnimationMode        = LOOP
;            End
;            Flags                    = RANDOMSTART
;            ;;ParticleSysBone            = None InfantryDustTrails
;        End
        
        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_1_WLKA
                AnimationMode        = LOOP
            End
;            Animation                = WLKE
;                AnimationName        = RUPsnt_1_WLKE
;                AnimationMode        = LOOP
;            End
            
            ;;ParticleSysBone     = None InfantryDustTrails
        End
        
        AnimationState                = MOVING
            Animation                = RUNA
                AnimationName        = RUPsnt_1_RUNA
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End
            Animation                = RUNC
                AnimationName        = RUPsnt_1_RUNC
                AnimationMode        = LOOP
;                AnimationSpeedFactorRange = 0.8 0.8
            End            
            Flags                    = RANDOMSTART
            ParticleSysBone            = None InfantryDustTrails
        End
        
; WORKING        
        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_1_IDLA 
                AnimationMode        =    LOOP
            End
        End

        
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKA
                AnimationName        = RUPsnt_1_WRKA
                AnimationMode        = ONCE
            End
            Animation                = WRKD
                AnimationName        = RUPsnt_1_WRKD
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End    
    
;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_1_HITA
                AnimationMode = ONCE
            End
        End

;;------------- EMOTIONS ---------------------------------------------

            

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing1
                AnimationName        = RUPsnt_1_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End

;;======= TERROR
        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_1_FERA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_TAUNTING
            Animation                = TNTA
                AnimationName        = RUPsnt_1_TNTA
                AnimationMode        = ONCE
            End
            Animation                = TNTB
                AnimationName        = RUPsnt_1_TNTB
                AnimationMode        = ONCE
            End    
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE        
        End

;;====== CELEBRATING        
            AnimationState                = EMOTION_CELEBRATING
                Animation                = CHRA
                    AnimationName        = RUPsnt_1_CHRA
                    AnimationMode        = ONCE
                End
                Animation                = CHRB
                    AnimationName        = RUPsnt_1_CHRB
                    AnimationMode        = ONCE
                End
                Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
            End
            
            AnimationState                = EMOTION_ALERT
                StateName                = STATE_Alert
                Animation                = &&ALERT&&
                    AnimationName        = RUPsnt_1_IDLA
                    AnimationMode        = LOOP
                End
            End
            
    ;;------------- SELECTED ---------------------------------------------

        AnimationState                =    SELECTED
            StateName                =    STATE_Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUPsnt_1_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End    

    ;;--------------- IDLE STATES -----------------------------------------------------------------    
        IdleAnimationState
            StateName            =    STATE_Idle
            Animation           = IDLA
                AnimationName     = RUPsnt_1_IDLA
                AnimationMode     = ONCE
                AnimationPriority = 20
            End

            Animation           = IDLC
                AnimationName     = RUPsnt_1_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLD
                AnimationName     = RUPsnt_1_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 2
            End

            Animation           = IDLE
                AnimationName     = RUPsnt_1_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLF
                AnimationName     = RUPsnt_1_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLG
                AnimationName     = RUPsnt_1_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 1                
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript        
        End
        
    ;---Transitions-------------------------------------        

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = RUPsnt_1_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End
        
        TransitionState                =    TRANS_IdleToSelected
            Animation                =    ATNA
                AnimationName        =    RUPsnt_1_ATNA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End    
        
    End
    
    ; ***DESIGN parameters ***
    Side = Rohan
    EditorSorting = UNIT
    ThreatLevel = 1.0
    TransportSlotCount = 1
    
    CommandPoints = 2

    CommandSet = PeasantCommandSet
    
    BountyValue = M_ROHAN_PEASANT_BOUNTY_VALUE

    ;;;; WEAPON SETS ;;;;
    WeaponSet
        Conditions          = None 
        Weapon              = PRIMARY        RohanFighterSword
    End
    
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY        RohanFighterSwordUpgraded
    End
    
    ;;;; ARMOR SETS ;;;;    
    ArmorSet
        Conditions      = None
        Armor           = PeasantArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
            
    DisplayName = OBJECT:RohanPeasant
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
    CrushRevengeWeapon = BasicInfantryCrushRevenge
    EquivalentTo = RohanPeasant    


    ; *** AUDIO Parameters ***;

    VoiceAttack                 = PeasantMaleVoiceAttack
    VoiceAttackCharge             = PeasantMaleVoiceAttackCharge
    VoiceAttackStructure             = PeasantMaleVoiceAttackBuilding
    VoiceAttackMachine             = PeasantMaleVoiceAttack
    VoiceCreated                 = PeasantMaleVoiceSalute
    VoiceFullyCreated             = PeasantMaleVoiceSalute
    VoiceGuard                    = PeasantMaleVoiceMove
    VoiceMove                     = PeasantMaleVoiceMove
    VoiceMoveToCamp                 = PeasantMaleVoiceMoveCamp
    VoiceMoveWhileAttacking         = PeasantMaleVoiceDisengage
    VoicePriority                = 30
    VoiceRetreatToCastle             = PeasantMaleVoiceRetreat
    VoiceSelect                 = PeasantMaleVoiceSelect
    VoiceSelect2                 = PeasantVoiceSelect2
    VoiceSelectBattle              = PeasantMaleVoiceSelectBattle
    
    VoiceEnterStateAttack             = PeasantMaleVoiceEnterStateAttack
    VoiceEnterStateAttackCharge         = PeasantMaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackStructure     = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackMachine         = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove             = PeasantMaleVoiceEnterStateMove
    VoiceEnterStateMoveToCamp         = PeasantMaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking     = PeasantMaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle    = PeasantMaleVoiceEnterStateRetreat
        
    SoundImpact                    = ImpactHorse
    
    UnitSpecificSounds
        VoiceGarrison            = PeasantMaleVoiceGarrison    
        VoiceRepair                = PeasantMaleVoiceRepair
    End

    EvaEventDamagedOwner             = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ClientBehavior = RandomSoundSelectorClientBehavior ModuleTag_RSSCB
        ; This is a counter to the similar module in the RohanPeasant4. Without this,
        ; the larger a group, the more likely it is a woman's voice will be heard; until
        ; a 100 peasant group will basically ALWAYS be playing. This ensures that a 
        ; large group of mixed peasants will still be led by a man. [Sorry, but that's
        ; Middle Earth for you -- just ask Eowyn!]
        Chance = 5% 
        RerollOnEveryFrame = No ; For consistancy
        VoicePriority = 32 ; Bossy man is high enough to overcome "bossy" women
    End
    
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_DIEA    Frames:45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_1_SKL.RUPsnt_1_DIEB    Frames:44
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_1_SKL.RUPsnt_1_LNDA    Frames:4
    End


    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER SWARM_DOZER GRAB_AND_DROP
    
;    CommandSet = GondorWorkerCommandSet
    
    Body = ActiveBody ModuleTag_02
        CheerRadius       = M_EMOTION_CHEER_RADIUS
        MaxHealth         = M_ROHAN_PEASANT_HEALTH                ;BALANCE Peasant Health
        MaxHealthDamaged  = M_ROHAN_PEASANT_HEALTH_DAMAGED            
        ;RecoveryTime      = M_ROHAN_PEASANT_HEALTH_RECOVERY_TIME        
    End
    
    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond    = 0.2%    ; % of max health to repair each second
        AILuaEventsList                    = StandardPeasantFunctions
        AttackPriority                =     AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End

    LocomotorSet
        Locomotor = HumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End

    LocomotorSet
        Locomotor = HumanWanderLocomotor
        Condition = SET_WANDER
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End 

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
    End
    
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 4000
        SinkRate = 0.25     ; in Dist/Sec
        DestructionDelay = 10000
            Sound = INITIAL PeasantMaleVoiceDie
    End
    
     Behavior = WeaponSetUpgrade ModuleTag_Weaponpgrade
        TriggeredBy = Upgrade_RohanForgedBlades
    End

     Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy = Upgrade_RohanHeavyArmor
        ArmorSetFlag            = PLAYER_UPGRADE
    End

    ;; Don't remove this. It's required for newly spawned members
    ;; It does not change the armor set, but it allows us to accept the Drafted Upgrade
     Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeDrafted
        TriggeredBy = Upgrade_Drafted
        IgnoreArmorUpgrade = Yes ; does not trigger any armor sets
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End        

    ;-------------------------------------------------------------------------------
    ;
    ;    Sub objects upgrade.
    ;
    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy    = Upgrade_RohanHeavyArmor
        ShowSubObjects    = HELMET
        HideSubObjects    = HAMMER
        UpgradeTexture    = RUPeasant01.tga 0 RUPeasant01HA.tga
        UpgradeTexture    = RUPeasant02.tga 0 RUPeasant02HA.tga
		UpgradeTexture    = RUPeasant03.tga 0 RUPeasant03HA.tga
        UpgradeTexture    = RUPeasant04.tga 0 RUPeasant04HA.tga
    ;    UpgradeTexture    = RUPeasantWep.tga 0 RUPeasantWep_HA.tga
    ;    UpgradeTexture    = RUPeasantWep_L.tga 0 RUPeasantWep_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End
    
    Behavior = SubObjectsUpgrade ForgedBlade_Upgrade
        TriggeredBy        = Upgrade_RohanForgedBlades
        ShowSubObjects    = FORGED_BLADE SWORD            ; Forged blade will give us a sword too, as we'll get a weapon upgrade.
        HideSubObjects    = HAMMER
    End
    
    Behavior = SubObjectsUpgrade Drafted_Upgrade
        TriggeredBy        = Upgrade_Drafted
        ShowSubObjects    = SWORD SHIELD
        HideSubObjects    = HAMMER
        FXListUpgrade   = FX_Draft
        ;Sound = INITIAL PeasantVoiceDraftUpgrade            ;this doesn't work
    End
    ;-------------------------------------------------------------------------------


    Behavior = SquishCollide ModuleTag_06
        ;nothing
    End
    
    Behavior = HordeMemberCollide ModuleTag_HMC
        ;nothing
    End

    Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
        FirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        SecondHeight = 24
        FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes ; I don't detonate, I just hit
        DieOnImpact = Yes
        BounceCount = 1   ; When I hit the ground, I'll arc again
        BounceDistance = 40 ; this far
        BounceFirstHeight = 16  ; Height of Bezier control points above highest intervening terrain
        BounceSecondHeight = 16
        BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2333 ; level 1 (light  damage)  hit reaction animations in ms
        HitReactionLifeTimer2 = 2333 ; level 2 (medium damage)  hit reaction animations in ms
        HitReactionLifeTimer3 = 2333 ; level 3 (heavy  damage)  hit reaction animations in ms

        HitReactionThreshold1 = 5.0   ; level 1 (light  damage) threshold trigger
        HitReactionThreshold2 = 25.0  ; level 2 (medium damage) threshold trigger
        HitReactionThreshold3 = 50.0  ; level 3 (heavy  damage) threshold trigger

        FastHitsResetReaction = Yes    ;If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Male
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes

	Shadow = SHADOW_DECAL	;volumetric shadow that doesn't cast onto all objects.
	ShadowSizeX = 20
	ShadowSizeY = 20
	ShadowTexture = ShadowI

End

;;------------------------------------------------------------------------------
; aka Peasant2  /// ADULT ////
ChildObject RohanPeasant2 RohanPeasant1
    ; ***ART Parameters ***
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = RUPeasant01.tga 0 RUPeasant01.tga
        RandomTexture = rupeasant02.tga 0 RUPeasant01.tga
		RandomTexture = rupeasant03.tga 0 RUPeasant01.tga
		RandomTexture = rupeasant04.tga 0 RUPeasant01.tga
		
		RandomTexture = ruhood.tga 0 RUHood.tga
		RandomTexture = ruhood02.tga 0 RUHood.tga
		RandomTexture = ruhood03.tga 0 RUHood.tga
		
		RandomTexture = ruhelm.tga 0 RUhelm.tga
		RandomTexture = ruhelm02.tga 0 RUhelm.tga
		RandomTexture = ruhelm03.tga 0 RUhelm.tga
    
;;====================== MODELS ================================================================    
        DefaultModelConditionState
            Model               = RUPsnt_2_SKN
            Skeleton            = RUPsnt_2_SKL
        End

;;================== ANIMATIONS =================================================================        

;;------------------  DYING -------------------------------------------------------------
        
        AnimationState        = PASSENGER
            Animation           = FLLA
                AnimationName     = RUPsnt_2_FLLA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = RUPsnt_2_FLYA
                AnimationMode     = LOOP
            End
        End
        
        

        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUPsnt_2_DIEA
                AnimationMode     = ONCE
            End
        End
        
        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUPsnt_2_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_2_LNDA
                AnimationMode     = ONCE
            End
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_2_LNDA
                AnimationMode     = ONCE
            End
        End    

;;------------------ ATTACKING ---------------------------------------

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation
                AnimationName        =    RUPsnt_2_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
        End

;;------------------ MOVING ------------------------------------------

;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = &&TERROR&&
                AnimationName        = RUPsnt_2_IDLA
                AnimationMode        = LOOP
            End
        End

; OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = WLKM
;                AnimationName        = RUPsnt_2_MFDA
;                AnimationMode        = LOOP
;            End
;            ;;ParticleSysBone     = None InfantryDustTrails
;        End
        
        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_2_WLKA
                AnimationMode        = LOOP
            End
            ;;ParticleSysBone     = None InfantryDustTrails
        End
        
        AnimationState                = MOVING
            Animation                = RUNA
                AnimationName        = RUPsnt_2_RUNA
                AnimationMode        = LOOP
                                AnimationSpeedFactorRange = 1.00 1.15 ;--- JGS
            End
            Flags                    = RANDOMSTART
            ;;ParticleSysBone            = None InfantryDustTrails
        End

; WORKING    

        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_2_IDLA 
                AnimationMode        =    LOOP
            End
        End

        
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKA
                AnimationName        = RUPsnt_2_WRKA
                AnimationMode        = LOOP
            End
        End

;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_2_HITA
                AnimationMode = ONCE
            End
        End
                
;;------------- EMOTIONS ---------------------------------------------

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing2
                AnimationName        = RUPsnt_2_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End

;;======= TERROR

        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_2_IDLA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_TAUNTING
            Animation                = &&TAUNT&&
                AnimationName        = RUPsnt_2_IDLA
                AnimationMode        = LOOP
            End
        End

;;====== CELEBRATING        
        AnimationState                = EMOTION_CELEBRATING
            Animation                = &&CHEER&&
                AnimationName        = RUPsnt_2_IDLA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_ALERT
            Animation                = &&ALERT&&
                AnimationName        = RUPsnt_2_IDLA
                AnimationMode        = LOOP
            End
        End

;;------------- SELECTED ---------------------------------------------

    IdleAnimationState
        Animation                = IDLA
            AnimationName        = RUPsnt_2_IDLA
            AnimationMode        = ONCE
        End
    End
        
;;--------------- IDLE STATES -----------------------------------------------------------------    

    ;---Transitions-------------------------------------
    
    
    End
    
    EquivalentTo = RohanPeasant    


; *** AUDIO Parameters ***;

    VoicePriority = 1
    VoiceFear = NoSound
    VoiceGuard = NoSound

    SoundImpact = ImpactHorse
    
    ;UnitSpecificSounds
    ;    VoiceGarrison         = NoSound
    ;    VoiceEnter            = NoSound
    ;    VoiceEnterHostile     = NoSound
    ;    VoiceGetHealed        = NoSound
    ;End

    EvaEventDamagedOwner = UnitUnderAttack        ;Eva event to trigger when unit is damaged


    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant     ; Peasant_Boy
    End


; *** ENGINEERING PARAMETERS *** ;

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy        = Upgrade_RohanHeavyArmor
        ShowSubObjects    = HELMET
        UpgradeTexture    = RUPeasant01.tga 0 RUPeasant01HA.tga
        UpgradeTexture    = RUPeasant02.tga 0 RUPeasant02HA.tga
		UpgradeTexture    = RUPeasant03.tga 0 RUPeasant03HA.tga
        UpgradeTexture    = RUPeasant04.tga 0 RUPeasant04HA.tga
    ;    UpgradeTexture    = RUPeasantWep.tga 0 RUPeasantWep_HA.tga
    ;    UpgradeTexture    = RUPeasantWep_L.tga 0 RUPeasantWep_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

End

;;------------------------------------------------------------------------------
; aka Peasant3  /// FAT GUY ///
ChildObject RohanPeasant3 RohanPeasant1
    ; ***ART Parameters ***
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
          OkToChangeModelColor = Yes
          
        RandomTexture = RUPeasant01.tga 0 RUPeasant01.tga
        RandomTexture = rupeasant02.tga 0 RUPeasant01.tga
		RandomTexture = rupeasant03.tga 0 RUPeasant01.tga
		RandomTexture = rupeasant04.tga 0 RUPeasant01.tga
		
		RandomTexture = ruhood.tga 0 RUHood.tga
		RandomTexture = ruhood02.tga 0 RUHood.tga
		RandomTexture = ruhood03.tga 0 RUHood.tga
		
		RandomTexture = ruhelm.tga 0 RUhelm.tga
		RandomTexture = ruhelm02.tga 0 RUhelm.tga
		RandomTexture = ruhelm03.tga 0 RUhelm.tga

;;====================== MODELS ================================================================        
        DefaultModelConditionState
            Model               = RUPsnt_3_SKN
            Skeleton            = RUPsnt_3_SKL
        End
        
;;================== ANIMATIONS =================================================================                

;;------------------  DYING -------------------------------------------------------------
    
        AnimationState                        = PASSENGER
            Animation                        = FLLA
                AnimationName                = RUPsnt_3_FLLA
                AnimationMode                = LOOP
            End
        End
        
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = RUPsnt_3_FLYA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState                        = FREEFALL
            Animation                        = FLYA
                AnimationName                = RUPsnt_3_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.7    0.7
                AnimationBlendTime            = 10
            End
        End
        
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUPsnt_3_FLYA
                AnimationMode      = LOOP
            End
            Flags               = RANDOMSTART
        End
        
        AnimationState                        = DYING SPLATTED
            Animation                        = LNDA
                AnimationName                = RUPsnt_3_LNDA
                AnimationMode                = ONCE
            End
        End
        
;        AnimationState                    =    DYING AFLAME
;            Animation                    =    Fire
;                AnimationName     = RUPsnt_3__MFDA
;                AnimationMode     = LOOP
;            End
;        End    
        
        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUPsnt_3_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEB
                AnimationName     = RUPsnt_3_DIEB
                AnimationMode     = ONCE
            End
            Animation           = DIEC
                AnimationName     = RUPsnt_3_DIEC
                AnimationMode     = ONCE
            End            
        End
        
        AnimationState        = STUNNED_STANDING_UP
;            Animation           = GTPA                ; from side
;                AnimationName     = RUPsnt_3_GTPA
;                AnimationMode     = ONCE
;            End
            Animation           = GTPB                ; from back
                AnimationName     = RUPsnt_3_GTPB
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End
        
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUPsnt_3_LNDA
                AnimationMode     = ONCE
            End
        End    
        
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUPsnt_3_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART 
        End
;        

;;------------------ ATTACKING ---------------------------------------        

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation                =    ATKA
                AnimationName        =    RUPsnt_3_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKB
                AnimationName        =    RUPsnt_3_ATKB 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End            
        End

;;------------------ MOVING ------------------------------------------

;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = BAKA
                AnimationName        = RUPsnt_3_BAKA
                AnimationMode        = LOOP
            End
        End
        
;OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = WLKM
;                AnimationName        = RUPsnt_3_MFDA
;                AnimationMode        = LOOP
;            End
;            ;;ParticleSysBone     = None InfantryDustTrails
;        End
        
        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_3_WLKA
                AnimationMode        = LOOP
            End
            ;;ParticleSysBone     = None InfantryDustTrails
        End

        AnimationState                = MOVING ATTACKING
            Animation                = RUNE
                AnimationName        = RUPsnt_3_RUNE
                AnimationMode        = LOOP
                AnimationBlendTime    = 15
            End
            Animation                = RUNF
                AnimationName        = RUPsnt_3_RUNF
                AnimationMode        = LOOP
                AnimationBlendTime    = 15
            End            
            ;;ParticleSysBone     = None InfantryDustTrails
        End
        
        AnimationState                = MOVING
            Animation                = RUNC
                AnimationName        = RUPsnt_3_RUNC
                AnimationMode        = LOOP
            End
            Animation                = RUND
                AnimationName        = RUPsnt_3_RUND
                AnimationMode        = LOOP
            End
            Flags                    = RANDOMSTART
            ;;ParticleSysBone            = None InfantryDustTrails
        End

; WORKING    

        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_3_IDLA 
                AnimationMode        =    LOOP
            End
        End
    
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKB
                AnimationName        = RUPsnt_3_WRKB
                AnimationMode        = ONCE
            End
            Animation                = WRKC
                AnimationName        = RUPsnt_3_WRKC
                AnimationMode        = ONCE
            End            
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE            
        End
                
;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_3_HITA
                AnimationMode = ONCE
            End
        End
        
;;------------- EMOTIONS ---------------------------------------------

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing3
                AnimationName        = RUPsnt_3_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End

;;======= TERROR

        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_3_FERA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                = EMOTION_TAUNTING
            Animation                = TNTA
                AnimationName        = RUPsnt_3_TNTA
                AnimationMode        = ONCE
            End
            Animation                = TNTB
                AnimationName        = RUPsnt_3_TNTB
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE                                
        End

;;====== CELEBRATING        
        AnimationState                = EMOTION_CELEBRATING
            Animation                = CHRA
                AnimationName        = RUPsnt_3_CHRA
                AnimationMode        = ONCE
            End
            Animation                = CHRB
                AnimationName        = RUPsnt_3_CHRB
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE            
        End
        
        AnimationState                = EMOTION_ALERT
            StateName                = STATE_Alert
            Animation                = &&ALERT&&
                AnimationName        = RUPsnt_3_IDLA
                AnimationMode        = LOOP
            End
        End
;;------------- SELECTED ---------------------------------------------

        AnimationState                =    SELECTED
            StateName                =    STATE_Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUPsnt_3_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End    

;;--------------- IDLE STATES -----------------------------------------------------------------            

        IdleAnimationState
            StateName                =    STATE_Idle
            Animation           = IDLA
                AnimationName     = RUPsnt_3_IDLA
                AnimationMode     = ONCE
                AnimationPriority = 20
            End
            
            Animation           = IDLC
                AnimationName     = RUPsnt_3_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLD
                AnimationName     = RUPsnt_3_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 2
            End

            Animation           = IDLE
                AnimationName     = RUPsnt_3_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLF
                AnimationName     = RUPsnt_3_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            Animation           = IDLG
                AnimationName     = RUPsnt_3_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 1                
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript                    
        End

    ;---Transitions-------------------------------------        

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = RUPsnt_3_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End
        
        TransitionState                =    TRANS_IdleToSelected
            Animation                =    ATNA
                AnimationName        =    RUPsnt_3_ATNA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End        
    
    End
    
    EquivalentTo = RohanPeasant    


    ; *** AUDIO Parameters ***;

    VoiceAttack                 = PeasantMaleVoiceAttack
    VoiceAttackCharge             = PeasantMaleVoiceAttackCharge
    VoiceAttackStructure             = PeasantMaleVoiceAttackBuilding
    VoiceAttackMachine             = PeasantMaleVoiceAttack
    VoiceCreated                 = PeasantMaleVoiceSalute
    VoiceFullyCreated             = PeasantMaleVoiceSalute
    VoiceGuard                    = PeasantMaleVoiceMove
    VoiceMove                     = PeasantMaleVoiceMove
    VoiceMoveToCamp                 = PeasantMaleVoiceMoveCamp
    VoiceMoveWhileAttacking         = PeasantMaleVoiceDisengage
    VoicePriority                = 30            ;3
    VoiceRetreatToCastle             = PeasantMaleVoiceRetreat
    VoiceSelect                 = PeasantMaleVoiceSelect
    VoiceSelectBattle              = PeasantMaleVoiceSelectBattle

    VoiceEnterStateAttack             = PeasantMaleVoiceEnterStateAttack
    VoiceEnterStateAttackCharge         = PeasantMaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackStructure     = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackMachine        = PeasantMaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove             = PeasantMaleVoiceEnterStateMove
    VoiceEnterStateMoveToCamp         = PeasantMaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking    = PeasantMaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle     = PeasantMaleVoiceEnterStateRetreat
    
    UnitSpecificSounds
        VoiceGarrison                 = PeasantMaleVoiceGarrison    
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Male
    End

    EvaEventDamagedOwner            = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_3_SKL.RUPsnt_3_DIEA    Frames:46
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_3_SKL.RUPsnt_3_DIEB    Frames:45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_3_SKL.RUPsnt_3_DIEC    Frames:35
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_3_SKL.RUPsnt_3_LNDA    Frames:8
    End


; *** ENGINEERING PARAMETERS *** ;

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy        = Upgrade_RohanHeavyArmor
        ShowSubObjects    = HELMET
        HideSubObjects    = HAMMER        
        UpgradeTexture    = RUPeasant01.tga 0 RUPeasant01HA.tga
        UpgradeTexture    = RUPeasant02.tga 0 RUPeasant02HA.tga
		UpgradeTexture    = RUPeasant03.tga 0 RUPeasant03HA.tga
        UpgradeTexture    = RUPeasant04.tga 0 RUPeasant04HA.tga
;        UpgradeTexture    = RUPeasantWep.tga 0 RUPeasantWep_HA.tga
;        UpgradeTexture    = RUPeasantWep_L.tga 0 RUPeasantWep_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

End
    
;;------------------------------------------------------------------------------
; aka Peasant4  ///  WOMAN ///
ChildObject RohanPeasant4 RohanPeasant1
    ; ***ART Parameters ***
    
    Draw = W3DScriptedModelDraw ModuleTag_01  

        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
            
        OkToChangeModelColor = Yes
          
        RandomTexture = RUPeasant04.tga 0 RUPeasant04.tga
        RandomTexture = RUPeasant04_Alt.tga 0 RUPeasant04.tga

;;====================== MODELS ================================================================        
        DefaultModelConditionState
            Model               = RUPsnt_4_SKN
            Skeleton            = RUPsnt_4_SKL
        End

;;================== ANIMATIONS =================================================================        


;;------------------  DYING -------------------------------------------------------------
        
        AnimationState                        = PASSENGER
            Animation                        = FLLA
                AnimationName                = RUPsnt_4_FLLA
                AnimationMode                = LOOP
            End
        End
        
        AnimationState                = THROWN_PROJECTILE
            Animation                = FLYA
                AnimationName        = RUPsnt_4_FLYA
                AnimationMode        = LOOP
            End
        End
        
        AnimationState                        = FREEFALL
            Animation                        = FLYA
                AnimationName                = RUPsnt_4_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.7    0.7
                AnimationBlendTime            = 10
            End
        End
        
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUPsnt_4_FLYA
                AnimationMode      = LOOP
            End
        End
        
        AnimationState                        = DYING SPLATTED
            Animation                        = LNDA
                AnimationName                = RUPsnt_4_LNDA
                AnimationMode                = ONCE
            End
        End
        
        AnimationState                = DYING
            Animation                = DIEA
                AnimationName        = RUPsnt_4_DIEA
                AnimationMode        = ONCE
            End
            Animation                = DIEB
                AnimationName        = RUPsnt_4_DIEB
                AnimationMode        = ONCE
            End
            Animation                = DIEC
                AnimationName        = RUPsnt_4_DIEC
                AnimationMode        = ONCE
            End
        End

        AnimationState                = STUNNED_STANDING_UP
            Animation                = GTPA
                AnimationName        = RUPsnt_4_GTPA
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
;            Animation           = GTPB
;                AnimationName     = RUPsnt_4_GTPB
;                AnimationMode     = ONCE
;            End                        
        End
        
        AnimationState                = STUNNED
            Animation                = LNDA
                AnimationName        = RUPsnt_4_LNDA
                AnimationMode        = ONCE
            End
        End
        
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUPsnt_4_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART 
        End

;;------------------ ATTACKING ---------------------------------------        

        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation
                AnimationName        =    RUPsnt_4_ATKA 
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName        =    RUPsnt_4_ATKB
                AnimationMode        =    LOOP
;                UseWeaponTiming        =    Yes
            End                        
        End


;;------------------ MOVING ------------------------------------------

;;===== BACKUP
        AnimationState                = MOVING BACKING_UP
            Animation                = BAKA
                AnimationName        = RUPsnt_4_BAKA
                AnimationMode        = LOOP
            End
        End

; OBSOLETE        
;        AnimationState                = MOVING PANICKING
;            Animation                = WLKM
;                AnimationName        = RUPsnt_4_MFDA
;                AnimationMode        = LOOP
;            End
;            ;;ParticleSysBone     = None InfantryDustTrails
;        End

        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = RUPsnt_4_WLKA
                AnimationMode        = LOOP
            End
            ;;ParticleSysBone     = None InfantryDustTrails
        End

        AnimationState                = MOVING ATTACKING
            Animation                = RUNB
                AnimationName        = RUPsnt_4_RUNB
                AnimationMode        = LOOP
                AnimationBlendTime    = 15
            End
            Animation                = RUNE
                AnimationName        = RUPsnt_4_RUNE
                AnimationMode        = LOOP
                AnimationBlendTime    = 15
            End            
            ;;ParticleSysBone     = None InfantryDustTrails
        End
                
        AnimationState                = MOVING
            Animation                = RUNA
                AnimationName        = RUPsnt_4_RUNA
                AnimationMode        = LOOP
            End
            Animation                = RUNC
                AnimationName        = RUPsnt_4_RUNC
                AnimationMode        = LOOP
            End                        
            Animation                = RUND
                AnimationName        = RUPsnt_4_RUND
                AnimationMode        = LOOP
            End                                    
            Flags                    = RANDOMSTART
            ;;ParticleSysBone            = None InfantryDustTrails
        End

; WORKING    



        AnimationState = ACTIVELY_CONSTRUCTING DEPLOYED ; building from too far to smack his hammer
            Animation                =    Stand
                AnimationName        =    RUPsnt_4_IDLA 
                AnimationMode        =    LOOP
            End
        End
    
        AnimationState                = ACTIVELY_CONSTRUCTING
            Animation                = WRKA
                AnimationName        = RUPsnt_4_WRKA
                AnimationMode        = LOOP
            End
        End
            
;;------------ HIT REACTION -----------------------------------------------------

        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUPsnt_4_HITA
                AnimationMode = ONCE
            End
        End

;;------------- EMOTIONS ---------------------------------------------

;;======== POINTING

        AnimationState                = EMOTION_POINTING
            Animation                = Pointing4
                AnimationName        = RUPsnt_4_PNTA
                AnimationMode        = LOOP
                AnimationSpeedFactorRange = 0.75 1.25
            End
        End
        
;;======= TERROR

        AnimationState                = EMOTION_AFRAID
            Animation                = &&FEAR&&
                AnimationName        = RUPsnt_4_FERA
                AnimationMode        = LOOP
            End
        End
            
        AnimationState                = EMOTION_TAUNTING
            Animation                = TNTA
                AnimationName        = RUPsnt_4_TNTA
                AnimationMode        = LOOP
            End
            Animation                = TNTB
                AnimationName        = RUPsnt_4_TNTB
                AnimationMode        = LOOP
            End    
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE                
        End
    
;;====== CELEBRATING        
        AnimationState                = EMOTION_CELEBRATING
            Animation                = CHRA
                AnimationName        = RUPsnt_4_CHRA
                AnimationMode        = ONCE
            End
            Animation                = CHRB
                AnimationName        = RUPsnt_4_CHRB
                AnimationMode        = ONCE
            End
            Animation                = CHRC
                AnimationName        = RUPsnt_4_CHRC
                AnimationMode        = ONCE
            End
            Flags                    = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE            
        End
        
        AnimationState                = EMOTION_ALERT
            StateName                = STATE_Alert
            Animation                = &&ALERT&&
                AnimationName        = RUPsnt_4_IDLA
                AnimationMode        = LOOP
            End
        End

;;------------- SELECTED ---------------------------------------------

        AnimationState                =    SELECTED
            StateName                =    STATE_Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUPsnt_4_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End    
        
;;--------------- IDLE STATES -----------------------------------------------------------------            

        IdleAnimationState
            StateName            =    STATE_Idle
            Animation           = IDLA
                AnimationName     = RUPsnt_4_IDLA
                AnimationMode     = ONCE
                AnimationPriority = 20
            End
            Animation           = IDLC
                AnimationName     = RUPsnt_4_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End
            Animation           = IDLD
                AnimationName     = RUPsnt_4_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 1
            End    
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript                                                    
        End
        
;---Transitions-------------------------------------        

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = RUPsnt_4_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End
        
        TransitionState                =    TRANS_IdleToSelected
            Animation                =    ATNA
                AnimationName        =    RUPsnt_4_ATNA
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.7 1.2
            End
        End    
    
    
    
    End
    
    EquivalentTo = RohanPeasant


    ; *** AUDIO Parameters ***;

    VoiceAttack                    = PeasantFemaleVoiceAttack                ;RohanPeasantWomanVoiceAttack
    VoiceAttackCharge                = PeasantFemaleVoiceAttackCharge
    VoiceAttackMachine            = PeasantFemaleVoiceAttack
    VoiceAttackStructure            = PeasantFemaleVoiceAttackBuilding
    VoiceCreated                = PeasantFemaleVoiceSalute
    VoiceFullyCreated             = PeasantFemaleVoiceSalute
    VoiceGuard                    = PeasantFemaleVoiceMove
    VoiceMove                    = PeasantFemaleVoiceMove                ;RohanPeasantWomanVoiceMove
    VoiceMoveToCamp                = PeasantFemaleVoiceMoveCamp
    VoiceMoveWhileAttacking            = PeasantFemaleVoiceDisengage
    VoicePriority                = 13                                ;3
    VoiceRetreatToCastle            = PeasantFemaleVoiceRetreat
    VoiceSelect                    = PeasantFemaleVoiceSelect                ;RohanPeasantWomanVoiceSelect
    VoiceSelectBattle             = PeasantFemaleVoiceSelectBattle

    VoiceEnterStateAttack            = PeasantFemaleVoiceEnterStateAttack        ;RohanPeasantWomanVoiceAttack
    VoiceEnterStateAttackCharge        = PeasantFemaleVoiceEnterStateAttackCharge
    VoiceEnterStateAttackMachine        = PeasantFemaleVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackStructure    = PeasantFemaleVoiceEnterStateAttackBuilding
    VoiceEnterStateMove            = PeasantFemaleVoiceEnterStateMove            ;RohanPeasantWomanVoiceMove
    VoiceEnterStateMoveToCamp        = PeasantFemaleVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking    = PeasantFemaleVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle    = PeasantFemaleVoiceEnterStateRetreat
        
    SoundImpact = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison            = PeasantFemaleVoiceGarrison
        VoiceRepair                = PeasantFemaleVoiceRepair
    End

    EvaEventDamagedOwner            = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ReplaceModule ModuleTag_RSSCB
        ClientBehavior = RandomSoundSelectorClientBehavior ModuleTag_RSSCB_Woman
            ; This boils down to: Each time a mixed RohanPeasant is created, there is a 
            ; 1.5% chance per female the female will be "bossy" and play her voices
            ; instead of the men's. Once the "bossy-ness" of a female is set, it does
            ; change, so that we don't keep getting voices from different people.
            ; So, normally, the male voices will be heard [hey, this IS Middle Earth -- not a place known
            ; for its gender equity], but every once in a while the females will get a voice. Otherwise
            ; we basically never ever hear all these nice lines. This spices things up a bit
            Chance = 1.5% 
            RerollOnEveryFrame = No ; For consistancy of which unit plays the voice
            VoicePriority = 31 ; High enough to overcome the non-bossy men
        End
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_4_SKL.RUPsnt_4_DIEA    Frames:47
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_4_SKL.RUPsnt_4_DIEB    Frames:43
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUPsnt_4_SKL.RUPsnt_4_DIEC    Frames:34
        AnimationSound = Sound:BodyFallGeneric1        Animation:RUPsnt_4_SKL.RUPsnt_4_LNDA    Frames:1
    End

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Peasant Peasant_Female
    End

; *** ENGINEERING PARAMETERS *** ;

    ;-------------------------------------------------------------------------------
    ;
    ;    Sub objects upgrade.
    ;
    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy    = Upgrade_RohanHeavyArmor
        UpgradeTexture    = RUPeasant04.tga 0 RUPeasant04_HA.tga
        UpgradeTexture    = RUPeasant04_Alt.tga 0 RUPeasant04_HA.tga
        UpgradeTexture    = RUPeasantWep.tga 0 RUPeasantWep_HA.tga
        UpgradeTexture    = RUPeasantWep_L.tga 0 RUPeasantWep_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseLeadership2
        SpecialPowerTemplate = SpecialAbilityRank2
        TriggeredBy = Upgrade_GenericUpgrade2
    End
    Behavior = SpecialPowerModule ModuleTag_Rank2Update   
        SpecialPowerTemplate      = SpecialAbilityRank2
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
        AttributeModifier = RohanSoldierRank2
;        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = NONE +RohanPeasant +RohanPeasantHorde +GondorFighterHordeBlock
        AttributeModifierFX = FX_GoodPower
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 4000
        SinkRate = 0.25     ; in Dist/Sec
        DestructionDelay = 10000
            Sound = INITIAL PeasantFemaleVoiceDie
    End
End
