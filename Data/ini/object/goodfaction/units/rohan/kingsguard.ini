
Object RohanKingsguard
    ; *** ART Parameters ***

    SelectPortrait         = UPGondor_TowerGuard

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        WadingParticleSys = EntRipples

    StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
    
        OkToChangeModelColor = Yes


        DefaultModelConditionState
            Model                    = ruroylgrd_skn
        End
   
        ModelConditionState            = WEAPONSET_PLAYER_UPGRADE
                Model                    = ruroylgrd_skn
        End
        
        ; --- Idle Anims
        IdleAnimationState
            Animation                = IDLB
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLB
                AnimationMode        = ONCE
                AnimationPriority   = 20
            End
            Animation                = IDLC
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLC
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            Animation                = IDLD
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLD
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            StateName                = Idle
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
            EndScript

        End

        AnimationState            = STUNNED_FLAILING 
            Flags               = RANDOMSTART
            Animation           = RUEowyn_FLYA
                AnimationName   = RUEowyn_SKL.RUEowyn_FLYA
                AnimationMode   = LOOP
            End
            StateName           = NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End

        ; --- Dying anims
        AnimationState                =    DYING SPLATTED
            Animation                =    RUEowyn_LNDA
                AnimationName        =    RUEowyn_SKL.RUEowyn_LNDA
                AnimationMode        =    ONCE
            End
            StateName                =    NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End
        AnimationState                =    DYING
            Animation                =    RUEowyn_DIEA
                AnimationName        =    RUEowyn_SKL.RUEowyn_DIEA
                AnimationMode        =    ONCE
                AnimationPriority   =   10
            End
        End
        
                ; --- Stunned anims
        AnimationState            = STUNNED_STANDING_UP
            Animation           = RUEowyn_GTPA
                AnimationName   = RUEowyn_SKL.RUEowyn_GTPA
                AnimationMode   = ONCE
                AnimationSpeedFactorRange= 1.5 1.5
            End
        End
        AnimationState            = STUNNED 
            Animation           = RUEowyn_LNDA
                AnimationName   = RUEowyn_SKL.RUEowyn_LNDA
                AnimationMode   = ONCE
            End
            StateName           = NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End
        
        
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUEowyn_SKL.RUEowyn_ATRA
                AnimationMode       = LOOP
            End
            ParticleSysBone        =    None InfantryDustTrails
            Flags               = RANDOMSTART 
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState                =    MOVING ATTACKING
            Flags                    =    RANDOMSTART
            ParticleSysBone        =    None InfantryDustTrails
            Animation                =    RUNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNB
                AnimationMode        =    LOOP
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End


        AnimationState                =    MOVING
            ParticleSysBone        =    None InfantryDustTrails
            Flags                    =    RANDOMSTART
            Animation                =    RUNA
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNA
                AnimationMode        =    LOOP
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End

        ; Attacking Anims [Weapon_A]
        AnimationState                =    FIRING_OR_PREATTACK_A
            StateName                =    Sword
            Animation                =    ATKA
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKA
                AnimationMode        =    ONCE
;                AnimationSpeedFactorRange = 2.6 2.6 ; 78 frames
;                UseWeaponTiming        =    No
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKB
                AnimationMode        =    ONCE
;                AnimationSpeedFactorRange = 3.1 3.1 ; 93 frames
;                UseWeaponTiming        =    No
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKC
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKC
                AnimationMode        =    ONCE
;                AnimationSpeedFactorRange = 1.9666 1.9666 ; 59 frames
;                UseWeaponTiming        =    No
                UseWeaponTiming        =    Yes
            End
            ParticleSysBone     = None MeleeDust
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        ; This is not in yet. Smite SPecial Weapon
        AnimationState        =  SPECIAL_WEAPON_ONE
            StateName = Attacking_throw
            Animation
                AnimationName        = RUEowyn_SKL.RUEowyn_ATKD
                AnimationMode       = ONCE
                AnimationBlendTime    = 0
            End
            BeginScript
                CurDrawableShowSubObject("spear")
            EndScript
        End


    
        ; ATTACKING
        AnimationState        = ATTACKING
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
        End
        
        ; --------- Click and Hit Reactions ------------
        AnimationState            = HIT_REACTION HIT_LEVEL_1
            StateName            = STATE_Bored_Sword
            Animation            = Hit_Level_1_A
                AnimationName    = RUEowyn_SKL.RUEowyn_HITA
                AnimationMode    = ONCE
            End
        End
        
        ; --------- Selected Anims and Transitions
        TransitionState                    =    TRANS_Idle_to_Selected
            Animation                    =    ATNC
                AnimationName            =    RUEowyn_SKL.RUEowyn_ATNA
                AnimationMode            =    ONCE
            End
        End
        
        TransitionState                    =    TRANS_Selected_To_Idle
            Animation                    =    ATNE
                AnimationName            =    RUEowyn_SKL.RUEowyn_ATNC
                AnimationMode            =    ONCE
            End
        End
        
        AnimationState                = LEVELED                         ; This state clears itself in 3 seconds
            Animation                = LevelUp
                AnimationName        = RUEowyn_SKL.RUEowyn_TNTB
                AnimationMode        = ONCE
            End
        End
        
        AnimationState                =    SELECTED
            StateName                =    Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
            EndScript
        End
        
        ;----Emotion Animations
        AnimationState                =    EMOTION_CELEBRATING
            Animation                =    CHRA
                AnimationName        =    RUEowyn_SKL.RUEowyn_CHRA
                AnimationMode        =    ONCE
                AnimationPriority    =    10
            End
            Animation                =    CHRB
                AnimationName        =    RUEowyn_SKL.RUEowyn_CHRB
                AnimationMode        =    ONCE
                AnimationPriority    =    5
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE                
        End
        
        AnimationState                    = EMOTION_ALERT EMOTION_MORALE_HIGH
            Animation                    = Taunting
                AnimationName            =  RUEowyn_SKL.RUEowyn_TNTA
                AnimationMode            = ONCE
            End
            Animation                    = Taunting
                AnimationName            =  RUEowyn_SKL.RUEowyn_TNTB
                AnimationMode            = ONCE
            End
            Flags                        = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End
        
        ; READY IDLE
        AnimationState        = EMOTION_ALERT
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
        End    
        
    End
    
    ; ***DESIGN parameters ***
    Side = Rohan
    EditorSorting = UNIT
    ThreatLevel = 1.0
    ThingClass = HORDE_UNIT
    CommandPoints = 3
    BountyValue = M_ROHAN_ROYALGUARD_BOUNTY_VALUE

    TransportSlotCount = 1
    WeaponSet
        Conditions = None 
        Weapon = PRIMARY    RohanKingsguardSword
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = RohanKingsguardArmor
        DamageFX        = NormalDamageFX
    End
	
    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD

    DisplayName = OBJECT:RohanKingsguard
    CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles

    CrushRevengeWeapon = SuperInfantryCrushRevenge
    
    CommandSet = RohanKingsguardCommandSet


    ; *** AUDIO Parameters ***;

    VoiceAttack					= RoyalGuardVoiceAttack
	VoiceAttackAir				= RohirrimVoiceAttackBow
	VoiceAttackCharge				= RoyalGuardVoiceAttackCharge
	VoiceAttackStructure			= RoyalGuardVoiceAttack		; ElvenWarriorVoiceAttackBuilding not recorded
	VoiceAttackMachine			= RoyalGuardVoiceAttack		; ElvenWarriorVoiceAttackBuilding not recorded
	VoiceCreated				= RoyalGuardVoiceSalute
      VoiceFullyCreated 			= RoyalGuardVoiceSalute
	VoiceMove					= RoyalGuardVoiceMove
	VoiceMoveToCamp				= RoyalGuardVoiceMoveCamp
	VoiceMoveWhileAttacking			= RoyalGuardVoiceDisengage
	VoicePriority				= 41
	VoiceRetreatToCastle			= RohirrimVoiceRetreat
	VoiceSelect					= RoyalGuardVoiceSelect
	VoiceSelect2                = GondorSwordmanVoiceSelect2
	VoiceSelectBattle 			= RoyalGuardVoiceSelectBattle
	VoiceGuard					= RoyalGuardVoiceMove

    SoundImpact                =    ImpactHorse

    UnitSpecificSounds
		;VoiceGarrison			= ElvenWarriorVoiceGarrison    
		VoicePrimaryWeaponMode		= RohirrimModeBow
		;VoiceSecondaryWeaponMode	= ElvenWarriorVoiceModeSword
    End

    EvaEventDamagedOwner            = UnitUnderAttack        ;Eva event to trigger when unit is damaged

    ; Tie into LargeGroupAudio system
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Infantry Gondor_Guard
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:TauntHitShieldPitchShifted    Animation:GUTowerGrd_SKL.GUTowerGrd_TNTB    Frames: 23 43
        AnimationSound = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_DIEA    Frames:36
        AnimationSound = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_LNDB    Frames:2
    End


    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP

;
;    Body = ActiveBody ModuleTag_02
;        CheerRadius       = M_EMOTION_CHEER_RADIUS
;        MaxHealth         = M_GONDOR_TOWERGUARD_HEALTH             
;        MaxHealthDamaged  = M_GONDOR_TOWERGUARD_HEALTH_DAMAGED
;        ;RecoveryTime      = M_GONDOR_TOWERGUARD_HEALTH_RECOVERY_TIME
;    End

    Body                    = PorcupineFormationBodyModule ModuleTag_porcupineFormation
        CheerRadius             = M_EMOTION_CHEER_RADIUS
        MaxHealth            = M_ROHAN_ROYALGUARD_FOOT_HEALTH        ;BALANCE Gondor Towerguard Health
        MaxHealthDamaged        = M_ROHAN_ROYALGUARD_HEALTH_DAMAGED
        ;RecoveryTime            = M_GONDOR_TOWERGUARD_HEALTH_RECOVERY_TIME
        ;DamageWeaponTemplate        =    PikemenPorcupineDamage
        CrushDamageWeaponTemplate    =    TowerGuardPorcupineCrushDamage
    End    
    
    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        AILuaEventsList                = GondorFighterFunctions
        AttackPriority                =     AttackPriority_Spearman
    End

    LocomotorSet
        Locomotor = GondorTowerShieldGuardLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End

    LocomotorSet
        Locomotor = GondorTowerShieldGuardDeployedLocomotor
        Condition = SET_NORMAL_UPGRADED
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End
    
    LocomotorSet
        Locomotor = GondorTowerShieldGuardLocomotor
        Condition = SET_COMBO
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED
    End
    
    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStunnedTimeLow        = 1400    ;msec
        ShockStunnedTimeHigh    = 2400    ;msec
        ShockStandingTime        = 1333    ;msec
    End
    
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40     ; in Dist/Sec
        DestructionDelay = 8000
        Sound = INITIAL HumanVoiceDie; TowerGuardVoiceDie
    End
    
    Behavior = SquishCollide ModuleTag_06
        ;nothing
    End
    
    Behavior = HordeMemberCollide ModuleTag_HMC
        ;nothing
    End
    
    Behavior = SlowDeathBehavior ModuleTag_07
        ; Same as normal death, but no sound (sound already played by SoundImpact = ... )
        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40     ; in Dist/Sec
        DestructionDelay = 8000
    End

    Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
        ; To tweak a Bezier path
        FirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        SecondHeight = 24
        FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes ; I don't detonate, I just hit
        DieOnImpact = Yes
        BounceCount = 1   ; When I hit the ground, I'll arc again
        BounceDistance = 40 ; this far
        BounceFirstHeight = 24  ; Height of Bezier control points above highest intervening terrain
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 9.6
    GeometryIsSmall = Yes

    Shadow = SHADOW_DECAL
    ShadowSizeX = 19;
    ShadowSizeY = 19;
    ShadowTexture = ShadowI;
End
