Object GondorCitadelGuard
    Scale = .92
    SelectPortrait         = UPGondor_CitadelGuard
    Draw = W3DHordeModelDraw ModuleTag_01
		OkToChangeModelColor = Yes
		StaticModelLODMode = Yes
		; specify options for static LODs
		LodOptions	= LOW
			AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_LOW
			MaxRandomTextures		=	MAX_RANDOM_TEXTURES_LOW
			MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_LOW
			MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_LOW
		End
		LodOptions	= MEDIUM
			AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_MED
			MaxRandomTextures		=	MAX_RANDOM_TEXTURES_MED
			MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_MED
			MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_MED
		End
		LodOptions	= HIGH
			AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_HIGH
			MaxRandomTextures		=	MAX_RANDOM_TEXTURES_HIGH
			MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_HIGH
			MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_HIGH
		End
		DefaultModelConditionState
			Model               = guNcitgrd_skn
			Skeleton            = GUTwrGrd_SKL
		End
		ModelConditionState WEAPONSET_PLAYER_UPGRADE
			Model               = guNcitgrd_skn
			Skeleton            = GUTwrGrd_SKL
		End
        ModelConditionState WEAPONSET_TOGGLE_1
            Model               = guNcitgrd_skn
            Skeleton            = GUTwrGrd_SKL
        End
        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = GUTwrGrd_FLYA
                AnimationMode     = LOOP
            End
        End
        AnimationState                            = PASSENGER FREEFALL
            Animation                            = Grabbed
                AnimationName                    = GUTwrGrd_FLLA
                AnimationMode                    = LOOP
            End
        End
        AnimationState                            = FREEFALL
            Animation                            = Falling
                AnimationName                    = GUTwrGrd_FLYA
                AnimationMode                    = LOOP
                AnimationBlendTime                = 10
            End
        End
        AnimationState        = DYING DEATH_2
            Animation           = LNDA
                AnimationName     = GUTwrGrd_IDLA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = DYING SPLATTED
            Animation           = LNDA
                AnimationName     = GUTwrGrd_LNDA
                AnimationMode     = ONCE
            End
        End
        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = GUTwrGrd_DIEA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
            Animation           = DIEA
                AnimationName     = GUTwrGrd_DIEB
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
            Animation           = DIEA
                AnimationName     = GUTwrGrd_DIEC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
        End
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUTwrGrd_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART  
        End
;=======TERROR
        AnimationState                    = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
            ShareAnimation                = Yes
            Animation                    = TerrorFromTheSky
                AnimationName            = GUTwrGrd_RUNE
                AnimationMode            = LOOP
            End
        End
        AnimationState                    = MOVING EMOTION_TERROR
            ShareAnimation                = Yes
            Animation                    = Terror
                AnimationName            = GUTwrGrd_RUNE
                AnimationMode            = LOOP
            End
        End
;----------------
;=======BACK UP
        AnimationState                =    MOVING BACKING_UP
            ShareAnimation = Yes
            Animation                =    BackingUp
                AnimationName        =    GUTwrGrd_BAKA
                AnimationMode        =    LOOP
            End
            Animation                =    BackingUp
                AnimationName        =    GUTwrGrd_BAKB
                AnimationMode        =    LOOP
            End            
            Flags                    =    RANDOMSTART 
        End
;--------------------
	AnimationState  = COMING_OUT_OF_FACTORY
		Animation = Being_Built
			AnimationName		= GUTwrGrd_RUNC
			AnimationMode		= LOOP
			AnimationBlendTime	= 0
		End
            ParticleSysBone     = None InfantryDustTrails
	End
        AnimationState        = MOVING ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
            ;ShareAnimation = Yes
            StateName            = STATE_EnrouteToPorcupine
            Animation
                AnimationName     = GUTwrGrd_WLKB
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            ParticleSysBone     = None InfantryDustTrails
        End
        AnimationState        = MOVING ALTERNATE_FORMATION 
            ;ShareAnimation = Yes
            StateName            = STATE_EnrouteToPorcupine
            Animation
                AnimationName     = GUTwrGrd_WLKB
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            ParticleSysBone     = None InfantryDustTrails
        End
        AnimationState        = MOVING ATTACKING
            ;ShareAnimation = Yes
            StateName            = STATE_EnrouteToPorcupine
            Animation
                AnimationName     = GUTwrGrd_RUNC
                AnimationMode     = LOOP
            End
            Animation
                AnimationName     = GUTwrGrd_RUND
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            ParticleSysBone     = None InfantryDustTrails
        End
        AnimationState        = MOVING
            ShareAnimation = Yes
            Animation           = RUNA
                AnimationName     = GUTwrGrd_RUNA
                AnimationMode     = LOOP
            End
            Animation
                AnimationName     = GUTwrGrd_RUNB
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            ParticleSysBone     = None InfantryDustTrails
        End
        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = GUTwrGrd_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKA
                AnimationName     = GUTwrGrd_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            ;ParticleSysBone     = None MeleeDust
        End
        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = GUTwrGrd_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
        End
        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = GUTwrGrd_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = GUTwrGrd_LNDA
                AnimationMode     = ONCE
            End
        End
        TransitionState       = TRANS_Plant
            Animation           = PLTA
                AnimationName     = GUTwrGrd_PLTA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
        End
        TransitionState       = TRANS_Unplant
            Animation           = PLTB
                AnimationName     = GUTwrGrd_PLTC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.5 1.2
            End
        End
;------------------ Hit Reaction ---------------------------------------
        AnimationState                        = HIT_REACTION
            Animation                        = HIT REACTION
                AnimationName                = GUTwrGrd_HITA
                AnimationMode                = ONCE
            End
        End
;------------------ EMOTIONS -------------------------------------------
;======= APPREHENSIVE
        AnimationState                    = EMOTION_ALERT EMOTION_AFRAID
            ShareAnimation                = Yes
            Animation                    = Apprehensive
                AnimationName            = GUTwrGrd_FERA
                AnimationMode            = LOOP    ;Change this to ONCE if adding additional anims
            End
            Flags                        = RANDOMSTART
        End
;======= AFRAID
        AnimationState                    = EMOTION_AFRAID
            ShareAnimation                = Yes
            Animation                    = FERA
                AnimationName            = GUTwrGrd_FERA
                AnimationMode            = LOOP
            End
            Flags                        = RANDOMSTART
        End
;======= TAUNTING
        AnimationState                    = EMOTION_TAUNTING ALTERNATE_FORMATION
            Animation                    = TNTA
                AnimationName            = GUTwrGrd_TNTA
                AnimationMode            = LOOP
            End
            Animation                    = TNTA
                AnimationName            = GUTwrGrd_TNTB
                AnimationMode            = LOOP
            End
        End
        AnimationState                    = EMOTION_TAUNTING
            Animation                    = Taunting
                AnimationName            = GUTwrGrd_TNTA
                AnimationMode            = ONCE
            End
            Animation                    = Taunting2
                AnimationName            = GUTwrGrd_TNTB
                AnimationMode            = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
        End
;======= POINTING
        AnimationState                    = EMOTION_POINTING
            Animation                    = Pointing1
                AnimationName            = GUTwrGrd_PNTA
                AnimationMode            = LOOP
            End
            Animation                    = Pointing1
                AnimationName            = GUTwrGrd_PNTB
                AnimationMode            = LOOP
            End
            Flags                        = RANDOMSTART
        End
;======= CELEBRATING
        AnimationState                    = EMOTION_CELEBRATING
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRA
                AnimationMode            = LOOP
            End
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRB
                AnimationMode            = LOOP
            End
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRC
                AnimationMode            = LOOP
            End
        End
;-------------- ALERT STATE ------------------------------------------------------------
        AnimationState                    = EMOTION_ALERT
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_IDLA
                AnimationMode            = LOOP
            End
        End
;-------------- SELECTED & IDLE --------------------------------------------------------
;======== SELECTED
        AnimationState                    = SELECTED ALTERNATE_FORMATION ; PORCUPINE
            ;ShareAnimation                = Yes
            StateName                    = STATE_SelectedAlternateFormation
            Animation
                AnimationName            = GUTwrGrd_PLTB
                AnimationMode            = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "STATE_SelectedAlternateFormation" and Prev ~= "STATE_Planted" and Prev ~= "TRANS_Plant" then CurDrawableSetTransitionAnimState("TRANS_Plant") end
            EndScript
        End
        AnimationState                    = SELECTED ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
            ;ShareAnimation                = Yes 
            StateName                    = STATE_SelectedAlternateFormation
            Animation
                AnimationName            = GUTwrGrd_ATNB
                AnimationMode            = LOOP
            End
        End
        AnimationState                        = ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
            Animation
                AnimationName                = GUTwrGrd_IDLA
                AnimationMode                = LOOP
            End
        End
        AnimationState                    = RAISING_FLAG
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRA
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRB
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                    = CHRA
                AnimationName            = GUTwrGrd_CHRC
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
        End
        AnimationState                    = SELECTED
            StateName                    = STATE_Selected
            ShareAnimation                = Yes
            Animation                    = ATNB
                AnimationName            = GUTwrGrd_ATNB
                AnimationMode            = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
            EndScript
        End
;======== IDLE
        AnimationState                    = ALTERNATE_FORMATION ;PORCUPINE    ;    aka Porcupine formation
            StateName                    = STATE_Planted
            ;ShareAnimation                = Yes
            Animation                    = IDLB
                AnimationName            = GUTwrGrd_PLTB
                AnimationMode            = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "STATE_SelectedAlternateFormation" and Prev ~= "STATE_Planted" and Prev ~= "TRANS_Plant" then CurDrawableSetTransitionAnimState("TRANS_Plant") end
            EndScript
        End
        IdleAnimationState
            StateName                    = STATE_Idle
            Animation                    = ATNB
                AnimationName            = GUNTwrGrd_IDLA
                AnimationMode            = ONCE
            End
            Animation                    = ATNB
                AnimationName            = GUNTwrGrd_IDLB
                AnimationMode            = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
            EndScript
        End
;-------------------------------------------------------------------------------------------------------------
    End
    Side = Gondor
    EditorSorting = UNIT
    ThreatLevel = 1.0
    ThingClass = HORDE_UNIT
    CommandPoints = 3
    BountyValue = M_GONDOR_TOWERGUARD_BOUNTY_VALUE
    TransportSlotCount = 1
    WeaponSet
        Conditions = None 
        Weapon = PRIMARY    GondorTowerShieldGuardSword
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    ArmorSet
        Conditions      = None
        Armor           = GondorCitadelGuardArmor
        DamageFX        = NormalDamageFX
    End
    VisionRange = M_VISION_STANDARD_MELEE
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
    DisplayName = OBJECT:GondorCitadelGuard
    CrushableLevel = 0
    CrushRevengeWeapon = BasicInfantryCrushRevenge
    CommandSet = GenericHordeMemberCommandSet
    VoiceAmbushed                =    TowerGuardVoiceAmbushed
    VoiceAttack                =    TowerGuardVoiceAttack
    VoiceAttackCharge            =    TowerGuardVoiceAttackCharge
    VoiceAttackMachine            =    TowerGuardVoiceAttack
    VoiceAttackStructure            =    TowerGuardVoiceAttackBuilding
    VoiceEnterStateAttack            =    TowerGuardVoiceEnterStateAttack
    VoiceEnterStateAttackCharge        =    TowerGuardVoiceEnterStateAttackCharge
    VoiceEnterStateAttackMachine        =    TowerGuardVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackStructure        =    TowerGuardVoiceEnterStateAttackBuilding
    VoiceCreated                =    TowerGuardVoiceSalute
    VoiceFullyCreated            =    TowerGuardVoiceSalute
    VoiceMove                =    TowerGuardVoiceMove
    VoiceMoveToCamp                =    TowerGuardVoiceMoveCamp
    VoiceMoveWhileAttacking            =    TowerGuardVoiceDisengage
    VoiceEnterStateMove            =    TowerGuardVoiceEnterStateMove
    VoiceEnterStateMoveToCamp        =    TowerGuardVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking    =    TowerGuardVoiceEnterStateDisengage
    VoicePriority                =     56
    VoiceRetreatToCastle            =    TowerGuardVoiceRetreat
    VoiceEnterStateRetreatToCastle        =    TowerGuardVoiceEnterStateRetreat
    VoiceSelect                =    TowerGuardVoiceSelect
    VoiceSelect2                =    GondorTowerGuardVoiceSelect2
    VoiceSelectBattle            =    TowerGuardVoiceSelectBattle
    VoiceGuard            = TowerGuardVoiceMove
    SoundImpact                =    ImpactHorse
    UnitSpecificSounds
        VoiceGarrison            =     TowerGuardVoiceGarrison
    End
    EvaEventDamagedOwner            = UnitUnderAttack
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Infantry Gondor_Guard
    End
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:TauntHitShieldPitchShifted    Animation:GUTowerGrd_SKL.GUTowerGrd_TNTB    Frames: 23 43
        AnimationSound = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_DIEA    Frames:36
        AnimationSound = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_LNDB    Frames:2
    End
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP
    Body                    = PorcupineFormationBodyModule ModuleTag_porcupineFormation
        CheerRadius             = M_EMOTION_CHEER_RADIUS
        MaxHealth            = M_GONDOR_TOWERGUARD_HEALTH
        MaxHealthDamaged        = M_GONDOR_TOWERGUARD_HEALTH_DAMAGED
        CrushDamageWeaponTemplate    =    TowerGuardPorcupineCrushDamage
    End
    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        AILuaEventsList                = GondorFighterFunctions
        AttackPriority                =     AttackPriority_Spearman
    End
    LocomotorSet
        Locomotor = GondorTowerShieldGuardLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
    End
    LocomotorSet
        Locomotor = GondorTowerShieldGuardLocomotor
        Condition = SET_COMBO
        Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED
    End
    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 1333
    End
    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        DeathFlags = DEATH_1 ; Tell model which death animation to play. Sets BOTH model condition and object status bits.
        Sound = INITIAL HumanVoiceDie
    End
    Behavior = SquishCollide ModuleTag_06
    End
    Behavior = HordeMemberCollide ModuleTag_HMC
    End
    Behavior = SlowDeathBehavior ModuleTag_07
        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End   
    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 8000
        DestructionDelay = 8000
        DeathFlags = DEATH_2
        FX = INITIAL FX_RohirrimAlliesUnsummon
    End
    Behavior = BezierProjectileBehavior ModuleTag_08
        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes
        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%
        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End
    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 9.6
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 19
    ShadowSizeY = 19
    ShadowTexture = ShadowI
End
ChildObject GondorCitadelGuard_Summoned GondorCitadelGuard
    IsTrainable = No
    CommandPoints = 0
    EquivalentTo = GondorCitadelGuard
    WeaponSet
        Conditions = None 
        Weapon = PRIMARY    GondorCitadelGuardSword_Summoned
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    ArmorSet
        Conditions      = None
        Armor           = GondorCitadelGuardArmor_Summoned
        DamageFX        = NormalDamageFX
    End
    Body                    = PorcupineFormationBodyModule ModuleTag_porcupineFormation
        CheerRadius             = M_EMOTION_CHEER_RADIUS
        MaxHealth            = M_GONDOR_CITADELGUARD_HEALTH
        MaxHealthDamaged        = M_GONDOR_TOWERGUARD_HEALTH_DAMAGED
        CrushDamageWeaponTemplate    =    TowerGuardPorcupineCrushDamage
    End
    Behavior = AutoHealBehavior ModuleTag_BoromirHealing1
        StartsActive = Yes
        HealingAmount = M_HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = M_HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End
    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_HERO_SPEED
    End
    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 75000 ; 180000
        MaxLifetime        = 75000 ; 180000
        DeathType        = FADED
    End
    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        AILuaEventsList                = GondorFighterFunctions
        AttackPriority                = AttackPriority_Cavalry
    End
    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 3
        MPOnly = Yes
    End
End
Object SummonGondorCitadelGuardEgg
    Draw = W3DScriptedModelDraw ModuleTag_Draw
        DefaultModelConditionState
            Model = None
        End
    End
    KindOf = INERT IMMOBILE UNATTACKABLE
    
    Body = ActiveBody ModuleTag_MakesKillWork
        MaxHealth = 1
    End
    Behavior = LifetimeUpdate ModuleTag_HatchTrigger
        MinLifetime = 0.0
        MaxLifetime = 0.0
    End
    Behavior = SlowDeathBehavior ModuleTag_HatchProcess
        DestructionDelay = 2000
        OCL = FINAL OCL_SpawnGondorCitadelGuard
    End
End
