Object GondorBeregond
;    Scale = .96
    SelectPortrait = HPBeregond
    ButtonImage = HIBeregond
    Draw = W3DHordeModelDraw ModuleTag_01
		OkToChangeModelColor = Yes	
		StaticModelLODMode = No
		ParticlesAttachedToAnimatedBones = Yes
		
;=================== MODELS ============================================================
; --------- With Bow ------------
; Bah, must come first even though all the other bow stuff is below the sword stuff
		DefaultModelConditionState
			Model							= guberegond_skn
			Skeleton						= GUFaramir_SKL
			WeaponLaunchBone				= PRIMARY ARROW
			WeaponLaunchBone				= TERTIARY ARROW
		End

;================== ANIMATIONS ==============================================================		
;----------- Flying through air -------
		AnimationState        = STUNNED_FLAILING
			StateName           = STATE_Sword
			Animation           = GUFaramir_FLYB
				AnimationName     = GUFaramir_FLYB
				AnimationMode     = LOOP
				AnimationSpeedFactorRange	= 0.4 0.6
			End
			Flags               = RANDOMSTART
		End
		;--------------------------Dying		
		AnimationState        = DYING SPLATTED
			StateName           = STATE_Sword
			Animation           = GUFaramir_LNDB
				AnimationName     = GUFaramir_LNDB
				AnimationMode     = ONCE
			End
		End
		AnimationState        = DYING
			StateName           = STATE_Sword
			Animation           = GUFaramir_DIEA
				AnimationName     = GUFaramir_DIEA
				AnimationMode     = ONCE
			End
			Animation           = GUFaramir_DIEB
				AnimationName     = GUFaramir_DIEB
				AnimationMode     = ONCE
			End
		End
		AnimationState        = STUNNED_STANDING_UP
			StateName           = STATE_Sword
			Animation           = GUFaramir_GTPB
				AnimationName     = GUFaramir_GTPB
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End
		AnimationState        = STUNNED
			StateName           = STATE_Sword
			Animation           = GUFaramir_LNDB
				AnimationName     = GUFaramir_LNDB
				AnimationMode     = ONCE
			End
		End			
		AnimationState        = USER_1
			Animation           = GUFaramir_POSA
				AnimationName     = GUFaramir_POSA
				AnimationMode     = ONCE
			End
		End
		AnimationState        =  SPECIAL_WEAPON_ONE
			StateName = STATE_Sword
			Animation           = ATKE
				AnimationName    = gudundan_atkb
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 1.149 1.149
			End
			FrameForPristineBonePositions = 59
			;BeginScript
			;	CurDrawableShowSubObject("arrow")
			;	CurDrawableHideSubObject("spr")
			;EndScript
		End
		AnimationState				=	SPECIAL_WEAPON_TWO
			Animation
				AnimationName		=	gudundan_chra
				AnimationMode		=	LOOP
			End
		End
		;------------------------Moving
		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			Animation           = TrotAndFire
				AnimationName       = gudundan_atra
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART
			StateName = RunAndSwing
			BeginScript
				CurDrawableHideSubObject("arrow")
			EndScript
		End
		AnimationState        = FIRING_OR_PREATTACK_A
			StateName           = STATE_Sword
			Animation           = ATKD
				AnimationName     = gudundan_atka
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 1.149 1.149
			End
			Animation           = ATKE
				AnimationName    = gudundan_atkb
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 1.149 1.149
			End
			Animation           = ATKF
				AnimationName    = gudundan_atka
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.47 1.47
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		AnimationState        = MOVING USER_4
			StateName           = Slaughter
			Flags               = RANDOMSTART
			Animation           = gudundan_atkb
				AnimationName     = gudundan_atkb
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End
		AnimationState                =    MOVING ATTACKING
            Animation                =    gudundan_runb
                AnimationName        =    gudundan_runb
                AnimationMode        =    LOOP
				;AnimationSpeedFactorRange = 0.9 0.9
            End
			Animation                        = GUFaramirA_RUND
                AnimationName                = GUManMocap_RUND
                AnimationMode                = LOOP
                ;AnimationSpeedFactorRange = 0.9 0.9
            End
            Flags                    =    RANDOMSTART
            ParticleSysBone        =    None InfantryDustTrails
            BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
			EndScript
        End		
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			Animation           = gudundan_rund
				AnimationName   = gudundan_rund
				AnimationSpeedFactorRange = 0.85 0.85
				Distance		= 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				CurDrawableHideSubObject("arrow")
			EndScript
		End		
		AnimationState        = ATTACKING
			StateName           = STATE_Sword
			Animation           = ATKD
				AnimationName     = gudundan_idlat
				AnimationMode     = MANUAL
			End			
		End
		AnimationState = EMOTION_ALERT HIT_REACTION
			Animation = Hit_Level_1_d
				AnimationName = GUFaramir_HITD
				AnimationMode = ONCE
			End
		End
		AnimationState = HIT_REACTION
			Animation = Hit_Level_1_b
				AnimationName = GUFaramir_HITB
				AnimationMode = ONCE
			End
		End	
		AnimationState						= EMOTION_AFRAID
			ShareAnimation					= Yes
			StateName						= STATE_Sword
			Animation						= FearWithSword
				AnimationName				= gufaramir_fear
				AnimationMode				= LOOP
			End
			BeginScript
				CurDrawableHideSubObject("arrow")
				CurDrawableHideSubObject("arrownock")
			EndScript
		End	
		AnimationState				= LEVELED
			Animation				= LevelUp
				AnimationName		= gudundan_chra
				AnimationMode		= ONCE
			End
		End
		AnimationState				=	EMOTION_CELEBRATING
			Animation
				AnimationName		=	gudundan_chra
				AnimationMode		=	LOOP
			End
		End
		AnimationState				=	EMOTION_TAUNTING
			Animation
				AnimationName		=	GUFaramir_TNTD
				AnimationMode		=	ONCE
			End
			Animation
				AnimationName		=	GUFaramir_TNTD
				AnimationMode		=	ONCE
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
		End
		AnimationState					= SELECTED
			StateName					= STATE_Selected_Sword
			Animation					= ATNE
				AnimationName			= gudundan_idlb
				AnimationMode			= LOOP
				AnimationBlendTime		= 15
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedSword") return end
			EndScript
		End
		AnimationState				=	EMOTION_ALERT
			StateName				=	STATE_READY
			Animation				=	ready
				AnimationName		=	gudundan_idlat
				AnimationMode		=	LOOP
				AnimationBlendTime	=	20
			End
		End
		IdleAnimationState					
			StateName					= STATE_Idle_Sword	
			Animation           		= IDLE
				AnimationName       	= gudundan_atnb
				AnimationMode       	= LOOP
				AnimationPriority	    = 20
				AnimationBlendTime  = 15
			End
			Animation           		= IDLF
				AnimationName       	= gudundan_atnb
				AnimationMode       	= LOOP
				AnimationPriority	    = 1
			End
			Animation           		= IDLG
				AnimationName       	= gudundan_atnb
				AnimationMode       	= LOOP
				AnimationPriority	    = 1
			End
			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
			EndScript
		End
		TransitionState = TRANS_BoredToSelectedSword
			Animation = ANTD
				AnimationName		= gudundan_atna
				AnimationMode				= ONCE_BACKWARDS
			End		
			Flags							= START_FRAME_LAST
		End
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= gudundan_atna
				AnimationMode	= ONCE
			End		
		End		
	End
    Side = Gondor
    EditorSorting = UNIT
    ThreatLevel = 4.0
    ThingClass = CHARACTER_UNIT
      BuildCost         = M_BEREGOND_BUILDCOST                
      BuildTime         = M_BEREGOND_BUILDTIME    
    DisplayMeleeDamage = M_BEREGOND_DAMAGE        
    HeroSortOrder = 50
    TransportSlotCount = 1
    WeaponSet
        Conditions = None 
        Weapon = PRIMARY    BeregondSpear
    End
    ArmorSet
        Conditions      = None
        Armor           = HeroArmor
        DamageFX        = NormalDamageFX
    End
    VisionRange = M_VISION_STANDARD_MELEE                
    ShroudClearingRange = M_SHROUD_CLEAR_STANDARD
    BountyValue = M_GONDOR_BEREGOND_BOUNTY_VALUE
    DisplayName = OBJECT:GondorBeregond
    RecruitText = CONTROLBAR:GondorBeregondRecruit
    ReviveText    = CONTROLBAR:GondorBeregondRevive
    Hotkey        = CONTROLBAR:GondorBeregondHotkey
    CrushableLevel = 2
    CommandSet = BeregondCommandSet 
    CommandPoints = 0
	
	VoiceAmbushed				= BeregondVoiceAmbush
    VoiceAttack				=	BeregondVoiceAttack
	VoiceAttackCharge			=	BeregondVoiceAttackCharge
	VoiceAttackMachine			=	BeregondVoiceAttack
	VoiceAttackStructure			=	BeregondVoiceAttackBuilding
	VoiceMove				=	BeregondVoiceMove
	VoiceMoveToCamp				=	BeregondVoiceMoveCamp
	VoiceMoveWhileAttacking			=	BeregondVoiceDisengage
    VoicePriority            = 56
    VoiceRetreatToCastle			=	BeregondVoiceRetreat
    VoiceSelect2            = HeroVoiceSelect2
    VoiceSelect				=	BeregondVoiceSelect
	VoiceSelectBattle				= BeregondVoiceSelectBattle
    VoiceGuard				= 	BeregondVoiceMove
    SoundImpact                = ImpactHorse
	
    EvaEventDamagedOwner = UnitUnderAttack
    EvaEventDieOwner = BeregondDie
	
	UnitSpecificSounds
		VoiceGarrison			= BeregondVoiceGarrison
	End
	
    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:TauntHitShieldPitchShifted    Animation:GUTwrGrd_SKL.GUTwrGrd_TNTB    Frames: 23 43
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUTWRGRD_SKL.GUTWRGRD_DIEA    Frames:30 51
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUTWRGRD_SKL.GUTWRGRD_DIEB    Frames:57
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUTWRGRD_SKL.GUTWRGRD_DIEC    Frames:38
        AnimationSound = Sound:BodyFallSoldier        Animation:GUTWRGRD_SKL.GUTWRGRD_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier        Animation:GUTwrGrd_SKL.GUTwrGrd_LNDB    Frames:2
    End
    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU1
        Key = Human Unit Infantry Hero
        UnitWeight = 2
    End
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE HERO ARMY_SUMMARY
    PathfindDiameter = 40.0  
    Body = RespawnBody ModuleTag_RespawnBody1
        CheerRadius             = M_EMOTION_CHEER_RADIUS
        MaxHealth                 = M_BEREGOND_HEALTH
        PermanentlyKilledByFilter    = NONE
           DodgePercent              = M_HERO_DODGE_PERCENT
    End
    Behavior = RespawnUpdate ModuleTag_RespawnUpdate1
        DeathAnim                = DYING
        DeathFX                = FX_GenericGoodDieToRespawn
        DeathAnimationTime        = 4966
        InitialSpawnFX            = FX_BeregondInitialSpawn
        RespawnAnim                = LEVELED
        RespawnFX                = FX_BeregondInitialSpawn
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                = hiberegond_res
        RespawnRules =            AutoSpawn:No    Cost:700        Time:90000        Health:100%
        RespawnEntry =    Level:2                Cost:800        Time:90000
        RespawnEntry =    Level:3                Cost:1000        Time:90000
        RespawnEntry =    Level:4                Cost:1100        Time:90000
        RespawnEntry =    Level:5                Cost:1200        Time:120000
        RespawnEntry =    Level:6                Cost:1300        Time:120000
        RespawnEntry =    Level:7                Cost:1500        Time:120000
        RespawnEntry =    Level:8                Cost:1600        Time:120000
        RespawnEntry =    Level:9                Cost:1700        Time:120000
        RespawnEntry =    Level:10            Cost:1800        Time:120000
    End
    Behavior = AutoHealBehavior ModuleTag_BoromirHealing1
        StartsActive = Yes
        HealingAmount = M_HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = M_HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End
    Behavior = LifetimeUpdate ModuleTag_LifeTime1
        WaitForWakeUp = Yes
    End
    Behavior = AIUpdateInterface ModuleTag_031
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        AILuaEventsList                = BeregondFunctions
    End
    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL 
        Speed     = M_NORMAL_GOOD_HERO_SPEED
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_HeroRadiateFear1
        StartsActive    = No
        BonusName        = HeroRadiateFear
        TriggeredBy        = Upgrade_HeroRadiateFear
        RefreshDelay    = 2000
        Range            = 120
        TargetEnemy        = Yes
        ObjectFilter    = ANY +ORC
    End    
    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior1
    End        
    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing1
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = M_ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = M_ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = M_HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End
    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus1
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End
    Behavior = DualWeaponBehavior ModuleTag_131
        SwitchWeaponOnCloseRangeDistance = 161
    End
    Behavior = PhysicsBehavior ModuleTag_041
        GravityMult = 1.0
        ShockStandingTime        = 4000
    End
    Behavior = SlowDeathBehavior ModuleTag_051
        DeathTypes = ALL 
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL BoromirVoiceDie
    End
    Behavior = SquishCollide ModuleTag_061
    End
    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag1
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10
        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End
    ;------ This is a dummy so the button will show as active. -----------
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Loyalty
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_GenericUpgrade1
    End 
    ;----------------------------------------------------------------------------
    Behavior = SpecialPowerModule ModuleTag_BeregondLeadershipUpdate1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End 
    Behavior = AttributeModifierAuraUpdate ModuleTag_BeregondGuard
        StartsActive    = Yes
        BonusName        = BeregondGuard
        RefreshDelay    = 2000
        Range            = 200
        ObjectFilter    = ANY -INFANTRY -CAVALRY +STRUCTURE -BASE_FOUNDATION -HERO
    End      

    ; ------------------------------ Defender of the White Tree (Gives leadership Pippin) ------------------------------ ;
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MerryEsquire
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_GenericUpgrade1
    End
    Behavior = SpecialPowerModule ModuleTag_MerryEsquireUpdate   
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End    
    Behavior = AttributeModifierAuraUpdate ModuleTag_MerryEsquireLeadership
        StartsActive    = No ;If no, requires upgrade to turn on.
        BonusName        = MerryEsquireLeadership
        TriggeredBy        = Upgrade_GenericUpgrade1
        RefreshDelay    = 2000
        Range            = 200
        ObjectFilter    = NONE +RohanPippin +GondorPippin
    End

    ; ------------------------------------- Pin ------------------------------------- ;
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LeapEnabler
        SpecialPowerTemplate = SpecialAbilityLurtzCripple
        TriggeredBy = Upgrade_GenericUpgrade3
    End 
    Behavior = SpecialPowerModule ModuleTag_LeapStarter                      
        SpecialPowerTemplate      = SpecialAbilityLurtzCripple
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        InitiateSound = BeregondVoicePin
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LeapUpdate   
        SpecialPowerTemplate    = SpecialAbilityLurtzCripple
        SkipContinue            = Yes

        UnpackTime                = 1100 ; Pull out arrow
        PreparationTime            = 1 ; Quick shot
        PersistentPrepTime        = 500 ; looping the quick shot
        PackTime                = 500 ; back to idle
        MustFinishAbility        = Yes
        
        AwardXPForTriggering        = 0        
        StartAbilityRange            = 30 ;325.0
        
        SpecialWeapon                = BeregondPin
        WhichSpecialWeapon            = 1
        RejectedConditions            = WEAPON_TOGGLE
    End 

    ; --------------------------- Summon Citadel Guards --------------------------- ;

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseCitadelGuards
        SpecialPowerTemplate = SuperweaponCitadelGuards
        TriggeredBy = Upgrade_GenericUpgrade6
    End
    Behavior = OCLSpecialPower ModuleTag_SummonCitadelGuards
        SpecialPowerTemplate = SuperweaponCitadelGuards
        OCL                  = OCL_SpawnCitadelGuardEgg
        StartsPaused            = Yes
        SetModelCondition        = ModelConditionState:USER_1
        SetModelConditionTime    = 8.1
        TriggerFX             = FX_RohirimSummon
        CreateLocation       = CREATE_AT_LOCATION
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
  Shadow = SHADOW_DECAL
  ShadowSizeX = 20
  ShadowSizeY = 20
  ShadowTexture = ShadowI
End
