Object GondorKingsGuard

	SelectPortrait                         = UPCitadelGuardnew
	ButtonImage                            = UIMinasTirithCitadelGuard
	
	Draw                                   = W3DScriptedModelDraw ModuleTag_DRAW
	
		OkToChangeModelColor                 = Yes
    StaticModelLODMode                   = yes
		ExtraPublicBone                      = arrow
		ExtraPublicBone                      = PASSENGERBONE
	 	DependencySharedModelFlags           = TURN_LEFT_HIGH_SPEED TURN_RIGHT_HIGH_SPEED MOVING ACCELERATE DECELERATE TURN_LEFT TURN_RIGHT ATTACKING BACKING_UP
		
		; -- Models
		DefaultModelConditionState
			Model                              = gukngsgrd_skna
			WeaponLaunchBone                   = PRIMARY PASSENGERBONE
		End
		
		ModelConditionState                  = WEAPONSET_HERO_MODE
			ParticleSysBone                    = BAT_RIBS BladeMaster FollowBone:Yes			
		End
		
		; -- Animations
		AnimationState                       = PACKING_TYPE_2
			StateName		                       =	CaptainPower
			Animation                          = GUFaramir_CHRC
				AnimationName                    = GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode                    = ONCE
				AnimationSpeedFactorRange        = 1.2 1.2
			End
		End
		
		AnimationState                       = STUNNED_FLAILING
			StateName                          = STATE_Sword
			Animation                          = GUFaramir_FLYB
				AnimationName                    = GUFaramir_SKL.GUFaramir_FLYB
				AnimationMode                    = LOOP
				AnimationSpeedFactorRange	       = 0.4 0.6
			End
			Flags                              = RANDOMSTART
		End
		
		AnimationState                       = DYING DEATH_2
			StateName                          = STATE_Sword
			Animation           		           = IDLE
				AnimationName       	           = GUFaramir_SKL.GUFaramirA_IDLE
				AnimationMode       	           = LOOP
				AnimationPriority	               = 20
				AnimationBlendTime  	           = 20
			End
			Animation                          = IDLF
                AnimationName            = GUFaramir_SKL.GUFaramirA_IDLF
                AnimationMode            = LOOP
                AnimationPriority        = 1
            End		
		End		
		
		AnimationState                       = DYING SPLATTED
			StateName                          = STATE_Sword
			Animation                          = GUFaramir_LNDB
				AnimationName                    = GUFaramir_SKL.GUFaramir_LNDB
				AnimationMode                    = ONCE
			End
		End
		
		AnimationState                       = DYING
			StateName                          = STATE_Sword
			Animation                          = GUFaramir_DIEA
				AnimationName                    = GUFaramir_SKL.GUFaramir_DIEA
				AnimationMode                    = ONCE
			End
			Animation                          = GUFaramir_DIEB
				AnimationName                    = GUFaramir_SKL.GUFaramir_DIEB
				AnimationMode                    = ONCE
			End
		End
		
		AnimationState                       = STUNNED_STANDING_UP
			StateName                          = STATE_Sword
			Animation                          = GUFaramir_GTPB
				AnimationName                    = GUFaramir_SKL.GUFaramir_GTPB
				AnimationMode                    = ONCE
				AnimationSpeedFactorRange        = 1.5 1.5
			End
		End
		
		AnimationState                       = STUNNED
			StateName                          = STATE_Sword
			Animation                          = GUFaramir_LNDB
				AnimationName                    = GUFaramir_SKL.GUFaramir_LNDB
				AnimationMode                    = ONCE
			End
		End	
		
		AnimationState                       = MOVING FIRING_OR_PREATTACK_A
			Animation                          = TrotAndFire
				AnimationName                    = GUFaramir_SKL.GUFaramir_ATRA
				AnimationMode                    = LOOP
			End
			Flags                              = RANDOMSTART
			StateName                          = RunAndSwing
		End
		
		AnimationState                       = FIRING_OR_PREATTACK_A
			StateName                          = STATE_Sword
			Animation                          = ATKD
				AnimationName                    = GUFaramir_SKL.GUFaramir_ATKD
				AnimationMode                    = ONCE
				UseWeaponTiming		               = Yes
				AnimationSpeedFactorRange        = 1.149 1.149
			End
			Animation                          = ATKE
				AnimationName                    = GUFaramir_SKL.GUFaramir_ATKE
				AnimationMode                    = ONCE
				UseWeaponTiming		               = Yes
				AnimationSpeedFactorRange        = 1.149 1.149
			End
			Animation                          = ATKF
				AnimationName                    = GUFaramir_SKL.GUFaramir_ATKF
				AnimationMode                    = ONCE
				AnimationSpeedFactorRange        = 1.47 1.47
			End
			Flags				                       =	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev                             = CurDrawablePrevAnimationState()
				if Prev                          == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		
		AnimationState			                 = MOVING
			StateName                          = STATE_RunningSword
			Flags                              = RANDOMSTART
			Animation                          = GUFaramir_RUNB
				AnimationName                    = GUFaramir_SKL.GUFaramir_RUNB
				AnimationSpeedFactorRange        = 0.85 0.85
				Distance		                     = 28
			End
			BeginScript
				Prev                             = CurDrawablePrevAnimationState()
				if Prev                          == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev                          == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
			EndScript
		End
		
		AnimationState                       = ATTACKING
			StateName                          = STATE_Sword
			Animation                          = ATKD
				AnimationName                    = GUFaramir_SKL.GUFaramir_IDLA
				AnimationMode                    = MANUAL
			End			
		End
		
		AnimationState                       = EMOTION_ALERT HIT_REACTION
			Animation                          = Hit_Level_1_d
				AnimationName                    = GUFaramir_SKL.GUFaramir_HITD
				AnimationMode                    = ONCE
			End
		End
		
		AnimationState                       = HIT_REACTION
			Animation                          = Hit_Level_1_b
				AnimationName                    = GUFaramir_SKL.GUFaramir_HITB
				AnimationMode                    = ONCE
			End
		End
		
		AnimationState				               = LEVELED
			Animation				                   = LevelUp
				AnimationName		                 = GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode		                 = ONCE
			End
		End
		
		AnimationState				               =	EMOTION_CELEBRATING
			Animation
				AnimationName		                 =	GUFaramir_SKL.GUFaramir_CHRC
				AnimationMode		                 =	LOOP
			End
		End
		
		AnimationState				               =	EMOTION_TAUNTING
			Animation
				AnimationName		                 =	GUFaramir_SKL.GUFaramir_TNTC
				AnimationMode		                 =	ONCE
			End
			Animation
				AnimationName		                 =	GUFaramir_SKL.GUFaramir_TNTD
				AnimationMode		                 =	ONCE
			End
			Flags						                   = RESTART_ANIM_WHEN_COMPLETE
		End
		
		AnimationState				               =	EMOTION_ALERT
			StateName				                   =	STATE_READY
			Animation				                   =	ready
				AnimationName		                 =	GUFaramir_SKL.GUFaramir_IDLA
				AnimationMode		                 =	LOOP
				AnimationBlendTime	             =	20
			End
		End
		
		AnimationState				               =	SELECTED 
			StateName					                 = STATE_Selected_Sword
			Animation					                 = ATNE
				AnimationName			               = GUFaramir_SKL.GUFaramir_ATNE
				AnimationMode			               = LOOP
				AnimationBlendTime		           = 15
			End
			Flags						                   = RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev                             = CurDrawablePrevAnimationState()
				if Prev                          == "STATE_Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev                          == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedSword") return end
			EndScript
		End
		
		IdleAnimationState
			StateName					                 = STATE_Idle_Sword	
			Animation           		           = IDLE
				AnimationName       	           = GUFaramir_SKL.GUFaramirA_IDLE
				AnimationMode       	           = LOOP
				AnimationPriority	               = 20
				AnimationBlendTime  	           = 20
			End
			Animation                          = IDLF
                AnimationName            = GUFaramir_SKL.GUFaramirA_IDLF
                AnimationMode            = LOOP
                AnimationPriority        = 1
            End
			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev                             = CurDrawablePrevAnimationState()
				if Prev                          == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev                          == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
			EndScript
		End
		
		TransitionState                      = TRANS_BoredToSelectedSword
			Animation                          = ANTD
				AnimationName		                 = GUFaramir_SKL.GUFaramir_ANTD
				AnimationMode		                 = ONCE
			End		
		End
		
		TransitionState                      = TRANS_SelectedToBoredSword
			Animation			                     = ATNF
				AnimationName	                   = GUFaramir_SKL.GUFaramirA_ATNG
				AnimationMode	                   = ONCE
			End		
		End	
		
	End
	
    
    ; ***DESIGN parameters ***
    Side                                 = Gondor
    EditorSorting                        = UNIT
    ThreatLevel                          = 4.0
    TransportSlotCount                   = 1
    BuildCost                            = M_EOMER_BUILDCOST
    BuildTime                            = M_EOMER_BUILDTIME
    BountyValue                          = M_ROHAN_EOMER_BOUNTY_VALUE
    DisplayMeleeDamage                   = M_EOMER_DAMAGE
    MaxSimultaneousOfType                = 4

    ;;;;;; WEAPON SETS ;;;;;;
    WeaponSet
        Conditions                       = None
        Weapon                           = PRIMARY        EomerSword
        AutoChooseSources                = TERTIARY        NONE
    End
    
    ;;;;;; ARMOR SETS ;;;;;;
    ArmorSet
        Conditions                       = None
        Armor                            = HeroArmor
        DamageFX                         = None
    End
    
    ArmorSet
        Conditions                       = MOUNTED
        Armor                            = HeroArmorMounted
        DamageFX                         = None
    End
    
    VisionRange                          = M_VISION_STANDARD_HORSE                
    ShroudClearingRange                  = M_SHROUD_CLEAR_HERO    

    DisplayName                          = OBJECT:GondorKingsGuard
    ;Hotkey                               = CONTROLBAR:RohanEomerHotkey
    CrusherLevel                         = 0            ;Can I crush anything?
    MountedCrusherLevel                  = 1        ;Crush level when mounted.
    CrushableLevel                       = 2            ;What am I?:        0 = for infantry, 1 = for trees, 2 = cavalry/heroes
    MountedCrushableLevel                = 2    ;Crusable level when mounted.
    CommandSet                           = GondorKingsGuardCommandSet
    CommandPoints                        = 5

    CrushWeapon                          = HeroCrush  

    MinCrushVelocityPercent              = 50 ; Has to be moving at at least 50% of full speed.
    CrushDecelerationPercent             = 30 ; Lose xx percent of max velocity when crushing.
    
    CrushKnockback                       = 40
    CrushZFactor                         = 1.0


    ; *** AUDIO Parameters ***;
  
    VoiceAmbushed                         = TowerGuardVoiceAmbushed
    VoiceAttack                           = TowerGuardVoiceAttack
    VoiceAttackCharge                     = TowerGuardVoiceAttackCharge
    VoiceAttackMachine                    = TowerGuardVoiceAttack
    VoiceAttackStructure                  = TowerGuardVoiceAttackBuilding
    VoiceEnterStateAttack                 = TowerGuardVoiceEnterStateAttack
    VoiceEnterStateAttackCharge           = TowerGuardVoiceEnterStateAttackCharge
    VoiceEnterStateAttackMachine          = TowerGuardVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackStructure        = TowerGuardVoiceEnterStateAttackBuilding
    VoiceCreated                          = TowerGuardVoiceSalute
    VoiceFullyCreated                     = TowerGuardVoiceSalute
    VoiceMove                             = TowerGuardVoiceMove
    VoiceMoveToCamp                       = TowerGuardVoiceMoveCamp
    VoiceMoveWhileAttacking               = TowerGuardVoiceDisengage
    VoiceEnterStateMove                   = TowerGuardVoiceEnterStateMove
    VoiceEnterStateMoveToCamp             = TowerGuardVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking     = TowerGuardVoiceEnterStateDisengage
    VoicePriority                         = 56
    VoiceRetreatToCastle                  = TowerGuardVoiceRetreat
    VoiceEnterStateRetreatToCastle        = TowerGuardVoiceEnterStateRetreat
    VoiceSelect                           = TowerGuardVoiceSelect
    VoiceSelect2                          = GondorTowerGuardVoiceSelect2
    VoiceSelectBattle                     = TowerGuardVoiceSelectBattle
    VoiceGuard                            = TowerGuardVoiceMove
    SoundImpact                           = ImpactHorse
    
    UnitSpecificSounds
        VoiceGarrison                     = TowerGuardVoiceGarrison
    End
    
    EvaEventDamagedOwner                  = UnitUnderAttack
    
    Behavior                              = LargeGroupAudioUpdate ModuleTag_LGAU
        Key                               = Human Unit Infantry Gondor_Guard
    End
    
    ClientBehavior                        = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
      MaxUpdateRangeCap                   = 800
      AnimationSound                      = Sound:FootstepDirtA            Animation:RUEomer_SKL.RUEomer_RUNA        Frames:4 15
      AnimationSound                      = Sound:FootstepDirtA            Animation:RUEomer_SKL.RUEomer_RUNB        Frames:5 15 26 36

      AnimationSound                      = Sound:SwordIntoScabbard1            Animation:RUEomer_SKL.RUEomer_ATKE         Frames:13
      ;AnimationSound                      = Sound:EomerThrowSpear            Animation:RUEomer_SKL.RUEomer_ATKE         Frames:55
      AnimationSound                      = Sound:SwordShingClean1            Animation:RUEomer_SKL.RUEomer_ATKE         Frames:91

      AnimationSound                      = Sound:TauntHumanHitShield        Animation:RUEomer_SKL.RUEomer_CHRB        Frames:22 32

      AnimationSound                      = Sound:BodyFallGenericNoArmor        Animation:RUEomer_SKL.RUEomer_DIEA        Frames:48
      AnimationSound                      = Sound:BodyFallGenericNoArmor        Animation:RUEomer_SKL.RUEomer_DIEB        Frames:18
      AnimationSound                      = Sound:BodyFallSoldier            Animation:RUEomer_SKL.RUEomer_LNDA        Frames:2

      AnimationSound                      = Sound:HorseMoveFootsteps            Animation:RUHHs_Theo_SKL.RUHHs_Theo_ACCL    Frames:15 32
      AnimationSound                      = Sound:HorseMoveFootsteps            Animation:RUHHs_Theo_SKL.RUHHs_Theo_RUNA    Frames:0
      AnimationSound                      = Sound:HorseMoveFootsteps            Animation:RUHHs_Theo_SKL.RUHHs_Theo_TNL1    Frames:0
      AnimationSound                      = Sound:HorseMoveFootsteps            Animation:RUHHs_Theo_SKL.RUHHs_Theo_TNR1    Frames:0

      AnimationSound                      = Sound:HorseWhinny                Animation:RUHHs_Theo_SKL.RUHHs_Theo_IDLC    Frames:3

      AnimationSound                      = Sound:SwordIntoScabbard1            Animation:RUHHs_Theo_SKL.RUEomrHrs_SPRA    Frames:10
      ;AnimationSound                      = Sound:EomerThrowSpear            Animation:RUHHs_Theo_SKL.RUEomrHrs_SPRA    Frames:53
      AnimationSound                      = Sound:SwordShingClean1            Animation:RUHHs_Theo_SKL.RUEomrHrs_SPRA    Frames:75

      AnimationSound                      = Sound:BodyFallSoldier            Animation:RUHHs_Theo_SKL.RUHHs_Theo_LNDA    Frames:3 10
      AnimationSound                      = Sound:HorseDieForHero            Animation:RUHHs_Theo_SKL.RUHHs_Theo_LNDA    Frames:2
      AnimationSound                      = Sound:HorseDieForHero            Animation:RUHHs_Theo_SKL.RUHHs_Theo_DIEA    Frames:0
      AnimationSound                      = Sound:BodyFallGenericNoArmor        Animation:RUHHs_Theo_SKL.RUHHs_Theo_DIEA    Frames:6
      AnimationSound                      = Sound:BodyFallSoldier            Animation:RUHHs_Theo_SKL.RUHHs_Theo_DIEA    Frames:45
      
      AnimationSound                      = Sound:TauntHitShieldPitchShifted    Animation:GUTowerGrd_SKL.GUTowerGrd_TNTB    Frames: 23 43
      AnimationSound                      = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_DIEA    Frames:36
      AnimationSound                      = Sound:BodyFallGeneric1            Animation:GUTowerGrd_SKL.GUTowerGrd_LNDB    Frames:2
    End
    
		; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP
			
    Body                                 = PorcupineFormationBodyModule ModuleTag_porcupineFormation
			CheerRadius                        = M_EMOTION_CHEER_RADIUS
			MaxHealth                          = M_EOMER_HEALTH
			MaxHealthDamaged                   = M_GONDOR_TOWERGUARD_HEALTH_DAMAGED
			CrushDamageWeaponTemplate          = TowerGuardPorcupineCrushDamage
    End
		
    Behavior                             = AutoHealBehavior ModuleTag_EomerHealing
			StartsActive                       = Yes
			HealingAmount                      = M_HERO_HEAL_AMOUNT
			HealingDelay                       = 1000
			StartHealingDelay                  = M_HERO_HEAL_DELAY
			HealOnlyIfNotInCombat              = Yes
    End
    
    Behavior                             = AIUpdateInterface ModuleTag_03
      AutoAcquireEnemiesWhenIdle         = Yes ATTACK_BUILDINGS
      MoodAttackCheckRate                = 500
      AILuaEventsList                    = GondorFighterFunctions
      AttackPriority                     = AttackPriority_Infantry
    End

    LocomotorSet
			Locomotor                          = HeroHumanLocomotor
			Condition                          = SET_NORMAL 
			Speed                              = M_NORMAL_GOOD_HERO_SPEED
    End

    LocomotorSet
			Locomotor                          = HeroHorseLocomotor
			Condition                          = SET_MOUNTED 
			Speed                              = 90
    End
      
    Behavior                             = PhysicsBehavior ModuleTag_04
			GravityMult                        = 1.0
			ShockStandingTime                  = 2533    ;msec        
    End

    Behavior                             = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
    End        
    
    Behavior                             = HeroDie ModuleTag_HeroDeath
      SpecialPowerTemplate               = SpecialAbilitySmite   ;the special power that I recharge by dying
    End
      
    Behavior                             = AttributeModifierAuraUpdate ModuleTag_HeroRadiateFear
			StartsActive                       = No ;If no, requires upgrade to turn on.
			BonusName                          = HeroRadiateFear
			TriggeredBy                        = Upgrade_HeroRadiateFear
			RefreshDelay                       = 2000
			Range                              = 120
			TargetEnemy                        = Yes
			ObjectFilter                       = ANY +ORC
    End    

    ;;; TOGGLE MOUNTED ABILITY ;;;
		Behavior                             = SpecialPowerModule ModuleTag_HorseToggleStarter                      
			SpecialPowerTemplate            	 = SpecialAbilityToggleMounted
			UpdateModuleStartsAttack        	 = Yes
			StartsPaused                    	 = No
		End

    Behavior                             = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
			SpecialPowerTemplate               = SpecialAbilityToggleMounted
			UnpackTime                         = 2000
			PreparationTime                    = 1  
			PersistentPrepTime                 = 250
			PackTime                           = 2000
			OpacityTarget                      = .3        ; How see-thru to be at peak of change   
			AwardXPForTriggering               = 0
    End

    Behavior                             = SlowDeathBehavior ModuleTag_05
			DeathTypes                         = ALL 
			SinkDelay                          = 3000
			SinkRate                           = 0.40     ; in Dist/Sec
			DestructionDelay                   = 8000
			Sound                              = INITIAL HumanVoiceDie
    End
    
    Behavior                             = SquishCollide ModuleTag_06
    End

    Geometry                             = CYLINDER
    GeometryMajorRadius                  = 8.0
    GeometryMinorRadius                  = 8.0
    GeometryHeight                       = 19.2
    GeometryIsSmall                      = Yes
		Shadow                               = SHADOW_DECAL
		ShadowSizeX                          = 20;
		ShadowSizeY                          = 20;
		ShadowTexture                        = ShadowI;
End

;------------------------------------------------------------------------------
ChildObject GondorKingsGuard_Summoned GondorKingsGuard
	IsTrainable                            = No
	CommandPoints                          = 0
	EquivalentTo                           = GondorKingsGuard
	Behavior                               = LifetimeUpdate ModuleTag_LifetimeUpdate
	; This one does the work, but the one in the horde displays the timer
		MinLifetime		                       = 120000 ; 180000
		MaxLifetime		                       = 120000 ; 180000
		DeathType		                         = FADED
	End	
End
;------------------------------------------------------------------------------
ChildObject GondorKingsGuard_Slaved GondorKingsGuard
	EquivalentTo                           = GondorKingsGuard
  
  Behavior = SlavedUpdate ModuleTag_Slave
		GuardMaxRange					= 75
		GuardWanderRange				= 50
		;DieOnMastersDeath				= Yes	
		;MarkUnselectable = Yes		
	End
End