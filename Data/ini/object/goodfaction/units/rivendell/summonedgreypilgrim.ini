;------------------------------------------------------------------------------
;
;    GreyPilgrim.ini aka Gandalf the Grey
;
;------------------------------------------------------------------------------

; Gandalf the Generic
;he is now grey to start out with until we use the spell
Object RivendellGreyPilgrimSummon  
    ; *** ART Parameters ***

    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
    SelectPortrait = HPRivendellGandalf
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
    ButtonImage = HIRivendellGandalf
    
    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDrawInWorldBuilder
        ;When in Worldbuilder, show the normal Gandalf. He's inherited as mounted mode, so we have to get creative.
        ;Because his other draw module has a default state, we need to not show anything if it's in WorldBuilder.
        
        OkToChangeModelColor = Yes
              
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = augandalf_skn
        End        
    End
 
    Draw = W3DScriptedModelDraw ModuleTag_01
        GlowEnabled = No;
        GlowEmissive = No;
        OkToChangeModelColor = Yes
        StaticModelLODMode = No ; Will append M or L to the skin name depending on GameLOD

        ExtraPublicBone = STAFF
        ExtraPublicBone = B_SWORDBONE
        DependencySharedModelFlags = TURN_LEFT_HIGH_SPEED TURN_RIGHT_HIGH_SPEED MOVING ACCELERATE DECELERATE TURN_LEFT TURN_RIGHT ATTACKING BACKING_UP
        
        ;;; MODEL STATES ;;;
        DefaultModelConditionState ;gandalf is grey to start out with
            Model                  = augandalf_skn
            WeaponLaunchBone       = TERTIARY STAFF 
        End

        ModelConditionState        = USER_1
            Model                  = augandalf_skn ;gugandalf_moria
            WeaponLaunchBone       = TERTIARY STAFF 
            Shadow                 = SHADOW_ADDITIVE_DECAL
            ShadowSizeX            = 200;
            ShadowSizeY            = 200;
            ShadowTexture          = EXGandalfGlow
        End

        IdleAnimationState
            StateName = Idle
            Animation = Foot_IDLB ; Bored Idle
                AnimationName       = GUGandalfG_SKL.GUGandalfN_IDLB ;GUGandalfG_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 20
            End
            Animation = Foot_IDLC ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfN_IDLC ;GUGandalfG_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 2
            End
            Animation = Foot_IDLD ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfG_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 1
            End
            Animation = Foot_IDLE ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfG_IDLE
                AnimationMode       = ONCE
                AnimationPriority   = 2
            End
            Animation = Foot_IDLF ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfF_IDLF
                AnimationMode       = ONCE
                AnimationPriority   = 1
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
                CurDrawableHideSubObject("STAFF_LIGHT")            
            EndScript            
                        
        End

        AnimationState      = STUNNED_FLAILING 
            Animation = StunnedFlail
                AnimationName         = GUGandalfG_SKL.GUGandalfG_FLYA
                AnimationMode     = LOOP
            End
        End
        
        AnimationState					=	DYING DEATH_2
          Animation					=	FadingOut 
            AnimationName			=	GUGandalfG_SKL.GUGandalfG_ATNB
            AnimationMode			=	ONCE
          End
        End
        
        AnimationState      = DYING SPLATTED
            Animation = Stunned
                AnimationName         = GUGandalfG_SKL.GUGandalfG_LNDA
                AnimationMode     = ONCE
            End
;      ;ParticleSysBone   = None GandalfIllumination FollowBone:yes FXTrigger:NONE Persist:KILL PersistID:100
        End
        
        AnimationState        = DYING AFLAME
            Animation = DieAflame
                AnimationName           = GUGandalfG_SKL.GUGandalfG_MFDA
                AnimationMode       = LOOP
            End
        End
        
        AnimationState        = DYING
            Animation = Die
                AnimationName           = GUGandalfG_SKL.GUGandalfG_DIEB
                AnimationMode       = ONCE
            End
;      ;ParticleSysBone     = None GandalfIllumination FollowBone:yes FXTrigger:NONE Persist:KILL PersistID:100
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GUGandalfG_GTPA
                AnimationName     = GUGandalfG_SKL.GUGandalfG_GTPA
                AnimationMode     = ONCE
            End
        End
        
        AnimationState      = STUNNED
            Animation = Stunned
                AnimationName         = GUGandalfG_SKL.GUGandalfG_LNDA
                AnimationMode     = ONCE
            End
;      ;ParticleSysBone   = None GandalfIllumination FollowBone:yes FXTrigger:NONE Persist:KILL PersistID:100
        End

        AnimationState        =  PASSENGER EATING
            StateName = BeingEaten
            Animation
                AnimationName           = GUGandalfG_SKL.GUGandalfG_EATA
                AnimationMode       = ONCE
                AnimationBlendTime    =    4
            End
        End
    
        AnimationState        =  PASSENGER
        StateName = BeingEaten
            Animation
                AnimationName           = GUGandalfG_SKL.GUGandalfG_FLLA
                AnimationMode       = LOOP
                AnimationBlendTime    =    4
            End
        End
    
        ;;; WORD OF POWER ANIMS ON FOOT ;;;
        AnimationState        =  SPECIAL_WEAPON_ONE
            StateName = Attacking
            Animation
                AnimationName           = GUGandalfG_SKL.GUGandalfG_SPCK
                AnimationMode       = ONCE
            End
            ;FXEvent            = Frame:5 Name:FX_GandalfPreAttackBlast
        End
    
        ;;; WIZARD BLAST ANIMS ON FOOT ;;;
        AnimationState        =  SPECIAL_WEAPON_TWO
            StateName = Attacking
            Animation
                AnimationName       = GUGandalfG_SKL.GUGandalfG_SPCL
                AnimationMode       = ONCE
            End
        End
        
        ;;; LIGHTNING CHARGE ANIMS ON FOOT ;;;
        AnimationState        =  PACKING_TYPE_1 UNPACKING
            StateName = Attacking
            Animation = LightningSwordStart
                AnimationName           = GUGandalfG_SKL.GUGandalfG_SPE3
                AnimationMode       = ONCE
            End
            FXEvent            = Frame:14 Name:FX_GandalfLightningCharge
;            FXEvent            = Frame:70 Name:FX_GandalfLightningFizzle
            FXEvent            = Frame:14 Name:FX_GandalfLightningSword  FrameStop:70
        End
    
        AnimationState        =  PACKING_TYPE_1 PREPARING
            StateName = Attacking
            Animation = LightningSwordLoop
                AnimationName           = GUGandalfG_SKL.GUGandalfG_SPE2
                AnimationMode       = LOOP
            End
        End

        AnimationState        =  PACKING_TYPE_1 PACKING
            StateName = Attacking
            Animation = LightningSwordPutAway
                AnimationName           = GUGandalfG_SKL.GUGandalfG_SPE1
                AnimationMode       = ONCE
            End
        End

        ;;; ISTARI LIGHT STAFF WEAPON ON FOOT ;;;
        AnimationState        =  SPECIAL_WEAPON_THREE ; FIRING_OR_PREATTACK_C
            StateName = Attacking
            Animation = StaffLaser
                AnimationName           = GUGandalfG_SKL.GUGandalfG_SPCH ; isitari's light?
                AnimationMode       = ONCE
            End
            ;FXEvent            = Frame:30 Name:FX_GandalfStaffFlare
        End
        
        ;;; Summoning Shadow Fax ;;;
        AnimationState        =  UNPACKING
            StateName = Attacking
            Animation
                AnimationName        = GUGdfHrs_SKL.GUGdfHrs_SPCJ
                AnimationMode       = ONCE
            End
        End

        ;;; Attacking
        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUGandalfG_SKL.GUGandalfG_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART  
        End
        

        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation = StaffSwing
                AnimationName           = GUGandalfG_SKL.GUGandalfG_ATKA
                AnimationMode       = ONCE
                UseWeaponTiming        = Yes
            End
            Animation = SwordSwing
              AnimationName           = GUGandalfG_SKL.GUGandalfG_ATKB    
              AnimationMode       = ONCE
              UseWeaponTiming        = Yes
            End
            Animation = SpinningSwordStaff
              AnimationName           = GUGandalfG_SKL.GUGandalfG_ATKC    
              AnimationMode       = ONCE
              UseWeaponTiming        = Yes
            End            
        End


        ;;; Moving Anims ;;;
        AnimationState        = MOVING WANDER
            Animation = Wandering
                AnimationName           = GUGandalfG_SKL.GUGandalfG_WLKA ;32
                AnimationMode       = LOOP
            End
        End
    
        AnimationState        = MOVING
            Animation = Moving
                AnimationName           = GUGandalfG_SKL.GUGandalfG_RUNB ;20
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End
        
        ; READY IDLE
        AnimationState        = EMOTION_ALERT
            Animation           = ALERT_1
                AnimationName     = GUGandalfG_SKL.GUGandalfG_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
        End

        AnimationState        = LEVELED    USER_1; This state clears itself in 3 of your Earth seconds
            Animation = Yippee
                AnimationName           = GUGandalfG_SKL.GUGandalfG_LVLA
                AnimationMode       = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("STAFF_LIGHT")            
            EndScript                        
        End

        AnimationState        = LEVELED    ; This state clears itself in 3 of your Earth seconds
            Animation = Yippee
                AnimationName           = GUGandalfG_SKL.GUGandalfG_LVLA
                AnimationMode       = ONCE
            End
        End
        
        ;;; Transition States
        TransitionState                    =    TRANS_Idle_to_Selected
            Animation                    =    ATNA
                AnimationName            =    GUGandalfG_SKL.GUGandalfG_ATNA
                AnimationMode            =    ONCE
            End
        End
        
        TransitionState                    =    TRANS_Selected_To_Idle
            Animation                    =    ATNE ;ATNC
                AnimationName            =    GUGandalfG_SKL.GUGandalfN_ATNE; GUGandalfG_ATNE ;C
                AnimationMode            =    ONCE
            End
        End

        AnimationState                =    SELECTED USER_1
            StateName                =    Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB            
                AnimationName        =    GUGandalfG_SKL.GUGandalfG_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
            EndScript
        End

        AnimationState                =    SELECTED
            StateName                =    Selected
            SimilarRestart            =   Yes            
            Animation                =    ATNB            
                AnimationName        =    GUGandalfG_SKL.GUGandalfG_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
                CurDrawableHideSubObject("STAFF_LIGHT")            
            EndScript
        End

        AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
                AnimationName = GUGandalfG_SKL.GUGandalfG_HITA
                AnimationMode = ONCE
            End
        End

        AnimationState        =  USER_1
            StateName = user_1_idle
            Animation = Foot_IDLB ; Bored Idle
                AnimationName       = GUGandalfG_SKL.GUGandalfN_IDLB ;GUGandalfG_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 2
            End
            Animation = Foot_IDLC ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfN_IDLC ;GUGandalfG_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 2
            End
            Animation = Foot_IDLD ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfG_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 1
            End
            Animation = Foot_IDLE ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfG_IDLE
                AnimationMode       = ONCE
                AnimationPriority   = 2
            End
            Animation = Foot_IDLF ; Bored Fidget
                AnimationName       = GUGandalfG_SKL.GUGandalfF_IDLF
                AnimationMode       = ONCE
                AnimationPriority   = 1
            End
            
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
                CurDrawableShowSubObject("STAFF_LIGHT")            
            EndScript            
        End

    End

    Draw = W3DScriptedModelDraw ModuleTag_LightController
        DefaultModelConditionState
            Model = None
        End
        
        ModelConditionState = USER_1
            Model = Invisible
            Shadow = SHADOW_ADDITIVE_DECAL_DYNAMIC
            ShadowSizeX = 200;
            ShadowSizeY = 200;
            ShadowTexture = EXGandalfGlow;
            ShadowOpacityStart = 0
            ShadowOpacityFadeInTime = 1000
            ShadowOpacityPeak = 255
            ShadowOpacityFadeOutTime = 1000
            ShadowOpacityEnd = 0
        End

        IdleAnimationState
            BeginScript
               CurDrawableHideModule("ModuleTag_DrawLight")
            EndScript
        End
        AnimationState = USER_1
            BeginScript
                CurDrawableShowModule("ModuleTag_DrawLight")
            EndScript
        End
        AttachToBoneInAnotherModule = STAFF
    End
    
    Draw                          = W3DLightDraw ModuleTag_DrawLight
        Ambient                     = R:25 G:25 B:25
        Diffuse                     = R:90 G:90 B:115
        Radius                      = 25
        Intensity                   = 35
        AttachToBoneInAnotherModule = STAFF
    End
    
    ; ***DESIGN parameters ***
    Side                     = Rivendell
    EditorSorting            = UNIT
    ThreatLevel              = 5.0
    ThingClass               = CHARACTER_UNIT
    DisplayMeleeDamage       = GREY_PILGRIM_DAMAGE
    HeroSortOrder            = 10
    LiveCameraOffset         = X:-112 Y:81 Z:57
    LiveCameraPitch          = 25.0
    IsTrainable              = No
    BuildCost                = M_GANDALF_THE_WHITE_BUILDCOST
    BuildTime                = M_GANDALF_THE_WHITE_BUILDTIME            
    TransportSlotCount       = 1
    
    WeaponSet
        Conditions           = None 
        Weapon               = PRIMARY GreyPilgrimSword
    End

    ArmorSet
        Conditions           = None
        Armor                = HeroArmor
        DamageFX             = NormalDamageFX
    End
    
    CommandSet               = GreyPilgrimCommandSet
    CommandPoints            = 0
    
    VisionRange              = M_VISION_STANDARD_MELEE                
    ShroudClearingRange      = M_SHROUD_CLEAR_STANDARD
    BountyValue              = M_GONDOR_GANDALFWHITE_BOUNTY_VALUE
    DisplayName              = OBJECT:GandalfTheWhite
    RecruitText              = CONTROLBAR:GandalfTheWhiteRecruit
    ReviveText               = CONTROLBAR:GandalfTheWhiteRevive
    Hotkey                   = CONTROLBAR:GandalfTheWhiteHotkey
    CrusherLevel             = 0    ;Can I crush anything?
    CrushableLevel           = 2    ;What am I?: 0 = for infantry, 1 = for trees, 2 = cavalry/heroes

    ; *** AUDIO Parameters ***;
    VoiceAttack             = GandalfVoiceAttack
    VoiceAttackCharge       = GandalfVoiceAttackCharge
    VoiceAttackMachine      = GandalfVoiceAttack
    VoiceAttackStructure    = GandalfVoiceAttack
    VoiceCreated            = GandalfVoiceSalute        ;this conflicts with his respawn dialogue line -- rehooked to spawn FX
    VoiceFullyCreated       = GandalfVoiceSalute        ;this conflicts with his respawn dialogue line -- rehooked to spawn FX
    VoiceFear               = GandalfVoiceHelpMe
    VoiceMove               = GandalfVoiceMove
    VoiceMoveToCamp         = GandalfVoiceMoveCamp
    VoiceMoveWhileAttacking = GandalfVoiceDisengage
    VoicePriority           = 96
    VoiceRetreatToCastle    = GandalfVoiceRetreat
    VoiceSelect             = GandalfVoiceSelect
    VoiceSelect2            = HeroVoiceSelect2
    VoiceSelectBattle       = GandalfVoiceSelectBattle
    VoiceGuard              = GandalfVoiceMove
    
    SoundImpact             = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison       = GandalfVoiceGarrison              
    End

    EvaEventDamagedOwner    = UnitUnderAttack         ;Eva event to trigger when unit is damaged
    EvaEventDieOwner        = GandalfDie            ;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU            ; Tie into LargeGroupAudio system
        Key         = Human Unit Infantry Hero
        UnitWeight  = 2
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:GUGandalfG_SKL.GUGandalfG_RUNA        Frames:10 20
        AnimationSound = Sound:FootstepDirtA            Animation:GUGandalfG_SKL.GUGandalfG_RUNB        Frames:10 22 33 45
        AnimationSound = Sound:BodyFallGenericNoArmor        Animation:GUGandalfG_SKL.GUGandalfG_DIEB        Frames:63
        AnimationSound = Sound:BodyFallGenericNoArmor        Animation:GUGandalfG_SKL.GUGandalfG_LNDA        Frames:2
    End

    ; *** ENGINEERING Parameters ***
    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ATTACK_NEEDS_LINE_OF_SIGHT NOTIFY_OF_PREATTACK ARMY_SUMMARY SCARY GANDALF
    PathfindDiameter = 40.0
    
    Body                            = ActiveBody ModuleTag_ActiveBody
        CheerRadius                 = M_EMOTION_CHEER_RADIUS
        MaxHealth                   = GREY_PILGRIM_HEALTH
    End
    
    Behavior                        = AIUpdateInterface ModuleTag_04
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        AILuaEventsList             = GandalfFunctions
    End 
    
    Behavior                        = HeroDie ModuleTag_HeroDeath
        SpecialPowerTemplate        = SpecialAbilitySmite   ;the special power that I recharge by dying
    End

    Behavior                        = AutoHealBehavior ModuleTag_GandalfHealing
        StartsActive                = Yes
        HealingAmount               = HERO_HEAL_AMOUNT
        HealingDelay                = 1000
        StartHealingDelay           = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat       = Yes
    End
        
    LocomotorSet
        Locomotor                   = HeroHumanLocomotor
        Condition                   = SET_NORMAL 
        Speed                       = NORMAL_GOOD_HERO_SPEED
    End
    
    Behavior                        = PhysicsBehavior ModuleTag_05
        GravityMult                 = 1.0
        ShockStandingTime           = 3800    ;msec
    End 
    
    Behavior                        = SquishCollide ModuleTag_07
        ;nothing
    End
    
    Behavior                        = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
    End  
    
    ;;; Add summon timer
    Behavior                        = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime                 = 75000
        MaxLifetime                 = 75000
        DeathType                   = FADED
    End 
    
    Behavior                        = SlowDeathBehavior ModuleTag_NormalDeath
        DeathTypes                  = NONE +KNOCKBACK -FADED 
        SinkDelay                   = 3000
        SinkRate                    = 0.40     ; in Dist/Sec
        DestructionDelay            = 8000
    End
    
    Behavior                        = SlowDeathBehavior ModuleTag_FuckDeath
        DeathTypes                  = ALL -FADED -KNOCKBACK
        SinkDelay                   = 3000
        SinkRate                    = 0.40     ; in Dist/Sec
        DestructionDelay            = 8000
    End
    
    Behavior                        = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                  = NONE +FADED
        FadeDelay                   = 0
        FadeTime                    = 8000
        DestructionDelay            = 8000
        DeathFlags		              = DEATH_2
        FX                          = INITIAL FX_UnSummonElvenAllies ;-- Include an FX if you want.
    End  
    
     ;;; Grant Level 10
    Behavior                        = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant                = 10
        MPOnly                      = Yes
    End   
    
    ; -- Gandalf's Cart
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_GreyPilgramCartEnabler
        SpecialPowerTemplate 			  = SpecialAbilityGreyPilgramCart
        TriggeredBy 							  = Upgrade_GenericUpgrade1
    End

    Behavior                        = OCLSpecialPower ModuleTag_GreyPilgramCart
        SpecialPowerTemplate        = SpecialAbilityGreyPilgramCart
        OCL                         = OCL_GreyPilgramCartEgg
        CreateLocation              = USE_OWNER_OBJECT
        StartsPaused                = Yes
        ;SetModelCondition          = ModelConditionState:USER_1
        ;SetModelConditionTime      = 8.1
        TriggerFX			              = FX_GreyPilgramCartSummonFX
    End
    
    ; -- Lets Risk a Little More Light 
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate        = SpecialAbilityTheodenGloriousCharge
        TriggeredBy                 = Upgrade_GenericUpgrade1
    End
    
    Behavior                        = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate   
        SpecialPowerTemplate        = SpecialAbilityTheodenGloriousCharge
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = No
        AttributeModifier           = GreyPilgrimLightBonus
        AttributeModifierRange      = 200
        AttributeModifierAffects    = NONE +INFANTRY +CAVALRY +ARCHER
        AttributeModifierFX         = FX_GloriousChargeGenericFX
        SetModelCondition			      = ModelConditionState:USER_1
        SetModelConditionTime		    = 5.0
        DisableDuringAnimDuration	  = Yes
    End

    Behavior                        = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                  = 1000
        UnpackingVariation		      = 2
        SpecialPowerTemplate	      = SpecialAbilityTheodenGloriousCharge
        PreparationTime             = 0  
        PersistentPrepTime          = 0
        PackTime                    = 3000
    End

    ; -- Disturber of the Peace aka firework shot
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_IstariLightEnabler
        SpecialPowerTemplate        = SpecialAbilityIstariLight
        TriggeredBy                 = Upgrade_GenericUpgrade1
    End
    Behavior                        = SpecialPowerModule ModuleTag_IstariLightPower                      
        SpecialPowerTemplate        = SpecialAbilityIstariLight
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = GandalfVoiceAttackIstariLight    ;this plays when he targets, not when he fires
    End

    Behavior                        = WeaponFireSpecialAbilityUpdate ModuleTag_IstariLightUpdate
        SpecialPowerTemplate        = SpecialAbilityIstariLight
        SkipContinue                = Yes
        UnpackTime                  = 2000 
        PreparationTime             = 1  
        PersistentPrepTime          = 2000
        PackTime                    = 500
        AwardXPForTriggering        = 0
        StartAbilityRange           = 290 ; Note: This has to be smaller than the weapon range or it'll never succeed
        ApproachRequiresLOS         = Yes
        SpecialWeapon               = GandalfDisturber
        MustFinishAbility           = Yes
        WhichSpecialWeapon          = 3
        BusyForDuration             = 2500
    End
    
    ; -- The Foe-Hammer
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
        SpecialPowerTemplate        = SpecialAbilityLightningSword
        TriggeredBy                 = Upgrade_GenericUpgrade1
    End

    Behavior                        = SpecialPowerModule ModuleTag_11                      
        SpecialPowerTemplate        = SpecialAbilityLightningSword
        UpdateModuleStartsAttack    = No ;
        StartsPaused                = Yes
        InitiateSound               = GandalfVoiceAttackLightningSword    ;this plays when he targets, not when he fires
    End

    Behavior                        = ArrowStormUpdate ModuleTag_12                
        SpecialPowerTemplate        = SpecialAbilityLightningSword
        StartAbilityRange           = 275.0
        UnpackingVariation          = 1       
        UnpackTime                  = 2500 ; Pull out arrow
        PreparationTime             = 1 ; Quick shot
        PersistentPrepTime          = 500 ; looping the quick shot
        PackTime                    = 1500 ; back to idle
        ApproachRequiresLOS         = Yes ; required so that it doesn't shoot through walls
        AwardXPForTriggering        = 0
        ActiveLoopSound             = GandalfLightningLoop  ; Sound loops entire time ability is actively firing

        ;Specific to ArrowStorm
        WeaponTemplate              = GandalfLightningSwordBlastWeapon
        TargetRadius                = 120
        ShotsPerTarget              = 1
        ShotsPerBurst               = 1
        MaxShots                    = 11  ; will double up if run out of targets
    End

    ; -- You Shall Not Pass
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_WordEnabler
        SpecialPowerTemplate        = SpecialAbilityWordOfPower
        TriggeredBy                 = Upgrade_GenericUpgrade1
    End
    
    Behavior                        = SpecialPowerModule ModuleTag_WordStarter
        SpecialPowerTemplate        = SpecialAbilityWordOfPower
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End
    
    Behavior                        = WeaponFireSpecialAbilityUpdate ModuleTag_WordWeaponFireUpdate   
        SpecialPowerTemplate        = SpecialAbilityWordOfPower
        WhichSpecialWeapon          = 1
        SkipContinue                = Yes
        UnpackTime                  = 1700 
        PackTime                    = 1        
        FreezeAfterTriggerDuration  = 2500 ; Hold AI for this long after we fire.
        AwardXPForTriggering        = 0        
        StartAbilityRange           = 80.0
        SpecialWeapon               = GreyPilgrimShallNotPassWeapon
    End

    ; -- MOUNTED HORDER SPECIAL ABILITY
    Behavior                        = UnpauseSpecialPowerUpgrade ModuleTag_HorseEnabler
        SpecialPowerTemplate        = SpecialAbilityToggleMounted
        TriggeredBy                 = Upgrade_GenericUpgrade1
    End
    
    Behavior                        = SpecialPowerModule ModuleTag_HorseToggleStarter                      
        SpecialPowerTemplate        = SpecialAbilityToggleMounted
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End
    
    Behavior                        = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
        SpecialPowerTemplate        = SpecialAbilityToggleMounted
        UnpackTime                  = 2000
        PreparationTime             = 1  
        PersistentPrepTime          = 250
        PackTime                    = 2000
        OpacityTarget               = .3        ; How see-thru to be at peak of change
        AwardXPForTriggering        = 0
    End    
  
    Geometry                        = CYLINDER
    GeometryMajorRadius             = 8.0
    GeometryMinorRadius             = 8.0
    GeometryHeight                  = 19.2
    GeometryIsSmall                 = No
    
    Shadow                          = SHADOW_DECAL
    ShadowSizeX                     = 20;
    ShadowSizeY                     = 20;
    ShadowTexture                   = ShadowI;
End

