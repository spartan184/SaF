
;------------------------------------------------------------------------------
; aka GondorTowerGuard TowerShieldGuard GuardTowerShield
Object RivendellBreelandGuard
	; *** ART Parameters ***
	Scale                  = .98
	SelectPortrait         = uprivbreelander
	ButtonImage	           = uirivbreelander

	Draw                   = W3DHordeModelDraw ModuleTag_01
		OkToChangeModelColor = Yes
		StaticModelLODMode   = Yes

    DefaultModelConditionState
      Model              = autwnsgrd_skn
      Skeleton           = GUTwrGrd_SKL
    End

    ModelConditionState    = RIDER2 ;aubreegrdHA_skn
      Model                = autwnsgrdHA_skn
      Skeleton             = GUTwrGrd_SKL
    End

    ModelConditionState    = COMING_OUT_OF_FACTORY ;aubreegrdHA_skn
      Model                = autwnsgrd_skn
      Skeleton             = GUTwrGrd_SKL
    End

    ; ------------------ Animations ------------------------ ;
    AnimationState                        = THROWN_PROJECTILE
        Animation                         = FLYA
            AnimationName                 = GUTwrGrd_FLYA
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = PASSENGER FREEFALL
        Animation                         = Grabbed
            AnimationName                 = GUTwrGrd_FLLA
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = FREEFALL
        Animation                         = Falling
            AnimationName                 = GUTwrGrd_FLYA
            AnimationMode                 = LOOP
            AnimationBlendTime            = 10
        End
    End
    AnimationState                        = DYING DEATH_2
        Animation                         = LNDA
            AnimationName                 = GUTwrGrd_IDLA
            AnimationMode                 = ONCE
        End
    End
    AnimationState                        = DYING SPLATTED
        Animation                         = LNDA
            AnimationName                 = GUTwrGrd_LNDA
            AnimationMode                 = ONCE
        End
    End
    AnimationState                        = DYING
        Animation                         = DIEA
            AnimationName                 = GUTwrGrd_DIEA
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        Animation                         = DIEA
            AnimationName                 = GUTwrGrd_DIEB
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        Animation                         = DIEA
            AnimationName                 = GUTwrGrd_DIEC
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 0.8 1.2
        End
    End
    AnimationState                        = MOVING FIRING_OR_PREATTACK_A
        ShareAnimation                    = Yes
        Animation                         = RunAndFire
            AnimationName                 = GUTwrGrd_ATRA
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART  
    End
  ;                                       =======TERROR
    AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
        ShareAnimation                    = Yes
        Animation                         = TerrorFromTheSky
            AnimationName                 = GUTwrGrd_RUNE
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = MOVING EMOTION_TERROR
        ShareAnimation                    = Yes
        Animation                         = Terror
            AnimationName                 = GUTwrGrd_RUNE
            AnimationMode                 = LOOP
        End
    End
  ;----------------
  ;                                       =======BACK UP
    AnimationState                        =    MOVING BACKING_UP
        ShareAnimation                    = Yes
        Animation                         =    BackingUp
            AnimationName                 =    GUTwrGrd_BAKA
            AnimationMode                 =    LOOP
        End
        Animation                         =    BackingUp
            AnimationName                 =    GUTwrGrd_BAKB
            AnimationMode                 =    LOOP
        End            
        Flags                             =    RANDOMSTART 
    End
  ;--------------------
    AnimationState                        = COMING_OUT_OF_FACTORY
      Animation                           = Being_Built
        AnimationName		                  = GUTwrGrd_RUNC
        AnimationMode		                  = LOOP
        AnimationBlendTime	              = 0
      End
              ParticleSysBone             = None InfantryDustTrails
    End
    AnimationState                        = MOVING ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
        ;ShareAnimation                   = Yes
        StateName                         = STATE_EnrouteToPorcupine
        Animation
            AnimationName                 = GUTwrGrd_WLKA
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
        ParticleSysBone                   = None InfantryDustTrails
    End
    AnimationState                        = MOVING ALTERNATE_FORMATION 
        ;ShareAnimation                   = Yes
        StateName                         = STATE_EnrouteToPorcupine
        Animation
            AnimationName                 = GUTwrGrd_WLKB
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
        ParticleSysBone                   = None InfantryDustTrails
    End
    AnimationState                        = MOVING ATTACKING
        ;ShareAnimation                   = Yes
        StateName                         = STATE_EnrouteToPorcupine
        Animation
            AnimationName                 = GUTwrGrd_RUNC
            AnimationMode                 = LOOP
        End
        Animation
            AnimationName                 = GUTwrGrd_RUND
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
        ParticleSysBone                   = None InfantryDustTrails
    End
    AnimationState                        = MOVING
        ShareAnimation                    = Yes
        Animation                         = RUNA
            AnimationName                 = GUTwrGrd_RUNA
            AnimationMode                 = LOOP
        End
        Animation
            AnimationName                 = GUTwrGrd_RUNB
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
        ParticleSysBone                   = None InfantryDustTrails
    End
    AnimationState                        =  FIRING_OR_PREATTACK_A
        Animation                         = ATKA
            AnimationName                 = GUTwrGrd_ATKA
            AnimationMode                 = ONCE
            UseWeaponTiming               = Yes
        End
        Animation                         = ATKA
            AnimationName                 = GUTwrGrd_ATKB
            AnimationMode                 = ONCE
            UseWeaponTiming               = Yes
        End
        ;ParticleSysBone                  = None MeleeDust
    End
    AnimationState                        = STUNNED_FLAILING
        Animation                         = FLYA
            AnimationName                 = GUTwrGrd_FLYA
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
    End
    AnimationState                        = STUNNED_STANDING_UP
        Animation                         = GTPA
            AnimationName                 = GUTwrGrd_GTPA
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 1.5 1.5
        End
    End
    AnimationState                        = STUNNED
        Animation                         = LNDA
            AnimationName                 = GUTwrGrd_LNDA
            AnimationMode                 = ONCE
        End
    End
    TransitionState                       = TRANS_Plant
        Animation                         = PLTA
            AnimationName                 = GUTwrGrd_PLTA
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 0.8 1.2
        End
    End
    TransitionState                       = TRANS_Unplant
        Animation                         = PLTB
            AnimationName                 = GUTwrGrd_PLTC
            AnimationMode                 = ONCE
            AnimationSpeedFactorRange     = 0.5 1.2
        End
    End
  ;------------------ Hit Reaction ---------------------------------------
    AnimationState                        = HIT_REACTION
        Animation                         = HIT REACTION
            AnimationName                 = GUTwrGrd_HITA
            AnimationMode                 = ONCE
        End
    End
  ;------------------ EMOTIONS -------------------------------------------
  ;                                       ======= APPREHENSIVE
    AnimationState                        = EMOTION_ALERT EMOTION_AFRAID
        ShareAnimation                    = Yes
        Animation                         = Apprehensive
            AnimationName                 = GUTwrGrd_FERA
            AnimationMode                 = LOOP    ;Change this to ONCE if adding additional anims
        End
        Flags                             = RANDOMSTART
    End
  ;                                       ======= AFRAID
    AnimationState                        = EMOTION_AFRAID
        ShareAnimation                    = Yes
        Animation                         = FERA
            AnimationName                 = GUTwrGrd_FERA
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
    End
  ;                                       ======= TAUNTING
    AnimationState                        = EMOTION_TAUNTING ALTERNATE_FORMATION
        Animation                         = TNTA
            AnimationName                 = GUTwrGrd_TNTA
            AnimationMode                 = LOOP
        End
        Animation                         = TNTA
            AnimationName                 = GUTwrGrd_TNTB
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = EMOTION_TAUNTING
        Animation                         = Taunting
            AnimationName                 = GUTwrGrd_TNTA
            AnimationMode                 = ONCE
        End
        Animation                         = Taunting2
            AnimationName                 = GUTwrGrd_TNTB
            AnimationMode                 = ONCE
        End
        Flags                             = RESTART_ANIM_WHEN_COMPLETE
    End
  ;                                       ======= POINTING
    AnimationState                        = EMOTION_POINTING
        Animation                         = Pointing1
            AnimationName                 = GUTwrGrd_PNTA
            AnimationMode                 = LOOP
        End
        Animation                         = Pointing1
            AnimationName                 = GUTwrGrd_PNTB
            AnimationMode                 = LOOP
        End
        Flags                             = RANDOMSTART
    End
  ;                                       ======= CELEBRATING
    AnimationState                        = EMOTION_CELEBRATING
        Animation                         = CHRA
            AnimationName                 = GUTwrGrd_CHRA
            AnimationMode                 = LOOP
        End
        Animation                         = CHRA
            AnimationName                 = GUTwrGrd_CHRB
            AnimationMode                 = LOOP
        End
        Animation                         = CHRA
            AnimationName                 = GUTwrGrd_CHRC
            AnimationMode                 = LOOP
        End
    End
  ;-------------- ALERT STATE ------------------------------------------------------------
    AnimationState                        = EMOTION_ALERT
        Animation                         = CHRA
            AnimationName                 = GUTwrGrd_IDLA
            AnimationMode                 = LOOP
        End
    End
  ;-------------- SELECTED & IDLE --------------------------------------------------------
  ;                                       ======== SELECTED
    AnimationState                        = SELECTED ALTERNATE_FORMATION ; PORCUPINE
        ;ShareAnimation                   = Yes
        StateName                         = STATE_SelectedAlternateFormation
        Animation
            AnimationName                 = GUTwrGrd_PLTB
            AnimationMode                 = LOOP
        End
        BeginScript
            Prev                          = CurDrawablePrevAnimationState()
            if Prev ~                     = "STATE_SelectedAlternateFormation" and Prev ~= "STATE_Planted" and Prev ~= "TRANS_Plant" then CurDrawableSetTransitionAnimState("TRANS_Plant") end
        EndScript
    End
    AnimationState                        = SELECTED ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
        ;ShareAnimation                   = Yes 
        StateName                         = STATE_SelectedAlternateFormation
        Animation
            AnimationName                 = GUTwrGrd_ATNB
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = ALTERNATE_FORMATION WEAPONSET_TOGGLE_1
        Animation
            AnimationName                 = GUTwrGrd_IDLA
            AnimationMode                 = LOOP
        End
    End
    AnimationState                        = SELECTED
        StateName                         = STATE_Selected
        ShareAnimation                    = Yes
        Animation                         = ATNB
            AnimationName                 = GUTwrGrd_ATNB
            AnimationMode                 = LOOP
        End
        BeginScript
            Prev                          = CurDrawablePrevAnimationState()
            if Prev                       == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
        EndScript
    End
  ;                                       ======== IDLE
    AnimationState                        = ALTERNATE_FORMATION ;PORCUPINE    ;    aka Porcupine formation
        StateName                         = STATE_Planted
        ;ShareAnimation                   = Yes
        Animation                         = IDLB
            AnimationName                 = GUTwrGrd_PLTB
            AnimationMode                 = LOOP
        End
        BeginScript
            Prev                          = CurDrawablePrevAnimationState()
            if Prev ~                     = "STATE_SelectedAlternateFormation" and Prev ~= "STATE_Planted" and Prev ~= "TRANS_Plant" then CurDrawableSetTransitionAnimState("TRANS_Plant") end
        EndScript
    End
    IdleAnimationState
        StateName                         = STATE_Idle
        Animation                         = IDLB
            AnimationName                 = GUTwrGrd_IDLB
            AnimationMode                 = ONCE
            AnimationBlendTime            = 15
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        Animation                         = IDLC
            AnimationName                 = GUTwrGrd_IDLC
            AnimationMode                 = ONCE
            AnimationBlendTime            = 9
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        Animation                         = IDLD
            AnimationName                 = GUTwrGrd_IDLD
            AnimationMode                 = ONCE
            AnimationBlendTime            = 9
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        Animation                         = IDLE
            AnimationName                 = GUTwrGrd_IDLE
            AnimationMode                 = ONCE
            AnimationBlendTime            = 9
            AnimationSpeedFactorRange     = 0.8 1.2
        End
        BeginScript
            Prev                          = CurDrawablePrevAnimationState()
            if Prev                       == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
        EndScript
    End
;-------------------------------------------------------------------------------------------------------------
 End
	
	; ***DESIGN parameters ***
	Side                = Rivendell
	EditorSorting       = UNIT
	ThreatLevel         = 1.0
	ThingClass          = HORDE_UNIT
	CommandPoints       = 2 
	BountyValue         = 5
	TransportSlotCount  = 1
  
	WeaponSet
		Conditions        = None 
		Weapon            = PRIMARY GondorSpearmanSpear
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	
	ArmorSet
		Conditions        = None
		Armor             = SpearmanArmor
		DamageFX          = NormalDamageFX
	End
	
	ArmorSet
		Conditions		    = PLAYER_UPGRADE
		Armor			        = SpearmenHeavyArmor
		DamageFX		      = NormalDamageFX
	End
	
	DisplayName         = OBJECT:RivendellBreelandGuard
  VisionRange         = M_VISION_STANDARD_MELEE
  ShroudClearingRange = M_SHROUD_CLEAR_STANDARD                
  CrushableLevel      = 0
  CrusherLevel        = 0
  CrushRevengeWeapon  = AntiCavalryInfantryCrushRevenge
	CommandSet          = RivendellBreelandGuardCommandSet

	; *** AUDIO Parameters *** ;
	VoiceAttack								          = BreeLandersVoiceAttack
	VoiceAttackAir							        = BreeLandersVoiceAttack				
	VoiceAttackCharge						        = BreeLandersVoiceAttackCharge
	VoiceAttackMachine						      = BreeLandersVoiceAttack
	VoiceAttackStructure					      = BreeLandersVoiceAttackBuilding
	VoiceCreated							          = BreeLandersVoiceSalute
	VoiceFullyCreated 						      = BreeLandersVoiceSalute		
	VoiceGuard								          = BreeLandersVoiceMove
	VoiceMove								            = BreeLandersVoiceMove		
	VoiceMoveToCamp							        = BreeLandersVoiceMoveCamp
	VoiceMoveWhileAttacking					    = BreeLandersVoiceDisengage
	VoicePriority							          = 30
	VoiceRetreatToCastle					      = BreeLandersVoiceRetreat
	VoiceSelect								          = BreeLandersVoiceSelect
	VoiceSelectBattle 						      = BreeLandersVoiceSelectBattle
	VoiceEnterStateAttack					      = BreeLandersVoiceEnterStateAttack	
	VoiceEnterStateAttackCharge				  = BreeLandersVoiceEnterStateAttackCharge
	VoiceEnterStateAttackMachine			  = BreeLandersVoiceEnterStateAttack
	VoiceEnterStateAttackStructure			= BreeLandersVoiceEnterStateAttackBuilding
	VoiceEnterStateMove						      = BreeLandersVoiceEnterStateMove
	VoiceEnterStateMoveToCamp				    = BreeLandersVoiceEnterStateMoveCamp
	VoiceEnterStateMoveWhileAttacking		= BreeLandersVoiceEnterStateDisengage
	VoiceEnterStateRetreatToCastle			= BreeLandersVoiceEnterStateRetreat
	SoundImpact				                  = ImpactHorse
		
  UnitSpecificSounds
		VoiceGarrison			                = BreeLandersVoiceGarrison
	End
  
  EvaEventDamagedOwner                = UnitUnderAttack

	; Tie into LargeGroupAudio system
	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
		Key = Humanoid_Male Man Man_Male Unit Infantry
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:BodyFallOrc			Animation:EUMthlnd_SKL.EUMthlnd_DIEC	Frames:56
		AnimationSound = Sound:BodyFallOrc			Animation:EUMthlnd_SKL.EUMthlnd_DTHA	Frames:23
		AnimationSound = Sound:BodyFallOrc			Animation:EUMthlnd_SKL.EUMthlnd_DTHB	Frames:34
		AnimationSound = Sound:BodyFallOrc			Animation:EUMthlnd_SKL.EUMthlnd_LNDD	Frames:2

		AnimationSound = Sound:BodyFallOrc			Animation:EUMTHLND_SKL.EUMTHLND_LNDA	Frames:6
		AnimationSound = Sound:BodyFallGeneric1		Animation:EUMTHLND_SKL.EUMTHLND_DIEA	Frames:50
		AnimationSound = Sound:BodyFallGeneric1		Animation:EUMTHLND_SKL.EUMTHLND_DIEB	Frames:75
		AnimationSound = Sound:BodyFallGeneric1		Animation:EUMTHLND_SKL.EUMTHLND_DIEC	Frames:53
		AnimationSound = Sound:BodyFallGeneric1		Animation:EUMTHLND_SKL.EUMTHLND_PLTA	Frames:18
	End

	; *** ENGINEERING Parameters ***
	RadarPriority = UNIT
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP

  Body                               = PorcupineFormationBodyModule ModuleTag_porcupineFormation
    CheerRadius                    = M_EMOTION_CHEER_RADIUS
    MaxHealth                      = M_GONDOR_SOLDIER_HEALTH
    MaxHealthDamaged               = M_GONDOR_SOLDIER_HEALTH_DAMAGED  
    DamageWeaponTemplate           = PikemenPorcupineDamage
    CrushDamageWeaponTemplate      = PikemenPorcupineCrushDamage
  End

	; -- FORGED BLADES UPGRADE
	Behavior                      = WeaponSetUpgrade WeaponSetUpgradeModuleTag
		TriggeredBy		              = Upgrade_RivendellForgedBlades
	End
	
	Behavior                      = SubObjectsUpgrade ForgedBlades_Upgrade
		TriggeredBy		              = Upgrade_RivendellForgedBlades
		ShowSubObjects	            = Forged_Blade
	End
  
	; -- HEAVY ARMOR UPGRADE
	; Behavior                      = SubObjectsUpgrade ModuleTag_Armor
		; TriggeredBy		              = Upgrade_RivendellHeavyArmor
    ; UpgradeTexture	            = aubreeguard.tga 0 aubreeguardHA.tga
    ; UpgradeTexture	            = aubreelandshield.tga 0 aubreelandshieldHA.tga
	; End
  
  Behavior                      = ModelConditionUpgrade ModuleTag_AmonSul
		TriggeredBy			            = Upgrade_RivendellHeavyArmor
		AddConditionFlags	          = RIDER2
	End
  
	; -- FORGED BLADES UPGRADE
	Behavior                      = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	= Yes 
		MoodAttackCheckRate			    = 500
		AILuaEventsList				      = BreelandTownsGuardFunctions
		AttackPriority				      = AttackPriority_Pikeman
	End

  ; -- Locomotors
  LocomotorSet
    Locomotor = GondorTowerShieldGuardLocomotor
    Condition = SET_NORMAL 
    Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
  End
  
  LocomotorSet
    Locomotor = GondorTowerShieldGuardDeployedLocomotor
    Condition = SET_NORMAL_UPGRADED
    Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED    
  End
  
  LocomotorSet
    Locomotor = GondorTowerShieldGuardLocomotor
    Condition = SET_COMBO
    Speed     = M_NORMAL_GOOD_INFANTRY_MEMBER_SPEED
  End

  ; -- Standard Behaviors
	Behavior                      = PhysicsBehavior ModuleTag_04
		GravityMult                 = 1.0
		ShockStunnedTimeLow		      = 1400	
		ShockStunnedTimeHigh	      = 2400	
		ShockStandingTime		        = 1333	
	End
	
	Behavior                      = SlowDeathBehavior ModuleTag_05
		DeathTypes                  = ALL -KNOCKBACK -FADED
		SinkDelay                   = 3000
		SinkRate                    = 0.40     
		DestructionDelay            = 8000
		Sound                       = INITIAL TowerGuardVoiceDie
	End

	Behavior                      = SquishCollide ModuleTag_06
	End
	
	Behavior                      = HordeMemberCollide ModuleTag_HMC
	End
	
	Behavior                      = SlowDeathBehavior ModuleTag_07
		DeathTypes                  = NONE +KNOCKBACK
		SinkDelay                   = 3000
		SinkRate                    = 0.40     
		DestructionDelay            = 8000
	End

	Behavior                      = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
		; To tweak a Bezier path
		FirstHeight                 = 24  ; Height of Bezier control points above highest intervening terrain
		SecondHeight                = 24
		FirstPercentIndent          = 30% ; Percentage of shot distance control points are placed
		SecondPercentIndent         = 70%
		TumbleRandomly              = Yes

		CrushStyle                  = Yes ; I don't detonate, I just hit
		DieOnImpact                 = Yes
		BounceCount                 = 1   ; When I hit the ground, I'll arc again
		BounceDistance              = 40 ; this far
		BounceFirstHeight           = 24  ; Height of Bezier control points above highest intervening terrain
		BounceSecondHeight          = 24
		BounceFirstPercentIndent    = 20% ; Percentage of shot distance control points are placed
		BounceSecondPercentIndent   = 80%

		GroundHitFX                 = FX_ThrownRockGroundHit
		GroundBounceFX              = FX_ThrownRockBounceHit
	End

	Geometry            = CYLINDER
	GeometryMajorRadius = 8.0
	GeometryMinorRadius = 8.0
	GeometryHeight      = 19.2
	GeometryIsSmall     = Yes
  Shadow              = SHADOW_DECAL
  ShadowSizeX         = 19
  ShadowSizeY         = 19
  ShadowTexture       = ShadowI
End
