;------------------------------------------------------------------------------
; This is the real well that the Men of the West are able to build in game!
Object RivendellWell

	; *** ART Parameters ***
	SelectPortrait = BPRivendellWell

	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor		= Yes
		UseStandardModelNames		= Yes
		StaticModelLODMode			= yes

		DefaultModelConditionState
			Model					= ABWell_skn
		End

    IdleAnimationState
      BeginScript
      Prev = CurDrawablePrevAnimationState()
      if Prev == "BeingConstructed" then 
          ; Don't play completed sound when canceling build-in-progress or when
          ; destroyed halfway
          if not CurDrawableModelcondition( "DYING" ) then 
          CurDrawablePlaySound("CampRivendellElfBuildCelebrianWell")
        end
      end
      EndScript
    End

		ModelConditionState = AWAITING_CONSTRUCTION 
			Model					= ABWell_BLD
		End
		AnimationState = AWAITING_CONSTRUCTION
			Animation				= ABWell_BLD
				AnimationName		= ABWell_BLD.ABWell_BLD
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			Flags					= START_FRAME_FIRST
		End

		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model					= ABWell_BLD
			ParticleSysBone			= CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		End

		AnimationState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation				= ABWell_BLD
				AnimationName		= ABWell_BLD.ABWell_BLD
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			Flags					= START_FRAME_FIRST
			StateName				= BeingConstructed
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End

		;--damaged building

		ModelConditionState = DAMAGED
			Model					= ABWell_D1
			ParticleSysBone FireSmall01 FireBuildingMedium
			ParticleSysBone FireSmall02 FireBuildingLarge
			ParticleSysBone FireSmall03 FireBuildingMedium
			ParticleSysBone FireSmall04 FireBuildingMedium
			ParticleSysBone FireSmall05 SmokeBuildingLarge
		End
		AnimationState = DAMAGED
			EnteringStateFX			= FX_BuildingDamaged
		End

		ModelConditionState = REALLYDAMAGED
			Model					= ABWell_D2
			ParticleSysBone FireSmall01 FireBuildingMedium
			ParticleSysBone FireSmall02 FireBuildingLarge
			ParticleSysBone FireSmall03 FireBuildingMedium
			ParticleSysBone FireSmall04 FireBuildingLarge
			ParticleSysBone FireSmall05 SmokeBuildingLarge
		End
		AnimationState = REALLYDAMAGED
			EnteringStateFX	= FX_BuildingReallyDamaged
			Animation	= RubbleAnimation
				AnimationName		=	ABWell_D2
				AnimationMode		=	ONCE	
	  		End
		End

		ModelConditionState = RUBBLE
			Model					= ABWell_D2	
			ParticleSysBone NONE SmokeBuildingLarge
			ParticleSysBone NONE TrebuchetImpactDebris
		End

		AnimationState = RUBBLE
			EnteringStateFX	= FX_StructureMediumCollapse
		End

		ModelConditionState = POST_RUBBLE
			Model					= None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

		ModelConditionState = POST_COLLAPSE
			Model					= None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

	End

	; Draw module just for the heal FX.
	Draw = W3DScriptedModelDraw TheHealEffect
		ModelConditionState = NONE
			Model					= None
			ParticleSysBone NONE WellHealFX
		End
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model					= None
		End
	End

	PlacementViewAngle  	= 0

	; *** DESIGN parameters ***
	DisplayName				           = OBJECT:RivendellWell
	Description				           = OBJECT:RivendellWellDesc
	Side					               = Rivendell
	EditorSorting			           = STRUCTURE
	ThreatLevel				           = 1.0
	IsTrainable 			           = No
	CommandSet				           = SellableCommandSet
	BuildCost				             = GONDOR_WELL_BUILDCOST
	BuildTime				             = GONDOR_WELL_BUILDTIME		; in seconds
	RefundValue				           = 100
	VisionRange				           = GONDOR_WELL_VISIONRANGE	; Shroud clearing distance
	ShroudClearingRange		       = GONDOR_WELL_SHROUDCLEAR
	BountyValue				           = GONDOR_WELL_BOUNTY_VALUE

	ArmorSet	                   
		Conditions			           = None
		Armor				               = StructureArmor
	End                          

	; *** AUDIO Parameters ***   
	VoiceSelect						       = RivendellWellSelect
	VoiceSelectUnderConstruction = BuildingGoodVoiceSelectUnderConstruction

	SoundAmbient					       = WaterFountain1AmbientLoop
	SoundAmbientDamaged				   = GenericFireMediumLoop
	SoundAmbientReallyDamaged		 = GenericFireLargeLoop
	SoundOnDamaged					     = BuildingLightDamageStone
	SoundOnReallyDamaged			   = BuildingHeavyDamageStone

	UnitSpecificSounds           
		UnderConstruction			     = BuildingConstructionLoop	; Built first time
		UnderRepairFromRubble		   = BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	; *** ENGINEERING Parameters ***
	RadarPriority								= STRUCTURE
	KindOf											= PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION MADE_OF_STONE CAN_SEE_THROUGH_STRUCTURE IGNORE_FOR_VICTORY

	Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName				        = GondorWorkerNoSelect
	End

	Body = StructureBody ModuleTag_05
		MaxHealth				          = GONDOR_WELL_MAXHEALTH
		MaxHealthDamaged		      = GONDOR_WELL_MAXHEALTHDAMAGED
		MaxHealthReallyDamaged	  = GONDOR_WELL_MAXHEALTH_REALLYDAMAGED
	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay		      = 5000
	End

	Behavior = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
		MinCollapseDelay		      = 000
		MaxCollapseDelay		      = 000
		CollapseDamping			      = .5
		MaxShudder				        = 0.6
		MinBurstDelay			        = 250
		MaxBurstDelay			        = 800
		BigBurstFrequency		      = 4
		FXList					          = INITIAL FX_StructureMediumCollapse
		CollapseHeight			      = 75
	End

	Behavior = PassiveAreaEffectBehavior ModuleTag_SplashOfHealingWater_Ahh
		EffectRadius			        = 200 ; please update the decal size in experience lvl INI if you change this... the value there is about 2.2x the value here	
		PingDelay				          = 2000;msec
		HealPercentPerSecond	    = 3%
		AllowFilter				        = ANY +INFANTRY +CAVALRY -MACHINE -IMMOBILE    
	End

	Behavior = CostModifierUpgrade ModuleTag_CostModifier
		LabelForPalantirString 	  = GUI:WATER_DISCOUNT
		StartsActive 			        = No 		  ; Fix for rebuild-discount ;Yes ; Run on build complete, not upgrade
		TriggeredBy 			        = Upgrade_WellIsBuilt ; Assures it'll be only given once, instead of whenever it's rebuilt
		ObjectFilter			        = ANY +GondorFighterHorde +GondorArcherHorde +GondorTowerShieldGuardHorde +GondorRangerHorde +GondorSpearmanHorde
		Percentage				        = -0%
		Percentage				        = -20%
		Percentage				        = -30%
	End

	;
	Behavior = GrantUpgradeCreate ModuleTag_GrantUpdateCreate
		UpgradeToGrant            = Upgrade_WellIsBuilt
	End

	;/////////////////////////////////////////////////////////
	;// BannerCarrierUpdate module for Well Object
	;/////////////////////////////////////////////////////////
	Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
		IdleSpawnRate				      = 12000 ;;,;; 5000							; spawn a new member every n seconds when idle (in miliseconds)		
		UnitSpawnFX					      = FX_BannerCarrierSpawnUnit		; name of particle FX to use when the BannerCarrier spawns a new unit		

		; This well object acts like a banner carrier except it spawns unit on nearby hordes instead of itself.
		ReplenishNearbyHorde		  = Yes
		ReplenishAllNearbyHordes	= Yes
		ScanHordeDistance			    = 200
	End
	
	Geometry				            = CYLINDER
	GeometryMajorRadius		      = 35.6
	GeometryHeight			        = 16.8
	GeometryIsSmall			        = No
	Shadow					            = SHADOW_VOLUME
	BuildCompletion			        = PLACED_BY_PLAYER

	GeometryContactPoint	      = X:0  Y:-40  Z:0 Grab
	GeometryContactPoint	      = X:-5  Y:-5  Z:16 
	GeometryContactPoint	      = X:-40  Y:0  Z:0 Grab
	GeometryContactPoint	      = X:-5  Y:5  Z:16 
	GeometryContactPoint	      = X:0  Y:40  Z:0 Grab
	GeometryContactPoint	      = X:5  Y:5  Z:16 
	GeometryContactPoint	      = X:40  Y:0  Z:0 Grab
	GeometryContactPoint	      = X:5  Y:-5  Z:16 
	
	GeometryContactPoint        = X:-23		Y:24		Z:0			Repair
	GeometryContactPoint        = X:46		Y:-54		Z:0			Repair

End
