;------------------------------------------------------------------------------------------
Object RivendellCastleDoor

  SelectPortrait                     = BPRivendellGate

  ; *** ART Parameters ***

 	Draw                               = W3DScriptedModelDraw ModuleTag_Draw
 		OkToChangeModelColor             = Yes
 		UseStandardModelNames            = Yes
 		
		DefaultModelConditionState
 			Model                          = EBWallGateN_SKN
 		End

		; -- Damage State D1
		ModelConditionState              = DAMAGED
			Model                          = EBWallGateN_D1
		End
    
		; -- Damage State D2
		ModelConditionState              = REALLYDAMAGED
			Model                          = EBWallGateN_D2
		End

    ; -- Collapsing Door Opening State 
		ModelConditionState              = COLLAPSING DOOR_1_OPENING
			Model                          = EBWallGateN_D4
		End
    
		AnimationState                   = COLLAPSING DOOR_1_OPENING
      Animation				               = RubbleAnimation
				AnimationName		             = EBWallGateN_D4.EBWallGateN_D4
				AnimationMode		             = ONCE
  		End
  		EnteringStateFX	               = FX_StructureMediumCollapse
  		ParticleSysBone NONE DestructionDust
		End
    
    ; -- Dying Door Open State 
		ModelConditionState              = DYING DOOR_1_OPENING
			Model                          = EBWallGateN_D4
		End
    
		AnimationState                   = DYING DOOR_1_OPENING
      Animation				               =	RubbleAnimation
				AnimationName		             =	 EBWallGateN_D4.EBWallGateN_D4
				AnimationMode		             =	ONCE
  		End
    	;EnteringStateFX	               = FX_StructureMediumCollapse
  		;ParticleSysBone NONE DestructionDust
		End

    ; -- Collapsing Door Closed State 
		ModelConditionState              = COLLAPSING
			Model                          = EBWallGateN_D3
		End
    
		AnimationState                   = COLLAPSING
      Animation				               =	RubbleAnimation
				AnimationName		             =	 EBWallGateN_D3.EBWallGateN_D3
				AnimationMode		             =	ONCE
  		End
  		EnteringStateFX	               = FX_StructureMediumCollapse
  		ParticleSysBone NONE DestructionDust
		End

    ; -- Dying Door Closed State
		ModelConditionState              = DYING
			Model                          = EBWallGateN_D3
		End
    
		AnimationState                   = DYING
      Animation				               = RubbleAnimation
				AnimationName		             = EBWallGateN_D3.EBWallGateN_D3
				AnimationMode		             = ONCE
  		End
  		;EnteringStateFX	               = FX_StructureMediumCollapse
  		;ParticleSysBone NONE DestructionDust
		End

    ; -- Rubble State
		ModelConditionState              = RUBBLE
			Model                          = None  
		End  
		
		; ModelConditionState              = POST_RUBBLE
			; Model                          = NONE
			; ParticleSysBone NONE SmokeBuildingMediumRubble
		; End
    
    ; -- Post Rubble State
		; AnimationState                   = POST_RUBBLE
		; End

    ; -- Post Collapse State
		; ModelConditionState              = POST_COLLAPSE
      ; Model                          = None
			; ParticleSysBone NONE SmokeBuildingMediumRubble
		; End
    
		; AnimationState                   = POST_COLLAPSE
		; End 

    ; -- Door Animation States
		; -- Door Opening	
		AnimationState                   = DOOR_1_OPENING 
			Flags                          = START_FRAME_LAST
			StateName                      = Door_Open
			Animation				               = Death
				AnimationName		             = EBWallGateN_SKL.EBWallGateN_OP
				AnimationMode		             = ONCE
			End
			BeginScript
				Prev                         = CurDrawablePrevAnimationState()
				if Prev                      == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			EndScript
		End
    
		TransitionState                  = TRANS_Closed_To_Open
			Animation                      = Open 
				AnimationName	               =	EBWallGateN_SKL.EBWallGateN_OPN
				AnimationMode	               =	ONCE 
			End
		End
    
    ; -- Door Closing
		AnimationState                   = DOOR_1_CLOSING 
			Flags                          = START_FRAME_LAST
			StateName                      = Door_Close
			Animation				               =	Death
				AnimationName		             =	EBWallGateN_SKL.EBWallGateN_CL
				AnimationMode		             =	ONCE
			End
			BeginScript
				Prev                         = CurDrawablePrevAnimationState()
				if Prev                      == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			EndScript
		End
    
		TransitionState                  = TRANS_Open_To_Closed
			Animation                      = Open 
				AnimationName	               =	EBWallGateN_SKL.EBWallGateN_CLS
				AnimationMode	               =	ONCE 
			End
		End
		
 	End

    ; *** AUDIO Parameters ***
    VoiceSelect                      = GateSelect
    SoundOnDamaged                   = BuildingLightDamageStone
    SoundOnReallyDamaged             = BuildingHeavyDamageStone

    ; ***DESIGN parameters ***
    DisplayName                      = OBJECT:RivendellCastleDoor
    Side                             = Rivendell
    EditorSorting                    = STRUCTURE
    ThreatLevel                      = 1.0
    BuildTime                        = 180.0           ; in seconds
    BuildCost                        = 1000

    VisionRange                      = 400.0          ; Shroud clearing distance

    ArmorSet
      Conditions                     = None
      Armor                          = CastleGateArmor
      DamageFX                       = GateDamageFX
    End

    CommandSet                       = CastleGateCommandSet


    ; *** ENGINEERING Parameters ***  
    KindOf                           = STRUCTURE IMMOBILE SELECTABLE BLOCKING_GATE
    RadarPriority                    = NOT_ON_RADAR
    KeepSelectableWhenDead           = Yes


    Body                             = ActiveBody ModuleTag_02
        MaxHealth                    = 3000.0
    End

    ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
    ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
    ; buildings automatically stick around because GarrisonContain has it's own DieModule
    Behavior                         = KeepObjectDie ModuleTag_IWantRubble
    End

    ClientBehavior                   = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap            = 800
        AnimationSound               = Sound: MinisTirithGateDie Animation:GBMgatedoorSKL.GBMgatedoorA3 Frames: 1 
    End

    Behavior                         = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop             = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
        SelfRepairFromDamageLoop     = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
        SelfRepairFromRubbleLoop     = BuildingConstructionLoop
        SpawnTimer                   = -1.0 ; Negative means no 'autoheal'
        RebuildTimeSeconds           = 120 ;30
    End

    Behavior                         = TransitionDamageFX ModleTag_hideBustedDoors
        PristineShowSubObject        RBCASTDRR RBCASTDRL
        PristineHideSubObject        RBCASTDRR_D1 RBCASTDRR_D2 RBCASTDRL_D1 RBCASTDRL_D2
        DamagedShowSubObject        RBCASTDRR_D1 RBCASTDRL_D1
        DamagedHideSubObject        RBCASTDRR_D2 RBCASTDRL_D2 RBCASTDRR RBCASTDRL
        ReallyDamagedShowSubObject    RBCASTDRR_D2 RBCASTDRL_D2
        ReallyDamagedHideSubObject  RBCASTDRR_D1  RBCASTDRL_D1 RBCASTDRR RBCASTDRL
        DamagedFXList1               = Loc: X:0 Y:0 Z:0            FXList:FX_BasicSevereScreenShake
         ReallyDamagedFXList1        = Loc: X:0 Y:0 Z:0        FXList:FX_BasicSevereScreenShake
         RubbleFXList1               = Loc: X:0 Y:0 Z:0            FXList:FX_HelmsDeepGateRubble
    End

    Behavior                         = GateOpenAndCloseBehavior ModuleTag_GATE
        ResetTimeInMilliseconds      = 3000 ;12200 ;important! this must be longer than the gates animation, ir it will twitch
        OpenByDefault                = Yes
        PercentOpenForPathing        = 50
        SoundOpeningGateLoop         = GateOpenStart
        SoundClosingGateLoop         = GateCloseStart
        SoundFinishedOpeningGate     = GateOpenEnd
        SoundFinishedClosingGate     = GateCloseEnd
        TimeBeforePlayingOpenSound   = 9500
        TimeBeforePlayingClosedSound = 9500
    End

    Behavior                         = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached   = Yes
    End 

    ;	Geometry from small men wall gate
    Scale                            = .95
    GeometryIsSmall			             = No

    ; Main
    AdditionalGeometry    	         = BOX
    GeometryName		  	             = "Closed"
    GeometryMajorRadius   	         = 9.0  
    GeometryMinorRadius   	         = 60.0  
    GeometryHeight        	         = 50

    ; Left open
    AdditionalGeometry    	         = BOX
    GeometryName		  	             = "OpenLeft"
    GeometryMajorRadius   	         = 9.0  
    GeometryMinorRadius   	         = 10.0  
    GeometryHeight        	         = 40
    GeometryOffset        	         = X:0 Y:-30 Z:0

    ; Right open
    AdditionalGeometry    	         = BOX
    GeometryName		  	             = "OpenRight"
    GeometryMajorRadius   	         = 9.0  
    GeometryMinorRadius   	         = 10.0  
    GeometryHeight        	         = 40
    GeometryOffset        	         = X:0 Y:30 Z:0

    GeometryContactPoint	           = X:0 Y:-50 Z:75
    GeometryContactPoint	           = X:0 Y:-50 Z:10
    GeometryContactPoint	           = X:0 Y:50 Z:10
    GeometryContactPoint	           = X:0 Y:50 Z:75

    Shadow					                 = SHADOW_VOLUME
    BuildCompletion			             = PLACED_BY_PLAYER
End
