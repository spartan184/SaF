;------------------------------------------------------------------------------
;Dunedain Gathering
Object RivendellDunedainGathering

	SelectPortrait = BPRivendellGathering
	
	; Scale = 1.1
 
  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw
    ExtraPublicBone = B_ARCHER01
    ExtraPublicBone = B_ARCHER02

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD     
    
    DefaultModelConditionState
      Model = abdunecamp_skn
      WeaponLaunchBone = PRIMARY ARROW
      ParticleSysBone     = B_EMBER GatheringEmbers Followbone:YES
      ParticleSysBone     = B_EMBER FireTorch FollowBone:Yes
      ParticleSysBone     = B_EMBER OrcTorchFlare FollowBone:Yes
    End
    
    IdleAnimationState
      BeginScript
      Prev = CurDrawablePrevAnimationState()
      if Prev == "BeingConstructed" then 
          ; Don't play completed sound when canceling build-in-progress or when
          ; destroyed halfway
          if not CurDrawableModelcondition( "DYING" ) then 
          CurDrawablePlaySound("CampRivendellElfBuildDunedainGathering")
        end
      end
      EndScript
    End
    ;------------ Build Up States -------
    ModelConditionState   = AWAITING_CONSTRUCTION 
      Model               = abdunecamp_bld
    End
    
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  abdunecamp_bld
        AnimationName     =  abdunecamp_bld.abdunecamp_bld
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End

    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = abdunecamp_bld
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
    End;
    
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = abdunecamp_bld
			AnimationName     = abdunecamp_bld.abdunecamp_bld
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName			  = BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
		EndScript
    End
    
      ;--damaged building
    
    ModelConditionState  = DAMAGED
      Model         = abdunecamp_D1
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingMedium
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 FireBuildingSmall
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = abdunecamp_D2
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingLarge
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 SmokeBuildingLarge
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
		EnteringStateFX	= FX_BuildingReallyDamaged
      	Animation				=	RubbleAnimation
			AnimationName		=	NBElvnBarx_D2SK.NBElvnBarx_D2AN
			AnimationMode		=	ONCE
  		End
    End

    ModelConditionState  = RUBBLE
      Model         = abdunecamp_D2
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End
    
    AnimationState = RUBBLE
		EnteringStateFX	= FX_StructureMediumCollapse
      	Animation				=	RubbleAnimation
			AnimationName		=	NBElvnBarx_D3SK.NBElvnBarx_D3AN
			AnimationMode		=	ONCE
  		End
      BeginScript
        CurDrawableHideSubObject("NBElvnBarxDP1")
        CurDrawableHideSubObject("NBElvnBarxDP2")
        CurDrawableHideSubObject("NBElvnBarxDP3")
        CurDrawableHideSubObject("NBElvnBarxDP4")
      EndScript
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End  
    
  End

	Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
		ModelName = abdunecamp_BIB
	End

	Draw = W3DScriptedModelDraw TheHordeEffects
		DefaultModelConditionState
		  Model = None
		End
		AnimationState = UPGRADE_ECONOMY_BONUS
			ParticleSysBone = None MusterTheRangersPulseFX
			ParticleSysBone	= None MusterTheRangersSparkleFX
		End
	End
   
  ;PlacementViewAngle  = 315
 
  ; ***DESIGN parameters ***
	DisplayName			= OBJECT:RivDunedainGathering
	Description 		= OBJECT:RivDunedainGatheringDesc	
	Side				= Rivendell
	EditorSorting		= STRUCTURE
	ThreatLevel			= 1.0
	BuildCost           = DUN_DUNEDAIN_CAMP_BUILDCOST 
	BuildTime           = DUN_DUNEDAIN_CAMP_BUILDTIME
	VisionRange         = 200
	ShroudClearingRange = DUN_DUNEDAIN_CAMP_SHROUD_CLEAR
	BountyValue        	= DUN_DUNEDAIN_CAMP_BOUNTY_VALUE
	
	CommandSet			= RivendellDunedainGatheringCommandset

	ArmorSet
		Conditions      = None
		Armor           = StructureArmor
	End

	WeaponSet
		Conditions		= None
	End

	; WeaponSet
		; Weapon			= PRIMARY RivendellStructureBow
		; Conditions		= PLAYER_UPGRADE
		; AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	; End

	; *** AUDIO Parameters ***

	;VoiceFullyCreated				= EVA:RivendellDunedainGatheringComplete ;EVA:GreenPastureComplete
	VoiceSelect						= RohanBattleTowerSelect				;RohanStablesSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

 	; SoundAmbient					= BuildingRohanStableAmbience
	SoundAmbientDamaged				= GenericFireMediumLoop
	SoundAmbientReallyDamaged		= GenericFireMediumLoop
	SoundOnDamaged					= BuildingLightDamageWood
	SoundOnReallyDamaged			= BuildingHeavyDamageWood

	UnitSpecificSounds
		UnderConstruction			= BuildingConstructionLoop  	; Built first time
		UnderRepairFromRubble		= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End
  
  ; *** ENGINEERING Parameters ***

	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE CAPTURABLE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
	End
	
	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName	= GondorWorkerNoSelect
	End
	
	Body                      = StructureBody ModuleTag_05
		MaxHealth               = DUN_DUNEDAIN_CAMP_HEALTH				
		MaxHealthDamaged        = DUN_DUNEDAIN_CAMP_HEALTH_DAMAGED			
		MaxHealthReallyDamaged  = DUN_DUNEDAIN_CAMP_HEALTH_REALLY_DAMAGED		
	End
	  
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		SetBonusModelConditionOnSpeedBonus = Yes ; set the UPGRADE_ECONOMY_BONUS if there is any production bonus
		BonusForType			= DunedainRangerHorde GreyCompanyRangerHorde
		;SpeedBonusAudioLoop		 = CallTheHordeOrcPitLoop; Sound to play while bonus is active
	End

	Behavior = QueueProductionExitUpdate ModuleTag_07
		UnitCreatePoint    = X:11.0 Y:-24.0 Z:0.0
		NaturalRallyPoint  = X:104.0 Y:26.0 Z:0.0
		ExitDelay = 300
	End
 
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate		= 250
	End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy			= Upgrade_StructureLevel1
		HideSubObjects			= RANK2 RANK3
	End

 	Behavior = SubObjectsUpgrade ModuleTag_ShowWalls 
		TriggeredBy			= Upgrade_StructureLevel2
		ShowSubObjects	= RANK2
		HideSubObjects	= RANK3
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowPillars 
		TriggeredBy			= Upgrade_StructureLevel3
		ShowSubObjects	= RANK3
	End

	Behavior = WeaponSetUpgrade ModuleTag_ThirdLevelBuildingArrows
		TriggeredBy			= Upgrade_StructureLevel3
	End
	
	; Behavior = ObjectCreationUpgrade MakeTheFreeArcher
		; TriggeredBy		= Upgrade_SentryTowerGarrisonGondor
		; Delay			= 5.0
		; DestroyWhenSold = Yes
		; ThingToSpawn	= RivendellRanger_Tower
		; Offset			= X:-26.9 Y:12.778 Z:55.3
		; FadeInTime		= 80
	; End


	; Behavior = ObjectCreationUpgrade MakeTheFreeArcher2
		; TriggeredBy		= Upgrade_SentryTowerGarrisonGondor
		; Delay			= 5.0
		; DestroyWhenSold = Yes
		; ThingToSpawn	= RivendellRanger_Tower
		; Offset			= X:-38.936 Y:27.28 Z:55.3
		; FadeInTime		= 80
	; End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay  = 6500
	End

	Behavior                  = StructureCollapseUpdate ModuleTag_06
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		CollapseHeight		= 110
		FXList                  = INITIAL   FX_StructureMediumCollapse

	End
	
	Behavior = BuildingBehavior ModuleTag_Building
		NightWindowName	= N_WINDOW N_GLOW
	End 
	  
	;; This is required for setting rally points which needs a small geometry to determine if quick path exists in tight spaces
  ;; If this was any bigger, it would fail to create the rallu points when in a camp or castle.
  Geometry              = CYLINDER
  GeometryMajorRadius   = 8.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 10

  ;; These are the actual building geometry pieces
  AdditionalGeometry    = BOX
  GeometryName			= Geom_Orig
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 75.0
  GeometryOffset		= X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName			= Geom_Orig
  GeometryMajorRadius   = 65.0
  GeometryMinorRadius   = 65.0
  GeometryHeight        = 40.0
  GeometryOffset		= X:0 Y:0 Z:0

  AdditionalGeometry    = BOX
  GeometryName			= Geom_V2
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 105.0
  GeometryOffset		= X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName			= Geom_V2
  GeometryMajorRadius   = 65.0
  GeometryMinorRadius   = 65.0
  GeometryHeight        = 60.0
  GeometryOffset		= X:0 Y:0 Z:0


  GeometryIsSmall       = No
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion		= PLACED_BY_PLAYER
  
  GeometryContactPoint = X:-44.644	Y:-56.367	Z:0		Repair
  GeometryContactPoint = X:33.041	Y:52.568	Z:0		Repair
  GeometryContactPoint = X:-9.861	Y:51.413	Z:0
  GeometryContactPoint = X:-33.314	Y:-54.902	Z:0
  GeometryContactPoint = X:-6.106	Y:-15.828	Z:40.3	Swoop

End