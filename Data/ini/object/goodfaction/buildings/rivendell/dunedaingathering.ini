; Please check the code for comments, and comment if you edit anything
Object RivendellDunedainGathering

  		; *** ART Parameters ***
	SelectPortrait = BPRivendellGathering
	
	; Scale = 1.1
 
  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw

    ExtraPublicBone = B_ARCHER01
	ExtraPublicBone = B_ARCHER02

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD  
	
	DefaultModelConditionState
		Model = abdunecamp_skn
		WeaponLaunchBone = PRIMARY ARROW
		ParticleSysBone     = B_EMBER GatheringEmbers Followbone:YES
		ParticleSysBone     = B_EMBER FireTorch FollowBone:Yes
		ParticleSysBone     = B_EMBER OrcTorchFlare FollowBone:Yes
	End
    
    ;------------ Build Up States ------- 
    ModelConditionState   = AWAITING_CONSTRUCTION 
      Model               = abdunecamp_bld
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End;
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  abdunecamp_bld
        AnimationName     =  abdunecamp_bld.abdunecamp_bld
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End

    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = abdunecamp_bld
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
    End;
    
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = abdunecamp_bld
			AnimationName     = abdunecamp_bld.abdunecamp_bld
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName			  = BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
		EndScript
    End
    
      ;--damaged building
    
    ModelConditionState  = DAMAGED
      Model         = abdunecamp_D1
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingMedium
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 FireBuildingSmall
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = abdunecamp_D2
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingLarge
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 SmokeBuildingLarge
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
		EnteringStateFX	= FX_BuildingReallyDamaged
      	Animation				=	RubbleAnimation
			AnimationName		=	NBElvnBarx_D2SK.NBElvnBarx_D2AN
			AnimationMode		=	ONCE
  		End
    End

    ModelConditionState  = RUBBLE
      Model         = abdunecamp_D2
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End
    
    AnimationState = RUBBLE
		EnteringStateFX	= FX_StructureMediumCollapse
      	Animation				=	RubbleAnimation
			AnimationName		=	NBElvnBarx_D3SK.NBElvnBarx_D3AN
			AnimationMode		=	ONCE
  		End
      BeginScript
        CurDrawableHideSubObject("NBElvnBarxDP1")
        CurDrawableHideSubObject("NBElvnBarxDP2")
        CurDrawableHideSubObject("NBElvnBarxDP3")
        CurDrawableHideSubObject("NBElvnBarxDP4")
      EndScript
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End  
    
  End

  Draw = W3DFloorDraw ModuleTag_DrawFloor
	StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
    ModelName = abdunecamp_BIB
  End

	Draw = W3DScriptedModelDraw TheHordeEffects
	    DefaultModelConditionState
	      Model = None
	    End
		AnimationState = UPGRADE_ECONOMY_BONUS
			ParticleSysBone = None MusterTheRangersPulseFX
			ParticleSysBone	= None MusterTheRangersSparkleFX
		End
	End
   
  PlacementViewAngle  = 340

	
	; ***DESIGN parameters ***
	DisplayName         = OBJECT:RivDunedainGathering
	Description 	    = OBJECT:RivDunedainGatheringDesc
	Side                = Rivendell
	EditorSorting       = STRUCTURE
	ThreatLevel         = 1.0
	BuildCost           = DUN_DUNEDAIN_CAMP_BUILDCOST
	BuildTime           = DUN_DUNEDAIN_CAMP_BUILDTIME           ; in seconds
	BountyValue         = DUN_DUNEDAIN_CAMP_BOUNTY_VALUE
	VisionRange         = 160.0                                 ; Shroud clearing distance
	ShroudClearingRange = DUN_DUNEDAIN_CAMP_SHROUD_CLEAR
	
	CommandSet          = RivendellDunedainGatheringCommandset

	ArmorSet
		Conditions		= None
		Armor			= StructureArmor
	End

	WeaponSet
		Conditions			= None
	End

			; *** AUDIO Parameters ***

	VoiceSelect					= GondorForbiddenPoolSelect
	SoundOnDamaged				= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  ; Built first time
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

 
			; *** ENGINEERING Parameters ***

	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION CASTLE_KEEP AUTO_RALLYPOINT FS_FACTORY ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE
	KeepSelectableWhenDead = Yes 							

	Body   = StructureBody ModuleTag_05
		MaxHealth             = DUN_DUNEDAIN_CAMP_HEALTH
		MaxHealthDamaged      = DUN_DUNEDAIN_CAMP_HEALTH_DAMAGED
		MaxHealthReallyDamaged  = DUN_DUNEDAIN_CAMP_HEALTH_REALLY_DAMAGED
    
		DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK
    
		DamageCreationList = OCL_GBFarm_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk3 CATAPULT_ROCK BACK_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
	End

	Behavior   = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName  = GondorWorkerNoSelect
		SelfBuildingLoop = BuildingBigConstructionLoop
		SelfRepairFromRubbleLoop = BuildingBigConstructionLoop
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
		BeingBuiltSound = BuildingBigConstructionLoop
	End 

	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate			= 250
	End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy			= Upgrade_StructureLevel1
		HideSubObjects		= RANK2 RANK3
	End

 	Behavior = SubObjectsUpgrade ModuleTag_ShowWalls 
		TriggeredBy			= Upgrade_StructureLevel2
		ShowSubObjects		= RANK2
		HideSubObjects		= RANK3
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowPillars 
		TriggeredBy			= Upgrade_StructureLevel3
		ShowSubObjects		= RANK3
	End
	
	Behavior                  = StructureCollapseUpdate ModuleTag_07
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 66
	End
	
	Behavior = RubbleRiseUpdate ModuleTag_08
		MinRubbleRiseDelay = 000
		MaxRubbleRiseDelay = 000
		RubbleHeight = 4.0
		MaxShudder = 0.6
		MinBurstDelay = 250
		MaxBurstDelay = 800
		BigBurstFrequency = 4
		FXList = INITIAL FX_StructureMediumPostCollapse
	End
	   
	Behavior                  = BuildingBehavior BuildingModuleTag
		NightWindowName         = WINDOW_N01
		FireWindowName          = WINDOW_F01
		GlowWindowName			= WINDOW_G01
	End
	 
	Behavior = ProductionUpdate ModuleTag_Production
		GiveNoXP = No
	End

	Behavior = QueueProductionExitUpdate ModuleTag_Exit	;have you updated the MF heroes built in this building ?
		UnitCreatePoint    = X:50.0 Y:-20 Z:0.0
		NaturalRallyPoint  = X:100 Y:-80 Z:0.0
		ExitDelay = 350
	End

  Geometry = BOX
  GeometryMajorRadius = 100.0
  GeometryMinorRadius = 90.0
  GeometryHeight = 50.0
  GeometryIsSmall = No
  Shadow = SHADOW_VOLUME
  GeometryContactPoint = X:0.407 Y:-0.489 Z:50.0 Swoop
  AttackContactPoint = X:100 Y:0 Z:0
End

