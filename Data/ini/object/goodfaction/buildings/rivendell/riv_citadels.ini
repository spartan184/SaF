;--------------------------------------Primary RivendellCitadel ---------------------------------------------------
Object RivendellCastleCitadel

 SelectPortrait = BPRivendellHall
 
  ; *** ART Parameters ***

	Draw = W3DScriptedModelDraw ModuleTag_MainDraw
		OkToChangeModelColor	= Yes
		UseStandardModelNames	= Yes
		
		DefaultModelConditionState
			Model = ABHallFire_SKN
		End

    IdleAnimationState
		ParticleSysBone   = BASE CampfireEmbersReg FollowBone:Yes
		ParticleSysBone   = BASE CampFireSmoke FollowBone:Yes
		ParticleSysBone   = BASE FireSmall05 FollowBone:Yes
	End 

		;------------Build Up States   
		ModelConditionState		= BASE_BUILD
			Model               	= ABHallFire_BLD
			ParticleSysBone     	= NONE BuildingContructDust
		End  

		AnimationState		  = BASE_BUILD
			Animation
				AnimationName 	= ABHallFire_BLD.ABHallFire_BLD
				AnimationMode 	= ONCE
				AnimationBlendTime = 0			
				AnimationSpeedFactorRange = 10.0 10.0 ; 300 frame anim, but need to shrink down to 5 seconds
			End
			BeginScript
				;CurDrawablePlaySound("GondorBarracksBeginConstruction")
				CurDrawablePlaySound("BuildingTopple")
			EndScript
		End

		ModelConditionState   = JUST_BUILT
			Model               = ABHallFire_BLD
		End
	    
		AnimationState		  = JUST_BUILT
			StateName				= JustBuilt
			Animation				= GBBtlTwrM_A
				AnimationName		= ABHallFire_BLD.ABHallFire_BLD
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
				AnimationSpeedFactorRange = 4 4
			End
			Flags = START_FRAME_FIRST
		End
		
		; ------------- Damge -------------------
		ModelConditionState = DAMAGED
			Model					= ABHallFire_SKN
		End  
		AnimationState = DAMAGED
			EnteringStateFX = FX_BuildingDamaged
		End

		ModelConditionState = REALLYDAMAGED
			Model					= ABHallFire_SKN
		End  

		ModelConditionState = RUBBLE
			Model					= ABHallFire_SKN
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
	End

	; *** AUDIO Parameters ***

	VoiceSelect				= RohanCitadelSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingBigConstructionLoop		; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingBigConstructionLoop		; Repaired from completely destroyed (not used???)
	End

	EvaEventDieOwner = CitadelDie

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
 		AnimationSound = Sound:BuildingHeavyDamageWood	Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:0
 		AnimationSound = Sound:BuildingSink			Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:25
 		AnimationSound = Sound:BuildingLightDamageWood	Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:105
	End


	; ***DESIGN parameters ***

	DisplayName      = OBJECT:RivendellHallOfFire
	Side = Rivendell
	EditorSorting   = STRUCTURE
	ThreatLevel = 1.0
	BuildCost           = 1000
	BuildTime           = 30.0           ; in seconds
	CommandSet			= RivendellCastleBaseKeepCommandSet

	ArmorSet
		Conditions        = None
		Armor             = CitadelArmor
		DamageFX          = RohanWallDamageFX
	End

  ; *** ENGINEERING Parameters ***  
  KindOf					= VITAL_FOR_BASE_SURVIVAL STRUCTURE SELECTABLE IMMOBILE SCORE CASTLE_KEEP MP_COUNT_FOR_VICTORY FS_FACTORY MADE_OF_WOOD CAN_ATTACK AUTO_RALLYPOINT	;  GARRISONABLE_UNTIL_DESTROYED GARRISON
  RadarPriority				= STRUCTURE
  KeepSelectableWhenDead	= Yes
  
  Body              = ActiveBody ModuleTag_02
    MaxHealth       = 4000.0
  End

  Behavior = GettingBuiltBehavior ModuleTag_04
    SelfBuildingLoop = BuildingBigConstructionLoop				; Only played if we DON'T spawn a worker
	SelfRepairFromDamageLoop  = NoSound         				; This doesn't cause an animation, so don't bother playing a sound
	SelfRepairFromRubbleLoop  = BuildingBigConstructionLoop
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
	BeingBuiltSound = BuildingBigConstructionLoop
  End 

  	;-----------------------------------------------
	;Used for hero revival and initial construction     
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		; nothing, but is required if we have any Object-level Upgrades!
	End
	Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
		UnitCreatePoint   = X:0.0 Y:-20.0 Z:0.0
		NaturalRallyPoint = X:28.8 Y:-80.0 Z:0.0;NaturalRallyPointX must always match GeometryMajorRadius! 
		ExitDelay = 300 ;Handles delays between units if multiple produced at a time. 
	End  
	;-----------------------------------------------

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
  ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
  ; buildings automatically stick around because GarrisonContain has it's own DieModule
  Behavior = KeepObjectDie ModuleTag_IWantRubble
  End
 
  
;  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;      DestructionDelay  = 6500
;  End


;  Behavior                  = StructureCollapseUpdate ModuleTag_06
;    MinCollapseDelay        = 5000
;    MaxCollapseDelay        = 5000
;    CollapseDamping         = .5
;    MaxShudder              = 0.6
;    MinBurstDelay           = 250
;    MaxBurstDelay           = 800
;    BigBurstFrequency       = 4
;    FXList                  = INITIAL   FX_StructureMediumCollapse
;  End
  
  
  
  
	Behavior       = EvacuateDamage ModuleTag_evacuateDamage
		WeaponThatCausesEvacuation  = MordorCatapultHumanHeads
	End

;	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
;		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK
;		ContainMax              = 4
;		MaxHordeCapacity        = 4
;		DamagePercentToUnits    = 0%
;		PassengerFilter			= ANY +INFANTRY +HORDE -CAVALRY
;		AllowEnemiesInside      = Yes
;		AllowNeutralInside      = Yes
;		NumberOfExitPaths       = 1 ; Defaults to 1.  Set 0 to not use ExitStart/ExitEnd, set higher than 1 to use ExitStart01-nn/ExitEnd01-nn
;		PassengerBonePrefix     = PassengerBone:ARROWBONE KindOf:INFANTRY
;		EntryOffset				= X:0.0 Y:-45.0 Z:0.0
;		ExitOffset				= X:0.0 Y:-45.0 Z:0.0
;		
;		;PassengersTestCollisionHeight = 80
;		;Slots                         = 1
;		;EnterSound                     = GarrisonEnter
;		;ExitSound                      = GarrisonExit
;		;ExitDelay               = 250
;		;GoAggressiveOnExit      = Yes ; AI Will tell people to set their mood to Aggressive on exiting
;		;ForceOrientationContainer = No  ; otherwise contained units can't orient themselves towards their targets...
;	End 

	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming			= M_GENERIC_KEEP_MONEY_TIME   ; in milliseconds
		DepositAmount			= M_GENERIC_KEEP_MONEY_AMOUNT   ; cash amount to deposit every DepositTiming
		InitialCaptureBonus		= 0  ; no initial bonus
	End


  Behavior                  = BuildingBehavior BuildingModuleTag
    NightWindowName         = WINDOW_N01
  ;  FireWindowName          = WINDOW_F01
  ;  GlowWindowName			= WINDOW_G01
  End
  
  Geometry				= BOX
  GeometryMajorRadius   = 21.0
  GeometryMinorRadius   = 41.0
  GeometryHeight        = 51.0
  
  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 57.0
  GeometryMinorRadius   = 0
  GeometryHeight        = 7.0
  
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 12.0
  GeometryMinorRadius   = 12.0
  GeometryHeight        = 120.0
  GeometryOffset		= X:-1 Y:2 Z:0
  
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  
;  AttackContactPoint	= X:-1 Y:2 Z:117
;  AttackContactPoint	= X:-1 Y:2 Z:0

	GeometryContactPoint	= X:-1.538		Y:2.559		Z:149.812			Swoop
	GeometryContactPoint	= X:-1.538		Y:2.559		Z:0

End
; --------------------------------------------------------------------------------------------------------------
Object RivendellCampCitadel

 SelectPortrait = BPRivendellHall
 
  ; *** ART Parameters ***

	Draw = W3DScriptedModelDraw ModuleTag_MainDraw
		OkToChangeModelColor	= Yes
		UseStandardModelNames	= Yes
		
		DefaultModelConditionState
			Model = ABHallFire_SKN
		End

    IdleAnimationState
		ParticleSysBone   = BASE CampfireEmbersReg FollowBone:Yes
		ParticleSysBone   = BASE CampFireSmoke FollowBone:Yes
		ParticleSysBone   = BASE FireSmall05 FollowBone:Yes
	End 

		;------------Build Up States   
		ModelConditionState		= BASE_BUILD
			Model               	= ABHallFire_BLD
			ParticleSysBone     	= NONE BuildingContructDust
		End  

		AnimationState		  = BASE_BUILD
			Animation
				AnimationName 	= ABHallFire_BLD.ABHallFire_BLD
				AnimationMode 	= ONCE
				AnimationBlendTime = 0			
				AnimationSpeedFactorRange = 10.0 10.0 ; 300 frame anim, but need to shrink down to 5 seconds
			End
			BeginScript
				;CurDrawablePlaySound("GondorBarracksBeginConstruction")
				CurDrawablePlaySound("BuildingTopple")
			EndScript
		End

		ModelConditionState   = JUST_BUILT
			Model               = ABHallFire_BLD
		End
	    
		AnimationState		  = JUST_BUILT
			StateName				= JustBuilt
			Animation				= GBBtlTwrM_A
				AnimationName		= ABHallFire_BLD.ABHallFire_BLD
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
				AnimationSpeedFactorRange = 4 4
			End
			Flags = START_FRAME_FIRST
		End
		
		; ------------- Damge -------------------
		ModelConditionState = DAMAGED
			Model					= ABHallFire_SKN
		End  
		AnimationState = DAMAGED
			EnteringStateFX = FX_BuildingDamaged
		End

		ModelConditionState = REALLYDAMAGED
			Model					= ABHallFire_SKN
		End  

		ModelConditionState = RUBBLE
			Model					= ABHallFire_SKN
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
	End

	; *** AUDIO Parameters ***
	VoiceSelect				            = RohanCitadelSelect
	SoundOnDamaged			          = BuildingLightDamageWood
	SoundOnReallyDamaged		      = BuildingHeavyDamageWood
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		        = BuildingBigConstructionLoop		; Built first time
		; UnderRepairFromDamage	    = NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	      = BuildingBigConstructionLoop		; Repaired from completely destroyed (not used???)
	End

	EvaEventDieOwner              = CitadelDie

	ClientBehavior                = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap           = 800
 		AnimationSound              = Sound:BuildingHeavyDamageWood	Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:0
 		AnimationSound              = Sound:BuildingSink			Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:25
 		AnimationSound              = Sound:BuildingLightDamageWood	Animation:RBCastKeep_D3.RBCastKeep_D3	Frames:105
	End


	; ***DESIGN parameters ***
	DisplayName               = OBJECT:RivendellHallOfFire
	Side                      = Rivendell
	EditorSorting             = STRUCTURE
	ThreatLevel               = 1.0
	BuildCost                 = 1000
	BuildTime                 = 30.0           ; in seconds
	CommandSet			          = RivendellCastleBaseKeepCommandSet

	ArmorSet
		Conditions              = None
		Armor                   = CitadelArmor
		DamageFX                = RohanWallDamageFX
	End

  ; *** ENGINEERING Parameters ***  
  KindOf					          = VITAL_FOR_BASE_SURVIVAL STRUCTURE SELECTABLE IMMOBILE SCORE CASTLE_KEEP MP_COUNT_FOR_VICTORY FS_FACTORY MADE_OF_WOOD CAN_ATTACK AUTO_RALLYPOINT	;  GARRISONABLE_UNTIL_DESTROYED GARRISON
  RadarPriority				      = STRUCTURE
  KeepSelectableWhenDead	  = Yes
  
  Body                      = ActiveBody ModuleTag_02
    MaxHealth               = 4000.0
  End

  Behavior                  = GettingBuiltBehavior ModuleTag_04
    SelfBuildingLoop        = BuildingBigConstructionLoop				; Only played if we DON'T spawn a worker
	SelfRepairFromDamageLoop  = NoSound         				; This doesn't cause an animation, so don't bother playing a sound
	SelfRepairFromRubbleLoop  = BuildingBigConstructionLoop
  End

  Behavior                  = CastleMemberBehavior ModuleTag_CMB
	BeingBuiltSound           = BuildingBigConstructionLoop
  End 

  	;-----------------------------------------------
	;Used for hero revival and initial construction     
	Behavior                  = ProductionUpdate ProductionUpdateModuleTag
		; nothing, but is required if we have any Object-level Upgrades!
	End
	Behavior                  = QueueProductionExitUpdate ModuleTag_QueuePEU
		UnitCreatePoint         = X:0.0 Y:-20.0 Z:0.0
		NaturalRallyPoint       = X:28.8 Y:-80.0 Z:0.0;NaturalRallyPointX must always match GeometryMajorRadius! 
		ExitDelay               = 300 ;Handles delays between units if multiple produced at a time. 
	End  
	;-----------------------------------------------

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
  ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
  ; buildings automatically stick around because GarrisonContain has it's own DieModule
  Behavior = KeepObjectDie ModuleTag_IWantRubble
  End

	Behavior       = EvacuateDamage ModuleTag_evacuateDamage
		WeaponThatCausesEvacuation  = MordorCatapultHumanHeads
	End

;	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
;		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK
;		ContainMax              = 4
;		MaxHordeCapacity        = 4
;		DamagePercentToUnits    = 0%
;		PassengerFilter			= ANY +INFANTRY +HORDE -CAVALRY
;		AllowEnemiesInside      = Yes
;		AllowNeutralInside      = Yes
;		NumberOfExitPaths       = 1 ; Defaults to 1.  Set 0 to not use ExitStart/ExitEnd, set higher than 1 to use ExitStart01-nn/ExitEnd01-nn
;		PassengerBonePrefix     = PassengerBone:ARROWBONE KindOf:INFANTRY
;		EntryOffset				= X:0.0 Y:-45.0 Z:0.0
;		ExitOffset				= X:0.0 Y:-45.0 Z:0.0
;		
;		;PassengersTestCollisionHeight = 80
;		;Slots                         = 1
;		;EnterSound                     = GarrisonEnter
;		;ExitSound                      = GarrisonExit
;		;ExitDelay               = 250
;		;GoAggressiveOnExit      = Yes ; AI Will tell people to set their mood to Aggressive on exiting
;		;ForceOrientationContainer = No  ; otherwise contained units can't orient themselves towards their targets...
;	End 

	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming			= M_GENERIC_KEEP_MONEY_TIME   ; in milliseconds
		DepositAmount			= M_GENERIC_KEEP_MONEY_AMOUNT   ; cash amount to deposit every DepositTiming
		InitialCaptureBonus		= 0  ; no initial bonus
	End

  Behavior                  = BuildingBehavior BuildingModuleTag
    NightWindowName         = WINDOW_N01
  End
  
  Geometry				= BOX
  GeometryMajorRadius   = 21.0
  GeometryMinorRadius   = 41.0
  GeometryHeight        = 51.0
  
  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 57.0
  GeometryMinorRadius   = 0
  GeometryHeight        = 7.0
  
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 12.0
  GeometryMinorRadius   = 12.0
  GeometryHeight        = 120.0
  GeometryOffset		= X:-1 Y:2 Z:0
  
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  
;  AttackContactPoint	= X:-1 Y:2 Z:117
;  AttackContactPoint	= X:-1 Y:2 Z:0

	GeometryContactPoint	= X:-1.538		Y:2.559		Z:149.812			Swoop
	GeometryContactPoint	= X:-1.538		Y:2.559		Z:0

End