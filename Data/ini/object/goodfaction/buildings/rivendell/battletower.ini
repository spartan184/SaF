;------------------------------------------------------------------------------------------
Object RivendellBattleTower

	SelectPortrait 	= BPRivendellTower
	ButtonImage 	= BRBattleTower

  	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_Draw

		ExtraPublicBone	= Arrow01
		ExtraPublicBone	= Arrow02
		ExtraPublicBone	= Arrow03
		ExtraPublicBone	= Arrow04

		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD  
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes

		DefaultModelConditionState
			Model				= ABRivTower
			WeaponLaunchBone	= PRIMARY Arrow
		End

		IdleAnimationState
			BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "BeingConstructed" then 
					; Don't play completed sound when canceling build-in-progress or when
					; destroyed halfway
					if not CurDrawableModelcondition( "DYING" ) then 
					CurDrawablePlaySound("CampRivendellElfBuildGeneric")
				end
			end
			EndScript
		End

		;------------ Build Up States ------------
		ModelConditionState			= AWAITING_CONSTRUCTION 
			Model					= ABRivTower_BLD
;			ParticleSysBone			= NONE BuildingDoughnutCloud
		End
		AnimationState				= AWAITING_CONSTRUCTION
			Animation				=  ABRivTower_BLD
				AnimationName		=  ABRivTower_BLD.ABRivTower_BLD
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			Flags					= START_FRAME_FIRST
		End

		ModelConditionState			= ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model					= ABRivTower_BLD
			ParticleSysBone			= CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		End

		AnimationState				= ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation				= ABRivTower_BLD
				AnimationName		= ABRivTower_BLD.ABRivTower_BLD
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			Flags					= START_FRAME_FIRST
			StateName				= BeingConstructed
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End

		;------------ Damaged Building ------------
		ModelConditionState			= DAMAGED
			Model					= ABRivTower_D1  
		End
		AnimationState				= DAMAGED
			EnteringStateFX			= FX_BuildingDamaged
		End	    
		
		ModelConditionState			= REALLYDAMAGED
			Model					= ABRivTower_D2
		End
		AnimationState				= REALLYDAMAGED
			Animation				=	RubbleAnimation
				AnimationName		=	 ABRivTower_D2.ABRivTower_D2
				AnimationMode		=	ONCE
			End
			EnteringStateFX			= FX_BuildingReallyDamaged
		End

		ModelConditionState			= COLLAPSING
			Model					= ABRivTower_D2
		End
		AnimationState				= COLLAPSING
			Animation				=	RubbleAnimation
				AnimationName		=	 ABRivTower_D2.ABRivTower_D2
				AnimationMode		=	ONCE
			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState			= RUBBLE
		  Model						=  None 
		  ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState				= RUBBLE
		End

		ModelConditionState			= POST_RUBBLE
			Model					= None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

		ModelConditionState			= POST_COLLAPSE
			 Model					= None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

	End
 
	Draw							= W3DFloorDraw ModuleTag_DrawFloor    
		StaticModelLODMode			= Yes
		ModelName					= EBBbattlet_Bib
	End
 
	; ***DESIGN parameters ***
	DisplayName         	= OBJECT:RivendellBattleTower
	Description 	    	= OBJECT:RivendellBattleTowerDesc
	Side                	= Rivendell
	EditorSorting       	= STRUCTURE
	ThreatLevel 		    = 1.0
	BuildCost           	= 500
	BuildTime           	= 45
	VisionRange         	= VISION_BASE_DEFENSE
 	ShroudClearingRange 	= SHROUD_CLEAR_BASE_DEFENSE

	CommandSet = RivendellBattleTowerCommandSet
  
	ArmorSet
		Conditions        	= None
		Armor             	= StructureArmor
	End
  
  	WeaponSet
  		Weapon				= PRIMARY BattleTowerBow 
		Conditions			= NONE
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End


	; *** AUDIO Parameters ***

	VoiceSelect 			= RohanBattleTowerSelect
	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged	= BuildingHeavyDamageWood

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction
	;VoiceFullyCreated				= EVA:GenericBuildingComplete-Builder-Elf

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  	; Built first time
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	; *** ENGINEERING Parameters ***

	RadarPriority       	= STRUCTURE
	KindOf              	= PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION CAN_ATTACK MADE_OF_WOOD GARRISON GARRISONABLE_UNTIL_DESTROYED ALWAYS_SHOW_HOUSE_COLOR FS_BASE_DEFENSE AUTO_RALLYPOINT IGNORE_FOR_VICTORY
	 
	Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName			= RivendellWorkerNoSelect
	End
  
  Behavior                      = CastleMemberBehavior ModuleTag_CMB
  End
  
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		 GiveNoXP       = Yes  ;disable granting xp when producing units.
	End
	
	Body = StructureBody ModuleTag_05
		MaxHealth               = 1500 
		MaxHealthDamaged        = 1000 
		MaxHealthReallyDamaged  = 500
		DamageCreationList 		= OCL_BuildingDamageList01 CATAPULT_ROCK
	    
		DamageCreationList 		= OCL_GBBtlTwrSD2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		DamageCreationList 		= OCL_GBBtlTwrSD2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
		DamageCreationList 		= OCL_GBBtlTwrSD2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
		DamageCreationList 		= OCL_GBBtlTwrSD2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay  = 5000
	End
	
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
 		AutoAcquireEnemiesWhenIdle	= Yes
		AILuaEventsList				= GarrisonableFunctions
 	End
	
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End
		  
	Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_StructureMediumCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 0
	End

	Behavior       = EvacuateDamage ModuleTag_evacuateDamage
		WeaponThatCausesEvacuation  = MordorCatapultHumanHeads
	End

 	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
		ContainMax              = 1
		MaxHordeCapacity        = 1
		DamagePercentToUnits    = 0%
		PassengerFilter			= ANY +INFANTRY +BANNER -CAVALRY -SUMMONED -COMBO_HORDE
		AllowEnemiesInside      = No ;Yes
		AllowNeutralInside      = Yes
		NumberOfExitPaths       = 1 ; Defaults to 1.  Set 0 to not use ExitStart/ExitEnd, set higher than 1 to use ExitStart01-nn/ExitEnd01-nn
		PassengerBonePrefix     = PassengerBone:ARCHER_BONE KindOf:INFANTRY
		EntryPosition			= X:0.0 Y:0.0 Z:0.0
		EntryOffset				= X:0.0 Y:-45.0 Z:0.0
		ExitOffset				= X:0.0 Y:-80.0 Z:0.0
		KillPassengersOnDeath	= No
		ShowPips				= No
 		ExitDelay				= 250
	End 

	Behavior = BuildingBehavior ModuleTag_Building
		NightWindowName	= N_WINDOW
		GlowWindowName	= N_GLOW
	End

	Geometry              	= BOX
	GeometryMajorRadius   	= 15
	GeometryMinorRadius   	= 15  
	GeometryHeight        	= 110
	GeometryOffset			= X:0 Y:0 Z:0
	
	GeometryIsSmall       	= No
	Shadow                	= SHADOW_VOLUME
	BuildCompletion     	= PLACED_BY_PLAYER

	GeometryContactPoint	= X:-19		Y:19		Z:0		Repair
	GeometryContactPoint	= X:19		Y:-19		Z:0		Repair
	GeometryContactPoint	= X:12.361	Y:24.008	Z:0
	GeometryContactPoint	= X:-11.371	Y:-22.442	Z:0
	GeometryContactPoint	= X:0.081	Y:-4.234	Z:111.299	Swoop

End