;----------------------------------------------------------------------------------------------
Object RivendellCastleWall1

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    WallBoundsMesh = W1

		DefaultModelConditionState
			Model = ebcastwall1 
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcastwall1
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcastwall1 ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcastwall1.ebcastwall1 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcastwall1 ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcastwall1.ebcastwall1 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcastwall1 ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcastwall1.ebcastwall1 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcastwall1 ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcastwall1 ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcastwall1.ebcastwall1 ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcastwall1 ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcastwall1.ebcastwall1 ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWall            
		DamageFX	= RohanWallDamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleWall2

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    WallBoundsMesh = W1

		DefaultModelConditionState
			Model = ebcastwall2 
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcastwall2
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcastwall2 ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcastwall2.ebcastwall2 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcastwall2 ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcastwall2.ebcastwall2 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcastwall2 ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcastwall2.ebcastwall2 ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcastwall2 ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcastwall2 ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcastwall2.ebcastwall2 ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcastwall2 ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcastwall2.ebcastwall2 ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWall            
		DamageFX	= RohanWallDamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleCorner

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    WallBoundsMesh = W1

		DefaultModelConditionState
			Model = ebcastcorn 
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcastcorn
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcastcorn ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcastcorn.ebcastcorn ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcastcorn ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcastcorn.ebcastcorn ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcastcorn ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcastcorn.ebcastcorn ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcastcorn ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcastcorn ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcastcorn.ebcastcorn ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcastcorn ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcastcorn.ebcastcorn ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWall            
		DamageFX	= RohanWallDamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleStair

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    RampMesh1 = W1

		DefaultModelConditionState
			Model = ebcaststair 
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcaststair
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcaststair ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcaststair.ebcaststair ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcaststair ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcaststair.ebcaststair ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcaststair ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcaststair.ebcaststair ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcaststair ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcaststair ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcaststair.ebcaststair ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcaststair ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcaststair.ebcaststair ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= NoArmor            
	End
	
	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE UNATTACKABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleGateMiddle

	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_01

		;WallBoundsMesh = W1
        ;RampMesh1 = Ramp01
        ;RampMesh2 = Ramp02
        RaisedWallMesh = W1
        
		DefaultModelConditionState
		  Model = ebcastgatem
		End

	IdleAnimationState
		Animation
			AnimationName     = ebcastgatem.ebcastgatem
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
        End
        Flags = START_FRAME_LAST
	End    

    ;------------Build Up States
    ModelConditionState   = BASE_BUILD
      Model               = ebcastgatem
;      ParticleSysBone	  = NONE BuildingDoughnutCloud
      ParticleSysBone     = NONE BuildingContructDust
    End  
	AnimationState		  = BASE_BUILD
		Animation
			AnimationName = ebcastgatem.ebcastgatem
			AnimationMode = ONCE
			AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
		End
	End

	AnimationState		  = JUST_BUILT
		Animation
			AnimationName = ebcastgatem.ebcastgatem
			AnimationMode = MANUAL
			AnimationBlendTime = 0
		End
        Flags = START_FRAME_FIRST
	End    

    ModelConditionState  = DAMAGED
      Model         = ebcastgatem ;RBCastBrdg_D1
;     ParticleSysBone emberBone01 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = ebcastgatem ;RBCastBrdg_D2
;     ParticleSysBone emberBone01 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
        Animation				=	ReallyDamagedanimation
			AnimationName		=	 ebcastgatem.ebcastgatem ;RBCastBrdg_D2.RBCastBrdg_D2
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
   		End
    End	
    
    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
      Model         = ebcastgatem ;RBCastBrdg_D1
;     ParticleSysBone emberBone01 SmokeBuildingLarge
    End
    
    ModelConditionState  = RUBBLE
      Model         = ebcastgatem ;RBCastBrdg_D3  
;      ParticleSysBone emberBone01 TrebuchetImpactDebris
;      ParticleSysBone emberBone02 SmokeBuildingLarge
;      ParticleSysBone emberBone03 PCTMediumDust
    End
    AnimationState = RUBBLE
    	Animation				=	Death
			AnimationName		=	ebcastgatem.ebcastgatem ;RBCastBrdg_D3.RBCastBrdg_D3
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
		End
	EnteringStateFX = FX_WallDie
    End

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

  End

	;----------------------- AUDIO -------------------------

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


  ; ***DESIGN parameters ***
  DisplayName      = OBJECT:RohanCastleGate
  Side = Rivendell
  EditorSorting = STRUCTURE
; Browser = CINEMATICS UNIT

  ArmorSet
    Conditions        = None
    Armor             = RohanCastleWall
    DamageFX          = RohanWallDamageFX
  End

  ; *** ENGINEERING Parameters ***  
;  KindOf                = STRUCTURE SELECTABLE IMMOBILE
;  RadarPriority = STRUCTURE
;  Body                  = ActiveBody ModuleTag_03
;    MaxHealth       = 2000.0
;  End
	KindOf					= STRUCTURE IMMOBILE CHUNK_VENDOR SELECTABLE WALK_ON_TOP_OF_WALL NOT_AUTOACQUIRABLE
	KeepSelectableWhenDead	= Yes
	
  RadarPriority = NOT_ON_RADAR	
	Body					= ActiveBody ModuleTag_03
			MaxHealth				= 6000.0
			MaxHealthDamaged		= 3000.0
			MaxHealthReallyDamaged  = 1000.0
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
  ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
  ; buildings automatically stick around because GarrisonContain has it's own DieModule
;  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;      DestructionDelay  = 5000
;  End
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

    Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = No  ; Even if walkway over gate is gone, enemy cannot enter castle
    End 


	; These are bunched-up together on purpose
	BuildCost		= 0  ; for free, since this serves no purpose
  	CommandSet				= GenericSelfRepairCommandSet   ;
 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds	= 15 ; nice and fast, so we don;t visually block the gateway
	End



  Geometry				= BOX
  GeometryMajorRadius   = 90.0
  GeometryMinorRadius   = 32.5 
  GeometryHeight        = 15.0
  GeometryOffset		= X:0 Y:10 Z:60  
  
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 32.5 
  GeometryHeight        = 75.0
  GeometryOffset		= X:70 Y:10 Z:0  
      
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 32.5 
  GeometryHeight        = 75.0
  GeometryOffset		= X:70 Y:10 Z:0  
 
  GeometryContactPoint =	X:-50		Y:0				Z:60 
  GeometryContactPoint =	X:0			Y:0				Z:60
   GeometryContactPoint =	X:50		Y:0				Z:60
  GeometryContactPoint =	X:60		Y:-40			Z:0 
  GeometryContactPoint =	X:67		Y:0				Z:60
  GeometryContactPoint =	X:75		Y:-40			Z:0 Grab
  GeometryContactPoint =	X:75		Y:65			Z:0 Grab
  GeometryContactPoint =	X:60		Y:65			Z:0 
  
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleGateLeft

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    WallBoundsMesh = W1

		DefaultModelConditionState
			Model = ebcastgatel 
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcastgatel
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcastgatel ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcastgatel.ebcastgatel ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcastgatel ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcastgatel.ebcastgatel ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcastgatel ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcastgatel.ebcastgatel ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcastgatel ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcastgatel ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcastgatel.ebcastgatel ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcastgatel ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcastgatel.ebcastgatel ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWall            
		DamageFX	= RohanWallDamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object RivendellCastleGateRight

    SelectPortrait = BRCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
	
		OkToChangeModelColor = Yes

	    WallBoundsMesh = W1

		DefaultModelConditionState
			Model = ebcastgater
		End

		ModelConditionState = WORLD_BUILDER
  			Model = ebcastgater
  		End

		ModelConditionState = BASE_BUILD
  			Model = ebcastgater ;RBCastWall_A
  		End
		AnimationState = BASE_BUILD
			Animation
				AnimationName = ebcastgater.ebcastgater ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 2.5 ; keep range wide to avoid lockstep anims
			End
		End    

		ModelConditionState = JUST_BUILT
  			Model = ebcastgater ;RBCastWall_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = ebcastgater.ebcastgater ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = ebcastgater ;RBCastWall_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = ebcastgater.ebcastgater ;RBCastWALL_A.RBCastWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End    

		
		ModelConditionState  = DAMAGED
			Model         = ebcastgater ;RBCastWALL_D1  
		End
	    
		AnimationState = DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = ebcastgater ;RBCastWALL_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 ebcastgater.ebcastgater ;RBCastWALL_D2.RBCastWALL_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = RUBBLE
      Model         = ebcastgater ;RBCastWall_D3
      ParticleSysBone NONE TrebuchetImpactSplinters
      ParticleSysBone NONE ExplosiveMineFire02
    End
	    
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	ebcastgater.ebcastgater ;RBCastWALL_D3.RBCastWALL_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
			;EnteringStateFX = FX_RohanWallRubble
		End      

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End

	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RivendellCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rivendell
	BuildTime		= M_CASTLE_WALL_REBUILD_TIME
	BuildCost		= M_CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWall            
		DamageFX	= RohanWallDamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= M_ROHAN_CASTLE_WALL_HEALTH
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = M_CASTLE_WALL_REBUILD_TIME
	End

;	Behavior = FoundationAIUpdate ModuleTag_foundationAI
;	End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 55.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 45.0
	
	GeometryContactPoint =	X:-50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:-40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:-40				Z:0 Grab
	GeometryContactPoint =	X:-50			Y:40				Z:0 Grab
	GeometryContactPoint =	X:0				Y:40				Z:40 Grab
	GeometryContactPoint =	X:50			Y:40				Z:0 Grab
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End