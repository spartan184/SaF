;---------------------------------------------------------------------------------
;Rivendell Library
Object RivendellLibrary

	SelectPortrait = BPRivendellLibrary
 
  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD    
	    
    DefaultModelConditionState
      Model					= eblibrary_skn
    End
		
    IdleAnimationState
      BeginScript
      Prev = CurDrawablePrevAnimationState()
      if Prev == "BeingConstructed" then 
          ; Don't play completed sound when canceling build-in-progress or when
          ; destroyed halfway
          if not CurDrawableModelcondition( "DYING" ) then 
          CurDrawablePlaySound("CampRivendellElfBuildLibrary")
        end
      end
      EndScript
    End

   ;-- building being constructed
    ModelConditionState   = AWAITING_CONSTRUCTION 
      Model               = eblibrary_bld
    End
	
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           = eblibrary_bld
        AnimationName     = GBMarket_ASKL.GBMarket_ABLD
        AnimationMode     = MANUAL
      End
      Flags				        = START_FRAME_FIRST
    End
    
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = eblibrary_bld
      ParticleSysBone     = DUSTBONE BuildingContructDust
    End
	
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Animation           = eblibrary_bld
        AnimationName     = eblibrary_bld.eblibrary_bld
        AnimationMode     = MANUAL
      End
      Flags		= START_FRAME_FIRST
      StateName	= BeingConstructed
      BeginScript
        CurDrawablePlaySound("GondorBarracksBeginConstruction")
      EndScript
    End

 ;--damaged building
    
    ModelConditionState  = DAMAGED
      Model         = eblibrary_d1
      ParticleSysBone FireSmall01 FireBuildingSmall
      ParticleSysBone FireSmall02 FireBuildingLarge
      ParticleSysBone FireSmall03 FireBuildingMedium
      ParticleSysBone FireSmall04 FireBuildingMedium
      ParticleSysBone FireSmall05 FireBuildingMedium
      ParticleSysBone FireSmall06 FireBuildingMedium
      ParticleSysBone SmokeMedium01 SmokeBuildingLarge
	
    End
    AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
			BeginScript
				CurDrawableHideSubObject("LEITHIANA")
				CurDrawableHideSubObject("LEITHIANB")
			EndScript		
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = eblibrary_d2
      	ParticleSysBone FireSmall01 FireBuildingSmall
     	ParticleSysBone FireSmall02 FireBuildingLarge
      	ParticleSysBone FireSmall03 FireBuildingMedium
      	ParticleSysBone FireSmall04 FireBuildingLarge
      	ParticleSysBone FireSmall05 FireBuildingMedium
      	ParticleSysBone FireSmall06 FireBuildingMedium
      	ParticleSysBone SmokeMedium01 SmokeBuildingLarge	
    End
    AnimationState = REALLYDAMAGED
		EnteringStateFX	= FX_BuildingReallyDamaged
    	Animation	= ReallyDamagedAnimation
				AnimationName		=	GBMarket_D2SK.GBMarket_D2AN
				AnimationMode		=	ONCE	
		End
			BeginScript
				CurDrawableHideSubObject("LEITHIANA")
				CurDrawableHideSubObject("LEITHIANB")
			EndScript		
    End

    ModelConditionState  = RUBBLE
      Model         = eblibrary_d2
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End
    AnimationState = RUBBLE
		EnteringStateFX	= FX_StructureMediumCollapse
    	Animation	= ReallyDamagedAnimation
				AnimationName		=	eblibrary_d2.eblibrary_d2
				AnimationMode		=	ONCE	
		End
			BeginScript
				CurDrawableHideSubObject("LEITHIANA")
				CurDrawableHideSubObject("LEITHIANB")
			EndScript		
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
      ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
      ParticleSysBone NONE SmokeBuildingMediumRubble
    End	
  End
  
  Draw = W3DFloorDraw ModuleTag_DrawFloor
	StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
    ModelName = eblibrary_bib
  End 
   
  PlacementViewAngle    = 90

  ; ***DESIGN parameters ***
	DisplayName         	= OBJECT:RivendellLibrary
	Description         	= OBJECT:RivendellLibraryDesc
	Side                	= Rivendell
	EditorSorting       	= STRUCTURE
	ThreatLevel 			    = 1.0 
	BuildCost           	= 500
	BuildTime           	= GONDOR_MARKETPLACE_BUILDTIME
	VisionRange         	= GONDOR_MARKETPLACE_VISION_RANGE
	ShroudClearingRange 	= GONDOR_MARKETPLACE_SHROUD_CLEAR
	BountyValue         	= GONDOR_MARKETPLACE_BOUNTY_VALUE
	CommandSet            = RivendellLibraryCommandSet

	ArmorSet
		Conditions          = None
		Armor               = StructureArmor
	End

    ; *** AUDIO Parameters ***
	VoiceSelect				            = RivendellLibrarySelect
	SoundAmbient				          = GondorMarketVenderAmbience
	SoundAmbientDamaged			      = GenericFireMediumLoop
	SoundAmbientReallyDamaged	    = GenericFireLargeLoop
	SoundOnDamaged				        = BuildingLightDamageStone
	SoundOnReallyDamaged		      = BuildingHeavyDamageStone

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction
	;VoiceFullyCreated				      = CampRivendellElfBuildLibrary

	UnitSpecificSounds
		UnderConstruction	          = BuildingConstructionLoop  	; Built first time
		UnderRepairFromRubble	      = BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

  ; *** ENGINEERING Parameters ***
	RadarPriority       	         = STRUCTURE
	KindOf              	         = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION MADE_OF_STONE IGNORE_FOR_VICTORY
	MaxSimultaneousOfType 	       = 1
	
	Behavior                       = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName		  	           = RivendellWorkerNoSelect
	End
    
  Behavior                       = CastleMemberBehavior ModuleTag_CMB
  End
  
	Behavior                       = AIUpdateInterface ModuleTag_03
		;AILuaEventsList				     = LibraryFunctions
	End
  
	Body                           = StructureBody ModuleTag_05
		MaxHealth        		         = GONDOR_MARKETPLACE_HEALTH
		MaxHealthDamaged  		       = GONDOR_MARKETPLACE_HEALTH_DAMAGED
		MaxHealthReallyDamaged 	     = GONDOR_MARKETPLACE_HEALTH_REALLY_DAMAGED

		;these correspond to the old marketplace
		DamageCreationList 		       = OCL_BuildingDamageList01 CATAPULT_ROCK

		DamageCreationList 		       = OCL_GBMrkPlace_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		DamageCreationList 		       = OCL_GBMrkPlace_Chunk2 CATAPULT_ROCK LEFT_DESTROYED
		DamageCreationList 		       = OCL_GBMrkPlace_Chunk3 CATAPULT_ROCK BACK_DESTROYED
		DamageCreationList 		       = OCL_GBMrkPlace_Chunk4 CATAPULT_ROCK RIGHT_DESTROYED

	End

	Behavior                       = StructureCollapseUpdate ModuleTag_06
		MinCollapseDelay             = 000
		MaxCollapseDelay             = 000
		CollapseDamping              = .5
		MaxShudder                   = 0.6
		MinBurstDelay                = 250
		MaxBurstDelay                = 800
		BigBurstFrequency            = 4
		FXList                       = INITIAL   FX_StructureMediumCollapse
		FXList                       = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	       = Yes
		CollapseHeight			         = 136
	End

	Behavior                       = BuildingBehavior BuildingModuleTag
	End
	
	Behavior                       = GeometryUpgrade Geom_ModuleTag_HideAll
		TriggeredBy		               = Upgrade_StructureLevel1
		ShowGeometry	               = Geom_Orig
		HideGeometry	               = Geom_V2 
	End
	Behavior                       = GeometryUpgrade Geom_ModuleTag_ShowWalls 
		TriggeredBy		               = Upgrade_StructureLevel2
		ShowGeometry	               = Geom_Orig
		HideGeometry	               = Geom_V2 
	End
  Behavior                       = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower 
		TriggeredBy		               = Upgrade_StructureLevel3
		ShowGeometry	               = Geom_V2 Geom_Orig
	End

	Behavior                       = ProductionUpdate ProductionUpdateModuleTag
		GiveNoXP		                 = Yes    
	End

	Behavior                       = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint			         = X:0.0 Y:-26.0 Z:0.0
		PlacementViewAngle		       = -90
		NaturalRallyPoint		         = X:0.0 Y:-80.0 Z:0.0
		ExitDelay				             = 300
	End
  
  ; -- Dunedain Discount
	Behavior                       = CostModifierUpgrade ModuleTag_CostModifier1
    LabelForPalantirString       = GUI:DUMMY_STR_DISCOUNT
    TriggeredBy		               = Upgrade_TechnologyRivendellLethian
    UpgradeDiscount		           = No
    ObjectFilter                 = ANY +DunedainRangerHorde +GreyCompanyRangerHorde +DunedainRanger +GreyCompanyRanger
    Percentage		               = -25%
	End
  
  ; -- Feanor Smithing Upgrade Discounts
	Behavior                       = AttributeModifierAuraUpdate ModuleTag_FeanorBonus
		StartsActive	               = No ;If no, requires upgrade to turn on.
		BonusName		                 = RivendellFeanorBonus
		TriggeredBy		               = Upgrade_TechnologyRivendellFeanorSmithing
		RefreshDelay	               = 2000
		Range			                   = 99999999
		TargetEnemy		               = No
		ObjectFilter	               = NONE +RivendellVeteranHorde +RivendellKnightHorde +RivendellGuardianHorde
	End	  
  ; -- Reflections on Dagorlad 
	Behavior                       = AttributeModifierAuraUpdate ModuleTag_HeroRadiateFear
		StartsActive	               = No ;If no, requires upgrade to turn on.
		BonusName		                 = RivendellDagorladBonus
		TriggeredBy		               = Upgrade_TechnologyRivendellDagorlad
		RefreshDelay	               = 2000
		Range			                   = 99999999
		TargetEnemy		               = No
		ObjectFilter	               = NONE +RivendellVeteranHorde +RivendellKnightHorde +RivendellGuardianHorde
	End	
	  
	Geometry				               = BOX
  GeometryName			             = Geom_Orig
  GeometryMajorRadius		         = 40.0
	GeometryMinorRadius		         = 40.0
	GeometryHeight			           = 40.0
	GeometryOffset			           = X:0 Y:-5 Z:0	
		
	AdditionalGeometry		         = BOX
	GeometryName			             = Geom_Orig
	GeometryMajorRadius		         = 11.0
	GeometryMinorRadius		         = 11.0
	GeometryHeight			           = 72.0
	GeometryOffset			           = X:-18 Y:16 Z:0	
	
	GeometryIsSmall       	       = No
	Shadow                	       = SHADOW_VOLUME
	BuildCompletion     	         = PLACED_BY_PLAYER
  
	GeometryContactPoint 	         = X:-60	Y:60	Z:0			Repair
	GeometryContactPoint 	         = X:72		Y:-66	Z:0			Repair
	GeometryContactPoint 	         = X:24.669		Y:36.984	Z:0
	GeometryContactPoint 	         = X:-1.623		Y:-45.628	Z:0
	GeometryContactPoint 	         = X:-17.937	Y:17.244	Z:73.532	Swoop

End