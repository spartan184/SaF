;------------------------------------------------------------------------------
; Blacksmith Forge
Object RivendellForge
	SelectPortrait = BPRivendellForge

  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_01

    OkToChangeModelColor  = Yes
    StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

 	ExtraPublicBone = ARROW01
	ExtraPublicBone = ARROW02
	ExtraPublicBone = ARROW03
	ExtraPublicBone = ARROW04

    DefaultModelConditionState
		Model               = EBForge_SKN
		WeaponLaunchBone = PRIMARY ARROW
    End

	IdleAnimationState
		StateName				=	STATE_Idle
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLA
			AnimationMode		=  ONCE
			AnimationPriority	=  10
		End
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLB
			AnimationMode		=  ONCE
			AnimationPriority	=  5
		End
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLC
			AnimationMode		=  ONCE
			AnimationPriority	=  3
		End
		ParticleSysBone     = FXFire ForgeSwordGlow FollowBone:Yes Persist:SPAWN PersistID:100
		ParticleSysBone     = FXSmoke forgeSmoke FollowBone:Yes Persist:SPAWN PersistID:101
		Flags				= RESTART_ANIM_WHEN_COMPLETE
	End

    ;------------ Build Up States -------
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = EBForge_A
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End;
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  EBForge_A
        AnimationName     =  EBForge_ASKL.EBForge_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End

    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model             = EBForge_A
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
    End;

    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = EBForge_A
			AnimationName     = EBForge_ASKL.EBForge_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName			  = BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
		EndScript
    End

;----- damage states

    ModelConditionState  = DAMAGED
      Model         = EBForge_D1
    	;ParticleSysBone FXLeaves EaglesNestbuildleaves
		;ParticleSysBone FXLeaves EaglesNestbuilddust
	  End

    AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
    End


    ModelConditionState  = REALLYDAMAGED
      Model         = EBForge_D2
    End
    AnimationState = REALLYDAMAGED
    	Animation	= RubbleAnimation
			AnimationName		=	EBForge_D2SK.EBForge_D2AN
			AnimationMode		=	ONCE
	  	End
		EnteringStateFX	= FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = EBForge_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
    	Animation	= RubbleAnimation
			AnimationName		=	EBForge_D3SK.EBForge_D3AN
			AnimationMode		=	ONCE
	  	End
	  	EnteringStateFX	= FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End

	AnimationState		= USER_5
		StateName				=	STATE_Idle
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLA
			AnimationMode		=  ONCE
			AnimationPriority	=  10
		End
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLB
			AnimationMode		=  ONCE
			AnimationPriority	=  5
		End
		Animation				=  EBForge_A
			AnimationName		=  EBForge_SKL.EBForge_IDLC
			AnimationMode		=  ONCE
			AnimationPriority	=  3
		End
		ParticleSysBone     = FXFire ForgeSwordGlow  FollowBone:Yes Persist:SPAWN PersistID:200 ;ElvenForgeGlowV3
		ParticleSysBone     = FXSmoke FireSmoke FollowBone:Yes Persist:SPAWN PersistID:201 ;ElvenForgeSmokeV3
		Flags						= RESTART_ANIM_WHEN_COMPLETE
	End

    ModelConditionState = USER_5
		Model = EBForge_SKN
		WeaponLaunchBone = PRIMARY ARROW
	End

    ModelConditionState = USER_4
		Model = EBForge_SKN
		WeaponLaunchBone = PRIMARY ARROW
	End

  End

  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
		ModelName = EBForge_Bib
  End


  ; ***DESIGN parameters ***

	DisplayName         	= OBJECT:RivendellForge
	Description	      		= OBJECT:RivendellForgeDesc
	Side                	= Rivendell
	EditorSorting       	= STRUCTURE
	ThreatLevel				= 1.0
	BuildCost           	= M_ROHAN_ARMORY_BUILDCOST
	BuildTime           	= 5 ;M_ROHAN_ARMORY_BUILDTIME
	BountyValue         	= M_ROHAN_ARMORY_BOUNTY_VALUE
	VisionRange         	= M_ROHAN_ARMORY_VISIONRANGE         		
	ShroudClearingRange 	= M_ROHAN_ARMORY_SHROUDCLEAR

	ArmorSet
		Conditions      	= None
		Armor           	= StructureArmor
	End
	CommandSet          	= RivendellForgeCommandSet

	WeaponSet
		Conditions			= None
	End

  ; *** AUDIO Parameters ***

	VoiceSelect					= GondorForgeSelect
	SoundAmbientDamaged			= GenericFireMediumLoop
	SoundAmbientReallyDamaged	= GenericFireLargeLoop
	SoundOnDamaged				= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  	; Built first time
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	; *** ENGINEERING Parameters ***

	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION MP_COUNT_FOR_VICTORY FS_FACTORY ATTACK_NEEDS_LINE_OF_SIGHT

	Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName		                                                                   = RohanWorkerNoSelect
	End

	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	                                                     = Yes
		MoodAttackCheckRate			                                                         = 250
	End

	Body = StructureBody ModuleTag_05
    MaxHealth                                                                        = M_ROHAN_ARMORY_MAXHEALTH				
    MaxHealthDamaged                                                                 = M_ROHAN_ARMORY_MAXHEALTHDAMAGED			
    MaxHealthReallyDamaged                                                           = M_ROHAN_ARMORY_MAXHEALTH_REALLYDAMAGED		
      
    DamageCreationList 		                                                           = OCL_BuildingDamageList01 CATAPULT_ROCK
    DamageCreationList 		                                                           = OCL_GBBlkSmith_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList 		                                                           = OCL_GBBlkSmith_Chunk2 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList 		                                                           = OCL_GBBlkSmith_Chunk3 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList 		                                                           = OCL_GBBlkSmith_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

	End

	Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy		                                                                   = Upgrade_StructureLevel1
		HideSubObjects	                                                                 = V1 V2 V2FLAG V1_PIECE* V2_PIECE*
	End

  	Behavior = SubObjectsUpgrade ModuleTag_ShowPillarsAndWalls
		TriggeredBy		                                                                   = Upgrade_StructureLevel2
		ShowSubObjects	                                                                 = V1 V1_PIECE*
		HideSubObjects	                                                                 = V2 V2FLAG V2_PIECE*
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowTower
		TriggeredBy		                                                                   = Upgrade_StructureLevel3
		ShowSubObjects	                                                                 = V1 V2 V2FLAG V1_PIECE* V2_PIECE*
	End

	;----------------------------------------------------------------------------------

	Behavior = QueueProductionExitUpdate ModuleTag_07
		UnitCreatePoint                                                                  = X:-5.0 Y:25.0 Z:0.0
		NaturalRallyPoint                                                                = X:40.0 Y:25.0 Z:0.0
		ExitDelay                                                                        = 750
		PlacementViewAngle                                                               = 0
	End

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildin
  ; never truly destroyed, even when reduced to zero health. Also note that garrisona
  ; buildings automatically stick around because GarrisonContain has it's own DieModu
	Behavior = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay                                                                 = 000
		MaxCollapseDelay                                                                 = 000
		CollapseDamping                                                                  = .5
		MaxShudder                                                                       = 0.6
		MinBurstDelay                                                                    = 250
		MaxBurstDelay                                                                    = 800
		BigBurstFrequency                                                                = 4
		FXList                                                                           = INITIAL   FX_StructureMediumCollapse
		FXList                                                                           = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	                                                           = Yes
		CollapseHeight			                                                             = 100
	End

	Behavior = ProductionUpdate ModuleTag_06
		GiveNoXP                                                                         = No ;Yes  ;disable granting xp when producing units.
	End

    ;--------------------------------------------------------------------------------

    Behavior = CostModifierUpgrade ModuleTag_CostModifierUpgrades
        LabelForPalantirString                                                       = GUI:STEEL_DISCOUNT
        StartsActive                                                                 = Yes ; Run on build complete, not upgrade
        UpgradeDiscount                                                              = Yes
        ObjectFilter                                                                 = ANY +STRUCTURE
        Percentage                                                                   = 0%
        Percentage                                                                   = -10%
        Percentage                                                                   = -15%
        Percentage                                                                   = -20%
        Percentage                                                                   = -30%
        Percentage                                                                   = -40%
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifierMachines
        LabelForPalantirString                                                       = GUI:STEEL_DISCOUNT
        StartsActive                                                                 = Yes ; Run on build complete, not upgrade
        ObjectFilter                                                                 = ANY +MACHINE
        Percentage                                                                   = 0%
        Percentage                                                                   = -10%
        Percentage                                                                   = -15%
        Percentage                                                                   = -20%
        Percentage                                                                   = -30%
        Percentage                                                                   = -40%
    End

	Behavior = BuildingBehavior BuildingModuleTag
		;NightWindowName       = N_Window
		; FireWindowName       = WINDOW_F01
		; GlowWindowName	     = WINDOW_G01
		; FireName		         = FIRE01
	End

  ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap      = 800
    AnimationSound         = Sound: GondorForgeHammering Animation:EBForge_SKL.EBForge_IDLA Frames: 40 61 89
    AnimationSound         = Sound: GondorForgeHammering Animation:EBForge_SKL.EBForge_IDLB Frames: 111
    AnimationSound         = Sound: GondorForgeHammering Animation:EBForge_SKL.EBForge_IDLC Frames: 162
  End

	Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
		TriggeredBy		         = Upgrade_StructureLevel1
		ShowGeometry		       = Geom_Orig
		HideGeometry		       = Geom_V1 Geom_V2
	End
  
	Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
		TriggeredBy		         = Upgrade_StructureLevel2
		ShowGeometry		       = Geom_Orig Geom_V1
		HideGeometry		       = Geom_V2
	End
  
  Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
		TriggeredBy		         = Upgrade_StructureLevel2
		ShowGeometry		       = Geom_Orig Geom_V1 Geom_V2
	End

	;-----------------------------------------------------------------------------

	Geometry				         = CYLINDER
  GeometryName			       = Geom_Orig
  GeometryMajorRadius		   = 18.0
	GeometryMinorRadius		   = 18.0
	GeometryHeight			     = 75.0
	GeometryOffset			     = X:-26.5 Y:0 Z:0

	AdditionalGeometry		   = BOX
	GeometryName			       = Geom_Orig
	GeometryMajorRadius		   = 10.0
	GeometryMinorRadius		   = 10.0
	GeometryHeight			     = 50.0
	GeometryOffset			     = X:1.5 Y:35.0 Z:0

	AdditionalGeometry		   = CYLINDER
  GeometryName			       = Geom_Orig
  GeometryMajorRadius		   = 20.0
	GeometryMinorRadius		   = 20.0
	GeometryHeight			     = 90.0
	GeometryOffset			     = X:5 Y:-30 Z:0

	AdditionalGeometry		   = BOX
  GeometryName			       = Geom_V1
  GeometryMajorRadius		   = 10.0
	GeometryMinorRadius		   = 12.0
	GeometryHeight			     = 118.0
	GeometryOffset			     = X:14 Y:-20 Z:0

  GeometryIsSmall       	 = No

	Shadow                	 = SHADOW_VOLUME
	BuildCompletion     	   = PLACED_BY_PLAYER

	GeometryContactPoint 	   = X:-35.943	Y:39.809	Z:0		Repair
	GeometryContactPoint 	   = X:26.935	Y:-42.402	Z:0		Repair
	GeometryContactPoint	   = X:-26.201	Y:-42.402	Z:0
	GeometryContactPoint 	   = X:35.727	Y:38.094	Z:0
	GeometryContactPoint 	   = X:-0.272	Y:23.661	Z:57.982	Swoop

End