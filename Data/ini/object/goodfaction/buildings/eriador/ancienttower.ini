;------------------------------------------------------------------------------
;Gondor Barracks
Object AncientTower

    SelectPortrait = BRBattleTower
 

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04
        ExtraPublicBone = ARROW_05
        ExtraPublicBone = ARROW_06
        ExtraPublicBone = ARROW_07
        ExtraPublicBone = ARROW_08
        ExtraPublicBone = ARROW_09
        ExtraPublicBone = ARROW_10
        ExtraPublicBone = ARROW_11
        ExtraPublicBone = ARROW_12
        
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = RuinTwr
            WeaponLaunchBone = PRIMARY ARROW_
        End

        IdleAnimationState
            Animation = IDLE
                AnimationName =    GBBtlTwrS.GBBtlTwrS
                AnimationMode =    LOOP    
            End        
            ;BeginScript
            ;    CurDrawableHideSubObject("B_FLAGBASE")
            ;EndScript
        End    
    
   
        ;---------------damage states-- garrisoned---------------
        
        ;--damaged building
        ModelConditionState  = GARRISONED DESTROYED_FRONT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
             ParticleSysBone FireLarge01 FireBuildingLarge
             ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_FRONT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
        End
    
        ModelConditionState  = GARRISONED DESTROYED_RIGHT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_RIGHT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
        End
        

        ModelConditionState  = GARRISONED DESTROYED_BACK
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_BACK
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
        End

        ModelConditionState  = GARRISONED DESTROYED_LEFT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_LEFT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
        End

        AnimationState = GARRISONED DAMAGED
            StateName = GarrisonedDamaged
            Animation           = RuinTwr_D
                AnimationName     = RuinTwr_D.RuinTwr_D
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "Damaged" and Prev ~= "GarrisonedReallyDamaged" and Prev ~= "TRANS_Damaged" then CurDrawableSetTransitionAnimState("TRANS_Damaged") end    
            EndScript
        End
        

        AnimationState = GARRISONED REALLYDAMAGED
            StateName = GarrisonedReallyDamaged
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "ReallyDamaged" and Prev ~= "TRANS_ReallyDamaged" then CurDrawableSetTransitionAnimState("TRANS_ReallyDamaged") end    
            EndScript
        End
    
        AnimationState = GARRISONED RUBBLE
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
            BeginScript
                CurDrawableHideSubObject("D2A")
                CurDrawableHideSubObject("D2B")
                CurDrawableHideSubObject("D2C")
                CurDrawableHideSubObject("D2D")
            EndScript
        End

        AnimationState = GARRISONED CONSTRUCTION_COMPLETE
            Animation           = RuinTwr
                AnimationName     = RuinTwr.RuinTwr
                AnimationMode     = LOOP
            End
        End

        AnimationState = GARRISONED
            Animation           = RuinTwr
                AnimationName     = RuinTwr.RuinTwr
                AnimationMode     = LOOP
            End
        End

    
        ;---------------damage states- non-garrisoned----------------
        
        ;--damaged building
        ModelConditionState  = DESTROYED_FRONT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
             ParticleSysBone FireLarge01 FireBuildingLarge
             ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_FRONT
            BeginScript
                CurDrawableHideSubObject("D2A")
            EndScript
        End
        
        ModelConditionState  = DESTROYED_RIGHT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
    
        AnimationState = DESTROYED_RIGHT
            BeginScript
                CurDrawableHideSubObject("D2B")
            EndScript
        End
    

        ModelConditionState  = DESTROYED_BACK
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_BACK
            BeginScript
                CurDrawableHideSubObject("D2C")
            EndScript
        End

        ModelConditionState  = DESTROYED_LEFT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_LEFT
            BeginScript
                CurDrawableHideSubObject("D2D")
            EndScript
        End
    
    
        ModelConditionState  = DAMAGED 
            Model         = RuinTwr_D
        End 
        AnimationState = DAMAGED
            StateName = Damaged
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "GarrisonedDamaged" and Prev ~= "ReallyDamaged" and Prev ~= "TRANS_Damaged" then CurDrawableSetTransitionAnimState("TRANS_Damaged") end    
            EndScript
        End

        AnimationState = REALLYDAMAGED
            StateName = ReallyDamaged
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "GarrisonedReallyDamaged" and Prev ~= "TRANS_ReallyDamaged" then CurDrawableSetTransitionAnimState("TRANS_ReallyDamaged") end    
            EndScript
        End

   

        ModelConditionState  = REALLYDAMAGED 
            Model         = RuinTwr_D
            ParticleSysBone None FireBuildingLarge
            ParticleSysBone None SmokeBuildingLarge
        End    
    

        ModelConditionState  = RUBBLE
            Model         = RuinTwr_D  
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
    

        AnimationState = RUBBLE
            BeginScript
                CurDrawableHideSubObject("D2A")
                CurDrawableHideSubObject("D2B")
                CurDrawableHideSubObject("D2C")
                CurDrawableHideSubObject("D2D")
            EndScript
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
    
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End
        
        
        
        TransitionState = TRANS_Damaged
            StateName = TRANS_Damaged
            EnteringStateFX    = FX_BuildingDamaged
        End
        
        TransitionState = TRANS_ReallyDamaged
            StateName = TRANS_ReallyDamaged
            EnteringStateFX    = FX_BuildingReallyDamaged
        End
        

    End ; draw

    Draw = W3DFloorDraw ModuleTag_DrawFloor    
        StaticModelLODMode = Yes        ; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = GBBeacon_Bib
    End

    Draw = W3DScriptedModelDraw Draw_HarshColdFX
        DefaultModelConditionState
          Model = None
        End
        ModelConditionState = USER_5
            Model = None
            ParticleSysBone = None HarshCold
        End
        AnimationState = USER_5
            ParticleSysBone = None HarshCold
        End
    End

  PlacementViewAngle  = -90

  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:RuinedTower
  Description         = OBJECT:RuinedTowerDescription
  Side                = Eriador
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = M_GONDOR_BARRACKS_BUILDCOST
  BuildTime           = M_GONDOR_BARRACKS_BUILDTIME          ; in seconds
  BountyValue         = M_GONDOR_BARRACKS_BOUNTY_VALUE
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = M_GONDOR_BARRACKS_SHROUD_CLEAR


  
  ArmorSet
    Conditions        = None
    Armor             = StructureArmor
  End
  CommandSet          = GondorBeaconCommandSet

    WeaponSet
        Conditions            = None
    End

  ; *** AUDIO Parameters ***

    VoiceSelect        = GondorStatueSelect

    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone
 
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop  ; Built first time
        ; UnderRepairFromDamage    = NoSound                    ; Repaired No animation on the building, so don't bother playing sound
        UnderRepairFromRubble    = BuildingConstructionLoop    ; Repaired from completely destroyed (not used???)
    End


  ; *** ENGINEERING Parameters ***

  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE CAPTURABLE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK GARRISON CAN_ATTACK GARRISONABLE_UNTIL_DESTROYED MADE_OF_STONE
 
  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName    = GondorWorkerNoSelect
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
  End 

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
         AutoAcquireEnemiesWhenIdle    = No
        AILuaEventsList                = GarrisonableFunctions
     End

  Body                    = ActiveBody ModuleTag_05
    MaxHealth             = M_GONDOR_BARRACKS_HEALTH
    MaxHealthDamaged      = M_GONDOR_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged  = M_GONDOR_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK
    
    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
    
  End

    Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
         ObjectStatusOfContained    = UNSELECTABLE CAN_ATTACK ENCLOSED
         ContainMax              = 1
         MaxHordeCapacity        = 1
         DamagePercentToUnits    = 0%
         PassengerFilter            = ANY +INFANTRY +BANNER +MordorHaradrim -CAVALRY -SUMMONED -COMBO_HORDE
         AllowEnemiesInside      = No
         AllowNeutralInside      = Yes    ; Cause this structure is normally neutral.
         NumberOfExitPaths       = 1        ; Defaults to 1.  Set 0 to not use ExitStart/ExitEnd, set higher than 1 to use ExitStart01-nn/ExitEnd01-nn
         PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
         EntryPosition            = X:0.0 Y:0.0 Z:0.0
         EntryOffset                = X:0.0 Y:-45.0 Z:0.0
         ExitOffset                = X:0.0 Y:-80.0 Z:0.0
         EnterSound                = RuinedTowerEnterSound
         KillPassengersOnDeath    = No
         ShowPips                = No
         ExitDelay                = 250
       End


    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired = ANY +GondorMarketPlace
        RefundPercent = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    ; nothing
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint    = X:0.0 Y:0.0 Z:0.0
    NaturalRallyPoint  = X:-90.0 Y:-100.0 Z:0.0
    ExitDelay = 750
  End
;  Behavior = QueueProductionExitUpdate ModuleTag_07
;    UnitCreatePoint    = X:-28.0 Y:-32.0 Z:0.0
;    NaturalRallyPoint  = X:50.0 Y:55.0 Z:0.0
;    ExitDelay = 750
;  End
    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        EffectRadius            = 200 ; please update the decal size in experience lvl INI if you change this... the value there is about 2.2x the value here
        PingDelay                = 2000;msec
        ModifierName            = GondorBeaconPassiveLeadership        
        AllowFilter                = ANY +INFANTRY +CAVALRY -MACHINE -IMMOBILE -HERO   
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_TaintedLandTwo
        StartsActive    = Yes ;If no, requires upgrade to turn on.
        BonusName        = TaintNegativeSpell        
        RefreshDelay    = 2000
        Range            = 200
        TargetEnemy        = Yes
        AntiCategory    = LEADERSHIP ; This means cancel all previous leadership bonuses
        AntiFX            = FX_AntiLeadership ; FX for anti category
        ObjectFilter    = ANY +INFANTRY +CAVALRY -HERO -STRUCTURE -BASE_FOUNDATION
    End
  
  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight            = 155
  End
 
    AttackContactPoint = X:-24 Y:-24 Z:99
    GeometryContactPoint = X:-39 Y:-39 Z:0 Repair
    GeometryContactPoint = X: 39 Y:-39 Z:0 Repair
    GeometryContactPoint = X:-39 Y: 39 Z:0 Repair
    GeometryContactPoint = X:10 Y: 10 Z:0 Bomb

  Behavior                  = BuildingBehavior BuildingModuleTag
  End

    Behavior = LifetimeUpdate ModuleTag_HatchTrigger
        MinLifetime =  M_BEACON_LIFETIME    ;duration of the anim
        MaxLifetime = M_BEACON_LIFETIME  ;16000
        DeathType        = FADED        ;so that I just spawn the final building without playing the death anim
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry    = Geom_Orig
        HideGeometry    = Geom_V2 
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls 
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry    = Geom_Orig
        HideGeometry    = Geom_V2 
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower 
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry    = Geom_V2
        HideGeometry    = Geom_Orig
    End

  ;; This is required for setting rally points which needs a small geometry to determine if quick path exists in tight spaces
  ;; If this was any bigger, it would fail to create the rallu points when in a camp or castle.
  Geometry              = CYLINDER
  GeometryMajorRadius   = 8.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 10

  ;; This is required for setting rally points which needs a small geometry to determine if quick path exists in tight spaces
  ;; If this was any bigger, it would fail to create the rallu points when in a camp or castle.
  Geometry              = CYLINDER
  GeometryMajorRadius   = 8.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 10

  ;; These are the actual building geometry pieces
  AdditionalGeometry    = BOX
  GeometryName            = Geom_Orig
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 75.0
  GeometryOffset        = X:0 Y:0 Z:0
;  GeometryOffset        = X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_Orig
  GeometryMajorRadius   = 25.0
  GeometryMinorRadius   = 30.0
  GeometryHeight        = 20.0
  GeometryOffset        = X:0 Y:0 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_V2
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 105.0
  GeometryOffset        = X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_V2
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 50.0
  GeometryHeight        = 60.0
  GeometryOffset        = X:0 Y:0 Z:0


  GeometryIsSmall       = No
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion        = PLACED_BY_PLAYER

  GeometryContactPoint = X:-49.644    Y:19.165    Z:0        Repair
  GeometryContactPoint = X:49.096    Y:-20.653    Z:0        Repair
  GeometryContactPoint = X:-9.861    Y:51.413    Z:0
  GeometryContactPoint = X:-33.314    Y:-54.902    Z:0
  GeometryContactPoint = X:-20.106    Y:-25.298    Z:89.3    Swoop
End

;------------------------------------------------------------------------------

;------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;Gondor Standalone battle tower
Object AncientTowerold 
 
 SelectPortrait = BPGBattleTower
 
    ; *** ART Parameters ***
    ButtonImage = BRBattleTower
      
    Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04
        ExtraPublicBone = ARROW_05
        ExtraPublicBone = ARROW_06
        ExtraPublicBone = ARROW_07
        ExtraPublicBone = ARROW_08
        ExtraPublicBone = ARROW_09
        ExtraPublicBone = ARROW_10
        ExtraPublicBone = ARROW_11
        ExtraPublicBone = ARROW_12
        
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = RuinTwr
            WeaponLaunchBone = PRIMARY ARROW_
        End

        IdleAnimationState
            Animation = IDLE
                AnimationName =    GBBtlTwrS.GBBtlTwrS
                AnimationMode =    LOOP    
            End        
            ;BeginScript
            ;    CurDrawableHideSubObject("B_FLAGBASE")
            ;EndScript
        End    
    
   
        ;---------------damage states-- garrisoned---------------
        
        ;--damaged building
        ModelConditionState  = GARRISONED DESTROYED_FRONT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
             ParticleSysBone FireLarge01 FireBuildingLarge
             ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_FRONT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
        End
    
        ModelConditionState  = GARRISONED DESTROYED_RIGHT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_RIGHT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
        End
        

        ModelConditionState  = GARRISONED DESTROYED_BACK
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_BACK
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
        End

        ModelConditionState  = GARRISONED DESTROYED_LEFT
        Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = GARRISONED DESTROYED_LEFT
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
        End

        AnimationState = GARRISONED DAMAGED
            StateName = GarrisonedDamaged
            Animation           = RuinTwr_D
                AnimationName     = RuinTwr_D.RuinTwr_D
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "Damaged" and Prev ~= "GarrisonedReallyDamaged" and Prev ~= "TRANS_Damaged" then CurDrawableSetTransitionAnimState("TRANS_Damaged") end    
            EndScript
        End
        

        AnimationState = GARRISONED REALLYDAMAGED
            StateName = GarrisonedReallyDamaged
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "ReallyDamaged" and Prev ~= "TRANS_ReallyDamaged" then CurDrawableSetTransitionAnimState("TRANS_ReallyDamaged") end    
            EndScript
        End
    
        AnimationState = GARRISONED RUBBLE
            Animation    = RuinTwr_D.RuinTwr_D
                AnimationName        =    RuinTwr_D.RuinTwr_D
                AnimationMode        =    LOOP    
            End    
            BeginScript
                CurDrawableHideSubObject("D2A")
                CurDrawableHideSubObject("D2B")
                CurDrawableHideSubObject("D2C")
                CurDrawableHideSubObject("D2D")
            EndScript
        End

        AnimationState = GARRISONED CONSTRUCTION_COMPLETE
            Animation           = RuinTwr
                AnimationName     = RuinTwr.RuinTwr
                AnimationMode     = LOOP
            End
        End

        AnimationState = GARRISONED
            Animation           = RuinTwr
                AnimationName     = RuinTwr.RuinTwr
                AnimationMode     = LOOP
            End
        End

    
        ;---------------damage states- non-garrisoned----------------
        
        ;--damaged building
        ModelConditionState  = DESTROYED_FRONT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
             ParticleSysBone FireLarge01 FireBuildingLarge
             ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_FRONT
            BeginScript
                CurDrawableHideSubObject("D2A")
            EndScript
        End
        
        ModelConditionState  = DESTROYED_RIGHT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
    
        AnimationState = DESTROYED_RIGHT
            BeginScript
                CurDrawableHideSubObject("D2B")
            EndScript
        End
    

        ModelConditionState  = DESTROYED_BACK
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_BACK
            BeginScript
                CurDrawableHideSubObject("D2C")
            EndScript
        End

        ModelConditionState  = DESTROYED_LEFT
            Model         = RuinTwr_D  
            ParticleSysBone FireSmall01 FireBuildingSmall
            ParticleSysBone FireSmall02 FireBuildingSmall
            ParticleSysBone FireSmall03 FireBuildingSmall
            ParticleSysBone FireSmall04 FireBuildingSmall
            ParticleSysBone FireMedium01 FireBuildingMedium
            ParticleSysBone FireMedium02 FireBuildingMedium
            ParticleSysBone FireLarge01 FireBuildingLarge
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = DESTROYED_LEFT
            BeginScript
                CurDrawableHideSubObject("D2D")
            EndScript
        End
    
    
        ModelConditionState  = DAMAGED 
            Model         = RuinTwr_D
        End 
        AnimationState = DAMAGED
            StateName = Damaged
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "GarrisonedDamaged" and Prev ~= "ReallyDamaged" and Prev ~= "TRANS_Damaged" then CurDrawableSetTransitionAnimState("TRANS_Damaged") end    
            EndScript
        End

        AnimationState = REALLYDAMAGED
            StateName = ReallyDamaged
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "GarrisonedReallyDamaged" and Prev ~= "TRANS_ReallyDamaged" then CurDrawableSetTransitionAnimState("TRANS_ReallyDamaged") end    
            EndScript
        End

   

        ModelConditionState  = REALLYDAMAGED 
            Model         = RuinTwr_D
            ParticleSysBone None FireBuildingLarge
            ParticleSysBone None SmokeBuildingLarge
        End    
    

        ModelConditionState  = RUBBLE
            Model         = RuinTwr_D  
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
    

        AnimationState = RUBBLE
            BeginScript
                CurDrawableHideSubObject("D2A")
                CurDrawableHideSubObject("D2B")
                CurDrawableHideSubObject("D2C")
                CurDrawableHideSubObject("D2D")
            EndScript
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
    
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End
        
        
        
        TransitionState = TRANS_Damaged
            StateName = TRANS_Damaged
            EnteringStateFX    = FX_BuildingDamaged
        End
        
        TransitionState = TRANS_ReallyDamaged
            StateName = TRANS_ReallyDamaged
            EnteringStateFX    = FX_BuildingReallyDamaged
        End
        

    End ; draw
    
    Draw = W3DFloorDraw ModuleTag_DrawFloor    
        StaticModelLODMode = Yes        ; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = GBBeacon_Bib
    End

  


    ; ***DESIGN parameters ***
    DisplayName         = OBJECT:RuinedTower
    Side                = Eriador
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0
     
    BuildCost           = 66 ;M_GONDOR_BATTLETOWER_BUILDCOST
    BuildTime           = 15.0           ; in seconds
    VisionRange         = M_VISION_BASE_DEFENSE
     ShroudClearingRange = M_SHROUD_CLEAR_BASE_DEFENSE    
     CommandSet            = NeutralBattleTowerCommandSet
 
       ArmorSet
        Conditions        = None
        Armor             = StructureArmor
        ;DamageFX          = StructureDamageFXNoShake
    End

    ; *** AUDIO Parameters ***

    VoiceSelect                = RuinedTowerVoiceSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    ;UnitSpecificSounds
    ;End


    ; *** ENGINEERING Parameters ***

    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION GARRISON CAN_ATTACK GARRISONABLE_UNTIL_DESTROYED MADE_OF_STONE CHUNK_VENDOR ALWAYS_SHOW_HOUSE_COLOR GARRISONABLE_UNTIL_DESTROYED
     
    Behavior            = GettingBuiltBehavior ModuleTag_04
        WorkerName        = GondorWorkerNoSelect
        EvilWorkerName    = MordorWorkerNoSelect
        TestFaction        = Yes
    End


    Body                        = StructureBody ModuleTag_05
        MaxHealth                 = 3000.0
        MaxHealthDamaged          = 2000.0
        MaxHealthReallyDamaged    = 1000.0
        DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK

        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabOffset = X:16 Y:0      
                    
        DamageCreationList = OCL_GBBtlTwrSD2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
        DamageCreationList = OCL_GBBtlTwrSD2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
        DamageCreationList = OCL_GBBtlTwrSD2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
        DamageCreationList = OCL_GBBtlTwrSD2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = WINDOW_N01
        ;FireWindowName          = WINDOW_F01
        ;GlowWindowName        = WINDOW_G01
    End
 
    Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
        DestructionDelay  = 5000
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
         AutoAcquireEnemiesWhenIdle    = No
        AILuaEventsList                = GarrisonableFunctions
     End
      
    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL FX_StructureMediumCollapse
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End 

    Behavior       = EvacuateDamage ModuleTag_evacuateDamage
        WeaponThatCausesEvacuation  = MordorCatapultHumanHeads
    End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired = ANY +GondorMarketPlace
        RefundPercent = 50%
    End

    Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
         ObjectStatusOfContained    = UNSELECTABLE CAN_ATTACK ENCLOSED
         ContainMax              = 1
         MaxHordeCapacity        = 1
         DamagePercentToUnits    = 0%
         PassengerFilter            = ANY +INFANTRY +BANNER +MordorHaradrim -CAVALRY -SUMMONED -COMBO_HORDE
         AllowEnemiesInside      = No
         AllowNeutralInside      = Yes    ; Cause this structure is normally neutral.
         NumberOfExitPaths       = 1        ; Defaults to 1.  Set 0 to not use ExitStart/ExitEnd, set higher than 1 to use ExitStart01-nn/ExitEnd01-nn
         PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
         EntryPosition            = X:0.0 Y:0.0 Z:0.0
         EntryOffset                = X:0.0 Y:-45.0 Z:0.0
         ExitOffset                = X:0.0 Y:-80.0 Z:0.0
         EnterSound                = RuinedTowerEnterSound
         KillPassengersOnDeath    = No
         ShowPips                = No
         ExitDelay                = 250
       End

    AttackContactPoint = X:-24 Y:-24 Z:99
    GeometryContactPoint = X:-39 Y:-39 Z:0 Repair
    GeometryContactPoint = X: 39 Y:-39 Z:0 Repair
    GeometryContactPoint = X:-39 Y: 39 Z:0 Repair
    GeometryContactPoint = X:10 Y: 10 Z:0 Bomb

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry    = Geom_Orig
        HideGeometry    = Geom_V2 
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls 
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry    = Geom_Orig
        HideGeometry    = Geom_V2 
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower 
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry    = Geom_V2
        HideGeometry    = Geom_Orig
    End

  ;; This is required for setting rally points which needs a small geometry to determine if quick path exists in tight spaces
  ;; If this was any bigger, it would fail to create the rallu points when in a camp or castle.
  Geometry              = CYLINDER
  GeometryMajorRadius   = 8.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 10

  ;; This is required for setting rally points which needs a small geometry to determine if quick path exists in tight spaces
  ;; If this was any bigger, it would fail to create the rallu points when in a camp or castle.
  Geometry              = CYLINDER
  GeometryMajorRadius   = 8.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 10

  ;; These are the actual building geometry pieces
  AdditionalGeometry    = BOX
  GeometryName            = Geom_Orig
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 75.0
  GeometryOffset        = X:0 Y:0 Z:0
;  GeometryOffset        = X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_Orig
  GeometryMajorRadius   = 25.0
  GeometryMinorRadius   = 30.0
  GeometryHeight        = 20.0
  GeometryOffset        = X:0 Y:0 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_V2
  GeometryMajorRadius   = 20.0
  GeometryMinorRadius   = 20.0
  GeometryHeight        = 105.0
  GeometryOffset        = X:-22 Y:-30 Z:0

  AdditionalGeometry    = BOX
  GeometryName            = Geom_V2
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 50.0
  GeometryHeight        = 60.0
  GeometryOffset        = X:0 Y:0 Z:0


  GeometryIsSmall       = No
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion        = PLACED_BY_PLAYER

  GeometryContactPoint = X:-49.644    Y:19.165    Z:0        Repair
  GeometryContactPoint = X:49.096    Y:-20.653    Z:0        Repair
  GeometryContactPoint = X:-9.861    Y:51.413    Z:0
  GeometryContactPoint = X:-33.314    Y:-54.902    Z:0
  GeometryContactPoint = X:-20.106    Y:-25.298    Z:89.3    Swoop
    
End

Object AncientTower_Egg
    Draw = W3DScriptedModelDraw ModuleTag_Draw
        DefaultModelConditionState
            Model = None
        End
    End
    KindOf = INERT IMMOBILE UNATTACKABLE
    
    Body = ActiveBody ModuleTag_MakesKillWork
        MaxHealth = 1
    End
    Behavior = LifetimeUpdate ModuleTag_HatchTrigger
        MinLifetime = 0.1
        MaxLifetime = 0.1
    End
    Behavior = SlowDeathBehavior ModuleTag_HatchProcess
        DestructionDelay = 1
        OCL = FINAL OCL_SpawnAncientTowerEgg_Final
    End
End
