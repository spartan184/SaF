;------------------------------------------------------------------------------
;Helms Deep Culvert
Object FakePosternGate

SelectPortrait = BPRHelmsDeep
 
	; *** ART Parameters ***
	;  SelectPortrait         = SNReactor_L
	;  ButtonImage            = SNReactor
	;day
	
	Draw = W3DScriptedModelDraw ModuleTag_W3DModelDrawInWorldBuilder
		;When in Worldbuilder, show the mounted version of Eomer!
		
		DefaultModelConditionState
			Model = RBHDDWCulvPst ;None
		End
		ModelConditionState = WORLD_BUILDER
			Model = RBHDDWCulvPst
		End		
	End
	
	;----------------------------------------------------------------------------------------------
	Draw = W3DScriptedModelDraw Draw_PosternGate
		ExtraPublicBone = Post01
		ExtraPublicBone = Post02
		ExtraPublicBone = Post03
		ExtraPublicBone = Post04

		DefaultModelConditionState
			Model			= None ;hdfakegate ;
		End
	End
  
	PlacementViewAngle  = 0
	 
	; ***DESIGN parameters ***
	DisplayName	= OBJECT:HelmsDeepCulvert
	Side			= Rohan
	EditorSorting	= STRUCTURE
	Browser		= REGION Helms_Deep STRUCTURE
	ThreatLevel	= 1.0
	VisionRange         = 160.0          ; Shroud clearing distance
	ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

;  VoiceSelect         = NuclearReactorSelect
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 

	; *** ENGINEERING Parameters ***

	RadarPriority	= NOT_ON_RADAR
	KindOf			= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE SELECTABLE 
 	CommandSet		= PosternGateCommandSet

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

	Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
	End
	
	Behavior = DynamicPortalBehaviour PosternGatePortal
		TriggeredBy				= Upgrade_PosternGate
		ConflictsWith			= Upgrade_OpenGarrison Upgrade_TrebuchetTurret
		CustomAnimAndDuration	= AnimState:UPGRADE_POSTERN_GATE AnimTime:0
		
		AllowKindOf		= INFANTRY CAVALRY
		RejectKindOf	= MONSTER MACHINE ARMY_OF_DEAD
		BonePrefix		= Post
		NumberOfBones	= 4
		WayPoint		= Index:0	Type:Walk	; 0
		WayPoint		= Index:1	Type:Walk	; 1
		WayPoint		= Index:2	Type:Walk	; 2
		WayPoint		= Index:3	Type:Walk	; 3
		WayPoint		= Index:2	Type:Walk	; 4
		WayPoint		= Index:1	Type:Walk	; 5
		Link			= From:0 Via:4 Via:5 To:3
		Link			= From:3 Via:1 Via:2 To:0
	End
	
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		; nothing, but is required if we have any Object-level Upgrades!
	End

	Body                  = ActiveBody ModuleTag_B_03
		MaxHealth       = 6000.0
		MaxHealthDamaged = 3000
		MaxHealthReallyDamaged = 1000
	    
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0    
	End

	ArmorSet
		Conditions        = None
		Armor             = HelmsDeepWalls
		DamageFX          = None
	End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	GeometryContactPoint = X:80 Y:0 Z:60 Menu ;<-- where to draw the radial menu

	Geometry              = BOX
	GeometryMajorRadius   = 222.0
	GeometryMinorRadius   = 46.0
	GeometryHeight        = 62.0
	GeometryOffset		  = X:0 Y:12 Z:0	
	GeometryIsSmall       = No
	Shadow                = SHADOW_VOLUME
End

;------------------------------------------------------------------------------
;Helms Deep Section C
Object HelmsDeepSectionCNew

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState
      Model = hddwramp
    End
    
    ;--damaged building
  
    ModelConditionState  = DAMAGED
      Model         = hddwramp_d1  
    End
    
    
    AnimationState = DAMAGED
      EnteringStateFX = FX_MinWallATransitionDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = hddwramp_d2
    End
    AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
		AnimationName		=	 hddwramp_d2.hddwramp_d2
		AnimationMode		=	ONCE
                AnimationSpeedFactorRange = 0.5 0.5
   	End
        EnteringStateFX = FX_MinWallATransitionReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = hddwramp_d3
    End
    
    AnimationState = RUBBLE
		Animation				=	Death
			AnimationName		=	hddwramp_d3.hddwramp_d3
			AnimationMode		=	ONCE
            AnimationSpeedFactorRange = 0.5 0.5
		End
        EnteringStateFX = FX_MinWallATransitionRubble
    End      

    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
          
    WallBoundsMesh = P1
    RampMesh1 = P2
    
  End
  
  	Draw = W3DScriptedModelDraw ModuleTag_W3DModelDrawInWorldBuilder
		;When in Worldbuilder, show the mounted version of Eomer!
		
		OkToChangeModelColor = Yes
		
		DefaultModelConditionState
			Model = None
		End
		ModelConditionState = WORLD_BUILDER
			Model = hddwrampWB
		End		
	End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepSectionC
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

;  VoiceSelect         = NuclearReactorSelect
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 

  ; *** ENGINEERING Parameters ***

  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI;SELECTABLE;@1
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

;  Behavior            = DestroyDie ModuleTag_07
;    ;nothing
;  End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

; 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
;		DeathTypes		= ALL
;		StartsActive	= Yes
;		DeathWeapon		= WallDeath
;	End	

	Geometry              = BOX
	GeometryMajorRadius   = 110.0
	GeometryMinorRadius   = 50.0
	GeometryHeight        = 75.0
	GeometryOffset		= X:26 Y:11.0 Z:0

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 70.0
	GeometryOffset		  = X:-50.0 Y:15.0 Z:0

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 60.0
	GeometryOffset		  = X:50.0 Y:15.0 Z:0
			
	GeometryIsSmall       = No
	GeometryFrontAngle    = 90.0
	Shadow                = SHADOW_VOLUME
  
	GeometryContactPoint = X:30   Y:67  Z:0 Grab
	GeometryContactPoint = X:90  Y:-47 Z:0 Grab
	GeometryContactPoint = X:90  Y:-38 Z:10 
	GeometryContactPoint = X:20   Y:-38 Z:70
	GeometryContactPoint = X:0  Y:-38 Z:10
	GeometryContactPoint = X:-25 Y:-38 Z:70
	GeometryContactPoint = X:-50  Y:-38 Z:10
	GeometryContactPoint = X:-50  Y:-47 Z:0 Grab
	GeometryContactPoint = X:-50  Y:67  Z:0 Grab
End

;------------------------------------------------------------------------------
;Helms Deep Gatehouse
Object HelmsDeepGatehouseRightNew

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdgater
    End
    
    
    ModelConditionState  = DAMAGED
      Model         = rnhdgater ;RBHDGatHsR_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = rnhdgater ;RBHDGatHsR_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = rnhdgater ;RBHDGatHsR_D1   
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
                                    
    WallBoundsMesh = P1
    RampMesh1 = P2
    RaisedWallMesh = P3
    
  End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepGatehouseRight
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

;  VoiceSelect         = NuclearReactorSelect
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 

  ; *** ENGINEERING Parameters ***

  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI ;SELECTABLE;@1
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = No   ; ??? Not sure, Helm's Deep doesn't support EVA CastleBreached anyway
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

  Geometry              = BOX
  GeometryMajorRadius   = 74.0
  GeometryMinorRadius   = 95.0
  GeometryHeight        = 140.0


	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 85.0
	GeometryOffset		  = X:12.0 Y:-25.0 Z:0	

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 85.0
	GeometryOffset		  = X:-60.0 Y:40.0 Z:0	

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 120.0
	GeometryOffset		  = X:20.0 Y:40.0 Z:0	

  
  GeometryIsSmall       = No
  GeometryFrontAngle    = -90.0
  Shadow                = SHADOW_VOLUME
  
  GeometryContactPoint = X:20  Y:-75 Z:0 Grab
  GeometryContactPoint = X:0  Y:40 Z:120
  GeometryContactPoint = X:-55  Y:-35 Z:0 Grab
  ;GeometryContactPoint = X:-60  Y:25 Z:92 Grab
End

;------------------------------------------------------------------------------
;Helms Deep Gate do SectionA2
Object HelmsDeepdoSectionA2New

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdowall1
    End
    
    ModelConditionState  = DAMAGED
      Model         = hdowall1 ;RBHDOSecA2_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = hdowall1 ;RBHDOSecA2_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = hdowall1 ;RBHDOSecA2_D1  
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
    
    WallBoundsMesh = P1
       
  End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepdoSectionA2
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***
;  VoiceSelect         = NuclearReactorSelect
;  SoundOnDamaged        = BuildingDamagedStateLight
;  SoundOnReallyDamaged  = BuildingDestroy
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 
  ; *** ENGINEERING Parameters ***
  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI ;SELECTABLE;@1  
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

  Behavior            = DestroyDie ModuleTag_07
    ;nothing
  End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Geometry              = BOX
	GeometryMajorRadius   = 130.0
	GeometryMinorRadius   = 55.0
	GeometryHeight        = 90.0
	GeometryOffset		= X:0 Y:14 Z:0

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:-80.0 Y:15.0 Z:0	

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:0.0 Y:15.0 Z:0	

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:80.0 Y:15.0 Z:0	
		
	GeometryIsSmall       = No
	GeometryFrontAngle    = -90.0
	Shadow                = SHADOW_VOLUME
	
	GeometryContactPoint = X:-110  Y:-47 Z:0 Grab
	GeometryContactPoint = X:0  Y:0 Z:85 Grab
	GeometryContactPoint = X:110  Y:-47 Z:0 Grab
End

ChildObject HelmsDeepdoSectionB1New HelmsDeepdoSectionA2New

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdowall2
    End
    
    ModelConditionState  = DAMAGED
      Model         = hdowall2 ;RBHDOSecA2_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = hdowall2 ;RBHDOSecA2_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = hdowall2 ;RBHDOSecA2_D1  
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
    
	WallBoundsMesh = P1
       
  End
  
 End


;------------------------------------------------------------------------------
;Helms Deep Gate do SectionB1
Object HelmsDeepdoSectionB1NewV

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdowall2
    End
    
    ModelConditionState  = DAMAGED
      Model         = hdowall2 ;RBHDOSecB1_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = hdowall2 ;RBHDOSecB1_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = hdowall2 ;RBHDOSecB1_D1  
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
             
    WallBoundsMesh = P1
      
  End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepdoSectionB1
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***
;  VoiceSelect         = NuclearReactorSelect
;  SoundOnDamaged        = BuildingDamagedStateLight
;  SoundOnReallyDamaged  = BuildingDestroy
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 
  ; *** ENGINEERING Parameters ***
  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI ;SELECTABLE;@1 
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

  Behavior            = DestroyDie ModuleTag_07
    ;nothing
  End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

  Geometry              = BOX
  GeometryMajorRadius   = 130.0
  GeometryMinorRadius   = 85.0
  GeometryHeight        = 90.0
  GeometryOffset		= X:0 Y:-10 Z:0

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:-80.0 Y:15.0 Z:0	
	  
	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:0.0 Y:15.0 Z:0	  

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:80.0 Y:15.0 Z:0	  

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:40.0 Y:-60.0 Z:0	  
  
  GeometryIsSmall       = No
  GeometryFrontAngle    = -90.0
  Shadow                = SHADOW_VOLUME
  
  GeometryContactPoint = X:-100  Y:-20 Z:0 Grab
  GeometryContactPoint = X:-20  Y:0 Z:75 Grab
  GeometryContactPoint = X:30  Y:-93 Z:0 Grab
  GeometryContactPoint = X:120  Y:-30 Z:0 Grab
End
;------------------------------------------------------------------------------
;Helms Deep Gate do SectionD
Object HelmsDeepdoSectionDNew

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdowall3 ;RBHDOSecD
    End
    
    ModelConditionState  = DAMAGED
      Model         = hdowall3 ;RBHDOSecD_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = hdowall3 ;RBHDOSecD_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = hdowall3 ;RBHDOSecD_D1  
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
                     
    WallBoundsMesh = P2
    RampMesh1 = P1
      
  End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepdoSectionD
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***
;  VoiceSelect         = NuclearReactorSelect
;  SoundOnDamaged        = BuildingDamagedStateLight
;  SoundOnReallyDamaged  = BuildingDestroy
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 
  ; *** ENGINEERING Parameters ***
  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI ;SELECTABLE;@1  
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

  Behavior            = DestroyDie ModuleTag_07
    ;nothing
  End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

  Geometry              = BOX
  GeometryMajorRadius   = 92.0
  GeometryMinorRadius   = 107.0
  GeometryHeight        = 90.0

	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:65.0 Y:-130.0 Z:0	
	
	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:65.0 Y:-50.0 Z:0	
	
	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:65.0 Y:35.0 Z:0	
	
	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:65.0 Y:120.0 Z:0	  
	
	AdditionalGeometry    = CYLINDER
	GeometryMajorRadius   = 40.0
	GeometryMinorRadius   = 40.0
	GeometryHeight        = 80.0
	GeometryOffset		  = X:-15.0 Y:60.0 Z:0	
	
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  
  ;HelmsDeepdoSectionD Grab points for rock wielding ents
  GeometryContactPoint = X:-75 Y:30   Z:0 Grab  
  GeometryContactPoint = X:-65 Y:30   Z:70
  GeometryContactPoint = X:15  Y:30   Z:70
  GeometryContactPoint = X:21  Y:-120 Z:0 Grab
  
  
End
;------------------------------------------------------------------------------
;Helms Deep Gate do StairsA1
Object HelmsDeepdoStairsA1New

SelectPortrait = BPRHelmsDeep
 
  ; *** ART Parameters ***
;  SelectPortrait         = SNReactor_L
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdowallstair
    End
    
    ModelConditionState  = DAMAGED
      Model         = hdowallstair ;RBHDOStA1_D1  
    End
    
    ModelConditionState  = REALLYDAMAGED
      Model         = hdowallstair ;RBHDOStA1_D1  
    End
	
    ModelConditionState  = RUBBLE
      Model         = hdowallstair ;RBHDOStA1_D1  
    End
    
    ModelConditionState  = POST_RUBBLE
		Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
		 Model         = None
    End
                             
    WallBoundsMesh = P2
    RampMesh1 = P1
;    RampMesh2 = P3
      
  End
  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:HelmsDeepdoStairsA1
  Side                = Rohan
  EditorSorting       = STRUCTURE
  Browser = REGION Helms_Deep STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160



; For Testing Purposes


; *** AUDIO Parameters ***
;  VoiceSelect         = NuclearReactorSelect
;  SoundOnDamaged        = BuildingDamagedStateLight
;  SoundOnReallyDamaged  = BuildingDestroy
 
;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End
 
  ; *** ENGINEERING Parameters ***
  RadarPriority       = NOT_ON_RADAR
  KindOf              = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR  NOT_AUTOACQUIRABLE IGNORED_IN_GUI ;SELECTABLE;@1 
 
  Behavior = CastleMemberBehavior ModuleTag_CMB
  End 

  ; Immortal because they can't be destroyed, only damaged.  
  Body                  = ImmortalBody ModuleTag_B_03
    MaxHealth       = 6000.0
    MaxHealthDamaged = 3000
    MaxHealthReallyDamaged = 1000
    
    GrabObject = EntThrownBuildingRock
	GrabFX = FX_WallGrab
	GrabDamage = 490
	GrabOffset = X:16 Y:0    
  End

  ArmorSet
    Conditions        = None
    Armor             = HelmsDeepWalls
    DamageFX          = None
  End

  Behavior            = DestroyDie ModuleTag_07
    ;nothing
  End
 
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= HelmsDeepWallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Geometry              = BOX
	GeometryMajorRadius   = 70.0
	GeometryMinorRadius   = 50.0
	GeometryHeight        = 25.0
	GeometryOffset		= X:-10 Y:0 Z:0
	GeometryIsSmall       = No
	Shadow                = SHADOW_VOLUME
	
	GeometryContactPoint = X:-10 Y:55  Z:0 Grab
	GeometryContactPoint = X:-10 Y:48  Z:0 
	GeometryContactPoint = X:-10 Y:48  Z:25 
	GeometryContactPoint = X:25 Y:-48  Z:25 
	GeometryContactPoint = X:65 Y:48  Z:25 
	GeometryContactPoint = X:65 Y:58  Z:0 
	GeometryContactPoint = X:65  Y:55  Z:0 Grab
End
;------------------------------------------------------------------------------
;Rohan Wall Elevator
Object FakePosternGate2
 
  ; *** ART Parameters ***
SelectPortrait = BRCastleWall
;  ButtonImage            = SNReactor
  ;day

  Draw = W3DScriptedModelDraw ModuleTag_01

		ExtraPublicBone = Post01
		ExtraPublicBone = Post02
		ExtraPublicBone = Post03
		ExtraPublicBone = Post04

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    DefaultModelConditionState
      Model = hdfakegate ;RBWallElev
    End
    
		ModelConditionState = WORLD_BUILDER
			Model = hdfakegate ;RBHDDWCulvPst
		End	
	
    WallBoundsMesh = P1
        
  End
 


  
  PlacementViewAngle  = 0
 
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:RohanWall
  Side                = Rohan
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0
 
  BuildCost           = 1
  BuildTime           = 5.0           ; in seconds
  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160

  ArmorSet
    Conditions = None
    Armor = StructureArmor
  End
  
  CommandSet = EmptyCommandSet


  ; *** AUDIO Parameters ***

	SoundOnDamaged		= BuildingLightDamageWood
	SoundOnReallyDamaged	= BuildingHeavyDamageWood


;  VoiceSelect         = NuclearReactorSelect

;  UnitSpecificSounds
;  UnderConstruction     = UnderConstructionLoop
;  End


  ; *** ENGINEERING Parameters ***

	KindOf				= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR NOT_AUTOACQUIRABLE MADE_OF_WOOD
	RadarPriority		= STRUCTURE
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= 3000.0
		
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End
	
	Behavior = DynamicPortalBehaviour PosternGatePortal
		TriggeredBy				= Upgrade_PosternGate
		ConflictsWith			= Upgrade_OpenGarrison Upgrade_TrebuchetTurret
		CustomAnimAndDuration	= AnimState:UPGRADE_POSTERN_GATE AnimTime:0
		
		AllowKindOf		= INFANTRY CAVALRY
		RejectKindOf	= MONSTER MACHINE ARMY_OF_DEAD
;		AllowEnemiesInside      = Yes
;		AllowNeutralInside      = Yes
		BonePrefix		= Post
		NumberOfBones	= 4
		WayPoint		= Index:0	Type:Walk	; 0
		WayPoint		= Index:1	Type:Walk	; 1
		WayPoint		= Index:2	Type:Walk	; 2
		WayPoint		= Index:3	Type:Walk	; 3
		WayPoint		= Index:2	Type:Walk	; 4
		WayPoint		= Index:1	Type:Walk	; 5
		Link			= From:0 Via:4 Via:5 To:3
		Link			= From:3 Via:1 Via:2 To:0
	End

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 50.0
	GeometryMinorRadius				= 44.0
	GeometryHeight					= 76.0
	GeometryIsSmall					= No
	
	GeometryContactPoint =	X:0			Y:0				Z:70 
	GeometryContactPoint =	X:0			Y:0				Z:0 
	GeometryContactPoint =	X:45		Y:0				Z:0 Grab
	GeometryContactPoint =	X:-45		Y:0				Z:0 Grab
	GeometryContactPoint =	X:0			Y:55			Z:0 Grab
	GeometryContactPoint =	X:0		Y:-45				Z:0 Grab
  
	Shadow							= SHADOW_VOLUME
End

;--------------------------------------------------------------------------------------------------------------------

Object FakePosternGateAgain
SelectPortrait = BRCastleWall
	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw Draw_Trebuchet
		OkToChangeModelColor = Yes

		; Don't want to change the hidden state of this when the postern gate is stealthed.
		AffectedByStealth = No
				
		DefaultModelConditionState
			Model = hdfakegate ;RBCastFlag_A		
		End

		ModelConditionState = WORLD_BUILDER
  			Model = hdfakegate ;RBCastFlagW
  		End

		IdleAnimationState
			StateName = Complete
			BeginScript
				CurDrawableHideModule("Draw_Trebuchet")
			EndScript
		End

		ModelConditionState  = SOLD
			Model = RBCastFlag_A  
		End
 		AnimationState = SOLD
 			Animation
 				AnimationName = RBCastFlag_A.RBCastFlag_A
 				AnimationMode = ONCE_BACKWARDS
 				AnimationSpeedFactorRange = 3.0 3.0
 			End
 			Flags = START_FRAME_LAST
			EnteringStateFX = FX_BuildingContructDustRohanCastles
		End
 

		ModelConditionState  = UPGRADE_TREBUCHET DAMAGED
			Model         = RBCastFlag_D1  
			ParticleSysBone	    = NONE WallUpgHeroFX
		End
	    
		AnimationState = UPGRADE_TREBUCHET DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = UPGRADE_TREBUCHET REALLYDAMAGED
			Model = RBCastFlag_D2
			ParticleSysBone	    = NONE WallUpgHeroFX
		End
		
		AnimationState = UPGRADE_TREBUCHET REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	RBCastFlag_D2.RBCastFlag_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = UPGRADE_TREBUCHET RUBBLE
		Model         = RBCastFlag_D3
		End
	    
		AnimationState = UPGRADE_TREBUCHET RUBBLE
			StateName = Complete
			Animation				=	Death
				AnimationName		=	RBCastFlag_D3.RBCastFlag_D3
				AnimationMode		=	ONCE
			End
	;        EnteringStateFX = FX_RohanWallRubble
			EnteringStateFX = FX_WallDie
		End      

		ModelConditionState  = UPGRADE_TREBUCHET POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = UPGRADE_TREBUCHET POST_COLLAPSE
			Model         = None
		End	

		ModelConditionState = UPGRADE_TREBUCHET
			Model = RBCastFlag_A
			ParticleSysBone	    = NONE WallUpgHeroFX	
		End	

		TransitionState = TRANS_IdleToBuild
			Animation
				AnimationName	=	RBCastFlag_A.RBCastFlag_A
				AnimationMode	=	ONCE
				AnimationSpeedFactorRange	= GONDOR_WALLTREBUCHET_BUILD_SPEED GONDOR_WALLTREBUCHET_BUILD_SPEED
			End
			EnteringStateFX = FX_BuildingContructDustRohanCastles
		End

		AnimationState = UPGRADE_TREBUCHET
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Complete" then CurDrawableSetTransitionAnimState("TRANS_IdleToBuild") end
			EndScript
			Flags = START_FRAME_LAST
			Animation
				AnimationName = RBCastFlag_A.RBCastFlag_A
				AnimationMode = ONCE
			End
		End
	
	End

		
	;----------------------------------------------------------------------------------------------
	Draw = W3DScriptedModelDraw Draw_Picker
	
		; Don't want to change the hidden state of this when the postern gate is stealthed.
		AffectedByStealth = No
		
		DefaultModelConditionState
			Model = RBCastWallOB
		End

	End
	
	;----------------------------------------------------------------------------------------------
	Draw = W3DScriptedModelDraw Draw_Decal
	
		; Don't want to change the hidden state of this when the postern gate is stealthed.
		AffectedByStealth = No
	
		DefaultModelConditionState
			Model = RBCastWallBF
		End

		IdleAnimationState
			BeginScript
				CurDrawableShowModule("Draw_Decal")
 				CurDrawableShowModule("Draw_Picker")
 			EndScript
 		End
 
 		AnimationState  = JUST_BUILT
			BeginScript
				CurDrawableHideModule("Draw_Decal")
				CurDrawableShowModule("Draw_Picker")
			EndScript
		End

 		AnimationState  = SOLD
 			BeginScript
 				CurDrawableHideModule("Draw_Decal"); since the command is not yet available
			EndScript
		End

 		AnimationState  = RUBBLE
 			BeginScript
 				CurDrawableHideModule("Draw_Decal")
 				CurDrawableHideModule("Draw_Picker")
			EndScript
		End

		AnimationState  = UPGRADE_POSTERN_GATE
			BeginScript
 				CurDrawableShowModule("Draw_PosternGate")
 				CurDrawableHideModule("Draw_Decal")			; Don't want to hide the decal cause this would give away our stealthed gate.
 				;			
 				CurDrawableHideModule("Draw_Tower")
 				CurDrawableHideModule("Draw_Trebuchet")
 				CurDrawableHideModule("Draw_Picker")
			EndScript
		End
		
		AnimationState  = UPGRADE_TREBUCHET
			BeginScript
 				CurDrawableShowModule("Draw_Trebuchet")
 				;			
 				CurDrawableHideModule("Draw_Decal")
 				CurDrawableHideModule("Draw_PosternGate")
 				CurDrawableHideModule("Draw_Tower")
 				CurDrawableHideModule("Draw_Picker")
			EndScript
		End
		
		AnimationState  = UPGRADE_GARRISON
			BeginScript
 				CurDrawableShowModule("Draw_Tower")
 				;			
 				CurDrawableHideModule("Draw_Decal")
 				CurDrawableHideModule("Draw_PosternGate")
 				CurDrawableHideModule("Draw_Trebuchet")
 				CurDrawableHideModule("Draw_Picker")
			EndScript
		End

	End
	
	;----------------------------------------------------------------------------------------------
	Draw = W3DScriptedModelDraw Draw_PosternGate

		ExtraPublicBone = Post01
		ExtraPublicBone = Post02
		ExtraPublicBone = Post03
		ExtraPublicBone = Post04

		DefaultModelConditionState
			Model = hdfakegate ;RBCastPOST
		End

		IdleAnimationState
			BeginScript
				CurDrawableHideModule("Draw_PosternGate")
			EndScript
		End
 
		ModelConditionState  = SOLD
			Model = hdfakegate ;RBCastPOST  
		End
 		AnimationState = SOLD
 			Animation
 				AnimationName = RBCastPOST.RBCastPOST
 				AnimationMode = ONCE_BACKWARDS
 				AnimationSpeedFactorRange = 3.0 3.0
 			End
			Flags = START_FRAME_LAST
			EnteringStateFX = FX_BuildingContructDustCastlesCentre
 		End
 
		ModelConditionState  = UPGRADE_POSTERN_GATE DAMAGED
			Model         = RBCastPOST_D1  
		End
	    
		AnimationState = UPGRADE_POSTERN_GATE DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = UPGRADE_POSTERN_GATE REALLYDAMAGED
			Model = RBCastPOST_D2
		End
		
		AnimationState = UPGRADE_POSTERN_GATE REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 RBCastPOST_D2.RBCastPOST_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = UPGRADE_POSTERN_GATE RUBBLE
		Model         = RBCastPOST_D3
		End
	    
		AnimationState = UPGRADE_POSTERN_GATE RUBBLE
			Animation				=	Death
				AnimationName		=	RBCastPOST_D3.RBCastPOST_D3
				AnimationMode		=	ONCE
			End
	;        EnteringStateFX = FX_RohanWallRubble
			EnteringStateFX = FX_WallDie
		End      

		ModelConditionState  = UPGRADE_POSTERN_GATE POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = UPGRADE_POSTERN_GATE POST_COLLAPSE
			Model         = None
		End		

		AnimationState = UPGRADE_POSTERN_GATE
			Animation
				AnimationName = RBCastPOST.RBCastPOST
				AnimationMode = ONCE
			End
			EnteringStateFX = FX_BuildingContructDustCastlesCentre
		End
	
	End
		
	;----------------------------------------------------------------------------------------------
	Draw = W3DScriptedModelDraw Draw_Tower

		ExtraPublicBone = ARROWBONE01
		ExtraPublicBone = ARROWBONE02
		ExtraPublicBone = ARROWBONE03
		ExtraPublicBone = ARROWBONE04
		ExtraPublicBone = ARROWBONE05
		ExtraPublicBone = ARROWBONE06
		ExtraPublicBone = ARROWBONE07
		ExtraPublicBone = ARROWBONE08
		ExtraPublicBone = ARROWBONE09
		ExtraPublicBone = ARROWBONE10
		ExtraPublicBone = ARROWBONE11
		ExtraPublicBone = ARROWBONE12
		ExtraPublicBone = ARROWBONE13
		ExtraPublicBone = ARROWBONE14

		; Don't want to change the hidden state of this when the postern gate is stealthed.
		AffectedByStealth = No

		DefaultModelConditionState
			Model = RBCastTOWR
			WeaponLaunchBone    = PRIMARY ARROWBONE
		End

		IdleAnimationState
			StateName = Complete
			BeginScript
				CurDrawableHideModule("Draw_Tower")
			EndScript
		End


		ModelConditionState  = SOLD
			Model = RBCastTOWR  
		End
 		AnimationState = SOLD
 			Animation
 				AnimationName = RBCastTOWR.RBCastTOWR
 				AnimationMode = ONCE_BACKWARDS
 				AnimationSpeedFactorRange = 3.0 3.0
 			End
			Flags = START_FRAME_LAST
 			EnteringStateFX = FX_BuildingContructDustRohanCastles
		End
 	

		ModelConditionState  = UPGRADE_GARRISON DAMAGED
			Model         = RBCastTOWR_D1  
		End
	    
		AnimationState = UPGRADE_GARRISON DAMAGED
	;      EnteringStateFX = FX_RohanWallDamaged
		End

		ModelConditionState  = UPGRADE_GARRISON REALLYDAMAGED
			Model         = RBCastTOWR_D2
		End
		
		AnimationState = UPGRADE_GARRISON REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	 RBCastTOWR_D2.RBCastTOWR_D2
				AnimationMode		=	ONCE
   			End
	;        EnteringStateFX = FX_RohanWallReallyDamaged
		End

		ModelConditionState  = UPGRADE_GARRISON RUBBLE
			Model         = RBCastTOWR_D3
		End
	    
		AnimationState = UPGRADE_GARRISON RUBBLE
			StateName = Complete
			Animation				=	Death
				AnimationName		=	RBCastTOWR_D3.RBCastTOWR_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX = FX_WallDie
		End      

		ModelConditionState  = UPGRADE_GARRISON POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = UPGRADE_GARRISON POST_COLLAPSE
			Model         = None
		End		

		TransitionState				=	TRANS_IdleToBuild
			Animation
				AnimationName		=	RBCastTOWR.RBCastTOWR
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= GONDOR_BATTLETOWER_BUILD_SPEED GONDOR_BATTLETOWER_BUILD_SPEED
			End
			EnteringStateFX = FX_BuildingContructDustRohanCastles
		End

		AnimationState = UPGRADE_GARRISON
			; If we're complete then transition via showing and build anim.
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Complete" then CurDrawableSetTransitionAnimState("TRANS_IdleToBuild") end
			EndScript
		
			Flags = START_FRAME_LAST
			Animation
				AnimationName = RBCastTOWR.RBCastTOWR
				AnimationMode = ONCE
			End

		End
		
	End


	ArmorSet
		Conditions	= None
		Armor		= RohanCastleWallUpgrade
		DamageFX	= RohanWallDamageFX
	End
	ArmorSet
		Conditions	= AS_TOWER
		Armor		= RohanCastleWallUpgradeAsTower
		DamageFX	= RohanWallDamageFX
	End



	WeaponSet
		Conditions			= None
	End
	WeaponSet
		Conditions			= PLAYER_UPGRADE
		Weapon				= PRIMARY CastleWallUpgradeBow
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End


	;----------------------- AUDIO -------------------------

	VoiceSelect				= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood

	VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	;UnitSpecificSounds
	;	UnderConstruction		= BuildingConstructionLoop
	;	UnderConstruction		= BuildingConstructionLoop  ; Built first time
	;	UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
	;	UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	;End

	; Change selection sounds based on upgrades
	ClientBehavior = UpgradeSoundSelectorClientBehavior ModuleTag_UpgradeSoundSelector
		SoundUpgrade = Upgrade_PosternGate								; EVERYTHING on this line must be present
			ExcludedUpgrades = Upgrade_OpenGarrison Upgrade_WallBanner			; NOTHING on this line can be present
			VoiceSelect = GondorPosternGateSelect
		End
		
		SoundUpgrade = Upgrade_OpenGarrison								; EVERYTHING on this line must be present
			ExcludedUpgrades = Upgrade_PosternGate Upgrade_WallBanner			; NOTHING on this line can be present
			VoiceSelect = RohanBattleTowerSelect
		End

		SoundUpgrade = Upgrade_WallBanner								; EVERYTHING on this line must be present
			ExcludedUpgrades = Upgrade_PosternGate Upgrade_OpenGarrison			; NOTHING on this line can be present
			VoiceSelect = GondorArmorySelect
		End
	End


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:RohanCastleWall
	EditorSorting	= STRUCTURE
	Side			= Rohan

	Body				= ActiveBody ModuleTag_02
		MaxHealth		= ROHAN_CASTLE_WALL_HEALTH
	End

	; ***ENGINEERING parameters ***
	Behavior = WallUpgradeUpdate ModuleTag_Update
	End

	Behavior = FoundationAIUpdate ModuleTag_FoundationAI
	End

	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
 		AutoAcquireEnemiesWhenIdle	= Yes
 		MoodAttackCheckRate			= 250
		AILuaEventsList				= GarrisonableFunctions
 	End
	
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		; nothing, but is required if we have any Object-level Upgrades!
	End
	
;	Behavior = GarrisonUpgrade TheGarrisonUpgrade
;		TriggeredBy				= Upgrade_OpenGarrison
;		ConflictsWith			= Upgrade_PosternGate Upgrade_WallBanner
;	End
	Behavior = WeaponSetUpgrade ModuleTag_Add5ArchersToAllKeepsAndBattleTowers
		TriggeredBy			= Upgrade_OpenGarrison
		ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
	End
	Behavior = CommandSetUpgrade ModueTag_GarrisonCommandSet
		TriggeredBy			= Upgrade_OpenGarrison
		ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
		CommandSet			= SellableCommandSet
	End	
	Behavior = GeometryUpgrade ModueTag_TowerGeom
		TriggeredBy			= Upgrade_OpenGarrison
		ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
		ShowGeometry		= TowerGeom
		HideGeometry		= DummyGeom TrebGeom
		CustomAnimAndDuration	= AnimState:UPGRADE_GARRISON AnimTime:0
	End
	Behavior = AttributeModifierUpgrade DontShootWhilstBuilding
		TriggeredBy			= Upgrade_OpenGarrison
		AttributeModifier	= PreventFromShooting
	End
	Behavior = ArmorUpgrade ArmorUpgradeModuleTag1
		TriggeredBy			= Upgrade_OpenGarrison
	    ArmorSetFlag		= AS_TOWER
	End
	Behavior = AudioLoopUpgrade ModuleTag_GarrisonBuildLoop
		; Play a "build loop" while the garrison is building up
		TriggeredBy			= Upgrade_OpenGarrison
		ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
		SoundToPlay			= BuildingConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 6166  ; Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
	End
	Behavior = TooltipUpgrade ModuleTag_GarrisonTooltip
		TriggeredBy				= Upgrade_OpenGarrison
		ConflictsWith			= Upgrade_PosternGate Upgrade_WallBanner
		DisplayName				= OBJECT:RohanBattleTower
		Description				= OBJECT:RohanBattleTowerDescription
	End

	; This isn't a geom upgrade, we just need something that doesn't do anything
	; to hook onto this upgrade.
	Behavior = GeometryUpgrade ModuleTag_FireArrows
		TriggeredBy			= Upgrade_BattleTowersToUseFireArrows
		ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
	End

	Behavior = GeometryUpgrade ModueTag_TrebGeom
		TriggeredBy				= Upgrade_WallBanner
		ConflictsWith			= Upgrade_PosternGate Upgrade_OpenGarrison
		CustomAnimAndDuration	= AnimState:UPGRADE_TREBUCHET AnimTime:0
		ShowGeometry			= TrebGeom
		HideGeometry			= DummyGeom TowerGeom
		WallBoundsMesh			= P4
		RampMesh1				= P2
		RampMesh2				= P3
	End
	Behavior = CommandSetUpgrade ModueTag_TrebCommandSet
		TriggeredBy			= Upgrade_WallBanner
		ConflictsWith		= Upgrade_PosternGate Upgrade_OpenGarrison
		CommandSet			= SellableCommandSet
	End
	Behavior = AttributeModifierUpgrade DontShootWhilstBuilding2	; Required for the buiding canceling - don't ask.
		TriggeredBy			= Upgrade_WallBanner
		AttributeModifier	= PreventFromShooting
	End
	Behavior = AudioLoopUpgrade ModuleTag_TrebBuildLoop
		; Play a "build loop" while the garrison is building up
		TriggeredBy			= Upgrade_WallBanner 
		ConflictsWith		= Upgrade_PosternGate Upgrade_OpenGarrison
		SoundToPlay			= BuildingConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 6166  ; Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
	End
	Behavior = ArmorUpgrade ArmorUpgradeModuleTag2
		TriggeredBy			= Upgrade_WallBanner
	    ArmorSetFlag		= AS_TOWER
	End
	Behavior = TooltipUpgrade ModuleTag_WallBannerTooltip
		TriggeredBy				= Upgrade_WallBanner
		ConflictsWith			= Upgrade_PosternGate Upgrade_OpenGarrison
		DisplayName				= OBJECT:RohanFlagTower
		Description				= OBJECT:RohanFlagTowerDescription
	End

	Behavior = DynamicPortalBehaviour PosternGatePortal
		TriggeredBy				= Upgrade_PosternGate
		ConflictsWith			= Upgrade_OpenGarrison Upgrade_WallBanner
		CustomAnimAndDuration	= AnimState:UPGRADE_POSTERN_GATE AnimTime:0
		ActivationDelaySeconds	= 7.0
		AllowEnemies				= Yes
		
		AllowKindOf		= INFANTRY CAVALRY
		RejectKindOf	= MONSTER MACHINE ARMY_OF_DEAD
		BonePrefix		= Post
		NumberOfBones	= 4
		WayPoint		= Index:0	Type:Walk	; 0
		WayPoint		= Index:1	Type:Walk	; 1
		WayPoint		= Index:2	Type:Walk	; 2
		WayPoint		= Index:3	Type:Walk	; 3
		WayPoint		= Index:2	Type:Walk	; 4
		WayPoint		= Index:1	Type:Walk	; 5
		Link			= From:0 Via:4 Via:5 To:3
		Link			= From:3 Via:1 Via:2 To:0
	End

	Behavior = CommandSetUpgrade ModueTag_PosternGateCommandSet
		TriggeredBy			= Upgrade_PosternGate
		ConflictsWith		= Upgrade_OpenGarrison Upgrade_WallBanner
		CommandSet			= SellableCommandSet
	End
	Behavior = AttributeModifierUpgrade DontShootWhilstBuilding3	; Required for the buiding canceling - don't ask.
		TriggeredBy			= Upgrade_PosternGate
		AttributeModifier	= PreventPosternGateFromShooting
	End
	Behavior = AudioLoopUpgrade ModuleTag_GateBuildLoop
		; Play a "build loop" while the garrison is building up
		TriggeredBy			= Upgrade_PosternGate
		ConflictsWith		= Upgrade_WallBanner Upgrade_OpenGarrison
		SoundToPlay			= BuildingConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 6166  ; Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
	End
	Behavior = StealthUpgrade ModuleTag_StealthUpgrade
		TriggeredBy			= Upgrade_PosternGate
		ConflictsWith		= Upgrade_WallBanner Upgrade_OpenGarrison
	End
	Behavior = TooltipUpgrade ModuleTag_PosternGateTooltip
		TriggeredBy				= Upgrade_PosternGate
		ConflictsWith			= Upgrade_WallBanner Upgrade_OpenGarrison
		DisplayName				= OBJECT:RohanPosternGate
		;Description			= OBJECT:RohanPosternGateDescription
	End


;	Behavior = HordeGarrisonContain GarrisonContainModuleTag
;		ContainMax              = 2
;		PassengerFilter			= ANY +INFANTRY +HORDE -CAVALRY
;		AllowAlliesInside       = Yes
;		AllowEnemiesInside      = Yes
;		ObjectStatusOfContained = UNSELECTABLE CAN_ATTACK
;		MaxHordeCapacity		= 2
;		EntryOffset				= X:0.0 Y:-45.0 Z:50.0
;		EntryOffset				= X:0.0 Y:0.0 Z:50.0
;		ExitOffset				= X:0.0 Y:0.0 Z:50.0
;		Enabled					= No
;		PassengerBonePrefix		= PassengerBone:Arrow_ KindOf:INFANTRY HORDE
;	End

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End

	Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
		TriggeredBy		= Upgrade_WallBanner
		ConflictsWith	= Upgrade_PosternGate Upgrade_OpenGarrison
		StartsActive	= No
		BonusName		= RohanWallPassiveLeadership
		RefreshDelay	= 1000
		;Range		= 120
		ObjectFilter	= ANY +INFANTRY +CAVALRY +MACHINE -IMMOBILE -HERO
	End	

	Behavior = CastleMemberBehavior ModuleTag_CMB
		StoreUpgradePrice = Yes ; We want to overload the refund price with any upgrades purchased.
		CountsForEvaCastleBreached = No  ; This is just the floating button
	End

	; Turned on for the postern gate upgrade.
	Behavior = StealthUpdate ModuleTag_Stealth
		StealthDelay                = 1000					; msec
		FriendlyOpacityMin          = 25.0%
		FriendlyOpacityMax          = 75.0%
		PulseFrequency              = 750				; msec
		DetectedByAnyoneRange		= 20.0
		DetectedByFriendliesOnly	= Yes
		InnateStealth               = Yes
		StartsActive				= No
	End

	KindOf					= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL WALL_UPGRADE CAN_ATTACK NOT_AUTOACQUIRABLE ;;;;;;;;;ATTACK_NEEDS_LINE_OF_SIGHT GARRISON
  RadarPriority = NOT_ON_RADAR
	CommandSet				= RohanCastleWallCommandSet
	KeepSelectableWhenDead	= Yes
  	VisionRange				= GONDOR_ARCHER_VISION_RANGE
	
	GeometryIsSmall					= No

	Geometry						= BOX
	GeometryMajorRadius				= 1.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 1.0
	GeometryName					= DummyGeom
	GeometryActive					= Yes

	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 28.0
	GeometryMinorRadius				= 20.0
	GeometryHeight					= 80.0
	GeometryOffset					= X:0.0 Y:-50.0 Z:0.0		; These structures are rotated 90, so 'y' is really the 'x' offset
	GeometryName					= TrebGeom
	GeometryActive					= No

	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 20.0
	GeometryMinorRadius				= 15.0
	GeometryHeight					= 133.0
	GeometryOffset					= X:0.0 Y:-38.0 Z:0.0		; These structures are rotated 90, so 'y' is really the 'x' offset
	GeometryName					= TowerGeom
	GeometryActive					= No

	Shadow							= SHADOW_VOLUME
	
	GeometryContactPoint	= X: 12.0	Y:-38.0	Z:133	Swoop
	GeometryContactPoint	= X:  0.0	Y:-38.0	Z:0
	GeometryContactPoint	= X:-12.0	Y:-38.0	Z:133	Swoop


End
