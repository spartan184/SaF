; Any SpecialPowers tied to the good spellbooks have a behavior put here.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;; GOOD SPELLS ;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Object GoodSpellBook
	EditorSorting                   = SYSTEM
    
	; *** ART Parameters ***
	Draw                            = W3DDefaultDraw ModuleTag_01
	;nothing
	End  ; Never drawn

  ; ------------------ [CAMERA SYSTEM] ------------------ ;
	; Borrowed with permission from the RJ-RotWK mod and adapted for BfME1;
	; we opted for a system where the mecanism is included in the full mod,
	; but enabled on a per map basis.
	
	Behavior                        = SpecialPowerModule ModuleTag_GeneralView
		SpecialPowerTemplate			    = SpellBookCameraSystem_GeneralView
		AvailableAtStart			        = Yes
	End

	Behavior                        = SpecialPowerModule ModuleTag_CommanderView
		SpecialPowerTemplate			    = SpellBookCameraSystem_CommanderView
		AvailableAtStart			        = Yes
	End

	Behavior                        = SpecialPowerModule ModuleTag_UnitView
		SpecialPowerTemplate			    = SpellBookCameraSystem_UnitView
		AvailableAtStart			        = Yes
	End

	Behavior                        = SpecialPowerModule ModuleTag_GroundView
		SpecialPowerTemplate			    = SpellBookCameraSystem_GroundView
		AvailableAtStart			        = Yes
	End

	Behavior                        = SpecialPowerModule ModuleTag_OverheadView
		SpecialPowerTemplate			    = SpellBookCameraSystem_OverheadView
		AvailableAtStart			        = Yes
	End
	; ------------------ [END OF CAMERA SYSTEM] ------------------ ;  
	
	; ------------------ [TEST POWERS] ------------------ ;
	; -- Reveal Entire Map
	Behavior                        = OCLSpecialPower ModuleTag_PalantirVisionTesting
		SpecialPowerTemplate          = SpellBookRevealMapTesting
		AttributeModifier             = PalantirVision ;
		AttributeModifierRange        = 1 ;
		AttributeModifierAffects      = NONE
		OCL                           = SpecialPowerRevealMapTesting
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart              = Yes
	End
	
	; -- Spawn Unit power
	Behavior                        = OCLSpecialPower ModuleTag_SummonUnits
		SpecialPowerTemplate          = TestSpellBookSpawnUnits
		OCL                           = OCL_SpawnTestingUnits
	  TriggerFX			 			          = FX_GenericGoodInitialSpawn
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart							= Yes
	End
	
	; -- Damage Units/Building power
	Behavior                        = OCLSpecialPower ModuleTag_DoDamage
		SpecialPowerTemplate          = TestSpellBookDoDamage
		OCL                           = OCL_SpawnTestingDamageWeapon
	  TriggerFX			 			          = FX_GenericGoodInitialSpawn
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart							= Yes
	End	
	
	; -- Grant Exp
	Behavior                        = OCLSpecialPower ModuleTag_GrantEXP
		SpecialPowerTemplate          = TestSpellBookGrantExp
		OCL                           = OCL_SpawnTestGrantExp
	  TriggerFX			 			          = FX_GenericGoodInitialSpawn
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart							= Yes
	End
	
	; ------------------ [END OF TEST POWERS] ------------------ ;  

	Behavior                        = CloudBreakSpecialPower	ModuleTag_CloudBreak_SP
		SpecialPowerTemplate			    = SpellBookCloudBreak_SP
    	SunbeamObject					      = CloudBreakSunbeam
		ObjectSpacing					        = 300
		AttributeModifier				      = SpellBookCloudBreak
		AttributeModifierAffects		  = ANY +INFANTRY +CAVALRY +MONSTER -HERO ENEMIES
		AttributeModifierRange			  = 999999
		
;		ReEnableAntiCategory			    = Yes ; cancel negative effects on good guys		
		AntiCategory					        = LEADERSHIP
;		AntiFX				                = FX_AntiLeadership ; FX for anti category
;		AttributeModifierWeatherBased	= Yes
		
		TargetAllSides				        = Yes
		AvailableAtStart				      = No
	End

	Behavior                        = CloudBreakSpecialPower	ModuleTag_CloudBreak_MP
		SpecialPowerTemplate			    = SpellBookCloudBreak_MP
    	SunbeamObject					      = CloudBreakSunbeam
		ObjectSpacing					        = 300
		AttributeModifier				      = SpellBookCloudBreak
		AttributeModifierAffects		  = ANY ENEMIES +INFANTRY +CAVALRY +MONSTER -HERO
		AttributeModifierRange			  = 999999
		
;		ReEnableAntiCategory			    = Yes ; cancel negative effects on good guys		
;		AntiCategory					        = LEADERSHIP
		AntiFX					              = FX_AntiLeadership ; FX for anti category	
;		AttributeModifierWeatherBased	= Yes			
		
		TargetAllSides					      = Yes
		AvailableAtStart				      = No
	End

	Behavior                        = ElvenWoodSpecialPower ModuleTag_ElvenWood
		SpecialPowerTemplate	        = SpellBookElvenWood
		ElvenGroveObject		          = ElvenGrove
		ElvenWoodRadius			          = 150
		ElvenWoodFX				            = FX_ElvenWoodSpellFX
		ElvenWoodOCL			            = OCL_ElvenWoodSeed
;		CreateLocation			          = CREATE_AT_LOCATION
		AvailableAtStart		          = No
	End


	Behavior                        = ElvenWoodSpecialPower ModuleTag_ElvenWoodRohan
		SpecialPowerTemplate	        = SpellBookElvenWoodRohan
		ElvenGroveObject		          = ElvenGrove
		ElvenWoodRadius			          = 150
		ElvenWoodFX				            = FX_ElvenWoodSpellFX
		ElvenWoodOCL			            = OCL_ElvenWoodSeed
;		CreateLocation			          = CREATE_AT_LOCATION
		AvailableAtStart		          = No
	End		
	
	Behavior                        = PlayerUpgradeSpecialPower	SpellBookElvenGifts_ModuleTag
		SpecialPowerTemplate		      = SpellBookElvenGifts
		UpgradeName 				          = Upgrade_ElvenGift
		UpdateModuleStartsAttack	    = No
		AffectAllies				          = No ; Should not try to affect ally units
		AvailableAtStart			        = No
	End

  Behavior                        = SpecialPowerModule	SpellBookDraft_Draft
		SpecialPowerTemplate		      = SpellBookDraft
		AttributeModifier			        = SpellBookDraft
		AttributeModifierRange		    = 999999
		AttributeModifierAffects	    = ANY +SWARM_DOZER
		AffectAllies				          = No ; Should not try to affect ally units
		;AttributeModifierFX		      = FX_Draft now in SubObjectsUpgrade in the unit
		UpdateModuleStartsAttack	    = No
		AttributeModifierFX			      = FX_PeasantVoiceDraftUpgrade	;voice only
		;InitiateSound				        = PeasantVoiceDraftUpgrade	;this didn't work
		AvailableAtStart			        = No
	End	

  Behavior                        = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate          = SpellBookHeal
		HealAffects			              = INFANTRY CAVALRY MONSTER MACHINE
		HealAmount			              = 0.8 ; 1.0	; 0.5 = 50% of maximum health
		HealRadius			              = M_SPELL_HEAL_RADIUS_UNIT_SCAN
		HealFX				                = FX_SpellHealUnitHealBuff		;FX_DefaultUnitHealBuff
		; To replenish hordes a bit
		HealOCL                       = OCL_HealSpellHordeReplenishPing
		AvailableAtStart	            = No
	End	

	; Behavior                      = PlayerUpgradeSpecialPower	ModuleTag_SpellBookAnduril
		; SpecialPowerTemplate		    = SpellBookAnduril
		; UpgradeName 				        = Upgrade_Anduril
		; UpdateModuleStartsAttack	  = No
		; AffectAllies				        = No ; Should not try to affect ally units
		; AvailableAtStart			      = No
	; End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonGondorian
		SpecialPowerTemplate          = SpellBookGondorian
		OCL                           = OCL_SpawnGondorians
	  TriggerFX			 			          = FX_GondorianSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonGreyCompany
		SpecialPowerTemplate          = SpellBookGreyCompany
		OCL                           = OCL_SpawnGreyCompanyEgg
	  TriggerFX			                = FX_GreyCompanySummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End

	Behavior                        = OCLSpecialPower ModuleTag_SummonGondorFieldoms
		SpecialPowerTemplate          = SpellBookFiefdomSummon
		OCL                           = OCL_SpawnFiefdomsEgg
	  TriggerFX			                = FX_FiefdomSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End

	Behavior                        = PlayerUpgradeSpecialPower	ModuleTag_SpellBookGandalfWhite
		SpecialPowerTemplate		      = SpellBookGandalftheWhite
		UpgradeName 				          = Upgrade_GandalfWhite
		UpdateModuleStartsAttack	    = No
		AffectAllies				          = No ; Should not try to affect ally units
		AvailableAtStart			        = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonElves
		SpecialPowerTemplate          = SpellBookElvenAllies
		OCL                           = OCL_SpawnElvenWarriorsEgg
	  TriggerFX			 	              = FX_ElvenAlliesSummon
		CreateLocation                = CREATE_AT_LOCATION
		UpgradeName			              = Upgrade_ElvenAllies
		AvailableAtStart	            = No
	End

	Behavior                        = OCLSpecialPower ModuleTag_SummonBeacon
		SpecialPowerTemplate          = SpellBookBeaconGondor
		OCL                           = OCL_SpawnBeaconGondor
    TriggerFX			                = FX_BeaconGondorSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonRohanHelmHammerhand
		SpecialPowerTemplate          = SpellBookRohanHelmHammerhand
		OCL                           = OCL_SpawnRohanHelmHammerhand
    TriggerFX			                = FX_RohanHelmHammerhandSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonRohan
		SpecialPowerTemplate          = SpellBookRohanAllies
		OCL                           = OCL_SpawnRohanRohirrimEgg
    TriggerFX			                = FX_RohirimSummon
		CreateLocation                = CREATE_AT_LOCATION
		UpgradeName			              = Upgrade_RohanAllies
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonEnts
		SpecialPowerTemplate          = SpellBookEntAllies
		OCL                           = OCL_SpawnEnts
    TriggerFX			                = FX_SummonEntAllies
		CreateLocation                = CREATE_AT_LOCATION
		UpgradeName			              = Upgrade_EntAllies
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonEagles
		SpecialPowerTemplate          = SpellBookEagleAllies
		OCL                           = OCL_SpawnEagles
		CreateLocation                = CREATE_ABOVE_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonDead
		SpecialPowerTemplate          = SpellBookArmyoftheDead
		OCL                           = OCL_GondorArmyofTheDeadEgg ;OCL_SpawnArmyOfTheDead
		TriggerFX			                = FX_SummonAOD
		CreateLocation		            = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	CommandSet                      = GoodSpellBookCommandSet
	RadarPriority                   = NOT_ON_RADAR
	KindOf                          = SPELL_BOOK IMMOBILE IGNORES_SELECT_ALL INERT
End

ChildObject RohanSpellBook GoodSpellBook
	CommandSet                      = RohanSpellBookCommandSet
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonThreeHunters
		SpecialPowerTemplate          = SpellBookThreeHunters
		OCL                           = OCL_SpawnThreeHuntersEgg
	  TriggerFX			              	= FX_ThreeHuntersSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End	
	
	Behavior                        = PlayerUpgradeSpecialPower	ModuleTag_SpellBookGandalfWhiteNew
		SpecialPowerTemplate		      = SpellBookGOTW
		UpgradeName 				          = Upgrade_GandalfWhite
		UpdateModuleStartsAttack	    = No
		AffectAllies				          = No ; Should not try to affect ally units
		AvailableAtStart			        = No
	End	
	
End

ChildObject GondorSpellBook GoodSpellBook
	CommandSet                      = GondorSpellBookCommandSet
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonGondorFieldomsMP
		SpecialPowerTemplate          = SpellBookFiefdomSummonMP
		OCL                           = OCL_SpawnFiefdomAlliesMP
	  TriggerFX			                = FX_ElvenAlliesSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = ProductionSpeedBonus ModuleTage_LandsKeptSafe
		SpecialPowerTemplate          = SpellBookLandsKeptSafe
		NumberOfFrames                = 180 ;1800
		SpeedMulitplier               = 20.0  ; 12x speedup BALANCE
		Type                          = GondorFighterHorde GondorArcherHorde GondorSpearmanHorde GondorKnightHorde GondorRangerHorde GondorTrebuchet GondorCitadelGuardHorde
		AvailableAtStart              = No
	End
	
	Behavior                        = PlayerUpgradeSpecialPower	ModuleTag_SpellBookKingElessar
		SpecialPowerTemplate		      = SpellBookKingElessar
		UpgradeName 				          = Upgrade_Anduril
		UpdateModuleStartsAttack	    = No
		AffectAllies				          = No ; Should not try to affect ally units
		AvailableAtStart			        = No
	End
End

ChildObject RivendellSpellBook GoodSpellBook
	CommandSet                      = RivendellSpellBookCommandSet
	
  Behavior                        = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate          = SpellBookRivendellHeal
		HealAffects			              = INFANTRY CAVALRY MONSTER MACHINE
		HealAmount			              = 0.8 ; 1.0	; 0.5 = 50% of maximum health
		HealRadius			              = M_SPELL_HEAL_RADIUS_UNIT_SCAN
		HealFX				                = FX_SpellHealUnitHealBuff
		HealOCL                       = OCL_HealSpellHordeReplenishPing
		AvailableAtStart	            = No
	End	
	
	Behavior                        = OCLSpecialPower ModuleTag_WisdomOfTheEldar
		SpecialPowerTemplate 		      = SpellBookWisdomOfTheEldar
		AttributeModifier    		      = WisdomOfEldarBonus
		AttributeModifierRange   	    = 100
		AttributeModifierAffects 	    = ANY +INFANTRY +CAVALRY +MACHINE +HERO -STRUCTURE -BASE_FOUNDATION
		OCL                  		      = SpecialPowerPalantirVision
		CreateLocation       		      = CREATE_AT_LOCATION
		AvailableAtStart     		      = No
  End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonManyMeetings
		SpecialPowerTemplate          = SpellBookManyMeetings
		OCL                           = OCL_ManyMeetings
		TriggerFX			                = FX_RohirimSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_OldKingdom
		SpecialPowerTemplate          = SpellBookOldKingdom
		OCL														= OCL_SpellbookRivendellRemnantsSeed
		TriggerFX											= FX_SpellbookRivendellRenmantsSummonFX
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SummonBreathOfManwe
		SpecialPowerTemplate          = SpellBookBreathOfManwe
		OCL                           = OCL_SpawnBreathOfManweEgg
		TriggerFX			                = FX_BreathOfManweSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
 	Behavior                        = OCLSpecialPower ModuleTag_BlessingOfUlmo
		SpecialPowerTemplate          = SpellBookBlessingOfUlmo
		OCL					                  = OCL_BlessingofUlmo
		CreateLocation		            = CREATE_CLOSEST_TO_SPAWN_POINT
		AvailableAtStart	            = No
	End
	
	Behavior                        = OCLSpecialPower ModuleTag_SpellbookSummonGreyPilgrim
		SpecialPowerTemplate          = SpellBookGreyPilgrim
		OCL                           = OCL_SpawnGreyPilgrim
		TriggerFX			                = FX_GreyPilgrimSummon
		CreateLocation                = CREATE_AT_LOCATION
		AvailableAtStart	            = No
	End
	
	Behavior                        = PlayerUpgradeSpecialPower ModuleTag_SpellBookRivendellLaurefindele
		SpecialPowerTemplate      	  = SpellBookLaurefindele
		UpgradeName 			  	        = Upgrade_GandalfWhite
		UpdateModuleStartsAttack	    = No
		AffectAllies				          = No ; Should not try to affect ally units
		AvailableAtStart			        = No
	End
End